!function(){var t,e=["127.0.0.1","localhost","chartiq.com"];if(t){var i=(new Date).getTime();if(t<=i)console.error("This license has expired!");else;}if(e&&e.length>2){for(var r=document.location.href,n=!1,a=0;a<e.length;a++)if(r.indexOf(e[a])>-1){n=!0;break}n||(alert("ERROR: Not licensed for domain "+r),console.error("ERROR: Not licensed for domain "+r))}}(),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():e(t)}(this,function(_exports){var __drawing_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing=function(){this.chartsOnly=!1,this.penDown=!1},e.Drawing.getDrawingParameters=function(t,i){var r;try{r=new e.Drawing[i]}catch(t){}if(!r)return null;r.stx=t,r.copyConfig();for(var n={},a=r.configs,s=0;s<a.length;s++)n[a[s]]=r[a[s]];return n},e.Drawing.prototype.copyConfig=function(){e.Drawing.copyConfig(this)},e.Drawing.copyConfig=function(t){for(var i=t.configs,r=0;r<i.length;r++){var n=i[r],a=t.stx.currentVectorParameters;"color"==n?t.color=a.currentColor:"parameters"==n?t.parameters=a.fibonacci:"font"==n?t.font=e.clone(a.annotation.font):t[n]=a[n]}},e.Drawing.prototype.dragToDraw=!1,e.Drawing.prototype.abort=function(t){},e.Drawing.prototype.measure=function(){},e.Drawing.prototype.construct=function(t,e){this.stx=t,this.panelName=e.name},e.Drawing.prototype.render=function(t){alert("must implement render function!")},e.Drawing.prototype.click=function(t,e,i){alert("must implement click function!")},e.Drawing.prototype.move=function(t,e,i){alert("must implement move function!")},e.Drawing.prototype.reposition=function(t,e,i,r){},e.Drawing.prototype.intersected=function(t,e,i){alert("must implement intersected function!")},e.Drawing.prototype.reconstruct=function(t,e){alert("must implement reconstruct function!")},e.Drawing.prototype.serialize=function(){alert("must implement serialize function!")},e.Drawing.prototype.adjust=function(){alert("must implement adjust function!")},e.Drawing.prototype.highlight=function(t){return t&&!this.highlighted?this.highlighted=t:!t&&this.highlighted&&(this.highlighted=t),this.highlighted},e.Drawing.prototype.littleCircleRadius=function(){return 6},e.Drawing.prototype.littleCircle=function(t,i,r,n){var a=this.stx.defaultColor,s=e.chooseForegroundColor(a);t.beginPath(),t.lineWidth=1,t.arc(i,r,this.littleCircleRadius(),0,2*Math.PI,!1),t.fillStyle=n?a:s,t.strokeStyle=a,t.fill(),t.stroke(),t.closePath()},e.Drawing.prototype.rotator=function(t,e,i,r){var n=this.littleCircleRadius(),a=this.stx.defaultColor;t.beginPath(),t.lineWidth=2,r||(t.globalAlpha=.5);var s=4+n;t.arc(e,i,s,0,3*Math.PI/2,!1),t.moveTo(e+2+s,i+2),t.lineTo(e+s,i),t.lineTo(e-2+s,i+2),t.moveTo(e-2,i+2-s),t.lineTo(e,i-s),t.lineTo(e-2,i-2-s),t.strokeStyle=a,t.stroke(),t.closePath(),t.globalAlpha=1},e.Drawing.prototype.mover=function(t,e,i,r){var n=this.littleCircleRadius(),a=this.stx.defaultColor,s=n+1;t.save(),t.lineWidth=2,t.strokeStyle=a,t.translate(e,i),r||(t.globalAlpha=.5);for(var o=0;o<4;o++)t.rotate(Math.PI/2),t.beginPath(),t.moveTo(0,s),t.lineTo(0,s+5),t.moveTo(-2,s+5-2),t.lineTo(0,s+5),t.lineTo(2,s+5-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()},e.Drawing.prototype.resizer=function(t,e,i,r){var n=this.littleCircleRadius(),a=this.stx.defaultColor,s=5*Math.sqrt(2),o=n+1;t.save(),t.lineWidth=2,t.strokeStyle=a,t.translate(e,i),t.rotate(-e*i/Math.abs(e*i)*Math.PI/4),r||(t.globalAlpha=.5);for(var l=0;l<2;l++)t.rotate(Math.PI),t.beginPath(),t.moveTo(0,o),t.lineTo(0,o+s),t.moveTo(-2,o+s-2),t.lineTo(0,o+s),t.lineTo(2,o+s-2),t.closePath(),t.stroke();t.globalAlpha=1,t.restore()},e.Drawing.prototype.pointIntersection=function(t,e,i){return!!this.stx.panels[this.panelName]&&t>=i.x0&&t<=i.x1&&e>=i.y1&&e<=i.y0},e.Drawing.prototype.setPoint=function(t,i,r,n){var a=null,s=null;"number"==typeof i?a=i:i.length>=8?s=i:a=Number(i),(r||0===r)&&(this["v"+t]=r);var o;if(null!==a)o=this.stx.dateFromTick(a,n,!0),this["tzo"+t]=o.getTimezoneOffset(),this["d"+t]=e.yyyymmddhhmmssmmm(o),this["p"+t]=[a,r];else if(null!==s){o=e.strToDateTime(s),this["tzo"+t]||0===this["tzo"+t]||(this["tzo"+t]=o.getTimezoneOffset()),this["d"+t]=s;var l=this["tzo"+t]-o.getTimezoneOffset();o.setMinutes(o.getMinutes()+l),this["p"+t]=[this.stx.tickFromDate(e.yyyymmddhhmmssmmm(o),n),r]}},e.Drawing.prototype.setLineColor=function(t){t||(t=this.color);var i=t;return("auto"==i||e.isTransparent(i))&&(i=this.stx.defaultColor),this.highlighted&&(i=this.stx.getCanvasColor("stx_highlight_vector")),i},e.Drawing.BaseTwoPoint=function(){this.p0=null,this.p1=null,this.color=""},e.Drawing.BaseTwoPoint.ciqInheritsFrom(e.Drawing),e.Drawing.BaseTwoPoint.prototype.configs=[],e.Drawing.BaseTwoPoint.prototype.lineIntersection=function(t,i,r,n){var a=this.p0,s=this.p1,o=this.stx.layout;return a&&s&&e.boxIntersects(r.x0,r.y0,r.x1,r.y1,a[0],a[1],s[0],s[1],n,o.semiLog||"log"==o.chartScale)},e.Drawing.BaseTwoPoint.prototype.boxIntersection=function(t,e){return!(!this.p0||!this.p1)&&(!(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))&&!(e>Math.max(this.p0[1],this.p1[1])||e<Math.min(this.p0[1],this.p1[1])))},e.Drawing.BaseTwoPoint.prototype.accidentalClick=function(t,e){var i=this.stx.panels[this.panelName],r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(t,i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,t,e),o=Math.abs(n-r),l=Math.abs(s-a);if(Math.sqrt(o*o+l*l)<10)return this.penDown=!1,this.dragToDraw&&this.stx.undo(),!0},e.Drawing.BaseTwoPoint.prototype.click=function(t,e,i){this.copyConfig();var r=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,r.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,r.chart),this.penDown=!0,!1)},e.Drawing.BaseTwoPoint.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart))},e.Drawing.BaseTwoPoint.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p1=[e,i],this.render(t))},e.Drawing.BaseTwoPoint.prototype.measure=function(){this.stx.setMeasure(this.p0[1],this.p1[1],this.p0[0],this.p1[0],!0,this.name)},e.Drawing.BaseTwoPoint.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i,s=e.value-r;"move"==e.action?(this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.setPoint(1,e.p1[0]-a,e.p1[1]-s,n.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,r],this.setPoint(0,this.p0[0],this.p0[1],n.chart),this.setPoint(1,this.p1[0],this.p1[1],n.chart),this.render(t))}},e.Drawing.annotation=function(){this.name="annotation",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={}},e.Drawing.annotation.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.annotation.prototype.getFontString=function(){this.fontDef={style:null,weight:null,size:"12px",family:null};var t=this.stx.canvasStyle("stx_annotation");t&&(t.fontStyle&&(this.fontDef.style=t.fontStyle),t.fontWeight&&(this.fontDef.weight=t.fontWeight),t.fontSize&&(this.fontDef.size=t.fontSize),t.fontFamily&&(this.fontDef.family=t.fontFamily)),this.font.style&&(this.fontDef.style=this.font.style),this.font.weight&&(this.fontDef.weight=this.font.weight),this.font.size&&(this.fontDef.size=this.font.size),this.font.family&&(this.fontDef.family=this.font.family),this.fontString="";var e=!0;for(var i in this.fontDef)this.fontDef[i]&&(e?e=!1:this.fontString+=" ",this.fontString+=this.fontDef[i])},e.Drawing.annotation.prototype.configs=["color","font"],e.Drawing.annotation.prototype.measure=function(){},e.Drawing.annotation.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]);t.font=this.fontString,t.textBaseline="top";var n=i,a=r,s=this.w,o=this.h,l=this.setLineColor();if(this.stem){var h,u,c,p;this.stem.d?(h=this.stx.pixelFromTick(this.stem.t),c=this.stx.pixelFromValueAdjusted(e,this.stem.t,this.stem.v),u=n+s/2,p=a+o/2):this.stem.x&&(h=n,c=a,n+=this.stem.x,a+=this.stem.y,u=n+s/2,p=a+o/2),t.beginPath(),this.borderColor?t.strokeStyle=this.borderColor:t.strokeStyle=l,t.moveTo(h,c),t.lineTo(u,p),t.stroke()}this.highlighted?(this.stx.canvasColor("stx_annotation_highlight_bg",t),t.fillRect(n,a,s,o)):this.fillColor?(t.fillStyle=this.fillColor,t.fillRect(n,a,s,o)):this.stem&&(t.fillStyle=this.stx.containerColor,t.fillRect(n,a,s,o)),this.borderColor&&(t.beginPath(),t.strokeStyle=this.borderColor,t.rect(n,a,s,o),t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=l,a+=this.padding;for(var d=0;d<this.arr.length;d++)t.fillText(this.arr[d],n+this.padding,a),a+=this.fontSize;t.textBaseline="alphabetic"}},e.Drawing.annotation.prototype.onChange=function(t){},e.Drawing.annotation.prototype.edit=function(t){function i(t){return function(i){if(i){switch(window.event?event.keyCode:i.keyCode){case 27:return void t.stx.undo()}}var r=t.stx,n=t.ta,a=r.controls.annotationSave,s=r.controls.annotationCancel,o=n.value.split("\n"),l=0;r.chart.context.font=t.fontString;for(var h=0;h<o.length;h++){var u=r.chart.context.measureText(o[h]).width;u>l&&(l=u)}var c=(o.length+1)*(t.fontSize+3);l<50&&(l=50),n.style.width=l+30+"px",n.style.height=c+"px";var p=parseInt(e.stripPX(n.style.top),10),d=e.stripPX(n.style.left);l=n.clientWidth,c=n.clientHeight,d+l+100<t.stx.chart.canvasWidth?(a.style.top=p+"px",s.style.top=p+"px",a.style.left=d+l+10+"px",s.style.left=d+l+60+"px"):p+c+30<t.stx.chart.canvasHeight?(a.style.top=p+c+10+"px",s.style.top=p+c+10+"px",a.style.left=d+"px",s.style.left=d+50+"px"):(a.style.top=p-35+"px",s.style.top=p-35+"px",a.style.left=d+"px",s.style.left=d+50+"px")}}var r=this.stx.panels[this.panelName];if(r){this.stx.editingAnnotation=!0,this.stx.undisplayCrosshairs(),this.stx.openDialog="annotation",this.ta||(this.ta=document.createElement("TEXTAREA"),this.ta.className="stx_annotation",this.ta.onkeyup=i(this),this.ta.onmouseup=function(t){return function(i){t.manageTouchAndMouse&&e.ChartEngine.drawingLine&&t.mouseup(i)}}(this.stx),this.ta.setAttribute("wrap","hard"),e.isIOS7or8&&this.ta.setAttribute("placeholder","Enter Text"),this.stx.chart.container.appendChild(this.ta),this.ta.style.position="absolute",this.ta.style.width="100px",this.ta.style.height="20px",e.ipad&&(this.ta.ontouchstart=function(t){t.stopPropagation()}));var n=this;if(this.ta.oninput=function(t){n.onChange(t)},this.ta.style.font=this.fontString,this.color)if("transparent"==this.color||"auto"==this.color){var a=getComputedStyle(this.ta);a&&e.isTransparent(a.backgroundColor)?this.ta.style.color=this.stx.defaultColor:this.ta.style.color="#000"}else this.ta.style.color=this.color;var s=this.stx.pixelFromTick(this.p0[0],r.chart),o=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]);if(this.ta.style.left=s+140<this.stx.chart.canvasRight?s+"px":this.stx.chart.canvasRight-200+"px",this.ta.style.top=o+60<this.stx.chart.canvasHeight?o+"px":o-60+"px","callout"==this.name&&(this.ta.style.left=s-(isNaN(this.w)?this.defaultWidth:this.w/2)+"px",this.ta.style.top=o-(isNaN(this.h)?this.defaultHeight:this.h/2)+"px"),this.stx.controls.annotationSave.style.display="inline-block",this.stx.controls.annotationCancel.style.display="inline-block",e.safeClickTouch(this.stx.controls.annotationSave,function(t){return function(e){""!==t.ta.value&&(t.stx.editingAnnotation=!1,t.text=t.ta.value,t.adjust(),t.stx.addDrawing(t),t.stx.changeOccurred("vector"),t.stx.undo(),t.stx.cancelTouchSingleClick=!0)}}(this)),e.safeClickTouch(this.stx.controls.annotationCancel,function(t){return function(e){t.stx.editingAnnotation=!1,t.stx.undo(),t.stx.cancelTouchSingleClick=!0}}(this)),i(this)(),this.ta.focus(),e.isAndroid&&!e.is_chrome){this.priorBottom=this.stx.chart.container.style.bottom;var l=this.stx.resolveY(o)+100;if(l>e.pageHeight()-400){var h=e.pageHeight()-l,u=400-h;this.stx.chart.container.style.bottom=u+"px"}}}},e.Drawing.annotation.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var r=this.stx.panels[this.panelName];return this.copyConfig(),this.setPoint(0,e,i,r.chart),this.adjust(),this.edit(t),!1}},e.Drawing.annotation.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i,s=e.value-r;this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.render(t)}},e.Drawing.annotation.prototype.intersected=function(t,i,r){var n=this.stx.panels[this.panelName];if(!this.p0)return null;var a=this.stx.pixelFromTick(this.p0[0],n.chart),s=this.stx.pixelFromValueAdjusted(n,this.p0[0],this.p0[1]),o=a+this.w,l=s+this.h;this.stem&&this.stem.x&&(a+=this.stem.x,o+=this.stem.x,s+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,n.chart),u=this.stx.pixelFromValueAdjusted(n,t,i);return h>=a&&h<=o&&u>=s&&u<=l&&(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.annotation.prototype.abort=function(){this.stx.controls.annotationSave.style.display="none",this.stx.controls.annotationCancel.style.display="none",this.ta&&this.stx.chart.container.removeChild(this.ta),this.ta=null,this.stx.openDialog="",this.stx.showCrosshairs(),this.stx.editingAnnotation=!1,e.clearCanvas(this.stx.chart.tempCanvas,this.stx),e.isAndroid&&!e.is_chrome&&(this.stx.chart.container.style.bottom=this.priorBottom),e.fixScreen()},e.Drawing.annotation.prototype.reconstruct=function(t,i){this.stx=t,this.color=i.col,this.panelName=i.pnl,this.d0=i.d0,this.tzo0=i.tzo0,this.v0=i.v0,this.text=t.escapeOnSerialize?decodeURIComponent(i.text):i.text,this.stem=i.stem,this.borderColor=i.bc,this.fillColor=i.bg,this.lineWidth=i.lw,this.pattern=i.ptrn,this.font=e.replaceFields(i.fnt,{st:"style",sz:"size",wt:"weight",fl:"family"}),this.font||(this.font={}),this.adjust()},e.Drawing.annotation.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,d0:this.d0,tzo0:this.tzo0,v0:this.v0,text:this.stx.escapeOnSerialize?encodeURIComponent(this.text):this.text};if(this.font){var i=e.removeNullValues(e.replaceFields(this.font,{style:"st",size:"sz",weight:"wt",family:"fl"}));e.isEmpty(i)||(t.fnt=i)}return this.stem&&(t.stem={d:this.stem.d,v:this.stem.v,x:this.stem.x,y:this.stem.y}),this.borderColor&&(t.bc=this.borderColor),this.fillColor&&(t.bg=this.fillColor),this.lineWidth&&(t.lw=this.lineWidth),this.pattern&&(t.ptrn=this.pattern),t},e.Drawing.annotation.prototype.adjust=function(){this.getFontString();var t=this.stx.panels[this.panelName];if(t){this.setPoint(0,this.d0,this.v0,t.chart),this.arr=this.text.split("\n");var i=0;this.stx.chart.context.font=this.fontString;for(var r=0;r<this.arr.length;r++){var n=this.stx.chart.context.measureText(this.arr[r]).width;n>i&&(i=n)}0===i&&(i=2*this.defaultWidth),this.fontSize=e.stripPX(this.fontDef.size);var a=this.arr.length*this.fontSize;e.touchDevice&&(a+=5),this.w=i+2*this.padding,this.h=a+2*this.padding;var s=this.stx.pixelFromTick(this.p0[0],t.chart)+i,o=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1])+a;this.p1=[this.stx.tickFromPixel(s,t.chart),this.stx.valueFromPixel(o,t)],this.stem&&this.stem.d&&(this.stem.t=this.stx.tickFromDate(this.stem.d,t.chart))}},e.Drawing.segment=function(){this.name="segment"},e.Drawing.segment.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.segment.prototype.render=function(t){var r=this.stx.panels[this.panelName];if(r){var n=this.stx.pixelFromTick(this.p0[0],r.chart),a=this.stx.pixelFromTick(this.p1[0],r.chart),s=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(r,this.p1[0],this.p1[1]),l=this.lineWidth,h=this.setLineColor(),u={pattern:this.pattern,lineWidth:l};if(this.stx.plotLine(n,a,s,o,h,this.name,t,r,u),this.axisLabel&&!this.highlighted)if("horizontal"==this.name){this.stx.endClip();var c=this.p0[1];r.chart.transformFunc&&(c=r.chart.transformFunc(this.stx,r.chart,c)),c=r.yAxis.priceFormatter?r.yAxis.priceFormatter(this.stx,r,c):this.stx.formatYAxisPrice(c,r),this.stx.createYAxisLabel(r,c,s,h),this.stx.startClip(r.name)}else if("vertical"==this.name&&this.p0[0]>=0&&!e.ChartEngine.hideDates()){var p,d;if(p=this.stx.dateFromTick(this.p0[0],r.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))p.setHours(0,0,0,0);else{var f=1e3*p.getSeconds()+p.getMilliseconds();this.stx.dataZone&&(d=new i.Date(p.getFullYear(),p.getMonth(),p.getDate(),p.getHours(),p.getMinutes(),this.stx.dataZone),p=new Date(d.getTime()+f)),this.stx.displayZone&&(d=new i.Date(p.getTime(),this.stx.displayZone),p=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()),p=new Date(p.getTime()+f))}var m=e.mmddhhmm(e.yyyymmddhhmm(p));if(r.chart.xAxis.formatter)m=r.chart.xAxis.formatter(p);else if(this.stx.internationalizer){var g;0!==p.getHours()||0!==p.getMinutes()?(g=this.stx.internationalizer.monthDay.format(p),g+=" "+this.stx.internationalizer.hourMinute.format(p)):g=this.stx.internationalizer.yearMonthDay.format(p),m=g}this.stx.endClip(),this.stx.createXAxisLabel(r,m,n,h,null,!0),this.stx.startClip(r.name)}if(this.highlighted&&"horizontal"!=this.name&&"vertical"!=this.name){var v="p0"==this.highlighted,y="p1"==this.highlighted;this.littleCircle(t,n,s,v),this.littleCircle(t,a,o,y)}}},e.Drawing.segment.prototype.abort=function(){this.stx.setMeasure(null,null,null,null,!1)},e.Drawing.segment.prototype.intersected=function(t,i,r){if(!this.p0||!this.p1)return null;if("horizontal"!=this.name&&"vertical"!=this.name&&"gartley"!=this.name){if(this.pointIntersection(this.p0[0],this.p0[1],r))return this.highlighted="p0",{action:"drag",point:"p0"};if(this.pointIntersection(this.p1[0],this.p1[1],r))return this.highlighted="p1",{action:"drag",point:"p1"}}return this.lineIntersection(t,i,r,this.name)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},e.Drawing.segment.prototype.configs=["color","lineWidth","pattern"],e.Drawing.segment.prototype.copyConfig=function(){e.Drawing.copyConfig(this),"none"==this.pattern&&(this.pattern="solid")},e.Drawing.segment.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.segment.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.continuous=function(){this.name="continuous",this.dragToDraw=!1,this.maxSegments=null},e.Drawing.continuous.ciqInheritsFrom(e.Drawing.segment),e.Drawing.continuous.prototype.click=function(t,i,r){var n=this.stx.panels[this.panelName];if(n){if(this.copyConfig(),!this.penDown)return this.setPoint(0,i,r,n.chart),this.penDown=!0,!1;if(this.accidentalClick(i,r))return this.stx.undo(),!0;this.setPoint(1,i,r,n.chart);var a=e.Drawing.segment,s=new a,o=this.serialize(this.stx);return s.reconstruct(this.stx,o),(this.stx.addDrawing(s),this.stx.changeOccurred("vector"),this.stx.draw(),this.segment++,this.maxSegments&&this.segment>this.maxSegments)?!0:(this.setPoint(0,i,r,n.chart),!1)}},e.Drawing.line=function(){this.name="line"},e.Drawing.line.prototype.dragToDraw=!1,e.Drawing.line.ciqInheritsFrom(e.Drawing.segment),e.Drawing.line.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]};i.x0>i.x1&&(i={x0:this.p1[0],y0:this.p1[1],x1:this.p0[0],y1:this.p0[1]});var r=i.x0-1e3,n=i.x1+1e3;this.v0B=e.yIntersection(i,r),this.v1B=e.yIntersection(i,n),this.d0B=this.stx.dateFromTick(r,t.chart),this.d1B=this.stx.dateFromTick(n,t.chart)}},e.Drawing.line.prototype.click=function(t,e,i){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?(this.setPoint(1,e,i,r.chart),this.calculateOuterSet(r),this.penDown=!1,!0):(this.setPoint(0,e,i,r.chart),this.penDown=!0,!1)},e.Drawing.line.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.v1=e.v1,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,e.d0B&&(this.d0B=e.d0B,this.d1B=e.d1B,this.v0B=e.v0B,this.v1B=e.v1B),this.adjust()},e.Drawing.line.prototype.serialize=function(){var t={name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return this.d0B&&(t.d0B=this.d0B,t.d1B=this.d1B,t.v0B=this.v0B,t.v1B=this.v1B),t},e.Drawing.line.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&(this.setPoint(0,this.d0B,this.v0B,t.chart),this.setPoint(1,this.d1B,this.v1B,t.chart)))},e.Drawing.ray=function(){this.name="ray"},e.Drawing.ray.ciqInheritsFrom(e.Drawing.line),e.Drawing.ray.prototype.calculateOuterSet=function(t){if(this.p0[0]!=this.p1[0]&&this.p0[1]!=this.p1[1]&&!e.ChartEngine.isDailyInterval(this.stx.layout.interval)){var i={x0:this.p0[0],y0:this.p0[1],x1:this.p1[0],y1:this.p1[1]},r=i.x1+1e3;i.x0>i.x1&&(r=i.x1-1e3),this.v0B=this.v0,this.v1B=e.yIntersection(i,r),this.d0B=this.d0,this.d1B=this.stx.dateFromTick(r,t.chart)}},e.Drawing.ray.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),e.ChartEngine.isDailyInterval(this.stx.layout.interval)&&this.d0B&&this.setPoint(1,this.d1B,this.v1B,t.chart))},e.Drawing.horizontal=function(){this.name="horizontal"},e.Drawing.horizontal.prototype.dragToDraw=!1,e.Drawing.horizontal.ciqInheritsFrom(e.Drawing.segment),e.Drawing.horizontal.prototype.measure=function(){},e.Drawing.horizontal.prototype.click=function(t,e,i){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.setPoint(0,e,i,r.chart),!0},e.Drawing.horizontal.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.v0=e.v0,this.d0=e.d0,this.tzo0=e.tzo0,this.axisLabel=e.al,this.adjust()},e.Drawing.horizontal.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,v0:this.v0,d0:this.d0,tzo0:this.tzo0,al:this.axisLabel}},e.Drawing.horizontal.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0]+100,this.p0[1]])},e.Drawing.horizontal.prototype.configs=["color","lineWidth","pattern","axisLabel"],e.Drawing.horizontal.prototype.copyConfig=function(){e.Drawing.copyConfig(this),"none"==this.pattern&&(this.pattern="solid")},e.Drawing.vertical=function(){this.name="vertical"},e.Drawing.vertical.ciqInheritsFrom(e.Drawing.horizontal),e.Drawing.vertical.prototype.measure=function(){},e.Drawing.vertical.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=[this.p0[0],this.p0[1]+1])},e.Drawing.measure=function(){this.name="measure"},e.Drawing.measure.ciqInheritsFrom(e.Drawing.segment),e.Drawing.measure.prototype.click=function(t,e,i){return this.copyConfig(),this.penDown?(this.stx.undo(),this.penDown=!1,!0):(this.p0=[e,i],this.penDown=!0,!1)},e.Drawing.rectangle=function(){this.name="rectangle"},e.Drawing.rectangle.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.rectangle.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=Math.round(Math.min(r,n))+.5,l=Math.min(a,s),h=Math.max(r,n)-o,u=Math.max(a,s)-l,c=this.color;this.highlighted&&(c=this.stx.getCanvasColor("stx_highlight_vector"));var p=this.fillColor;p&&!e.isTransparent(p)&&"auto"!=p&&(t.beginPath(),t.rect(o,l,h,u),t.fillStyle=p,t.globalAlpha=.2,t.fill(),t.closePath(),t.globalAlpha=1);var d={pattern:this.pattern,lineWidth:this.lineWidth};if(this.highlighted&&"none"==d.pattern&&(d.pattern="solid",.1==d.lineWidth&&(d.lineWidth=1)),this.stx.plotLine(r,n,a,a,c,"segment",t,i,d),this.stx.plotLine(n,n,a-.5,s+.5,c,"segment",t,i,d),this.stx.plotLine(n,r,s,s,c,"segment",t,i,d),this.stx.plotLine(r,r,s+.5,a-.5,c,"segment",t,i,d),this.highlighted){var f="p0"==this.highlighted,m="p1"==this.highlighted;this.littleCircle(t,r,a,f),this.littleCircle(t,n,s,m)}}},e.Drawing.rectangle.prototype.intersected=function(t,i,r){return this.p0&&this.p1?this.pointIntersection(this.p0[0],this.p0[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.boxIntersection(t,i)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null:null},e.Drawing.rectangle.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.rectangle.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.rectangle.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.ellipse=function(){this.name="ellipse"},e.Drawing.ellipse.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.ellipse.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=r-(n-r),l=n,h=a,u=s,c=a-(s-a),p=(u-c)/6,d=this.lineWidth;d||(d=1.1);var f=this.color;("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor),this.highlighted&&(f=this.stx.getCanvasColor("stx_highlight_vector"),.1==d&&(d=1.1));var m=this.fillColor;if(t.beginPath(),t.moveTo(o,h),t.bezierCurveTo(o,u+p,l,u+p,l,h),t.bezierCurveTo(l,c-p,o,c-p,o,h),m&&!e.isTransparent(m)&&"auto"!=m&&(t.fillStyle=m,t.globalAlpha=.2,t.fill(),t.globalAlpha=1),f&&"none"!=this.pattern&&(t.strokeStyle=f,t.lineWidth=d,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(d,this.pattern)),t.lineDashOffset=0),t.stroke()),t.closePath(),this.highlighted){var g="p1"==this.highlighted;this.littleCircle(t,n,s,g)}}},e.Drawing.ellipse.prototype.intersected=function(t,i,r){if(!this.p0||!this.p1)return null;if(this.pointIntersection(this.p1[0],this.p1[1],r))return this.highlighted="p1",{action:"drag",point:"p1"};var n=this.p0[0]-(this.p1[0]-this.p0[0]),a=this.p1[0],s=this.p1[1],o=this.p0[1]-(this.p1[1]-this.p0[1]);return!(t>Math.max(n,a)||t<Math.min(n,a))&&(!(i>Math.max(o,s)||i<Math.min(o,s))&&(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}))},e.Drawing.ellipse.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.ellipse.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},e.Drawing.ellipse.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}},e.Drawing.fibonacci=function(){this.name="fibonacci",this.configurator="fibonacci"},e.Drawing.fibonacci.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.fibonacci.mapping={trend:"t",color:"c",parameters:"p",pattern:"pt",opacity:"o",lineWidth:"lw",level:"l",extendLeft:"e",printLevels:"pl",printValues:"pv",timezone:"tz"},e.Drawing.fibonacci.prototype.configs=["color","fillColor","lineWidth","pattern","parameters"],e.Drawing.fibonacci.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var t=this.p0[1],i=this.p1[1],r=this.p0[0],n=this.p1[0],a=0,s=1,o=0;o<this.parameters.fibs.length;o++){var l=this.parameters.fibs[o];if(!(l.level>=a&&l.level<=s)&&l.display){var h=i-(i-t)*l.level,u=e.xIntersection({x0:r,x1:n,y0:t,y1:i},h);l.level<a?(a=l.level,this.outer.p1[1]=h,this.outer.p1[0]=u):l.level>s&&(s=l.level,this.outer.p0[1]=h,this.outer.p0[0]=u)}}},e.Drawing.fibonacci.prototype.click=function(t,i,r){var n=this.stx.panels[this.panelName];if(n)return this.copyConfig(),this.penDown?this.accidentalClick(i,r)?this.dragToDraw:(this.setPoint(1,i,r,n.chart),this.setOuter(),this.parameters=e.clone(this.parameters),this.penDown=!1,!0):(this.setPoint(0,i,r,n.chart),this.penDown=!0,!1)},e.Drawing.fibonacci.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=i.yAxis;if(this.p1){var n=Math.max(this.p0[1],this.p1[1]),a=Math.min(this.p0[1],this.p1[1]),s=n-a,o=this.stx.pixelFromTick(this.p0[0],i.chart),l=this.stx.pixelFromTick(this.p1[0],i.chart),h=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),u=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),c=Math.min(u,h),p=Math.max(u,h),d=p-c,f=(u-h)/(l-o)>0,m={color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}};this.parameters.trend||(this.parameters.trend=m);var g=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var v=t.measureText("161.8%").width+10,y=Number.MAX_VALUE,x=Number.MAX_VALUE,C=-1*Number.MAX_VALUE,S=-1*Number.MAX_VALUE,w=this.color;("auto"==w||e.isTransparent(w))&&(w=this.stx.defaultColor);for(var D=0;D<this.parameters.fibs.length;D++){t.textAlign="left",t.fillStyle=w;var b=this.parameters.fibs[D];if(b.display){var T=this.stx.pixelFromValueAdjusted(i,this.p0[0],u<h?n-s*b.level:a+s*b.level),M=e.xIntersection({x0:o,x1:l,y0:h,y1:u},T),k=this.parameters.extendLeft?0:M,A=this.stx.chart.left+this.stx.chart.width;if(this.parameters.printLevels){var P=Math.round(1e3*b.level)/10+"%";A-=v,this.parameters.printValues&&(t.fillStyle=w,this.stx.canvasFont("stx_yaxis",t)),A<k&&(t.textAlign="right"),t.fillText(P,A,T),A<k?A+=5:A-=5}if(this.parameters.printValues&&M<this.stx.chart.width){var _=this.stx.transformedPriceFromPixel(T,i);_=r.priceFormatter?r.priceFormatter(this.stx,i,_):this.stx.formatYAxisPrice(_,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,_,T,w,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var F=b.color;("auto"==F||e.isTransparent(F))&&(F=this.color),("auto"==F||e.isTransparent(F))&&(F=this.stx.defaultColor);var E=b.color;("auto"==E||e.isTransparent(E))&&(E=this.fillColor),("auto"==E||e.isTransparent(E))&&(E=this.stx.defaultColor),t.fillStyle=E,this.stx.plotLine(k,A,T,T,F,"segment",t,i,b.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(A,T),t.lineTo(k,T),k?t.lineTo(l,u):t.lineTo(k,u),t.lineTo(A,u),void 0!==E&&t.fill(),t.globalAlpha=1,T<x&&(y=M,x=T),T>S&&(C=M,S=T)}}for(var L in{0:0,1:1}){var N=f?p-d*L:c+d*L;N=Math.round(N),N<x&&(y=e.xIntersection({x0:o,x1:l,y0:h,y1:u},N),x=N),N>S&&(C=e.xIntersection({x0:o,x1:l,y0:h,y1:u},N),S=N)}if(this.stx.plotLine(y,C,x,S,g,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var O="p0"==this.highlighted,I="p1"==this.highlighted;this.littleCircle(t,o,h,O),this.littleCircle(t,l,u,I)}}}},e.Drawing.fibonacci.prototype.reposition=function(t,i,r,n){i&&(e.Drawing.BaseTwoPoint.prototype.reposition.apply(this,arguments),this.adjust())},e.Drawing.fibonacci.prototype.intersected=function(t,i,r){var n=this.p0,a=this.p1,s=this.outer,o=this.stx.layout
;return n&&a&&e.boxIntersects(r.x0,r.y0,r.x1,r.y1,s.p0[0],s.p0[1],s.p1[0],s.p1[1],"segment",o.semiLog||"log"==o.chartScale)?this.pointIntersection(n[0],n[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(a[0],a[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):(this.highlighted=!0,{action:"move",p0:e.clone(n),p1:e.clone(a),tick:t,value:i}):null},e.Drawing.fibonacci.prototype.reconstruct=function(t,i){i=e.replaceFields(i,e.reverseObject(e.Drawing.fibonacci.mapping)),this.stx=t,this.parameters=i.parameters,this.parameters||(this.parameters=e.clone(this.stx.currentVectorParameters.fibonacci)),this.color=i.col,this.fillColor=i.fc,this.panelName=i.pnl,this.d0=i.d0,this.d1=i.d1,this.tzo0=i.tzo0,this.tzo1=i.tzo1,this.v0=i.v0,this.v1=i.v1,this.adjust()},e.Drawing.fibonacci.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setOuter())},e.Drawing.fibonacci.prototype.serialize=function(){var t={name:this.name,parameters:this.parameters,pnl:this.panelName,col:this.color,fc:this.fillColor,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1};return e.replaceFields(t,e.Drawing.fibonacci.mapping)},e.Drawing.retracement=function(){this.name="retracement"},e.Drawing.retracement.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.getDrawingToolList=function(t){var i={},r={ciqInheritsFrom:!0,stxInheritsFrom:!0,copyConfig:!0,getDrawingParameters:!0,getDrawingToolList:!0,BaseTwoPoint:!0,shape:!0};e.extend(r,t);for(var n in e.Drawing)r[n]||(i[(new e.Drawing[n]).name]=n);return i},t},__i18n_=function(t){var e=t.CIQ,i=t.$$;return e.I18N=function(){},e.I18N.hereDoc=function(t){return t.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},e.I18N.language="en",e.I18N.longMonths={zh:!0},e.I18N.reverseColorsByLocale={zh:!0,ja:!0},e.I18N.findAllTextNodes=function(t){if(t||(t=document.body),t==document.body&&!i("stashedTextNodes")){var r=document.createElement("div");r.id="stashedTextNodes",r.style.display="none",t.appendChild(r);for(var n=document.querySelectorAll("input,textarea,.editable_content"),a=0;a<n.length;a++){var s=n[a].getAttribute("placeholder");if(s){var o=r.appendChild(document.createElement("translate"));o.setAttribute("original",s),o.placeholderFor=n[a],o.appendChild(document.createTextNode(s))}}}for(var l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),h=l.nextNode(),u=new RegExp("^\\s*$"),c=new RegExp("\n|\t|\f","g"),p={},d={SCRIPT:!0,STYLE:!0};h;){var f=h.nodeValue;if(!u.test(f)){var m=h.parentNode,g=m.tagName;if(!d[g]){if("TRANSLATE"!=g){var v=m.insertBefore(document.createElement("translate"),h);v.setAttribute("original",f),v.appendChild(h)}else f=m.getAttribute("original");c.test(f)&&(f=f.replace(c,"")),p[f]||(p[f]=[]),p[f].push(h)}}h=l.nextNode()}if(t==document.body){var y=e.Studies?e.Studies.studyLibrary:null;if(y)for(var x in y){null===p[x]&&(p[x]=[]);var C=y[x];if(C.inputs)for(var S in C.inputs)p[S]||(p[S]=[]);if(C.outputs)for(var w in C.outputs)p[w]||(p[w]=[])}}return p},e.I18N.missingWordList=function(t){t||(t=e.I18N.language);var i=e.I18N.findAllTextNodes(),r={},n=e.I18N.wordLists[t];n||(n={});var a=function(t){void 0===n[t]&&(r[t]="")};for(var s in i)a(s);if(!e.Studies||!e.Studies.studyLibrary)return r;var o,l;for(var h in e.Studies.studyLibrary){o=e.Studies.studyLibrary[h],a(o.name);for(var u in o.inputs)switch(a(u),l=o.inputs[u],Object.prototype.toString.call(l)){case"[object String]":a(l);break;case"[object Array]":for(var c=0;c<l.length;++c)a(l[c])}for(var p in o.outputs)a(p)}return a("Show Zones"),a("OverBought"),a("OverSold"),r},e.I18N.printableMissingWordList=function(t){var i=JSON.stringify(e.I18N.missingWordList(t));return i=i.replace(/","/g,'",\n"')},e.I18N.translateUI=function(t,i){if("pu"==t&&(t="pt"),e.I18N.wordLists){t||(t=e.I18N.language);var r=e.I18N.findAllTextNodes(i),n=e.I18N.wordLists[t];if(n)for(var a in r)for(var s=e.I18N.translateSections(a,n),o=r[a],l=0;l<o.length;l++){var h=o[l],u=h.parentNode,c=u.getAttribute("original");","!==s&&s||(s=c);var p=u.placeholderFor;p?p.placeholder=s:h.data=s}}},e.I18N.translate=function(t,i){if(i||(i=e.I18N.language),!e.I18N.wordLists)return console.log("Must include translations.js in order to use CIQ.I18N.translate()"),t;var r=e.I18N.wordLists[i],n=null;return r&&(n=e.I18N.translateSections(t,r)||t),","===n?t:n},e.I18N.translateSections=function(t,e){if(t&&-1!=t.indexOf("‌")){t=t.replace(/([(),])/g,"‌$1‌");var i=t.split("‌");return i.forEach(function(t,i,r){var n=t.match(/^(\s*).*\S(\s*)$/),a=e[t.trim()];a&&(n&&(a=n[1]+a+n[2]),r[i]=a)}),i.join("")}return e[t]},e.I18N.convertCSV=function(t){var i=new RegExp("[“”]|[‘’]","g"),r=new RegExp('"',"g"),n=e.I18N.wordLists;t||(t=e.I18N.csv);for(var a=t.split("\n"),s=a[0],o=s.split(","),l=0;l<o.length;l++){var h=o[l];n[h]||(n[h]={})}for(var u=1;u<a.length;u++){var c=a[u].match(/(".*?"|[^",]+)(?=\s*,|\s*$)|(,(?=,))/g)||[],p=c[0];r.test(p)&&(p=p.replace(r,"")),i.test(p)&&(p=p.replace(i,'"'));for(var d=1;d<c.length;d++)n[o[d]][p]=c[d]}},e.I18N.setLanguage=function(t,i,r,n,a){"pu"==i&&(i="pt"),e.I18N.convertCSV(n),e.I18N.language=i,e.I18N.translateUI(i,a),r||(r=e.I18N.translate),t.translationCallback=r},e.I18N.setLocale=function(t,e,i,r,n){if(!Intl.__addLocaleData)return t.setLocale(e,n),void(i&&i(null));r=void 0===r?"locale-data/jsonp":r;var a=r+"/"+e+".js",s=document.createElement("SCRIPT");s.async=!0,s.src=a;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(s,o.nextSibling),s.onload=function(){t.setLocale(e,n),i&&i(null)},s.onerror=function(){i&&i("cannot load script")}},e.I18N.createMonthArrays=function(t,i,r){t.monthAbv=[],t.monthLetters=[];var n=new Date,a=!0;e.I18N.longMonths&&e.I18N.longMonths[r]&&(a=!1);for(var s=0;s<12;s++){n.setDate(1),n.setMonth(s);var o=i.format(n);if(a){for(var l="",h=0;h<o.length;h++){var u=o.charAt(h);u.charCodeAt(0)<65||(l+=u)}t.monthAbv[s]=l,t.monthLetters[s]=l[0]}else t.monthAbv[s]=o,t.monthLetters[s]=o}},e.I18N.localize=function(t,e){var i=t.locale,r=this.reverseColorsByLocale[e],n=this.reverseColorsByLocale[i];this.setLocale(t,e),this.setLanguage(t,e),r&&n||(r||n)&&this.reverseCandles(t)},e.I18N.reverseCandles=function(t){var e=t.styles,i=t.cloneStyle(e.stx_candle_down),r=t.cloneStyle(e.stx_candle_up);e.stx_candle_up=i,e.stx_candle_down=r},t},__markers_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.makeMarkerHelper=function(){this.markerHelper={chartMap:{},classMap:{}}},e.ChartEngine.prototype.addToHolder=function(t){var i=this.panels[t.params.panelName];if(i){e.derivedFrom(t.params.node,e.Marker.NodeCreator)?(t.stxNodeCreator=t.params.node,t.node=t.stxNodeCreator.node):t.node=t.params.node,this.markerHelper||this.makeMarkerHelper(),t.params.chartContainer?this.container.appendChild(t.node):t.params.includeAxis?i.holder.appendChild(t.node):i.subholder.appendChild(t.node);var r=t.params.label;this.markers[r]||(this.markers[r]=[]),this.markers[r].push(t),t.chart=i.chart,this.markerHelper.chartMap[t.chart.name]||(this.markerHelper.chartMap[t.chart.name]={dataSetLength:0,markers:[]}),this.markerHelper.chartMap[t.chart.name].markers.push(t),t.className||console.log("Marker objects must have a member className");var n=this.markerHelper.classMap[t.className];n||(n=this.markerHelper.classMap[t.className]={}),n[t.params.panelName]||(n[t.params.panelName]=[]),n[t.params.panelName].push(t),this.setMarkerTick(t)}},e.ChartEngine.prototype.getMarkerArray=function(t,e){var i=[];for(var r in this.markers)for(var n=0;n<this.markers[r].length;n++){var a=this.markers[r][n];"panelName"==t?a.params.panelName==e&&i.push(a):"label"==t?r==e&&i.push(a):"all"==t&&i.push(a)}return i},e.ChartEngine.prototype.removeFromHolder=function(t){var e=this.panels[t.params.panelName];e&&(t.node.parentNode==e.holder?e.holder.removeChild(t.node):t.node.parentNode==e.subholder?e.subholder.removeChild(t.node):t.node.parentNode==this.container&&this.container.removeChild(t.node));var i=this.markers[t.params.label];if(i){var r;for(r=0;r<i.length;r++)if(i[r]===t){i.splice(r,1);break}var n=this.markerHelper.chartMap[t.chart.name];if(n)for(r=0;r<n.markers.length;r++)if(n.markers[r]===t){n.markers.splice(r,1);break}var a=this.markerHelper.classMap[t.className];if(a){var s=a[t.params.panelName];if(s)for(r=0;r<s.length;r++)if(s[r]===t){s.splice(r,1);break}}}},e.ChartEngine.prototype.moveMarkers=function(t,e){for(var i=this.getMarkerArray("panelName",t),r=0;r<i.length;r++)i[r].params.panelName=e;for(var n in this.markerHelper.classMap){var a=this.markerHelper.classMap[n][t];a&&(this.markerHelper.classMap[n][e]=a,delete this.markerHelper.classMap[n][t])}},e.ChartEngine.prototype.establishMarkerTicks=function(){this.markerHelper||this.makeMarkerHelper();var t=this.markerHelper.chartMap;for(var e in t){var i=t[e];if(i.dataSetLength!=this.charts[e].dataSet.length)for(var r=0;r<i.markers.length;r++)this.setMarkerTick(i.markers[r])}},e.ChartEngine.prototype.futureTickIfDisplayed=function(t){var e=t.chart;if(!(e.dataSet.length<1)){var i=e.xaxis[e.xaxis.length-1].DT;if(i=new Date(i.getTime()-6e4*this.timeZoneOffset),!(t.params.x>i))for(var r,n,a=e.maxTicks-e.dataSegment.length,s=e.dataSet.length+a,o=new Date(+e.dataSet[e.dataSet.length-1].DT),l=this.standardMarketIterator(o,null,e),h=t.params.x.getTime(),u=e.dataSet.length;u<s;u++){if(r=o.getTime(),o=l.next(),(n=o.getTime())==h)return void(t.tick=u);if(n>h&&r<h)return void(t.tick=Math.max(u-1,0))}}},e.ChartEngine.prototype.setMarkerTick=function(t){var e=t.chart;if("master"==t.params.xPositioner&&t.params.x)return void(t.tick=Math.floor(t.params.x/this.layout.periodicity));if("date"==t.params.xPositioner&&t.params.x){for(var i,r,n=t.params.x.getTime(),a=0;a<e.dataSet.length;a++){if(r=e.dataSet[a].DT.getTime(),i=r,a>0&&(i=e.dataSet[a-1].DT.getTime()),r==n)return void(t.tick=a);if(r>n&&i<n)return void(t.tick=Math.max(a-1,0));if(n<r)return void(t.tick=null)}if(e.dataSet.length<1)return;new Date(+e.dataSet[a-1].DT).getTime()<n&&(t.params.future=!0),t.tick=null}},e.ChartEngine.prototype.positionMarkers=function(){function t(){if(!e.runPrepend("positionMarkers",arguments)){e.markerTimeout=null;for(var t in e.markerHelper.classMap)for(var i in e.markerHelper.classMap[t]){var r=e.markerHelper.classMap[t][i],n=e.panels[i];if(r.length){var a={stx:e,arr:r,panel:n};a.firstTick=n.chart.dataSet.length-n.chart.scroll,a.lastTick=a.firstTick+n.chart.dataSegment.length;var s=r[0].constructor.placementFunction;s?s(a):e.defaultMarkerPlacement(a)}}e.runAppend("positionMarkers",arguments)}}var e=this;e.markerHelper&&(this.markerDelay||0===this.markerDelay?this.markerTimeout||(this.markerTimeout=setTimeout(t,this.markerDelay)):t())},e.Marker=function(t){if(this.params={xPositioner:"date",yPositioner:"value",panelName:"chart",permanent:!1,label:"generic",includeAxis:!1},e.extend(this.params,t),this.params.node||(this.params.node=document.createElement("DIV")),!this.params.stx)return void console.log("Marker created without specifying stx");this.className||(this.className="CIQ.Marker"),this.params.stx.addToHolder(this)},e.Marker.prototype.remove=function(){this.params.stx.removeFromHolder(this)},e.Marker.prototype.render=function(){var t=[this],e={stx:this.params.stx,arr:t,panel:this.params.stx.panels[this.params.panelName],showClass:this.showClass};this.constructor.placementFunction(e)},e.Marker.removeByLabel=function(t,e){for(var i=t.getMarkerArray("label",e),r=0;r<i.length;r++)t.removeFromHolder(i[r])},e.ChartEngine.prototype.getBarBounds=function(t){var e,i=(this.layout.chartType,this.layout.aggregationType);return e="pandf"==i?{high:Math.max(t.pfOpen,t.pfClose),low:Math.min(t.pfOpen,t.pfClose)}:{high:t.High,low:t.Low},t.markerHigh&&(e.high=markerHigh),t.markerLow&&(e.low=markerLow),e},e.ChartEngine.prototype.defaultMarkerPlacement=function(t){var e=t.panel,i=t.yAxis?t.yAxis:t.panel.yAxis,r=e.chart,n=t.stx,a=n.highLowBars[n.layout.chartType],s=r.defaultPlotField;s&&!a||(s="Close");for(var o={},l=0;l<t.arr.length;l++){var h=t.arr[l],u=h.params,c=h.node;h.clientWidth||(h.clientWidth=c.clientWidth),h.clientHeight||(h.clientHeight=c.clientHeight);var p=null,d=u.xPositioner,f=u.yPositioner,m=h.tick,g=r.dataSet,v=h.clientWidth;if("none"!=d){if("bar"==d&&u.x){if(u.x<r.xaxis.length){var y=r.xaxis[u.x];y&&(p=y.data)}c.style.left=Math.round(n.pixelFromBar(u.x,r)-v/2)+1+"px"}else{if(!m&&0!==m){if(!(u.future&&r.scroll<r.maxTicks)){c.style.left="-1000px";continue}if(n.futureTickIfDisplayed(h),!(m=h.tick)&&0!==m){c.style.left="-1000px";continue}}if(m<g.length&&(p=g[m]),m<t.firstTick&&h.rightEdge<0)continue;h.leftpx=Math.round(n.pixelFromTick(m,r)-r.left-v/2),h.rightEdge=h.leftpx+v,c.style.left=h.leftpx+"px"}p||(p=g[g.length-1])}else if(f.indexOf("candle")>-1&&(left=getComputedStyle(c).left,left)){var x=n.barFromPixel(parseInt(left,10),r);x>=0&&((p=r.xaxis[x].data)||(p=g[g.length-1]))}var C,S=u.y,w=c.clientHeight;if("none"!=f){var D=u.chartContainer?n.height:e.yAxis.bottom,b=0,T=0;void 0===o[c.style.left]&&(o[c.style.left]=0),T=o[c.style.left],o[c.style.left]+=w,"value"==f&&S?b=Math.round(D-n.pixelFromPrice(S,e,i)-w/2)+"px":"under_candle"==f&&p?(C=p[s],a&&(C=n.getBarBounds(p).low),b=Math.round(D-n.pixelFromPrice(C,e,i)-w-T)+"px"):"on_candle"==f&&p?(C=p[s],a&&(C=(p.Low+p.High)/2),b=Math.round(D-n.pixelFromPrice(C,e,i)-w/2-T)+"px"):"top"==f?b=Math.round(D-w-T)+"px":"bottom"==f?b=Math.round(T)+"px":p&&(C=p[s],a&&(C=n.getBarBounds(p).high),b=Math.round(D-n.pixelFromPrice(C,e,i)+T)+"px"),c.style.bottom!=b&&(c.style.bottom=b)}}},e.Marker.NodeCreator=function(){},e.Marker.NodeCreator.toNode=function(){return this.node},e.Marker.Simple=function(t){var i=this.node=document.createElement("div");i.className="stx-marker",e.appendClassName(i,t.type),t.category&&e.appendClassName(i,t.category);var r=e.newChild(i,"div","stx-visual");e.newChild(i,"div","stx-stem");var n;if("callout"==t.type){var a=e.newChild(r,"div","stx-marker-content");e.newChild(a,"h4",null,t.headline),n=e.newChild(a,"div","stx-marker-expand"),e.newChild(n,"p",null,t.story)}else n=e.newChild(i,"div","stx-marker-expand"),e.newChild(n,"h4",null,t.headline),e.newChild(n,"p",null,t.story),e.safeClickTouch(n,function(t){e.toggleClassName(i,"highlight")});e.safeClickTouch(r,function(t){e.toggleClassName(i,"highlight")})},e.Marker.Simple.ciqInheritsFrom(e.Marker.NodeCreator,!1),t},__quoteFeed_=function(t){function e(){}var i=t.CIQ;return e.fetchInitialData=function(t,e,i,r,n){},e.fetchUpdateData=function(t,e,i,r){},e.fetchPaginationData=function(t,e,i,r,n){},e.subscribe=function(t){},e.unsubscribe=function(t){},i.QuoteFeed=function(){},i.QuoteFeed.prototype.fetch=function(t,e){this.v2QuoteFeed||console.log("You must implement CIQ.QuoteFeed.[yourfeedname].prototype.fetch()")},i.QuoteFeed.prototype.announceError=function(t,e){t.suppressErrors||e.suppressAlert||t.startDate||t.endDate||e.error&&i.alert("Error fetching quote:"+e.error)},i.QuoteFeed.prototype.multiFetch=function(t,e){function r(t,e,i){return function(r){if(e.results.push({dataCallback:r,params:t}),++e.counter>=e.finished){var n=e.results;e.results=[],i(n)}}}0===t.length&&e([]);for(var n={counter:0,finished:t.length,results:[]},a=0;a<t.length;a++){var s=t[a];s.stx.isEquationChart(s.symbol)?i.fetchEquationChart(s,r(s,n,e)):i.ChartEngine.Driver.fetchData(i.QuoteFeed.SERIES,this,s,r(s,n,e))}},i.QuoteFeed.Subscriptions=function(){this.subscriptions=[]},i.QuoteFeed.Subscriptions.ciqInheritsFrom(i.QuoteFeed),i.QuoteFeed.Subscriptions.prototype.checkSubscriptions=function(t){for(var e,i,r=t.getSymbols(),n=0;n<this.subscriptions.length;n++)this.subscriptions[n].match=!1;for(var a=0;a<r.length;a++){i=r[a];var s=i.interval;for("month"!=s&&"week"!=s||t.dontRoll||(s="day"),i.interval=s,i.period=1,i.match=!1,isNaN(i.interval)||(i.period=i.interval,i.interval=i.timeUnit,i.interval||(i.interval="minute")),delete i.periodicity,delete i.timeUnit,delete i.setSpan,n=0;n<this.subscriptions.length;n++){if(e=this.subscriptions[n],e.symbol==i.symbol&&e.period==i.period&&e.interval==i.interval){i.match=!0,e.match=!0;break}e.symbol!=i.symbol?("period"!=i.reason&&(i.reason="symbol"),e.reason="symbol"):(i.reason="period",e.reason="period")}}var o=this;this.subscriptions=this.subscriptions.filter(function(e){return e.match||(e.stx||(e.stx=t),o.unsubscribe(e)),e.match}),r.forEach(function(e){e.match||(e.stx||(e.stx=t),e.reason||(e.reason="initialize"),o.subscribe(e),o.subscriptions.push(e))})},i.QuoteFeed.Subscriptions.prototype.fetch=function(t,e){var i=this;this.fetchFromSource(t,function(r){r.error||i.checkSubscriptions(t.stx),e(r)})},i.QuoteFeed.Subscriptions.prototype.subscribe=function(t){console.log("subscribe",t)},i.QuoteFeed.Subscriptions.prototype.unsubscribe=function(t){console.log("unsubscribe",t)},i.QuoteFeed.Subscriptions.prototype.fetchFromSource=function(t,e){console.log("Please provide implementation of fetchFromSource")},i.QuoteFeed.prototype.requiresImmediateRefresh=function(t){return!1},i.ChartEngine.prototype.attachQuoteFeed=function(t,e){if(e||(e={}),this.quoteDriver&&this.quoteDriver.die(),"function"!=typeof t.fetchInitialData&&"function"!=typeof t.fetchUpdateData&&"function"!=typeof t.fetchPaginationData)return void(this.quoteDriver=new i.ChartEngine.Driver(this,t,e));"function"!=typeof t.fetchPaginationData&&"function"!=typeof t.fetchUpdateData&&(e.noLoadMore=!0),t.v2QuoteFeed=!0,["multiFetch","announceError","requiresImmediateRefresh"].forEach(function(e){t[e]||(t[e]=i.QuoteFeed.prototype[e])}),"function"==typeof t.subscribe&&(t.checkSubscriptions=i.QuoteFeed.Subscriptions.prototype.checkSubscriptions,t.subscriptions=[]),this.quoteDriver=new i.ChartEngine.Driver(this,t,e)},i.ChartEngine.prototype.attachEngineQuoteFeed=function(t,e){this.attachQuoteFeed(t,e)},i.ChartEngine.prototype.attachTagAlongQuoteFeed=function(t){if(!t.label)return void console.log("Attempt to attachTagAlongQuoteFeed without assigning a label");this.quoteDriver.attachTagAlongQuoteFeed(t)},i.ChartEngine.prototype.detachTagAlongQuoteFeed=function(t){if(!t.label)return void console.log("Attempt to detachTagAlongQuoteFeed without assigning a label");this.quoteDriver.detachTagAlongQuoteFeed(t)},i.ChartEngine.Driver=function(t,e,i){this.tagalongs={},this.stx=t,this.quoteFeed=e,this.behavior=i,this.loadingNewChart=!1,this.intervalTimer=null,this.updatingChart=!1,this.updateChartLoop()},i.ChartEngine.Driver.prototype.die=function(){this.intervalTimer&&(window.clearInterval(this.intervalTimer),this.intervalTimer=-1)},i.ChartEngine.Driver.prototype.updateSubscriptions=function(){this.quoteFeed.checkSubscriptions&&this.quoteFeed.checkSubscriptions(this.stx)},i.ChartEngine.Driver.prototype.attachTagAlongQuoteFeed=function(t){t.label&&(this.tagalongs[t.label]||(this.tagalongs[t.label]={label:t.label,quoteFeed:t.quoteFeed,behavior:t.behavior?t.behavior:{},count:0}),this.tagalongs[t.label].count++)},i.ChartEngine.Driver.prototype.detachTagAlongQuoteFeed=function(t){if(t.label){var e=this.tagalongs[t.label];e.count--,e.count||(this.tagalongs[t.label]=null)}},i.ChartEngine.Driver.prototype.loadDependents=function(t,e){var r,n,a,s=t.stx,o=t.chart,l=o.series,h=s.masterData,u=[],c=t.originalState.update;for(r in l)if(n=l[r],(c||!1!==n.moreAvailable)&&(a=n.parameters.symbolObject,!n.parameters.data||n.parameters.data.useDefaultQuoteFeed)){for(var p=!0,d=0;d<u.length;d++)i.symbolEqual(u[d],a)&&(p=!1);p&&u.push(a)}for(var f=[],m=0;m<u.length;m++){a=u[m];var g=i.shallowClone(t.originalState);g.symbol=a.symbol,g.symbolObject=a,n=l[r],g.update?g.startDate=function(e){for(var r=h.length-1;r>=0;r--)if(h[r]&&void 0!==h[r][e])return i.strToDateTime(h[r].Date);return t.startDate}(r):(g.startDate||(g.startDate=t.startDate),g.endDate||(g.endDate=s.convertToDataZone(new Date)),g.ticks=t.ticks),f.push(g)}if(!f.length)return s.createDataSet(null,null,{appending:t.originalState.update}),t.nodraw||s.draw(),void(e&&e(null));this.quoteFeed.multiFetch(f,function(r){return function(a){for(var o=0;o<a.length;o++){var l=a[o],h=l.dataCallback.error;if(!h&&0!==h){for(var u=l.params.symbolObject,c=l.dataCallback,p=c.quotes,d=c.moreAvailable,f=s.getSeries({symbolObject:u}),m={},g=0;g<f.length;g++)n=f[g],r||(n.moreAvailable=!1!==d&&(d||p.length>(l.params.endDate?1:0))),m=n.parameters;i.addMemberToMasterdata({stx:s,label:u.symbol,data:p,fieldForLabel:m.field,fillGaps:m.fillGaps})}}s.createDataSet(null,null,{appending:t.originalState.update}),t.nodraw||s.draw(),e&&e(null)}}(c))},i.ChartEngine.Driver.prototype.executeTagAlongs=function(t){var e={count:i.objLength(this.taglongs)},r=this;for(var n in this.tagalongs){var a=this.tagalongs[n],s=i.shallowClone(a.behavior);i.extend(s,t,!0),i.ChartEngine.Driver.fetchData(null,a.quoteFeed,s,function(t,e,n){return function(a){if(n.count--,!a.error){var s=t.fields;s||(s=null),i.addMemberToMasterdata(r.stx,e.label,a.quotes,s)}-1==n.count&&(r.stx.createDataSet(null,null,{appending:t.originalState.update}),r.stx.draw())}}(s,a,e))}},i.ChartEngine.Driver.prototype.updateChart=function(){if(!this.updatingChart&&!this.loadingNewChart){var t=i.objLength(this.stx.charts),e=0,r=this.stx.layout.interval,n=this.stx.layout.timeUnit;for(var a in this.stx.charts){var s=this.stx.charts[a];if(s.symbol){var o=this.makeParams(s.symbol,s.symbolObject,s);s.masterData&&s.masterData.length&&(o.startDate=s.masterData[s.masterData.length-1].DT),o.update=!0,o.originalState=i.shallowClone(o),this.updatingChart=!0;var l=function(i,a,s){return i.behavior.prefetchAction&&i.behavior.prefetchAction("updateChart"),function(o){e++;var l=i.stx,h=a.chart,u=h.masterData;if(s==h.symbol&&r==l.layout.interval&&n==l.layout.timeUnit){if(o.error)i.quoteFeed.announceError(a.originalState,o);else{var c=o.quotes;l.doCleanupDates(o.quotes,r);var p=!1;if(!a.missingBarsCreated){if(u&&u.length&&c&&c.length>0){var d=u[u.length-1],f=c[0];(f.DT&&d.DT<f.DT||f.Date&&d.Date<f.Date)&&(c.unshift(d),p=!0)}o.quotes=c=l.doCleanupGaps(c,h),p&&c.shift()}l.appendMasterData(c,h,{noCreateDataSet:!0}),h.attribution=o.attribution}e==t&&(i.updatingChart=!1),i.executeTagAlongs(a),i.behavior.callback&&i.behavior.callback(a),i.loadDependents(a)}}}(this,o,s.symbol);this.stx.isEquationChart(o.symbol)?i.fetchEquationChart(o,l):i.ChartEngine.Driver.fetchData(i.QuoteFeed.UPDATE,this.quoteFeed,o,l)}}}},i.ChartEngine.Driver.prototype.updateChartLoop=function(t){-1!=this.intervalTimer&&(this.intervalTimer&&window.clearInterval(this.intervalTimer),this.behavior.noUpdate||(t||0===t||(t=this.behavior.refreshInterval),t&&(this.intervalTimer=window.setInterval(function(t){return function(){t.behavior.noUpdate||t.updateChart()}}(this),1e3*t))))},i.ChartEngine.Driver.prototype.resetRefreshInterval=function(t){this.behavior.refreshInterval=t,this.updateChartLoop()},i.ChartEngine.Driver.prototype.loadAll=function(t,e){function i(){return function(a){a?e(a):t.moreAvailable?t.loadingMore?e(null):++n>20?e("error, moreAvailable not implemented correctly in QuoteFeed"):r.checkLoadMore(t,!0,!0,i()):e(null)}}var r=this,n=0;i()()},i.ChartEngine.Driver.prototype.checkLoadMore=function(t,e,r,n,a){function s(e){t.loadingMore=!1,n&&n(e)}if(t.loadingMore)return t.initialScroll=t.scroll,void(n&&n(null));var o,l=this.stx;if(!t.moreAvailable){if(t.dataSet.length>0&&t.scroll>=t.dataSet.length||e)for(var h in t.series)if(!1!==t.series[h].moreAvailable)return o=this.makeParams(t.symbol,t.symbolObject,t),t.masterData&&t.masterData.length?o.endDate=t.masterData[0].DT:o.endDate=l.convertToDataZone(new Date),o.originalState=i.shallowClone(o),o.nodraw=a,t.loadingMore=!0,void this.loadDependents(o,s);return void(n&&n(null))}var u=l.layout.interval,c=l.layout.timeUnit,p=!1;if(!this.behavior.noLoadMore&&(!l.maxDataSetSize||t.dataSet.length<l.maxDataSetSize)&&(t.scroll>=t.dataSet.length||e)){t.initialScroll=t.scroll,t.loadingMore=!0,o=this.makeParams(t.symbol,t.symbolObject,t),t.masterData&&t.masterData.length?o.endDate=function(){for(var e=0;e<t.masterData.length;e++)if(t.masterData[e]&&void 0!==t.masterData[e][t.defaultPlotField])return t.masterData[e].DT;return t.masterData[0].DT}():o.endDate=l.convertToDataZone(new Date),o.originalState=i.shallowClone(o),o.nodraw=a,l.fetchMaximumBars[l.layout.aggregationType]&&(r=!0),r&&(o.fetchMaximumBars=!0,o.ticks=Math.max(2e4,o.ticks));var d=function(t,e){return t.behavior.prefetchAction&&t.behavior.prefetchAction("checkLoadMore"),function(r){var s=t.stx,o=e.chart;if(e.symbol==o.symbol&&u==s.layout.interval&&c==s.layout.timeUnit)if(e.loadMore||(e.chart.loadingMore=!1),r.error)t.quoteFeed.announceError(e.originalState,r),e.chart.loadingMore=!1,n&&n(r.error);else{if(r.quotes||(r.quotes=[]),s.doCleanupDates(r.quotes,u),r.quotes.length){var l=r.quotes[r.quotes.length-1];!l.DT&&l.Date&&(l.DT=i.strToDateTime(l.Date)),l.DT&&+l.DT==+o.masterData[0].DT&&r.quotes.pop()}e.missingBarsCreated||(r.quotes.push(o.masterData[0]),r.quotes=s.doCleanupGaps(r.quotes,o),r.quotes.pop()),r.moreAvailable?o.moreAvailable=!0:!1!==r.moreAvailable&&r.quotes.length?o.moreAvailable=!0:o.moreAvailable=!1,t.tickMultiplier=r.quotes.length?2:2*t.tickMultiplier,o.loadingMore=!1,e.loadMoreReplace?s.setMasterData(r.quotes,o):i.addMemberToMasterdata({stx:s,chart:o,data:r.quotes,fields:["*"]}),s.createDataSet(),a||s.draw(),t.executeTagAlongs(e),t.behavior.callback&&t.behavior.callback(e),t.loadDependents(e,n)}}}(this,o);l.isEquationChart(o.symbol)?i.fetchEquationChart(o,d):i.ChartEngine.Driver.fetchData(i.QuoteFeed.PAGINATION,this.quoteFeed,o,d),p=!0}!p&&n&&n(null)},i.ChartEngine.Driver.prototype.barsToFetch=function(t){if(t.isSeries)return t.stx.masterData.length;var e=this.stx.layout.interval,i=t.stx.layout.periodicity;return"month"!=e&&"week"!=e||this.stx.dontRoll||(i*="week"==e?7:30),t.stx.chart.maxTicks*i*this.tickMultiplier},i.ChartEngine.Driver.prototype.makeParams=function(t,e,r){var n=this.stx.layout.interval,a=this.barsToFetch({stx:this.stx});"month"!=n&&"week"!=n||this.stx.dontRoll||(n="day");var s=i.shallowClone(this.behavior);return i.extend(s,{stx:this.stx,symbol:t,symbolObject:e,chart:r,interval:n,extended:this.stx.layout.extended,period:1,feed:"delayed",ticks:a},!0),s.symbolObject||(s.symbolObject={symbol:t}),isNaN(s.interval)||(s.period=parseInt(s.interval,10),s.interval=this.stx.layout.timeUnit,s.interval||(s.interval="minute")),s},i.ChartEngine.Driver.prototype.newChart=function(t,e){var r=this.stx,n=t.symbol,a=r.layout.interval,s=r.layout.timeUnit,o=t.chart;o.moreAvailable=null,o.attribution=null,this.tickMultiplier=2;var l=this.makeParams(n,t.symbolObject,o);i.extend(l,t,!0),(r.fetchMaximumBars[r.layout.aggregationType]||t.fetchMaximumBars)&&(l.ticks=Math.max(2e4,l.ticks),l.fetchMaximumBars=!0),this.loadingNewChart=!0,this.updatingChart=!1,l.originalState=i.shallowClone(l);var h=function(i,o){return i.behavior.prefetchAction&&i.behavior.prefetchAction("newChart"),function(l){var h,u=o.chart;if(n!=u.symbol||a!=r.layout.interval||s!=r.layout.timeUnit)return void(e&&e("orphaned"));l.error?i.quoteFeed.announceError(o.originalState,l):(r.doCleanupDates(l.quotes,a),o.missingBarsCreated||(h=l.quotes=r.doCleanupGaps(l.quotes,u)),r.setMasterData(h,u),u.moreAvailable=!!h&&!1!==l.moreAvailable,u.attribution=l.attribution,t.initializeChart&&r.initializeChart(),r.createDataSet(),o.nodraw||r.home());for(var c in u.series)u.series[c].moreAvailable=null;i.loadingNewChart=!1;var p=u.masterData;p&&p.length&&(o.startDate=p[0].DT,o.endDate=p[p.length-1].DT),i.executeTagAlongs(o),i.behavior.callback&&i.behavior.callback(o),i.loadDependents(o,function(){e&&e(l.error),i.stx.dispatch("newChart",{stx:i.stx,symbol:i.stx.chart.symbol,symbolObject:i.stx.chart.symbolObject,moreAvailable:i.stx.chart.moreAvailable,quoteDriver:i}),i.resetRefreshInterval(i.behavior.refreshInterval)})}}(this,l);this.stx.isEquationChart(l.symbol)?i.fetchEquationChart(l,h):i.ChartEngine.Driver.fetchData(i.QuoteFeed.INITIAL,this.quoteFeed,l,h)},i.QuoteFeed.INITIAL=1,i.QuoteFeed.UPDATE=2,i.QuoteFeed.PAGINATION=3,i.QuoteFeed.SERIES=4,i.ChartEngine.Driver.fetchData=function(t,e,r,n){e.v2QuoteFeed?"function"!=typeof e.subscribe?i.ChartEngine.Driver.fetchDataInContext(t,e,r,n):i.ChartEngine.Driver.fetchDataInContext(t,e,r,function(t){t.error||e.checkSubscriptions(r.stx),n(t)}):e.fetch(r,n)},i.ChartEngine.Driver.fetchDataInContext=function(t,e,r,n){var a,s,o,l;switch(t===i.QuoteFeed.SERIES&&(r.series=!0,t=i.QuoteFeed.INITIAL,r.endDate&&!r.startDate?t=i.QuoteFeed.PAGINATION:r.startDate&&!r.endDate&&(t=i.QuoteFeed.UPDATE)),t){case i.QuoteFeed.UPDATE:var h;r.startDate?h=r.startDate:(h=new Date,h.setHours(0,0,0,0)),"function"==typeof e.fetchUpdateData&&e.fetchUpdateData(r.symbol,h,r,n);break;case i.QuoteFeed.INITIAL:l=new Date,l.setMilliseconds(0),a={begin:l,interval:"tick"==r.interval?1:r.interval,periodicity:"tick"==r.interval?r.stx.chart.xAxis.futureTicksInterval:r.period,inZone:r.stx.dataZone,outZone:r.stx.dataZone},s=r.stx.chart.market.newIterator(a),o=r.startDate?r.startDate:s.previous(r.ticks),l=r.endDate?r.endDate:l,"function"==typeof e.fetchInitialData&&e.fetchInitialData(r.symbol,o,l,r,n);break;case i.QuoteFeed.PAGINATION:a={begin:r.endDate,interval:"tick"==r.interval?1:r.interval,periodicity:"tick"==r.interval?r.stx.chart.xAxis.futureTicksInterval:r.period,inZone:r.stx.dataZone,outZone:r.stx.dataZone},s=r.stx.chart.market.newIterator(a);var u=r.ticks;if(e.maxTicks&&(u=Math.min(u,e.maxTicks)),o=s.previous(u),"function"==typeof e.fetchPaginationData){if(r.stx.maxMasterDataSize&&r.stx.maxMasterDataSize<=r.stx.masterData.length)return;e.fetchPaginationData(r.symbol,o,r.endDate,r,n)}break;default:console.error("Illegal fetchData constant")}},t},__span_=function(t){var e=t.CIQ;return e.ChartEngine.prototype.setRange=function(t,i){function r(e){void 0===e&&(e=null);var r=0,n=0,a=new Date,h=t.base,c=t.periodicity,p=s.dataSet,d=p.length,f=u.layout;if(!p||0===d)return void(i&&i(e));if("day"===h&&c&&"day"===c.interval){var m=t.multiplier;r=d<m?0:d-m,n=d-1}else if("today"===h&&p[d-1].DT.getDate()!=a.getDate()){for(var g=new Date(p[d-1].DT.getTime()),v=new Date(g.getTime()),y=d-1;y>=0;y--)if(p[y]&&p[y].DT.getDate()!=g.getDate()){g=new Date(+p[y+1].DT);break}v.getTime()==g.getTime()&&(g=new Date(+p[0].DT)),r=u.tickFromDate(g,s,null,!0),n=u.tickFromDate(v,s)}else r=o.getTime()>=p[0].DT.getTime()||t.goIntoPast?u.tickFromDate(o,s,null,!0):0,n=l.getTime()<=p[d-1].DT.getTime()||t.goIntoFuture?u.tickFromDate(l,s):d-1;var x=n-r+1;if(x<1)return void(i&&i(e));var C=u.getLabelOffsetInPixels(u,s,f.chartType),S=Math.max(C,t.padding);n<d-1&&(S=0);var w=(s.width-S)/x;u.setCandleWidth(w,s),s.scroll=x-(n-d)-1,u.micropixels=1;for(var D in u.panels)u.calculateYAxisMargins(u.panels[D].yAxis);u.draw(),u.changeOccurred("layout"),i&&i(e)}function n(t){return t&&0===c?(s.scroll=M,u.setCandleWidth(k),u.layout.interval=A,u.layout.periodicity=P,u.layout.timeUnit=_,void(i&&i(t))):++c>10?(console.log("CIQ.ChartEngine.setRange(): Too many loads (10) from server. Stopping. Check periodicity logic."),void r()):void(s.moreAvailable&&s.masterData[0]&&s.masterData[0].DT>o?u.quoteDriver.checkLoadMore(s,!0,!1,function(t){t?r(t):n()},!0):r())}e.isEmpty(t)&&(t={dtLeft:arguments[0],dtRight:arguments[1],padding:arguments[2],chart:arguments[3],goIntoFuture:!1},i=arguments[4]),t.chart||(t.chart=this.chart),void 0===t.padding&&(t.padding=0);var a=!1,s=t.chart,o=t.dtLeft,l=this.convertToDataZone(new Date);if(t.dtRight&&(l=t.dtRight),!o){var h=this.standardMarketIterator(l,null,s);o=h.previous(s.maxTicks),t.periodicity||(a=!0)}var u=this,c=0;if(this.quoteDriver){var p,d,f;if(a)p=this.layout.interval,f=this.layout.timeUnit,d=this.layout.periodicity;else if(t.periodicity)p=t.periodicity.interval,f=t.periodicity.timeUnit,d=t.periodicity.period;else{var m=l.getTime()-o.getTime();if(this.autoPickCandleWidth.turnOn){var g=0;g=this.autoPickCandleWidth.candleWidth?this.autoPickCandleWidth.candleWidth:this.barsHaveWidth[this.layout.chartType]?5:2;var v=s.width/g,y=this.dynamicRangePeriodicityMap;p=y[0].interval,d=1
;for(var x,C=0;C<y.length;C++){var S=m/y[C].rangeInMS;if(S<v){y[C-1]?(p=y[C-1].interval,f=y[C-1].timeUnit,d=Math.ceil(x/v)):(p=y[C].interval,f=y[C].timeUnit,d=1);break}x=S}}else{for(var w=this.staticRangePeriodicityMap,D=null,b=0;b<w.length;b++){var T=w[b];if(m/T.rangeInMS<1.001){D=T;break}}p=D.interval,d=D.periodicity,f=D.timeUnit}}var M=this.chart.scroll,k=this.layout.candleWidth,A=this.layout.interval,P=this.layout.periodicity,_=this.layout.timeUnit;this.chart.scroll=this.chart.maxTicks=function(t,i,r,n,a,s){var o=0,l=t-i;return e.ChartEngine.isDailyInterval(r)?o="month"==r?l/e.MONTH/n:"week"==r?l/e.WEEK/n:l/e.DAY/n:isNaN(r)||(o="millisecond"==a?l/(n*r):"second"==a?l/e.SECOND/(n*r):l/e.MINUTE/(n*r)),Math.round(o)}(l.getTime(),o.getTime(),p,d,f,this.dontRoll),this.layout.candleWidth=this.chart.width/this.chart.maxTicks;var F=this.needDifferentData({periodicity:d,interval:p,timeUnit:f});if(this.chart.masterData&&this.chart.masterData.length&&!F)this.layout.interval==p&&this.layout.periodicity==d||(this.layout.interval=p,this.layout.periodicity=d,this.createDataSet()),n();else{this.layout.interval=p,this.layout.periodicity=d,this.layout.timeUnit=f,this.layout.timeUnit||(e.ChartEngine.isDailyInterval(this.layout.interval)?this.layout.timeUnit=null:"second"==this.layout.interval?this.layout.timeUnit="second":"tick"!=this.layout.interval&&(this.layout.timeUnit="minute"));var E={symbol:s.symbol,symbolObject:s.symbolObject,chart:s,nodraw:!0};"tick"==this.layout.interval&&(E.startDate=o,E.endDate=l),this.displayInitialized||(E.initializeChart=!0),E.startDate=new Date(2*o-l),E.startDate.setHours(0,0,0,0),this.quoteDriver.newChart(E,n)}}else r()},e.ChartEngine.prototype.setSpan=function(t,i){function r(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}var n=arguments[0],a=arguments[1],s=arguments[2],o=arguments[3];if("object"==typeof t?(n=t.period?t.period:t.multiplier?t.multiplier:1,a=t.interval?t.interval:t.base?t.base:t.span?t.span:t.period,s=t.padding,o=t.chart):(t={period:n,interval:a,padding:s,chart:o},i=arguments[5]),o||(o=this.chart),"all"==(a=a.toLowerCase()))return void this.displayAll(t,i);var l=a,h=1;"today"==a?l="day":"year"==a&&(l="month",h=12);var u=e.shallowClone(t);u.goIntoFuture=!1;var c,p={begin:new Date,interval:l,period:h,outZone:this.dataZone};"ytd"!==a&&(c=o.market.newIterator(p));var d=this.convertToDataZone(new Date);if("ytd"===a)d=r(d),d.setMonth(0),d.setDate(1);else if("today"===a)c.next(),(d=c.previous())>p.begin&&(d=c.previous());else if("month"===a)d=r(new Date),d.setMonth(d.getMonth()-n);else if("year"===a)d=r(new Date),d.setFullYear(d.getFullYear()-n);else if("week"===a)d=r(new Date),d.setDate(d.getDate()-7*n);else if("day"===a&&1==n){var f=d.getHours(),m=d.getMinutes(),g=d.getSeconds(),v=d.getMilliseconds();d=c.previous(),d.setHours(f),d.setMinutes(m),d.setSeconds(g),d.setMilliseconds(v)}else d=c.previous(n-1);u.dtLeft=d,"today"===a&&(u.goIntoFuture=!0,u.dtRight=new Date(+d),u.dtRight.setDate(d.getDate()+1),u.dtRight=o.market._convertFromMarketTZ(u.dtRight,this.dataZone),u.dtLeft.setHours(c.market.zopen_hour),u.dtLeft.setMinutes(c.market.zopen_minute),u.dtLeft.setSeconds(0),u.dtLeft=o.market._convertFromMarketTZ(u.dtLeft,this.dataZone)),u.maintainPeriodicity&&(u.periodicity={},u.periodicity.interval=this.layout.interval,u.periodicity.period=this.layout.periodicity),o.spanLock=!1;var y=this;this.setRange(u,function(e){t.maintainPeriodicity||(y.layout.setSpan=t,y.changeOccurred("layout")),"today"==a&&(o.spanLock=!0),i&&i(e)})},e.ChartEngine.prototype.getSpanCandleWidth=function(t){if(t&&t.base&&t.multiplier){var e=parseFloat(t.multiplier),i=t.base,r=new Date,n=new Date;"year"==i?n.setFullYear(n.getFullYear()-e):"month"==i?n.setMonth(n.getMonth()-e):"day"==i?n.setDate(n.getDate()-e):"week"==i?n.setDate(n.getDate()-7*e):"YTD"==i&&(n.setMonth(0),n.setDate(1));var a=(r.getTime()-n.getTime())/1e3/60/60/24;a=5*a/7;return this.chart.width/a}},e.ChartEngine.prototype.displayAll=function(t,i){function r(){if(a.masterData&&a.masterData.length){var r=e.clone(t);r.dtLeft=a.masterData[0].DT,r.dtRight=a.masterData[a.masterData.length-1].DT,t.maintainPeriodicity?(r.periodicity={},r.periodicity.interval=s.layout.interval,r.periodicity.period=s.layout.periodicity):t.periodicity&&(r.periodicity=t.periodicity),s.setRange(r,function(e){t.maintainPeriodicity||(s.layout.setSpan={base:t.base,multiplier:t.multiplier},s.changeOccurred("layout"));for(var r in s.panels)s.calculateYAxisMargins(s.panels[r].yAxis);s.draw(),i&&i(e)})}}function n(){s.quoteDriver.loadAll(a,r)}var a=this.chart;t&&t.chart&&(a=t.chart);var s=this;if(!this.quoteDriver)return void r();var o=e.ChartEngine.isDailyInterval(this.layout.interval),l=t.maintainPeriodicity?{periodicity:this.layout.periodicity,interval:this.layout.interval}:{periodicity:1,interval:"month"};l=t.periodicity?t.periodicity:l,l.period&&(l.periodicity=l.period),this.layout.periodicity=l.periodicity,this.layout.interval=l.interval,this.layout.timeUnit=null;var h=e.ChartEngine.isDailyInterval(this.layout.interval);t.forceLoad||h!=o?this.quoteDriver.newChart({noDraw:!0,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,chart:this.chart,initializeChart:!0,fetchMaximumBars:!0},n):a.moreAvailable?n():(this.createDataSet(),r())},t},__studies_=function(t){var e=t.CIQ;return e.Studies=function(){},e.Studies.DEFAULT_INPUTS={Period:14},e.Studies.DEFAULT_OUTPUTS={Result:"auto"},e.Studies.actualOutputs=[],e.Studies.studyPanelMap={},e.Studies.colorPickerDiv=null,e.Studies.StudyDescriptor=function(t,i,r,n,a,s){this.name=t,this.type=i,this.panel=r,this.inputs=n,this.outputs=a,this.parameters=s,this.outputMap={},this.min=null,this.max=null,this.startFrom=0;var o=e.Studies.studyLibrary[i];o||(o={},("chart"==r||!r&&s&&"chart"==s.chartName)&&(this.overlay=!0)),void 0===o.inputs&&(o.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===o.outputs&&(o.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS)),this.study=o,this.libraryEntry=o},e.Studies.generateID=function(t,i,r,n){var a=e.Studies.studyLibrary[i];if(a&&(a.customRemoval||e.isEmpty(a.inputs)))return i;var s="‌"+i+"‌",o=s+" (",l=!1;for(var h in r)if("id"!=h&&"display"!=h&&"Shading"!=h){var u=r[h];"field"!=u&&(u=u.toString(),void 0!==e.Studies.prettify[u]&&(u=e.Studies.prettify[u]),l?u&&(o+=","):l=!0,o+=u)}if(o+=")",n&&0===n.indexOf(o))return n;if(t.layout.studies&&t.layout.studies[o])for(var c=2;c<50;c++){var p=o+"-"+c;if(!t.layout.studies[p]){o=p;break}}return o},e.Studies.DialogHelper=function(t){var i=this.stx=t.stx,r=this.sd=t.sd;this.name=r?r.type:t.name,this.inputs=[],this.outputs=[],this.parameters=[];var n=this.libraryEntry=r?r.study:e.Studies.studyLibrary[t.name];void 0===n.inputs&&(n.inputs=e.clone(e.Studies.DEFAULT_INPUTS)),void 0===n.outputs&&(n.outputs=e.clone(e.Studies.DEFAULT_OUTPUTS));var a=r&&i.panels[r.panel]?i.panels[r.panel]:{chart:i.chart},s=a.chart;this.title=i.translateIf(n.name),this.attributes=n.attributes,this.attributes||(this.attributes={});for(var o in n.inputs){var l={};this.inputs.push(l),l.name=o,l.heading=i.translateIf(o);var h=n.inputs[o];if(r&&r.inputs&&void 0!==r.inputs[o]&&null!==r.inputs[o]?l.value=r.inputs[o]:l.value=n.inputs[o],l.defaultInput=n.inputs[o],this.attributes[o]||(this.attributes[o]=e.Studies.inputAttributeDefaultGenerator(l.defaultInput)),h.constructor==Number)l.type="number";else if(h.constructor==String){var u=e.Studies.movingAverageHelper(i,l.defaultInput);if(u){l.type="select",l.defaultInput=u;var c=e.Studies.movingAverageHelper(i,l.value);c||(c=l.value),l.value=c,l.options=e.Studies.movingAverageHelper(i,"options")}else if("field"==h){l.type="select",l.options={};t:for(var p in s.dataSet[s.dataSet.length-1]){if(-1==["Open","High","Low","Close","Adj_Close","hl/2","hlc/3","hlcc/4","ohlc/4",s.defaultPlotField].indexOf(p)){if(-1==e.Studies.actualOutputs.indexOf(p))continue;if(t.sd)for(var d in t.sd.outputMap)if(-1!=p.indexOf(d)&&-1==p.indexOf(d+"-"))continue t}l.options[p]=i.translateIf(p)}"field"==l.value&&(l.value="Close"),"field"==l.defaultInput&&(l.defaultInput="Close")}else l.type="text"}else if(h.constructor==Boolean)l.type="checkbox",!0!==l.value&&"true"!=l.value&&"on"!=l.value||(l.value=!0);else if(h.constructor==Array){l.type="select",l.options={};for(var f=0;f<h.length;f++)l.options[h[f]]=i.translateIf(h[f]);l.value.constructor==Array&&(l.value=l.value[0]),l.defaultInput=h[0]}}for(o in n.outputs){var m={name:o,heading:i.translateIf(o)};this.outputs.push(m),m.color=m.defaultOutput=n.outputs[o],r&&r.outputs&&r.outputs[o]&&(m.color=r.outputs[o]),"auto"==m.color&&(m.color=i.defaultColor)}if(n.parameters&&"studyOverZones"==n.parameters.template){var g=n.parameters.init;if(g){var v;v={name:"studyOverZones",heading:i.translateIf("Show Zones"),defaultValue:g.studyOverZonesEnabled,value:g.studyOverZonesEnabled};var y=r?r.parameters:null;y&&(y.studyOverZonesEnabled||!1===y.studyOverZonesEnabled)&&(v.value=y.studyOverZonesEnabled),this.parameters.push(v),v={name:"studyOverBought",heading:i.translateIf("OverBought"),defaultValue:g.studyOverBoughtValue,value:g.studyOverBoughtValue,defaultColor:g.studyOverBoughtColor,color:g.studyOverBoughtColor},y&&y.studyOverBoughtValue&&(v.value=y.studyOverBoughtValue),y&&y.studyOverBoughtColor&&(v.color=y.studyOverBoughtColor),"auto"==v.color&&(v.color=i.defaultColor),this.parameters.push(v),v={name:"studyOverSold",heading:i.translateIf("OverSold"),defaultValue:g.studyOverSoldValue,value:g.studyOverSoldValue,defaultColor:g.studyOverSoldColor,color:g.studyOverSoldColor},y&&y.studyOverSoldValue&&(v.value=y.studyOverSoldValue),y&&y.studyOverSoldColor&&(v.color=y.studyOverSoldColor),"auto"==v.color&&(v.color=i.defaultColor),this.parameters.push(v),this.attributes.studyOverBoughtValue||(this.attributes.studyOverBoughtValue={}),this.attributes.studyOverSoldValue||(this.attributes.studyOverSoldValue={})}}},e.Studies.DialogHelper.prototype.updateStudy=function(t){var i={},r=this.sd,n=this.libraryEntry;n||(n={}),r||(r=n),i.inputs=e.shallowClone(r.inputs),i.outputs=e.clone(r.outputs),i.parameters=e.shallowClone(r.parameters),e.extend(i,t),i.parameters||(i.parameters={}),i.inputs&&i.inputs.id?this.sd=e.Studies.replaceStudy(this.stx,i.inputs.id,this.name,i.inputs,i.outputs,i.parameters,null,r.study):this.sd=e.Studies.addStudy(this.stx,this.name,i.inputs,i.outputs,i.parameters,null,r.study)},e.Studies.prepareStudy=function(t,i,r,n){if(void 0===i.calculateFN&&(i.useRawValues=!0),n&&n.replaceID&&(e.Studies.rejiggerDerivedStudies(t,n.replaceID,r.inputs.id,r.panel),delete n.replaceID),e.isEmpty(r.outputMap))for(var a in r.outputs)i.useRawValues?r.outputMap[a]=a:r.outputMap[a+" "+r.name]=a;(r.overlay||r.underlay)&&(t.overlays[r.name]=r),i.feed?t.attachTagAlongQuoteFeed(i.feed):(r.chart.dataSet&&t.createDataSet(),t.draw())},e.Studies.rejiggerDerivedStudies=function(t,i,r,n){var a=t.layout.studies;t.overlays;for(var s in a){var o=a[s],l=o.inputs,h=l.id;if(-1!=l.id.indexOf(i)&&-1==l.id.indexOf(i+"-")){for(var u=(l.id.replace(i,r),!1),c=e.Studies.getFieldInputs(o),p=0;p<c.length;p++)if(-1!=l[c[p]].indexOf(i)){o.name;l[c[p]]=l[c[p]].replace(i,r),l.id=l.id.replace(i,r),l.display=l.display.replace(i,r),o.name=o.name.replace(i,r),o.outputMap={};for(var d in o.outputs)o.study.useRawValues?o.outputMap[d]=d:o.outputMap[d+" "+o.name]=d;u=!0}u&&e.Studies.replaceStudy(t,h,o.type,o.inputs,o.outputs,o.parameters)}}},e.Studies.removeStudySymbols=function(t,e){t.series&&e.deleteSeries(t.series,null,{action:"remove-study"}),e.draw()},e.Studies.replaceStudy=function(t,i,r,n,a,s,o,l){s||(s={}),i&&(s.replaceID=i),n.id==n.display&&delete n.display,delete n.id;var h=t.layout.studies[s.replaceID];return e.Studies.removeStudySymbols(h,t),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),e.Studies.addStudy(t,r,n,a,s,o,l)},e.Studies.addStudy=function(t,i,r,n,a,s,o){var l=o||e.Studies.studyLibrary[i];if(l){if(l.inputs){var h=e.shallowClone(l.inputs);for(var u in h)h[u]instanceof Array&&(h[u]=h[u][0]);r=e.extend(h,r)}l.outputs&&(n=e.extend(e.clone(l.outputs),n));var c=l.parameters;c&&c.init&&(a=e.extend(e.shallowClone(c.init),a))}r||(r=e.clone(e.Studies.DEFAULT_INPUTS)),n||(n=e.clone(e.Studies.DEFAULT_OUTPUTS)),a||(a={}),a.chartName||(a.chartName="chart"),r.Period<1&&(r.Period=1),r.id||(r.id=e.Studies.generateID(t,i,r,a.replaceID));var p=null;if(!(p=l&&l.initializeFN?l.initializeFN(t,i,r,n,a,s,o):e.Studies.initializeFN(t,i,r,n,a,s,o)))return void console.log("CIQ.Studies.addStudy: initializeFN() returned null for "+i);o=p.study,p.chart=t.charts[a.chartName],t.layout.studies||(t.layout.studies={}),t.layout.studies[p.inputs.id]=p,p.type=i,p.permanent=o.permanent,p.customLegend=o.customLegend;var d=t.panels[p.panel];e.Studies.prepareStudy(t,o,p,a),t.quoteDriver&&t.quoteDriver.updateSubscriptions(),t.changeOccurred("layout");var f=!1,m=!(p.overlay||p.underlay);if(m&&o.horizontalCrosshairFieldFN&&(d.horizontalCrosshairField=o.horizontalCrosshairFieldFN(t,p)),t.editCallback?f=!0:m?(t.callbacks.studyPanelEdit||t.callbackListeners.studyPanelEdit&&t.callbackListeners.studyPanelEdit.length)&&(f=!0):(t.callbacks.studyOverlayEdit||t.callbackListeners.studyOverlayEdit&&t.callbackListeners.studyOverlayEdit.length)&&(f=!0),f){a.editMode=!0;var g=!1;for(var v in p.inputs)if("id"!=v&&"display"!=v){g=!0;break}if(!g)for(var y in p.outputs){g=!0;break}if(g){var x;void 0!==p.study.edit?p.study.edit&&(x=function(t,e,i,r){return function(){e.study.edit(e,{stx:t,inputs:i,outputs:r,parameters:a})}}(t,p,r,n),t.setPanelEdit(d,x),p.editFunction=x):!m&&t.callbacks.studyOverlayEdit?(x=function(t,e,i,r,n){return function(a){t.dispatch("studyOverlayEdit",{stx:t,sd:e,inputs:i,outputs:r,parameters:n,forceEdit:a})}}(t,p,r,n,a),p.editFunction=x):t.editCallback?(x=function(t,r,n,s){return function(){var o=t.editCallback(t,r);e.Studies.studyDialog(t,i,o,{inputs:n,outputs:s,parameters:a})}}(t,p,r,n),"chart"!=d.name&&t.setPanelEdit(d,x)):(x=function(t,e,i,r,n){return function(){t.dispatch("studyPanelEdit",{stx:t,sd:e,inputs:i,outputs:r,parameters:n})}}(t,p,r,n,a),"chart"!=d.name&&(t.setPanelEdit(d,x),p.editFunction=x))}}return p},e.Studies.quickAddStudy=e.Studies.addStudy,e.Studies.removeStudy=function(t,e){if(e.overlay||e.underlay)t.removeOverlay(e.name),t.draw();else{var i=t.panels[e.panel];i&&t.panelClose(i)}},e.Studies.displayStudies=function(t,i,r){var n=t.layout.studies;if(n){r&&(e.Studies.actualOutputs=[]);var a={};a[i.name]=!0;for(var s in n){var o=n[s],l=o.study;if(l){if(r){if(!o.underlay&&!l.underlay)continue}else if(o.underlay||l.underlay)continue;var h=t.panels[o.panel];if(h){if(h.chart==i&&("bypass"!=o.study.range&&(h.min=null),!h.hidden)){if(!a[h.name]){var u=o.permanent;h.closeX?h.closeX.style.display=u?"none":"":h.close.style.display=u?"none":"",a[h.name]=u}var c=o.chart.dataSegment;for(var p in o.outputMap)e.Studies.actualOutputs.push(p);for(var d=e.Studies.getFieldInputs(o),f=0;f<d.length;f++)if(o.panel==o.parameters.chartName&&o.inputs[d[f]]){var m=e.Studies.studyPanelMap[o.inputs[d[f]]];if(m){o.panel=m.panel;break}}void 0===l.seriesFN?(e.Studies.displaySeriesAsLine(t,o,c),h&&e.Studies.displayError(t,o)):l.seriesFN&&h&&(l.seriesFN(t,o,c),e.Studies.displayError(t,o))}}else delete n[s]}}}},e.Studies.displayError=function(t,e,i){var r=i&&i.panel?i.panel:e.panel,n=t.panels[r].state;n.studyError||!e.error||"undefined"!=typeof practiceMode&&practiceMode||(i=i||{h:"center",v:"bottom"},i.text=n.studyError=!0===e.error?t.translateIf("Not enough data to compute ")+t.translateIf(e.study.name):t.translateIf(e.error),t.watermark(r,i))},e.Studies.calculateMinMaxForDataPoint=function(t,e,i){for(var r=Number.MAX_VALUE,n=-1*Number.MAX_VALUE,a=0;a<i.length;a++){var s=i[a][e];null!==s&&void 0!==s&&(isNaN(s)||(r=Math.min(s,r),n=Math.max(s,n)))}return{min:r,max:n}},e.Studies.determineMinMax=function(t,e,i){function r(t,e){if(t){var i=t[e];null===i||void 0===i||isNaN(i)||(n.min=Math.min(i,n.min),n.max=Math.max(i,n.max))}}var n=t.panels[e.panel];if(n){if(!n.min&&0!==n.min){var a=e.study;if(e.min||0===e.min)n.min=e.min,n.max=e.max;else{if("0 to 100"==a.range)n.min=0,n.max=100;else if("-1 to 1"==a.range)n.min=-1,n.max=1;else if("bypass"!=a.range){n.min=Number.MAX_VALUE,n.max=-1*Number.MAX_VALUE;for(var s,o,l,h=0;h<i.length;h++){var u=i[h];if(u){for(o in e.outputMap)r(u,o);for(s=0;s<=2;s++)l=e.name+"_hist"+(s||""),r(u,l)}}if(n.min==Number.MAX_VALUE||n.min==n.max){for(o in e.outputMap)r(t.getPreviousBar(n.chart,o,0),o),r(t.getNextBar(n.chart,o,i.length-1),o);for(s=0;s<=2;s++)l=e.name+"_hist"+(s||""),r(t.getPreviousBar(n.chart,l,0),l),r(t.getNextBar(n.chart,l,i.length-1),l)}}"0 to max"==a.range&&(n.min=Math.min(0,n.min))}}(n.highValue||0===n.highValue)&&n.highValue>n.max&&(n.max=n.highValue),(n.lowValue||0===n.lowValue)&&n.lowValue<n.min&&(n.min=n.lowValue);var c=n.yAxis;(c.max||0===c.max)&&(n.max=c.max),(c.min||0===c.min)&&(n.min=c.min),n.max==n.min&&(n.max=2*n.max,n.min=0),n.shadow=n.max-n.min,n.max>0&&n.min<0&&(n.shadow=n.max+-1*n.min),c.high=n.max,c.low=n.min,c.shadow=c.high-c.low}},e.Studies.createYAxis=function(t,i,r,n){if(!n.axisDrawn){n.height=n.bottom-n.top,e.Studies.determineMinMax(t,i,r);var a,s=i.study;s.yaxis||s.yAxisFN?(a={noDraw:!0},t.createYAxis(n,a),t.drawYAxis(n,a),s.yaxis&&s.yaxis(t,i),s.yAxisFN&&s.yAxisFN(t,i)):(a={noDraw:i.parameters&&i.parameters.studyOverZonesEnabled},"0 to 100"==s.range?a.range=[0,100]:"-1 to 1"==s.range&&(a.range=[-1,1]),s.yAxis&&s.yAxis.ground&&(a.ground=!0),t.createYAxis(n,a),t.drawYAxis(n,a)),i.error||(s.centerline?e.Studies.drawHorizontal(t,i,r,s.centerline):n.min<0&&n.max>0&&e.Studies.drawHorizontal(t,i,r,0)),n.axisDrawn=!0}},e.Studies.displaySeriesAsLine=function(t,i,r){if(r.length){var n=t.panels[i.panel];if(n&&!n.hidden){n.name==i.chart.name||i.underlay||e.Studies.createYAxis(t,i,r,n),e.Studies.drawZones(t,i,r);for(var a in i.outputMap)e.Studies.studyPanelMap[a]=i,e.Studies.displayIndividualSeriesAsLine(t,i,n,a,r)}}},e.Studies.displaySeriesAsHistogram=function(t,i,r){if(r.length){var n=t.panels[i.panel];if(n&&!n.hidden){var a=[];for(var s in i.outputMap){var o=i.outputs[i.outputMap[s]],l={field:s,fill_color_up:o,border_color_up:o,fill_color_down:o,border_color_down:o};a.push(l)}var h=i.inputs,u={name:i.name,type:h.HistogramType?h.HistogramType:"overlaid",panel:i.panel,heightPercentage:h.HeightPercentage?h.HeightPercentage:.25,widthFactor:h.WidthFactor?h.WidthFactor:.5};i.study&&i.study.parameters&&i.study.parameters.excludeYAxis||e.Studies.createYAxis(t,i,i.chart.dataSegment,t.panels[i.panel]),t.drawHistogram(u,a)}}},e.Studies.displayIndividualSeriesAsLine=function(t,i,r,n,a){r.height||(r.height=r.bottom-r.top);var s=t.chart.context,o=i.outputs[i.outputMap[n]];t.chart.context.save(),"string"==typeof o&&(o={color:o,width:1});var l=o.width||1;s.lineWidth=i.highlight?l+2:l;var h=o.color;"auto"==h&&(h=t.defaultColor),s.strokeStyle=h;var u=o.pattern;s.setLineDash(e.borderPatternToArray(s.lineWidth,u)),s.lineDashOffset=0;var c=0,p=i.study,d=r.yAxis;d.shadow<1e3&&(c=2),d.shadow<5&&(c=4),(i.overlay||i.underlay)&&(c=null),(d.decimalPlaces||0===d.decimalPlaces)&&(c=d.decimalPlaces);var f=i.parameters.label,m=p.parameters;m||(m={});var g=!!i.series&&(i.series.parameters.type?"step"==i.series.parameters.type:"step"==m.plotType);m.noLabels&&(f=!1),i.noSlopes||!1===i.noSlopes||(i.noSlopes=m.noSlopes),i.extendToEnd||!1===i.extendToEnd||(i.extendToEnd=m.extendToEnd);var v=f||t.preferences.labels&&!1!==f,y=i.gaplines,x=y?t.getGapColorFunction(n,h,u,y):null;t.plotDataSegmentAsLine(n,r,{skipTransform:t.panels[i.panel].name!=i.chart.name,label:v,labelDecimalPlaces:c,noSlopes:i.noSlopes,step:g,extendToEndOfDataSet:i.extendToEnd,gaps:y},x),p.appendDisplaySeriesAsLine&&p.appendDisplaySeriesAsLine(t,i,a,n,r),t.chart.context.restore()},e.Studies.drawHorizontal=function(t,e,i,r){var n=t.panels[e.panel];if(n){var a=t.pixelFromPrice(r,n);a>n.top&&a<n.yAxis.bottom&&t.plotLine(n.left,n.right,a,a,"#DDDDDD","segment",t.chart.context,!1,{})}},e.Studies.displayHistogramWithSeries=function(t,i,r){var n=t.panels[i.panel];e.Studies.createYAxis(t,i,r,n),e.Studies.createHistogram(t,i,r,!1,.4),e.Studies.displaySeriesAsLine(t,i,r)},e.Studies.drawZones=function(t,i,r){if(i.parameters&&i.parameters.studyOverZonesEnabled){var n=parseFloat(i.parameters.studyOverSoldValue),a=parseFloat(i.parameters.studyOverBoughtValue),s=i.parameters.studyOverSoldColor,o=i.parameters.studyOverBoughtColor,l=i.zoneOutput;l||(l="Result");var h=e.Studies.determineColor(i.outputs[l]);h&&"auto"!=h&&!e.isTransparent(h)||(h=t.defaultColor),s||(s=h),s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor),o||(o=h),o&&"auto"!=o&&!e.isTransparent(o)||(o=t.defaultColor);var u=t.panels[i.panel],c=u.yAxis.displayBorder;!1===t.axisBorders&&(c=!1),!0===t.axisBorders&&(c=!0);var p=Math.round(u.right)+.5,d=c?p-.5:u.right,f=c?3:0,m=t.chart.context,g=m.fillStyle;t.chart.context.globalAlpha=.2,t.startClip(u.name,!0);var v=u.yAxis,y=v.yAxisPlotter=new e.Plotter;y.newSeries("border","stroke",t.canvasStyle("stx_grid_border")),m.beginPath();var x=Math.round(t.pixelFromPrice(a,u))+.5;m.strokeStyle=o,m.moveTo(u.left,x),m.lineTo(d,x),m.stroke(),m.closePath(),t.chart.context.beginPath();var C=Math.round(t.pixelFromPrice(n,u))+.5;m.strokeStyle=s,m.moveTo(u.left,C),m.lineTo(d,C),m.stroke(),m.closePath(),c&&(y.moveTo("border",p-.5,x),y.lineTo("border",p+f,x),y.moveTo("border",p-.5,C),y.lineTo("border",p+f,C)),m.fillStyle=g;var S={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:l+" "+i.name};if(e.preparePeakValleyFill(t,r,e.extend(S,{threshold:a,direction:1,color:o})),e.preparePeakValleyFill(t,r,e.extend(S,{threshold:n,direction:-1,color:s})),m.globalAlpha=1,!i.study||!i.study.yaxis){if(c){var w=Math.round(v.bottom)+.5;y.moveTo("border",p,v.top),y.lineTo("border",p,w),y.draw(t.chart.context,"border")}t.canvasFont("stx_yaxis"),t.canvasColor("stx_yaxis");var D=v.left+f+3;m.fillText(a,D,x),m.fillText(n,D,C),u.axisDrawn=!0}t.endClip(),m.globalAlpha=1}},e.Studies.createHistogram=function(t,i,r,n,a){var s=t.panels[i.panel];t.startClip(s.name);var o=t.layout.candleWidth-2;o<2&&(o=1);var l=t.pixelFromPrice(0,s);s.min>0&&(l=t.pixelFromPrice(s.min,s)),n&&(l=Math.floor(s.top+s.height/2));var h=t.chart.context,u=i.name+"_hist";i.outputs["Decreasing Bar"]||i.outputs["Negative Bar"]?h.globalAlpha=a||1:t.canvasColor("stx_histogram");for(var c=null,p=null,d=i.outputs,f=0;f<r.length;f++){var m=r[f];if(m){m.candleWidth&&(o=Math.floor(Math.max(1,m.candleWidth-2)));var g=Math.floor(t.pixelFromBar(f,s.chart)-o/2),v=Math.floor(o);if(null===c){var y=t.tickFromPixel(g,s.chart)-1;c=y<0?p:t.pixelFromPrice(t.chart.dataSet[y][u],s)-l}else c=p;p=t.pixelFromPrice(m[u],s)-l;var x=e.Studies.determineColor(d["Decreasing Bar"]),C=e.Studies.determineColor(d["Increasing Bar"]),S=e.Studies.determineColor(d["Positive Bar"]),w=e.Studies.determineColor(d["Negative Bar"]);x&&p>c?h.fillStyle=x:C&&p<c?h.fillStyle=C:S&&p<0?h.fillStyle=S:w&&p>0&&(h.fillStyle=w),h.fillRect(g,l,v,Math.floor(p))}}h.globalAlpha=1,t.endClip()},e.Studies.volumeChart=function(t,e,i,r){var n,a,s=-1*Number.MAX_VALUE;for(n in i)for(var o=0;o<i[n].length;o++)(a=i[n][o])&&a>s&&(s=a);var l=t.panels[e.panel],h=Math.floor(l.yAxis.bottom)+.5,u=Math.floor(l.yAxis.top)+.5,c=h-u,p=t.layout.candleWidth,d=null;e.parameters&&e.parameters.displayBorder||(r=null);var f=0;r||(f=(p-t.chart.tmpWidth)/2);var m=t.chart.context;m.lineWidth=1,t.startClip(e.panel);for(n in i){r&&(d=r[n]),m.fillStyle=n,d&&(m.strokeStyle=d),m.beginPath();for(var g,v=h+.5,y=Math.floor(t.pixelFromBar(0,l.chart)),x=0;x<i[n].length;x++)if(t.chart.dataSegment[x]&&t.chart.dataSegment[x].candleWidth?(p=t.chart.dataSegment[x].candleWidth,r||(f=p/4)):(p=t.layout.candleWidth,r||(f=(p-t.chart.tmpWidth)/2)),0===x&&(y-=p/2,g=y),a=i[n][x]){var C,S,w=a*(c/s),D=Math.min(Math.floor(h-c+(c-w))+.5,h);C=Math.floor(g+f),S=Math.floor(g+p-f),C=Math.max(C,y),m.moveTo(C,h),m.lineTo(S,h),m.lineTo(S,D),m.lineTo(C,D),r?(v>D||0===x)&&m.lineTo(C,v):m.lineTo(C,h),v=D,g+=p}else v=h,g+=p;m.fill(),m.strokeStyle=d,r&&t.layout.candleWidth>=2&&m.stroke(),m.closePath()}t.endClip()},e.Studies.prettify={Close:"C",Open:"O",High:"H",Low:"L",simple:"ma",exponential:"ema","time series":"tsma",triangular:"tma",variable:"vma",VIDYA:"vdma",weighted:"wma","welles wilder":"smma",true:"y",false:"n"},e.Studies.prettyRE=/^.*\((.*?)\).*$/,e.Studies.prettyDisplay=function(t){var i=e.Studies.prettyRE.exec(t);if(!i)return t;var r=i[1];if(r){for(var n in e.Studies.prettify)r=r.replace(n,e.Studies.prettify[n]);t=t.replace(i[1],r)}return t},e.Studies.getFieldInputs=function(t){var e=[],i=t.study.inputs;for(var r in i)"field"==i[r]&&e.push(r);return e},e.Studies.initializeFN=function(t,i,r,n,a,s,o){function l(i,r,n){for(var a=null,s=e.Studies.getFieldInputs(h),o=0;o<s.length;o++){var l=e.Studies.studyPanelMap[i[s[o]]];if(l){a=l.panel;break}"Volume"!=i[s[o]]||"Volume"==t.chart.defaultPlotField&&!t.highLowBars[t.layout.chartType]||(a=n.vchart?"vchart":"volume")}return a||(a=r.chartName),a}r||(r={id:i}),a||(a={}),r.display||(r.display=r.id);var h=new e.Studies.StudyDescriptor(r.id,i,r.id,r,n,a);r.Period&&(h.days=Math.max(1,parseInt(h.inputs.Period,10))),o?(o.inputs||(o.inputs=h.study.inputs),o.outputs||(o.outputs=h.study.outputs),h.study=o):o=h.study,o.display&&(r.display=o.display),s||(s=r.id);var u=h.overlay||o.overlay||r.Overlay,c=h.underlay||o.underlay||r.Underlay;c&&(h.underlay=!0),u&&(h.overlay=!0);var p=a.replaceID?t.layout.studies[a.replaceID]:null;if(p&&(t.panelExists(a.replaceID)||u||c))if(u||c)h.panel=l(r,a,t.panels),a.replaceID!=h.inputs.id&&(delete t.layout.studies[a.replaceID],delete t.overlays[a.replaceID],e.deleteRHS(e.Studies.studyPanelMap,p),t.panelExists(a.replaceID)&&t.panelClose(t.panels[a.replaceID]));else{h.panel=s;var d={};for(var f in t.panels)if(f==a.replaceID){var m=t.panels[f];m.name=s,m.display=r.display,d[s]=m,a.replaceID!=s&&e.deleteRHS(e.Studies.studyPanelMap,p),t.moveMarkers&&t.moveMarkers(a.replaceID,s)}else d[f]=t.panels[f];t.panels=d,a.replaceID!=h.inputs.id&&delete t.layout.studies[a.replaceID]}else if(t.panelExists(s))h.panel=s,h.underlay||h.panel!=t.chart.name||(h.overlay=!0);else if(u||c)h.panel=l(r,a,t.panels);else{var g=o.panelHeight?o.panelHeight:null;t.createPanel(r.display,r.id,g,a.chartName),o.yAxis||(t.panels[r.id].yAxis.displayGridLines=t.displayGridLinesInStudies),p&&a.replaceID!=h.inputs.id&&e.Studies.removeStudy(t,p)}var v=t.panels[h.panel];if(v&&v.chart.name!=v.name){var y=o?o.yAxis:null,x=o?o.parameters:null;y?(e.extend(v.yAxis,y),y.ground&&(v.yAxis.initialMarginBottom=0),(y.ground||y.initialMarginTop||0===y.initialMarginTop||y.initialMarginBottom||0===y.initialMarginBottom)&&t.calculateYAxisMargins(v.yAxis)):x&&(x.zoom||0===x.zoom)?v.yAxis.zoom=x.zoom:v.yAxis.zoom=10}return h},e.Studies.overZones=function(t,i,r){if(r.length){var n=t.panels[i.panel];if(n&&!n.hidden){e.Studies.displaySeriesAsLine(t,i,r);var a=i.parameters;if(a&&a.studyOverZonesEnabled){var s=t.chart.context,o=parseFloat(a.studyOverBoughtValue),l=parseFloat(a.studyOverSoldValue),h=n.height/n.shadow,u=n.bottom-h*o,c=n.bottom-h*l,p={lineWidth:1};if(s.globalAlpha=.2,t.plotLine(n.left,n.right-5,u,u,a.studyOverBoughtColor,"segment",s,!1,p),s.globalAlpha=.2,t.plotLine(n.left,n.right-5,c,c,a.studyOverSoldColor,"segment",s,!1,p),!i.study||!i.study.yaxis){var d=t.getCanvasFontSize("stx_yaxis");t.canvasFont("stx_yaxis"),t.canvasColor("stx_yaxis"),s.fillText(o,n.yAxis.left,u+d/2),s.fillText(l,n.yAxis.left,c+d/2),n.axisDrawn=!0}}}}},e.Studies.displayPSAR2=function(t,i,r){var n=t.panels[i.panel],a=n.name==n.chart.name;t.startClip(n.name);var s=t.chart.context,o="squarewave"==i.inputs["Plot Type"];for(var l in i.outputs){var h=l+" "+i.name;s.beginPath();for(var u=t.layout.candleWidth,c=Math.max(3,Math.floor(t.chart.tmpWidth/2)),p=0;p<r.length;p++){var d=r[p];if(d&&(d[h]||0===d[h])){d.candleWidth&&(u=d.candleWidth),a&&d.transform&&(d=d.transform);var f=t.pixelFromBar(p,n.chart);o&&(f-=u/2);var m=t.pixelFromTransformedValue(d[h],n);if(0!==p&&r[p-1]&&(r[p-1][h]||0===r[p-1][h])||s.moveTo(f,m),o){if(s.lineTo(f,m),s.lineTo(f+u,m),r[p+1]){var g=r[p+1];a&&g.transform&&(g=g.transform),g[h]||0===g[h]||s.lineTo(f+u,t.pixelFromTransformedValue(g[i.referenceOutput+" "+i.name],t.panels[i.panel]))}}else s.moveTo(f-c/2,m),s.lineTo(f+c/2,m)}}s.lineWidth=1,i.highlight&&(s.lineWidth=3);var v=e.Studies.determineColor(i.outputs[l]);"auto"==v&&(v=t.defaultColor),s.strokeStyle=v,s.stroke(),s.closePath(),s.lineWidth=1}t.endClip()},e.Studies.initializeStochastics=function(t,i,r,n){return r.display=t.translateIf("Stoch")+" ("+r.Period+")",e.Studies.initializeFN.apply(null,arguments)},e.Studies.calculateVolume=function(t,i){var r=i.outputs,n=e.Studies.determineColor(r["Up Volume"]),a=e.Studies.determineColor(r["Down Volume"]);if("vchart"==i.name||"volume"==i.name)t.setStyle("stx_volume_up","color",n),t.setStyle("stx_volume_down","color",a);else{if(!t||!t.chart.dataSet)return;var s=t.layout,o=i.parameters.removeStudy,l=s.volumeUnderlay;s.volumeUnderlay=!o,l!=s.volumeUnderlay&&t.changeOccurred("layout"),o?e.Studies.removeStudy(t,i):(t.setStyle("stx_volume_underlay_up","color",n),t.setStyle("stx_volume_underlay_down","color",a))}},e.Studies.MA=function(t,i,r,n,a,s,o){var l=new e.Studies.StudyDescriptor(a+" "+o.name,"ma",o.panel);l.chart=o.chart,l.days=parseInt(i,10),l.startFrom=o.startFrom,l.inputs={},t&&(l.inputs.Type=t),r&&(l.inputs.Field=r),n&&(l.inputs.Offset=parseInt(n,10)),e.Studies.calculateMovingAverage(s,l)},e.Studies.movingAverage={conversions:{ma:"simple",sma:"simple",ema:"exponential",tsma:"time series",tma:"triangular",vma:"variable",vdma:"vidya",wma:"weighted",smma:"welles wilder"},translations:{simple:"Simple",exponential:"Exponential","time series":"Time Series",triangular:"Triangular",variable:"Variable",vidya:"VIDYA",weighted:"Weighted","welles wilder":"Welles Wilder"},typeMap:{ema:"Exponential",exponential:"Exponential",tsma:"TimeSeries","time series":"TimeSeries",tma:"Triangular",triangular:"Triangular",vma:"Variable",variable:"Variable",vdma:"Variable",vidya:"Variable",wma:"Weighted",weighted:"Weighted",smma:"Exponential","welles wilder":"Exponential"}},e.Studies.movingAverageHelper=function(t,i){if("options"==i){var r={};for(var n in e.Studies.movingAverage.translations)r[n]=t.translateIf(e.Studies.movingAverage.translations[n]);return r}return e.Studies.movingAverage.conversions[i]},e.Studies.volUnderlay=function(t,i,r){e.Studies.createVolumeChart(t,i,r)},e.Studies.createVolumeChart=function(t,i,r){var n=i.panel,a=i.inputs,s=i.underlay,o=i.overlay,l=s||o,h=l?"stx_volume_underlay":"stx_volume",u=[{field:"Volume",fill_color_up:t.canvasStyle(h+"_up").color,border_color_up:t.canvasStyle(h+"_up").borderLeftColor,opacity_up:t.canvasStyle(h+"_up").opacity,fill_color_down:t.canvasStyle(h+"_down").color,border_color_down:t.canvasStyle(h+"_down").borderLeftColor,opacity_down:t.canvasStyle(h+"_down").opacity}],c=u[0];l||"rgb(184, 44, 12)"!==c.border_color_down||(c.border_color_down="#000000",c.border_color_up="#000000");var p={name:"Volume",panel:n,heightPercentage:l?.25:null,widthFactor:1,bindToYAxis:!l};e.extend(p,i.study.parameters),e.extend(p,i.parameters),t.colorByCandleDirection&&(c.color_function=function(t){var e=t.Open,i=t.Close;return{fill_color:e>i?c.fill_color_down:c.fill_color_up,border_color:e>i?c.border_color_down:c.border_color_up,opacity:e>i?c.opacity_down:c.opacity_up}}),l||(i.outputMap.Volume="transparent",e.Studies.createYAxis(t,i,i.chart.dataSegment,t.panels[n])),a.HeightPercentage&&(p.heightPercentage=a.HeightPercentage),t.drawHistogram(p,u)},e.Studies.calculateRSI=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);for(var r=e.startFrom;r<i.length;r++)if(r){var n=i[r],a=i[r-1],s=n.Close-a.Close,o=Math.min(r,e.days),l=a["_avgG "+e.name];l||(l=0),l-=l/o;var h=a["_avgL "+e.name];h||(h=0),h-=h/o,s>0?l+=s/o:h-=s/o,r>=e.days&&(n["RSI "+e.name]=function(t,e){return 0===e?100:100-100/(1+t/e)}(l,h)),n["_avgG "+e.name]=l,n["_avgL "+e.name]=h}
e.zoneOutput="RSI"},e.Studies.calculateMACD=function(t,i){var r=i.chart.scrubbed,n=i.inputs,a=i.name;if(i.macd1Days||(i.macd1Days=parseFloat(n["Fast MA Period"])),i.macd2Days||(i.macd2Days=parseFloat(n["Slow MA Period"])),i.signalDays||(i.signalDays=parseFloat(n["Signal Period"])),i.days||(i.days=Math.max(i.macd1Days,i.macd2Days,i.signalDays)),r.length<i.days+1)return void(i.error=!0);var s=i.inputs.Field;s&&"field"!=s||(s="Close");var o=n["Moving Average Type"];o||(o="exponential"),e.Studies.MA(o,i.macd1Days,s,0,"_MACD1",t,i),e.Studies.MA(o,i.macd2Days,s,0,"_MACD2",t,i);var l,h,u=Math.max(i.startFrom,i.days-1);for(l=u;l<r.length;l++)h=r[l],h["MACD "+a]=h["_MACD1 "+a]-h["_MACD2 "+a];var c=n["Signal MA Type"];c||(c="exponential"),e.Studies.MA(c,i.signalDays,"MACD "+a,0,"Signal",t,i);var p=a+"_hist";for(l=u;l<r.length;l++){h=r[l];var d=h["Signal "+a];(d||0===d)&&(h[p]=h["MACD "+a]-h["Signal "+a])}},e.Studies.calculateStandardDeviation=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close");var a=i.inputs["Moving Average Type"];a||(a=i.inputs.Type),e.Studies.MA(a,i.days,n,i.inputs.Offset,"_MA",t,i);var s=0,o=0,l=0,h=Number(i.inputs["Standard Deviations"]);h<0&&(h=2);var u=i.name;for(var c in i.outputs)u=c+" "+u;var p,d,f;for(p=i.startFrom-1,f=0;p>=0&&f<i.days;p--,f++)d=r[p][n],isNaN(d)&&(d=0),s+=Math.pow(d,2),o+=d;for(p=i.startFrom;p<r.length;p++){var m=r[p];if(d=m[n],isNaN(d)&&(d=0),s+=Math.pow(d,2),o+=d,!(p<i.days-1)){if(p>=i.days){var g=r[p-i.days][n];isNaN(g)&&(g=0),s-=Math.pow(g,2),o-=g}l=m["_MA "+i.name],m[u]=Math.sqrt((s+i.days*Math.pow(l,2)-2*l*o)/i.days)*h}}},e.Studies.calculateMovingAverage=function(t,i){if(i.chart.scrubbed){var r=i.inputs.Type;"ma"!=r&&r||(r="simple");var n=e.Studies.movingAverage.typeMap;if(r in n)return e.Studies["calculateMovingAverage"+n[r]](t,i);if("simple"===r){var a=i.chart.scrubbed,s=0,o=[],l=i.name;for(var h in i.outputs)l=h+" "+l;var u=i.inputs.Field;u&&"field"!=u||(u="Close");var c=parseInt(i.inputs.Offset,10);isNaN(c)&&(c=0);var p,d,f=i.startFrom,m=c;for(p=i.startFrom-1;p>=0;p--)if((d=a[p][u])||0===d)if(m>0)m--,f=p;else{if(o.length==i.days-1)break;s+=d,o.unshift(d)}for(o.length<i.days-1&&(o=[],f=0),p=f;p<a.length;p++){d=a[p][u];var g=p+c>=0&&p+c<a.length,v=g?a[p+c]:null;d||0===d?(s+=d,o.push(d),o.length>i.days&&(s-=o.shift()),v&&(v[l]=o.length==i.days?s/i.days:null)):v&&(v[l]=null)}}}},e.Studies.calculateMovingAverageExponential=function(t,e){var i=e.inputs.Type,r=e.chart.scrubbed,n=0,a=0,s=0,o=2/(e.days+1);"welles wilder"==i&&(o=1/e.days);var l=null,h=e.name;for(var u in e.outputs)h=u+" "+h;var c=e.inputs.Field;c&&"field"!=c||(c="Close");var p=parseInt(e.inputs.Offset,10);isNaN(p)&&(p=0);var d,f,m=e.startFrom,g=p;for(d=e.startFrom-1;d>=0;d--)if((f=r[d][h])||0===f){if(null===l&&(l=f),g<=0)break;g--,m=d}for(null===l&&(l=m=0),d=m;d<r.length;d++){f=r[d][c];var v=d+p>=0&&d+p<r.length,y=v?r[d+p]:null;f||0===f?(l||0===l?(a=(f-l)*o+l,y&&(y[h]=a)):s==e.days-1?(n+=f,a=n/e.days,y&&(y[h]=a)):0===s?(n+=f,a=n,y&&(y[h]=null)):(n+=f,a=n/(s+1),y&&(y[h]=null)),l=a,s++):y&&(y[h]=null)}},e.Studies.calculateMovingAverageVariable=function(t,i){var r=i.inputs.Type,n=i.chart.scrubbed,a=2/(i.days+1),s=null,o=i.name;for(var l in i.outputs)o=l+" "+o;var h=i.inputs.Field;h&&"field"!=h||(h="Close"),"vidya"==r?(i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=5,i.std.startFrom=i.startFrom,i.std.inputs={Field:h,"Standard Deviations":1,Type:"ma"},i.std.outputs={_STD:null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.MA("ma",20,"_STD "+i.name,0,"_MASTD",t,i)):(i.cmo=new e.Studies.StudyDescriptor(i.name,"cmo",i.panel),i.cmo.chart=i.chart,i.cmo.days=9,i.cmo.startFrom=i.startFrom,i.cmo.outputs={_CMO:null},e.Studies.calculateChandeMomentum(t,i.cmo));var u=parseInt(i.inputs.Offset,10);isNaN(u)&&(u=0);var c,p,d=i.startFrom,f=u;for(c=i.startFrom-1;c>=0;c--)if((p=n[c][o])||0===p){if(null===s&&(s=p),f<=0)break;f--,d=c}for(null===s&&(s=d=0),c=d;c<n.length;c++){var m=n[c];p=m[h];var g=c+u>=0&&c+u<n.length,v=g?n[c+u]:null;if(p||0===p){var y;if("vidya"==r){if(!m["_MASTD "+i.name])continue;y=m["_STD "+i.name]/m["_MASTD "+i.name]}else{if(!m["_CMO "+i.name])continue;y=Math.abs(m["_CMO "+i.name])/100}var x=a*y*p+(1-a*y)*s;v&&(v[o]=x),s=x}else v&&(v[o]=null)}},e.Studies.calculateMovingAverageTimeSeries=function(t,i){i.ma=new e.Studies.StudyDescriptor(i.name,"ma",i.panel),i.ma.chart=i.chart,i.ma.days=i.days,i.ma.startFrom=i.startFrom,i.ma.inputs=i.inputs,e.Studies.calculateLinearRegressionIndicator(t,i.ma);var r=i.name;for(var n in i.outputs)r=n+" "+r;var a=parseInt(i.inputs.Offset,10);isNaN(a)&&(a=0);for(var s=i.chart.scrubbed,o=a,l=i.startFrom-1;l>=0;l--){var h=s[l][r];if(h||0===h){if(!(o>0))break;o--}}for(l++;l<s.length;l++){var u=s[l];l+a>=0&&l+a<s.length&&(s[l+a][r]=u["Forecast "+i.name])}},e.Studies.calculateMovingAverageTriangular=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close");var a=Math.ceil(i.days/2);e.Studies.MA("simple",a,i.inputs.Field,0,"TRI1",t,i),i.days%2==0&&a++,e.Studies.MA("simple",a,"TRI1 "+i.name,0,"TRI2",t,i);var s=i.name;for(var o in i.outputs)s=o+" "+s;var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0);for(var h=l,u=i.startFrom-1;u>=0;u--){var c=r[u][s];if(c||0===c){if(!(h>0))break;h--}}for(u++;u<r.length;u++)u+l>=0&&u+l<r.length&&(r[u+l][s]=r[u]["TRI2 "+i.name])},e.Studies.calculateMovingAverageWeighted=function(t,e){var i=e.chart.scrubbed,r=0,n=0,a=e.inputs.Field;a&&"field"!=a||(a="Close");var s=e.days*(e.days+1)/2,o=e.name;for(var l in e.outputs)o=l+" "+o;var h=parseInt(e.inputs.Offset,10);isNaN(h)&&(h=0);var u,c,p=[],d=e.startFrom,f=h;for(u=e.startFrom-1;u>=0;u--)if((c=i[u][a])||0===c)if(f>0)f--,d=u;else{if(p.length==e.days-1)break;p.unshift(c)}for(p.length<e.days-1&&(p=[],d=0),u=0;u<p.length;u++)r+=(u+1)*p[u],n+=p[u];for(u=d;u<i.length;u++){c=i[u][a];var m=u+h>=0&&u+h<i.length,g=m?i[u+h]:null;c||0===c?(p.push(c),p.length>e.days&&(r-=n,n-=p.shift()),r+=p.length*c,n+=c,u<e.days-1?g&&(g[o]=null):g&&(g[o]=r/s)):g&&(g[o]=null)}},e.Studies.calculateKlinger=function(t,i){var r=i.chart.scrubbed,n=Number(i.inputs["Short Cycle"]),a=Number(i.inputs["Long Cycle"]);if(r.length<Math.max(n,a)+1)return void(i.error=!0);var s,o=i.name+"_hist",l="Klinger "+i.name,h="KlingerSignal "+i.name,u="_SV "+i.name,c="_EMA-S "+i.name,p="_EMA-L "+i.name;for(s=Math.max(1,i.startFrom);s<r.length;s++){var d=r[s].Volume;r[s]["hlc/3"]<r[s-1]["hlc/3"]&&(d*=-1),r[s][u]=d}for(e.Studies.MA("exponential",n,u,0,"_EMA-S",t,i),e.Studies.MA("exponential",a,u,0,"_EMA-L",t,i),s=Math.max(a,i.startFrom);s<r.length;s++)r[s][l]=r[s][c]-r[s][p];for(e.Studies.MA("exponential",Number(i.inputs["Signal Periods"]),l,0,"KlingerSignal",t,i),s=i.startFrom;s<r.length;s++)r[s][o]=r[s][l]-r[s][h]},e.Studies.calculateStochastics=function(t,i){i.smooth||(i.smooth=i.inputs.Smooth);var r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=i.inputs["%K Periods"];n||(n=i.days);var a=i.chart.scrubbed;if(a.length<Math.max(n,i.days)+1)return void(i.error=!0);var s=i.inputs["%K Smoothing Periods"];s?i.smooth=!0:i.smooth&&(s=3);var o=i.inputs["%D Periods"];o||(o=3),i.outputMap={},i.outputMap["%K "+i.name]="Fast",i.outputMap["%D "+i.name]="Slow";for(var l=Math.max(n,i.startFrom);l<a.length;l++)a[l][i.name]=function(t,e,i){for(var r=t-i+1,n=-1*Number.MAX_VALUE,s=Number.MAX_VALUE,o=r;o<=t;o++)s=Math.min(s,a[o].Low),n=Math.max(n,a[o].High);return n==s?0:(a[t][e]-s)/(n-s)*100}(l,r,n);e.Studies.MA("simple",i.smooth?s:1,i.name,0,"%K",t,i),e.Studies.MA("simple",o,"%K "+i.name,0,"%D",t,i)},e.Studies.calculateStudyATR=function(t,e){var i=e.chart.scrubbed,r=e.days;if(i.length<r+1)return void(e.error=!0);for(var n=0,a=e.name,s=Math.max(e.startFrom,1);s<i.length;s++){var o=i[s],l=i[s-1],h=o.trueRange;l["Sum True Range "+a]&&(n=l["Sum True Range "+a]),n+=h,s>r&&(n-=i[s-r]["True Range "+a]),o["True Range "+a]=h,o["Sum True Range "+a]=n,s==r?o["ATR "+a]=n/r:s>r&&(o["ATR "+a]=(l["ATR "+a]*(r-1)+h)/r)}},e.Studies.calculatePSAR=function(t,e){function i(){n=0,a=null,s=!s}var r=e.chart.scrubbed,n=0,a=null,s=!1,o=0,l=parseFloat(e.inputs["Minimum AF"]),h=parseFloat(e.inputs["Maximum AF"]);if(e.startFrom>0){o=r[e.startFrom-1]["Result "+e.name];var u=r[e.startFrom-1]["_state "+e.name];u&&3==u.length&&(n=u[0],a=u[1],s=u[2])}for(var c=e.startFrom-1;c<r.length-1;c++)if(!(c<0)){var p=o;if(s){(!a||a<r[c].High)&&(a=r[c].High,n=Math.min(n+l,h)),o=p+n*(a-p);var d=Math.min(r[Math.max(1,c)-1].Low,r[c].Low);o>r[c+1].Low?(o=a,i()):o>d&&(o=d)}else{(!a||a>r[c].Low)&&(a=r[c].Low,n=Math.min(n+l,h)),o=p+n*(a-p);var f=Math.max(r[Math.max(1,c)-1].High,r[c].High);o<r[c+1].High?(o=a,i()):o<f&&(o=f)}r[c+1]["Result "+e.name]=o,r[c+1]["_state "+e.name]=[n,a,s]}},e.Studies.calculateTRIX=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);for(var n=i.name,a=["Close","_MA1 "+n,"_MA2 "+n,"_MA3 "+n],s=0;s<a.length-1;s++)e.Studies.MA("exponential",i.days,a[s],0,"_MA"+(s+1).toString(),t,i);for(var o=a[3],l=Math.max(1,i.startFrom);l<r.length;l++){var h=r[l-1][o];h&&(r[l]["Result "+n]=100*(r[l][o]/h-1))}},e.Studies.calculateIntradayMomentum=function(t,e){var i=e.chart.scrubbed,r=e.days;if(i.length<r+1)return void(e.error=!0);var n=0,a=0;e.startFrom>1&&(n=i[e.startFrom-1]["_totUp "+e.name],a=i[e.startFrom-1]["_totDn "+e.name]);for(var s=e.startFrom;s<i.length;s++){var o=i[s].Close-i[s].Open;if(o>0?n+=o:a-=o,s>=r){var l=i[s-r].Close-i[s-r].Open;l>0?n-=l:a+=l}i[s]["Result "+e.name]=100*n/(n+a),i[s]["_totUp "+e.name]=n,i[s]["_totDn "+e.name]=a}},e.Studies.calculateQStick=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);for(var n=i.startFrom;n<r.length;n++)r[n]["_Close-Open "+i.name]=r[n].Close-r[n].Open;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Close-Open "+i.name,0,"Result",t,i)},e.Studies.calculateSchaff=function(t,i){function r(t,e,r){for(var a=null,s=null,o=e-t+1;o<=e;o++){var l=n[o][r+" "+i.name];l&&(a=null===a?l:Math.min(a,l),s=null===s?l:Math.max(s,l))}return[a,s]}var n=i.chart.scrubbed,a=i.days,s=Number(i.inputs["Short Cycle"]),o=Number(i.inputs["Long Cycle"]);if(n.length<Math.max(a,s,o)+1)return void(i.error=!0);var l=i.inputs.Field;l&&"field"!=l||(l="Close");e.Studies.MA(i.inputs["Moving Average Type"],s,l,0,"_MACD1",t,i),e.Studies.MA(i.inputs["Moving Average Type"],o,l,0,"_MACD2",t,i);for(var h=0,u=0,c=i.startFrom;c<n.length;c++){var p=n[c];if(p["Result "+i.name]=u,!(c<o-1||(p["_MACD "+i.name]=p["_MACD1 "+i.name]-p["_MACD2 "+i.name],c<o+(a-1)))){var d=r(a,c,"_MACD");h=d[1]>d[0]?100*(p["_MACD "+i.name]-d[0])/(d[1]-d[0]):h,p["_PF "+i.name]=n[c-1]["_PF "+i.name]?n[c-1]["_PF "+i.name]+.5*(h-n[c-1]["_PF "+i.name]):h,c<o+2*(a-1)||(d=r(a,c,"_PF"),u=d[1]>d[0]?100*(p["_PF "+i.name]-d[0])/(d[1]-d[0]):u,p["Result "+i.name]=n[c-1]["Result "+i.name]?n[c-1]["Result "+i.name]+.5*(u-n[c-1]["Result "+i.name]):u)}}},e.Studies.calculateStochMomentum=function(t,i){var r=Number(i.inputs["%K Periods"]),n=Number(i.inputs["%K Smoothing Periods"]),a=Number(i.inputs["%K Double Smoothing Periods"]),s=Number(i.inputs["%D Periods"]),o=i.chart.scrubbed;if(o.length<r+n+a-1||o.length<s)return void(i.error=!0);var l;for(l=Math.max(r,i.startFrom)-1;l<o.length;l++){var h=o[l],u=function(t,e){for(var i=null,r=null,n=e-t+1;n<=e;n++)i=null===i?o[n].Low:Math.min(i,o[n].Low),r=null===r?o[n].High:Math.max(r,o[n].High);return[i,r]}(r,l);h["_H "+i.name]=h.Close-(u[0]+u[1])/2,h["_DHL "+i.name]=u[1]-u[0]}for(e.Studies.MA("exponential",n,"_H "+i.name,0,"_HS1",t,i),e.Studies.MA("exponential",a,"_HS1 "+i.name,0,"_HS2",t,i),e.Studies.MA("exponential",n,"_DHL "+i.name,0,"_DHL1",t,i),e.Studies.MA("exponential",a,"_DHL1 "+i.name,0,"_DHL2",t,i),l=r-1;l<o.length;l++)o[l]["%K "+i.name]=o[l]["_HS2 "+i.name]/(.5*o[l]["_DHL2 "+i.name])*100;e.Studies.MA(i.inputs["%D Moving Average Type"],s,"%K "+i.name,0,"%D",t,i),i.zoneOutput="%K"},e.Studies.calculateEhlerFisher=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=0;e.startFrom>1&&(r=i[e.startFrom-1]["_n "+e.name]);for(var n=e.startFrom;n<i.length;n++){var a=i[n];if(n<e.days-1)a["EF "+e.name]=a["EF Trigger "+e.name]=r;else{var s=function(t,e){for(var r=Number.MAX_VALUE,n=-1*Number.MAX_VALUE,a=e-t+1;a<=e;a++){var s=(i[a].High+i[a].Low)/2;r=Math.min(r,s),n=Math.max(n,s)}return[r,n]}(e.days,n);r=.66*(((i[n].High+i[n].Low)/2-s[0])/Math.max(1e-6,s[1]-s[0])-.5)+.67*r,r>0?r=Math.min(r,.9999):r<0&&(r=Math.max(r,-.9999));var o=n?i[n-1]["EF "+e.name]:0;a["EF "+e.name]=.5*Math.log((1+r)/(1-r))+.5*o,a["EF Trigger "+e.name]=o,a["_n "+e.name]=r}}},e.Studies.calculatePrettyGoodOscillator=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);e.Studies.MA("exponential",i.days,"trueRange",0,"_EMA",t,i),e.Studies.MA("simple",i.days,"Close",0,"_SMA",t,i);for(var n=Math.max(1,i.startFrom);n<r.length;n++)r[n]["_SMA "+i.name]&&r[n]["_EMA "+i.name]&&(r[n]["Result "+i.name]=(r[n].Close-r[n]["_SMA "+i.name])/r[n]["_EMA "+i.name])},e.Studies.calculateUltimateOscillator=function(t,e){var i=e.chart.scrubbed,r=[e.inputs["Cycle 1"],e.inputs["Cycle 2"],e.inputs["Cycle 3"]],n=Math.max(r[0],r[1],r[2]);if(i.length<n+1)return void(e.error=!0);var a=r[0]*r[1],s=r[0]*r[2],o=r[1]*r[2],l=[0,0,0],h=[0,0,0];e.startFrom&&(i[e.startFrom-1]["_accbp "+e.name]&&(l=i[e.startFrom-1]["_accbp "+e.name].slice()),i[e.startFrom-1]["_acctr "+e.name]&&(h=i[e.startFrom-1]["_acctr "+e.name].slice()));for(var u=Math.max(1,e.startFrom);u<i.length;u++){for(var c=Math.min(i[u].Low,i[u-1].Close),p=i[u].Close-c,d=Math.max(i[u].High,i[u-1].Close)-c,f=0;f<r.length;f++)if(l[f]+=p,h[f]+=d,u>r[f]){var m=Math.min(i[u-r[f]].Low,i[u-r[f]-1].Close),g=i[u-r[f]].Close-m,v=Math.max(i[u-r[f]].High,i[u-r[f]-1].Close)-m;l[f]-=g,h[f]-=v}if(i[u]["_accbp "+e.name]=l.slice(),i[u]["_acctr "+e.name]=h.slice(),!(u<n)){var y=o*l[0]/h[0]+s*l[1]/h[1]+a*l[2]/h[2],x=o+s+a;i[u]["Result "+e.name]=100*y/x}}},e.Studies.calculatePriceVolumeTrend=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var r=e.chart.scrubbed,n=0;e.startFrom>1&&(n=r[e.startFrom-1]["Result "+e.name]);for(var a=Math.max(1,e.startFrom);a<r.length;a++)r[a][i]&&r[a-1][i]&&(n+=r[a].Volume*(r[a][i]-r[a-1][i])/r[a-1][i],r[a]["Result "+e.name]=n)},e.Studies.calculateOnBalanceVolume=function(t,e){var i=e.inputs.Field;i&&"field"!=i||(i="Close");var r=e.inputs["Min Tick Value"],n=!1;r||0===r||(n=!0,r=0);for(var a,s,o=e.chart.scrubbed,l=0,h=e.startFrom;h<o.length;h++)if(a=o[h],h&&a[i]&&(o[h-1][i]&&(s=o[h-1]),s)){a[i]-s[i]>r?l=1:s[i]-a[i]>r?l=-1:n&&(l=0);var u=s["Result "+e.name];u||(u=0),u+=a.Volume*l,a["Result "+e.name]=u}},e.Studies.calculateVolumeIndex=function(t,i){var r=i.inputs.Field;r&&"field"!=r||(r="Close");var n=i.chart.scrubbed;if(n.length<i.days+1)return void(i.error=!0);var a=100;i.startFrom>1&&(a=n[i.startFrom-1]["Index "+i.name]);for(var s=Math.max(1,i.startFrom);s<n.length;s++)n[s][r]&&n[s-1][r]&&(("Pos Vol"==i.type&&n[s].Volume>n[s-1].Volume||"Neg Vol"==i.type&&n[s].Volume<n[s-1].Volume)&&(a*=n[s][r]/n[s-1][r]),n[s]["Index "+i.name]=a);e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Index "+i.name,0,"MA",t,i)},e.Studies.calculateHistoricalVolatility=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=e.inputs.Field;r&&"field"!=r||(r="Close");var n=e.inputs["Standard Deviations"];n<0&&(n=1);var a=100*Math.sqrt(function(e){return isNaN(e)&&(e=365),"day"==t.layout.interval?e:"week"==t.layout.interval?52:"month"==t.layout.interval?12:e}(e.inputs["Days Per Year"]))*n,s=[],o=0;e.startFrom>1&&(o=i[e.startFrom-1]["_state "+e.name][0],s=i[e.startFrom-1]["_state "+e.name][1].slice());for(var l=Math.max(1,e.startFrom);l<i.length;l++){var h=i[l-1][r];if(h){var u=Math.log(i[l][r]/h);if(s.push(u),o+=u,l>=e.days){var c=0;o/=e.days;for(var p=0;p<s.length;p++)c+=Math.pow(s[p]-o,2);o*=e.days,o-=s.shift(),i[l]["Result "+e.name]=Math.sqrt(c/e.days)*a}}i[l]["_state "+e.name]=[o,s.slice()]}},e.Studies.calculateSwingIndex=function(t,e){var i=e.inputs["Limit Move Value"];(null===i||isNaN(i))&&(i=99999);var r=e.chart.scrubbed,n=0;e.startFrom>1&&(n=r[e.startFrom-1]["Result "+e.name]);for(var a=Math.max(1,e.startFrom);a<r.length;a++){var s=Math.abs(r[a].High-r[a-1].Close),o=Math.abs(r[a].Low-r[a-1].Close),l=Math.abs(r[a].High-r[a].Low),h=Math.abs(r[a-1].Close-r[a-1].Open),u=Math.max(s,o),c=Math.max(l,u),p=c+.25*h;c==s?p-=.5*o:c==o&&(p-=.5*s);var d=50*(r[a].Close-r[a-1].Close+.5*(r[a].Close-r[a].Open)+.25*(r[a-1].Close-r[a-1].Open))/p*(u/i);0!==p&&0!==i||(d=0),"Swing"==e.type&&(n=0),n+=d,r[a]["Result "+e.name]=n}},e.Studies.calculateADX=function(t,i){e.Studies.calculateStudyATR(t,i);var r=i.chart.scrubbed,n=i.days,a=parseInt(i.inputs["Smoothing Period"],10);if(a||0===a||(a=n),r.length<i.days+1)return void(i.error=!0);for(var s,o=0,l=0,h=0,u=0,c=Math.max(1,i.startFrom);c<r.length;c++){s=r[c];var p=Math.max(0,s.High-r[c-1].High),d=Math.max(0,r[c-1].Low-s.Low);if(p>d?d=0:p=d>p?0:d=0,c<=n?(l+=p,h+=d,o+=s["True Range "+i.name]):(l=r[c-1]["_sm+DM "+i.name]*(n-1)/n+p,h=r[c-1]["_sm-DM "+i.name]*(n-1)/n+d,o=r[c-1]["_smTR "+i.name]*(n-1)/n+s["True Range "+i.name]),s["_sm+DM "+i.name]=l,s["_sm-DM "+i.name]=h,s["_smTR "+i.name]=o,!(c<n)){var f=100*l/o,m=100*h/o,g=100*Math.abs(f-m)/(f+m);if(s["+DI "+i.name]=f,s["-DI "+i.name]=m,!1!==i.inputs.Series&&a)if(c<n+a-1){if(c==i.startFrom)for(var v=n;v<i.startFrom;v++)u+=100*Math.abs(r[v]["+DI "+i.name]-r[v]["-DI "+i.name])/(r[v]["+DI "+i.name]+r[v]["-DI "+i.name]);u+=g}else s["ADX "+i.name]=c==n+a-1?u/a:(r[c-1]["ADX "+i.name]*(a-1)+g)/a;if(i.inputs.Histogram){var y=i.name+"_hist";if(!s["+DI "+i.name]&&0!==s["+DI "+i.name])continue;if(!s["-DI "+i.name]&&0!==s["-DI "+i.name])continue;s[y]=s["+DI "+i.name]-s["-DI "+i.name],!1===i.inputs.Series&&(s["+DI "+i.name]=null,s["-DI "+i.name]=null)}}}},e.Studies.calculateRandomWalk=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);for(var r=Math.max(2,e.startFrom);r<i.length;r++){for(var n=0,a=i[r].High,s=i[r].Low,o=0,l=0,h=1;h<=e.days;h++){if(r<=h){o=l=0;break}n+=i[r-h].trueRange;var u=n/h*Math.sqrt(h);if(u){var c=(a-i[r-h].Low)/u,p=(i[r-h].High-s)/u;o=Math.max(o,c),l=Math.max(l,p)}}i[r]["Random Walk High "+e.name]=o,i[r]["Random Walk Low "+e.name]=l}},e.Studies.calculateRateOfChange=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=e.inputs.Field;"Vol ROC"==e.type?r="Volume":r&&"field"!=r||(r="Close");var n=e.name;for(var a in e.outputs)n=a+" "+n;var s=e.inputs["Center Line"];s=s?parseInt(s,10):0;for(var o=Math.max(e.startFrom,e.days);o<i.length;o++)if("Momentum"==e.type)i[o][n]=i[o][r]-i[o-e.days][r]+s;else{var l=i[o-e.days][r];l&&(i[o][n]=100*(i[o][r]/l-1)+s)}},e.Studies.calculateTypicalPrice=function(t,e){var i=e.chart.scrubbed,r=e.days;if(i.length<r+1)return void(e.overlay||(e.error=!0));var n=e.name;for(var a in e.outputs)n=a+" "+n;var s="hlc/3";"Med Price"==e.type?s="hl/2":"Weighted Close"==e.type&&(s="hlcc/4");var o=0;e.startFrom<=r&&(e.startFrom=0);for(var l=e.startFrom;l<i.length;l++)l&&i[l-1][n]&&(o=i[l-1][n]*r),o+=i[l][s],l>=r&&(o-=i[l-r][s],i[l][n]=o/r)},e.Studies.calculateElderRay=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days)return void(i.error=!0);e.Studies.MA("exponential",i.days,"Close",0,"_EMA",t,i);for(var n=Math.max(i.startFrom,i.days-1);n<r.length;n++)r[n][i.name+"_hist1"]=r[n].High-r[n]["_EMA "+i.name],r[n][i.name+"_hist2"]=r[n].Low-r[n]["_EMA "+i.name]},e.Studies.calculateElderForce=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days)return void(i.error=!0);for(var n=Math.max(1,i.startFrom);n<r.length;n++)r[n]["_EF1 "+i.name]=r[n].Volume*(r[n].Close-r[n-1].Close);e.Studies.MA("exponential",i.days,"_EF1 "+i.name,0,"Result",t,i)},e.Studies.calculateCenterOfGravity=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)return void(e.error=!0);var r=e.inputs.Field;r&&"field"!=r||(r="Close");for(var n=Math.max(e.startFrom,e.days-1);n<i.length;n++){for(var a=0,s=0,o=0;o<e.days;o++)a-=(o+1)*i[n-o][r],s+=i[n-o][r];s&&(i[n]["Result "+e.name]=a/s)}},e.Studies.calculateEaseOfMovement=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days)return void(i.error=!0);for(var n=Math.max(1,i.startFrom);n<r.length;n++){var a=(r[n].High+r[n].Low)/2,s=(r[n-1].High+r[n-1].Low)/2,o=a-s,l=r[n].Volume/1e8/(r[n].High-r[n].Low);r[n]["_EOM1 "+i.name]=0===l?NaN:o/l}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_EOM1 "+i.name,0,"Result",t,i)},e.Studies.calculateChaikinVolatility=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days)return void(i.error=!0);var n;for(n=i.startFrom;n<r.length;n++)r[n]["_High-Low "+i.name]=r[n].High-r[n].Low;e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_High-Low "+i.name,0,"_MA",t,i);var a=i.inputs["Rate Of Change"];for(a||(a=i.days),n=Math.max(i.startFrom,a);n<r.length;n++)r[n-a]["_MA "+i.name]&&(r[n]["Result "+i.name]=100*(r[n]["_MA "+i.name]/r[n-a]["_MA "+i.name]-1))},e.Studies.calculateChaikinMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)return void(e.error=!0);var r=0,n=0,a=i[e.startFrom-1];a&&(a["_sumMF "+e.name]&&(r=a["_sumMF "+e.name]),a["_sumV "+e.name]&&(n=a["_sumV "+e.name]));for(var s=e.startFrom;s<i.length;s++)i[s].High==i[s].Low?i[s]["_MFV "+e.name]=0:i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-i[s].High-i[s].Low)/(i[s].High-i[s].Low),r+=i[s]["_MFV "+e.name],n+=i[s].Volume,s>e.days-1&&(r-=i[s-e.days]["_MFV "+e.name],(n-=i[s-e.days].Volume)&&(i[s]["Result "+e.name]=r/n)),i[s]["_sumMF "+e.name]=r,i[s]["_sumV "+e.name]=n},e.Studies.calculateTwiggsMoneyFlow=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days)return void(e.error=!0);var r=0,n=0,a=i[e.startFrom-1];a&&(a["_sumMF "+e.name]&&(r=a["_sumMF "+e.name]),a["_sumV "+e.name]&&(n=a["_sumV "+e.name]));for(var s=Math.max(1,e.startFrom);s<i.length;s++){var o=Math.max(i[s-1].Close,i[s].High),l=Math.min(i[s-1].Close,i[s].Low);i[s]["_MFV "+e.name]=i[s].Volume*(2*i[s].Close-o-l)/(o-l==0?999999:o-l),s>e.days-1&&(r*=(e.days-1)/e.days,n*=(e.days-1)/e.days),r+=i[s]["_MFV "+e.name],n+=i[s].Volume,s>e.days-1&&n&&(i[s]["Result "+e.name]=r/(n>0?n:999999)),i[s]["_sumMF "+e.name]=r,i[s]["_sumV "+e.name]=n}},e.Studies.calculateMassIndex=function(t,i){var r=i.chart.scrubbed;if(r.length<Math.max(9,i.days+1))return void(i.error=!0);for(var n=i.startFrom;n<r.length;n++)r[n]["_High-Low "+i.name]=r[n].High-r[n].Low;e.Studies.MA("exponential",9,"_High-Low "+i.name,0,"_EMA",t,i),e.Studies.MA("exponential",9,"_EMA "+i.name,0,"_EMA2",t,i);var a=0;r[i.startFrom-1]&&r[i.startFrom-1]["_total "+i.name]&&(a=r[i.startFrom-1]["_total "+i.name]);for(var s=Math.max(17,i.startFrom);s<r.length;s++)a+=r[s]["_EMA "+i.name]/r[s]["_EMA2 "+i.name],s>=17+i.days-1&&(r[s]["Result "+i.name]=a,a-=r[s-i.days+1]["_EMA "+i.name]/r[s-i.days+1]["_EMA2 "+i.name]),r[s]["_total "+i.name]=a},e.Studies.calculateMoneyFlowIndex=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=0,n=0,a=i[e.startFrom-1],s="_rawMF "+e.name,o="_cumMF "+e.name,l="Result "+e.name;a&&a[o]&&(r=a[o][0],n=a[o][1]);for(var h=e.startFrom;h<i.length;h++){var u=i[h]["hlc/3"];if(h>0){var c=i[h-1]["hlc/3"],p=u*i[h].Volume;if(u>c?r+=p:u<c?(p*=-1,n-=p):p=0,h>e.days){var d=i[h-e.days][s];d>0?r-=d:n+=d,i[h][l]=0===n?100:100-100/(1+r/n)}i[h][s]=p,i[h][o]=[r,n]}}},e.Studies.calculateChandeMomentum=function(t,e){var i=e.name;for(var r in e.outputs)i=r+" "+i;var n=e.chart.scrubbed;if(n.length<e.days+1)return void(e.error=!0);for(var a=0,s=0,o=[],l=e.startFrom-e.days+1;l<n.length;l++)if(!(l<1)){var h=n[l].Close-n[l-1].Close;if(o.push(h),a+=h,s+=Math.abs(h),o.length==e.days){n[l][i]=100*a/s;var u=o.shift();a-=u,s-=Math.abs(u)}}},e.Studies.calculateChandeForecast=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA("time series",i.days,n,0,"MA",t,i);for(var a=Math.max(1,i.startFrom);a<r.length;a++)r[a]["Result "+i.name]=100*(1-r[a]["MA "+i.name]/r[a][n])},e.Studies.calculateDetrendedPrice=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,n,0,"MA",t,i);for(var a=Math.max(i.startFrom,Math.floor(i.days/2+1));a<r.length;a++)r[a]["Result "+i.name]=r[a-Math.floor(i.days/2+1)][n]-r[a]["MA "+i.name]},e.Studies.calculateAroon=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=0,n=0,a=null,s=null;if(e.startFrom>0){var o=i[e.startFrom-1]["_state "+e.name];o&&(r=o[0],n=o[1],a=o[2],s=o[3])}for(var l,h=e.startFrom;h<i.length;h++){if(null===a&&(a=i[h].High),null===s&&(s=i[h].Low),(a=Math.max(a,i[h].High))==i[h].High)r=0;else if(++r>e.days)for(a=i[h].High,r=0,l=1;l<=e.days;l++)(a=Math.max(a,i[h-l].High))==i[h-l].High&&(r=l);if((s=Math.min(s,i[h].Low))==i[h].Low)n=0;else if(++n>e.days)for(s=i[h].Low,n=0,l=1;l<=e.days;l++)(s=Math.min(s,i[h-l].Low))==i[h-l].Low&&(n=l);i[h]["Aroon Up "+e.name]=100*(1-r/e.days),i[h]["Aroon Down "+e.name]=100*(1-n/e.days),i[h]["Aroon Oscillator "+e.name]=i[h]["Aroon Up "+e.name]-i[h]["Aroon Down "+e.name],i[h]["_state "+e.name]=[r,n,a,s]}},e.Studies.calculatePrimeNumber=function(t,e){function i(t){if(t<=0)return!1;if(t!=Math.floor(t))return!1;if(!0===r[t]||!1===r[t])return r[t];for(var e=parseInt(Math.sqrt(t),10),i=2;i<=e;i++)if(t%i==0)return r[t]=!1,!1;return r[t]=!0,!0}for(var r=[],n=e.chart.scrubbed,a=e.startFrom;a<n.length;a++){var s=n[a];if(s){for(var o=s.High,l=0;o>0&&o<=10;l++)o*=10;for(i(o)&&(o+=2),o=Math.ceil(o),o%2==0&&o++;!i(o);)o+=2;o/=Math.pow(10,l);for(var h=s.Low,u=0;h>0&&h<=10;u++)h*=10;if(i(h)&&(h-=2),h=Math.floor(h),h%2==0&&h--,h>0){for(;!i(h);)h-=2;h/=Math.pow(10,u)}if("Prime Number Bands"==e.type)s["Prime Bands Top "+e.name]=o,s["Prime Bands Bottom "+e.name]=Math.max(0,h);else{var c=0,p=e.inputs["Tolerance Percentage"]*(o-h)/100,d=o+h-2*s.Close;d<p?c=1:d>p&&(c=-1),c&&(s["Result "+e.name]=c)}}}},e.Studies.calculateVerticalHorizontalFilter=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);i.mhml=new e.Studies.StudyDescriptor(i.name,i.type,i.panel),i.mhml.chart=i.chart,i.mhml.days=i.days,i.mhml.startFrom=i.startFrom,i.mhml.inputs={},i.mhml.outputs={_MHML:null},e.Studies.calculateMaxHighMinLow(t,i.mhml);for(var n=0,a=[],s=Math.max(1,i.startFrom-i.days);s<r.length;s++){var o=Math.abs(r[s].Close-r[s-1].Close);a.push(o),n+=o,a.length==i.days&&(r[s]["Result "+i.name]=r[s]["_MHML "+i.name]/n,n-=a.shift())}},e.Studies.calculatePriceOscillator=function(t,i){var r=i.chart.scrubbed,n=Number(i.inputs["Short Cycle"]),a=Number(i.inputs["Long Cycle"]);if(r.length<Math.max(n,a)+1)return void(i.error=!0);var s=i.inputs.Field,o=i.inputs["Moving Average Type"];o||(o="simple"),s&&"field"!=s||(i.parameters.isVolume?(s="Volume",o="exponential"):s="Close");var l=i.inputs["Points Or Percent"];l||(l="Percent"),e.Studies.MA(o,n,s,0,"_Short MA",t,i),e.Studies.MA(o,a,s,0,"_Long MA",t,i);for(var h=Math.max(a,i.startFrom);h<r.length;h++){var u=r[h];u&&(u["Result "+i.name]="Points"==l?u["_Short MA "+i.name]-u["_Long MA "+i.name]:100*(u["_Short MA "+i.name]/u["_Long MA "+i.name]-1),i.outputs["Increasing Bar"]&&(u[i.name+"_hist"]=u["Result "+i.name]))}},e.Studies.calculateKeltner=function(t,i){e.Studies.MA(i.inputs["Moving Average Type"],i.days,"Close",0,"MA",t,i),e.Studies.calculateStudyATR(t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,"MA "+i.name,"ATR "+i.name)},e.Studies.calculateCoppock=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close");var a=parseInt(i.inputs["Long RoC"],10);a||(a=14);var s=parseInt(i.inputs["Short RoC"],10);s||(s=11);var o=i.days;if(o||(o=10),!(a<s)){if(r.length<Math.max(s,a,o)+1)return void(i.error=!0);for(var l=Math.max(i.startFrom,a);l<r.length;l++){var h=r[l-s][n],u=r[l-a][n];h&&u&&(r[l]["_Sum "+i.name]=100*(r[l][n]/h+r[l][n]/u-2))}e.Studies.MA("weighted",o,"_Sum "+i.name,0,"Result",t,i)}},e.Studies.calculateLinearRegressionIndicator=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);var r=e.inputs.Field;r&&"field"!=r||(r="Close");var n=e.days*(e.days+1)/2,a=Math.pow(n,2),s=n*(2*e.days+1)/3,o=0,l=0,h=0;if(e.startFrom){var u=i[e.startFrom-1]["_sums "+e.name];u&&(l=u[0],o=u[1],h=u[2])}for(var c=e.startFrom;c<i.length;c++)if((i[c][r]||0===i[c][r])&&(l+=e.days*i[c][r]-o,o+=i[c][r],h+=Math.pow(i[c][r],2),!(c<e.days-1))){if(c>e.days-1){if(!i[c-e.days][r]&&0!==i[c-e.days][r])continue;o-=i[c-e.days][r],h-=Math.pow(i[c-e.days][r],2)}var p=(e.days*l-n*o)/(e.days*s-a);i[c]["Slope "+e.name]=p;var d=(o-p*n)/e.days;i[c]["Intercept "+e.name]=d,i[c]["Forecast "+e.name]=d+p*e.days;var f=(e.days*s-a)/(e.days*h-Math.pow(o,2));i[c]["RSquared "+e.name]=p*p*f,i[c]["_sums "+e.name]=[l,o,h]}},e.Studies.calculateBollinger=function(t,i){var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"_MA",t,i),i.std=new e.Studies.StudyDescriptor(i.name,"STD Dev",i.panel),i.std.chart=i.chart,i.std.startFrom=i.startFrom,i.std.days=i.days,i.std.inputs={Field:r,"Standard Deviations":1,Type:i.inputs["Moving Average Type"]},i.std.outputs={"_STD Dev":null},e.Studies.calculateStandardDeviation(t,i.std),e.Studies.calculateGenericEnvelope(t,i,i.inputs["Standard Deviations"],"_MA "+i.name,"_STD Dev "+i.name),"Boll %b"==i.type&&(i.zoneOutput="%b")},e.Studies.calculateMAEnvelope=function(t,i){var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,r,0,"MA",t,i);var n=i.inputs["Shift Type"],a=i.inputs.Shift;n||(n="percent",a=i.inputs["Shift Percentage"]),"percent"==n?e.Studies.calculateGenericEnvelope(t,i,a/100,"MA "+i.name):"points"==n&&e.Studies.calculateGenericEnvelope(t,i,null,"MA "+i.name,null,Number(a))},e.Studies.calculateGenericEnvelope=function(t,e,i,r,n,a){i||(i=0),a||(a=0),r||(r="Close"),n||(n=r);for(var s=e.chart.scrubbed,o=e.startFrom;s&&o<s.length;o++){var l=s[o];if(l&&l[r]){var h=i*l[n]+a;l[e.type+" Top "+e.name]=l[r]+h,l[e.type+" Bottom "+e.name]=l[r]-h,l[e.type+" Median "+e.name]=l[r],l["Bandwidth "+e.name]=200*h/l[r],l["%b "+e.name]=50*((l.Close-l[r])/h+1)}}},e.Studies.calculateMaxHighMinLow=function(t,e){var i=e.chart.scrubbed,r=e.days,n=e.days;if(e.inputs["High Period"]&&(r=e.inputs["High Period"]),e.inputs["Low Period"]&&(n=e.inputs["Low Period"]),i.length<Math.max(r,n)+1)return void(e.error=!0);var a,s=Number.MAX_VALUE,o=-1*Number.MAX_VALUE;if(e.startFrom>1){for(a=1;a<r;a++)o=Math.max(o,i[e.startFrom-a].High);for(a=1;a<n;a++)s=Math.min(s,i[e.startFrom-a].Low)}for(var l=Math.max(0,e.startFrom-1);l<i.length;l++){if(o=Math.max(o,i[l].High),s=Math.min(s,i[l].Low),l>=r&&i[l-r].High==o)for(o=i[l].High,a=1;a<r;a++)o=Math.max(o,i[l-a].High);if(l>=n&&i[l-n].Low==s)for(s=i[l].Low,a=1;a<n;a++)s=Math.min(s,i[l-a].Low);var h=0;if("HHV"==e.type)h=o;else if("LLV"==e.type)h=s;else if("Donchian Width"==e.type)h=o-s;else if("GAPO"==e.type||"Gopala"==e.type)h=Math.log(o-s)/Math.log(n);else{if("VT HZ Filter"==e.type){h=o-s,i[l]["_MHML "+e.name]=h;continue}if("Williams %R"==e.type){h=-100*(o-i[l].Close)/(o-s),i[l]["Result "+e.name]=h;continue}}if(l==i.length-1)break;"Donchian Channel"==e.type?(i[l+1]["Donchian High "+e.name]=o,i[l+1]["Donchian Low "+e.name]=s,i[l+1]["Donchian Median "+e.name]=(o+s)/2):i[l+1]["Result "+e.name]=h}},e.Studies.calculateAccumulationDistribution=function(t,e){for(var i=e.chart.scrubbed,r=e.startFrom;r<i.length;r++)if(r){var n=i[r],a=i[r-1],s=0;n.Close>a.Close?s=n.Close-Math.min(n.Low,a.Close):n.Close<a.Close&&(s=n.Close-Math.max(n.High,a.Close)),e.inputs["Use Volume"]&&(s*=n.Volume);var o=a["Result "+e.name];o||(o=0),o+=s,n["Result "+e.name]=o}},e.Studies.calculateCCI=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);e.Studies.MA("simple",i.days,"hlc/3",0,"MA",t,i);for(var n=Math.max(i.startFrom,i.days-1);n<r.length;n++){var a=r[n];if(a){
for(var s=0,o=0;o<i.days;o++)s+=Math.abs(r[n-o]["hlc/3"]-a["MA "+i.name]);s/=i.days,Math.abs(s)<1e-8?a["Result "+i.name]=0:a["Result "+i.name]=(a["hlc/3"]-a["MA "+i.name])/(.015*s)}}},e.Studies.calculateFractalChaos=function(t,e){var i=e.chart.scrubbed,r=0,n=0,a=0;e.startFrom&&"Fractal Chaos Bands"==e.type&&(r=i[e.startFrom-1]["Fractal High "+e.name],n=i[e.startFrom-1]["Fractal Low "+e.name]);for(var s=Math.max(4,e.startFrom);s<i.length;s++){i[s]["Result "+e.name]=0;var o;for(a=0,o=0;o<=s&&i[s-o]&&!(i[s-o].High>i[s-2].High)&&!(o<2&&i[s-o].High==i[s-2].High);o++)if(i[s-o].High<i[s-2].High&&a++,4==a){r=i[s-2].High;break}for("Fractal Chaos Bands"==e.type?i[s]["Fractal High "+e.name]=r>0?r:null:4==a&&(i[s]["Result "+e.name]=1),a=0,o=0;o<=s&&i[s-o]&&!(i[s-o].Low<i[s-2].Low)&&!(o<2&&i[s-o].Low==i[s-2].Low);o++)if(i[s-o].Low>i[s-2].Low&&a++,4==a){n=i[s-2].Low;break}"Fractal Chaos Bands"==e.type?i[s]["Fractal Low "+e.name]=n>0?n:null:4==a&&(i[s]["Result "+e.name]=-1)}},e.Studies.displayPrettyGoodOscillator=function(t,i,r){e.Studies.displaySeriesAsLine(t,i,r);var n=t.panels[i.panel],a=t.chart.context.strokeStyle;t.chart.context.globalAlpha=.2,t.chart.context.strokeStyle=i.outputs.Result,t.chart.context.beginPath();var s=t.pixelFromPrice(3,n);t.chart.context.moveTo(0,s),t.chart.context.lineTo(t.chart.width,s);var o=t.pixelFromPrice(-3,n);t.chart.context.moveTo(0,o),t.chart.context.lineTo(t.chart.width,o),t.chart.context.stroke(),t.chart.context.closePath();var l={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:3,direction:1,color:i.outputs.Result};e.preparePeakValleyFill(t,r,l),e.preparePeakValleyFill(t,r,e.extend(l,{threshold:-3,direction:-1})),t.chart.context.strokeStyle=a,t.chart.context.globalAlpha=1},e.Studies.displayRAVI=function(t,i,r){var n;e.Studies.determineMinMax(t,i,r);var a=t.panels[i.panel];a.yAxis.low=a.min=Math.min(0,a.min),a.yAxis.high=a.max=Math.max(0,a.max),e.Studies.displaySeriesAsLine(t,i,r);var s=t.pixelFromPrice(0,a),o=t.layout.candleWidth-2;o<2&&(o=1);var l=e.Studies.determineColor(i.outputs["Increasing Bar"]),h=e.Studies.determineColor(i.outputs["Decreasing Bar"]);for(t.canvasColor("stx_histogram"),t.chart.context.globalAlpha=1,t.startClip(i.panel),n=0;n<r.length;n++){var u=r[n];if(u&&r[n-1]){var c=0,p=0;i.parameters&&i.parameters.studyOverZonesEnabled&&(c=parseFloat(i.parameters.studyOverBoughtValue),p=parseFloat(i.parameters.studyOverSoldValue)),0===n?t.chart.context.fillStyle="#CCCCCC":u[i.name+"_hist"]>c&&r[n-1][i.name+"_hist"]<u[i.name+"_hist"]?t.chart.context.fillStyle=l:u[i.name+"_hist"]<p&&r[n-1][i.name+"_hist"]>u[i.name+"_hist"]?t.chart.context.fillStyle=h:t.chart.context.fillStyle="#CCCCCC",u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(n,a.chart)-o/2),Math.floor(s),Math.floor(o),Math.floor(t.pixelFromPrice(u[i.name+"_hist"],a)-s))}}t.endClip()},e.Studies.displayElderForce=function(t,i,r){e.Studies.displaySeriesAsLine(t,i,r);var n={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:0,color:i.outputs.Result};n.direction=1,e.preparePeakValleyFill(t,r,n),n.direction=-1,e.preparePeakValleyFill(t,r,n)},e.Studies.displayElderRay=function(t,i,r){function n(r,n,l,h){t.chart.context.fillStyle=e.Studies.determineColor(i.outputs[l]),t.chart.context.fillRect(Math.floor(t.pixelFromBar(r,a.chart)-o/2+o*n),Math.floor(s),Math.floor(o*(1-2*n)),Math.floor(t.pixelFromPrice(u[i.name+h],a)-s))}e.Studies.determineMinMax(t,i,r);var a=t.panels[i.panel];a.yAxis.low=a.min=Math.min(0,a.min),a.yAxis.high=a.max=Math.max(0,a.max),e.Studies.displaySeriesAsLine(t,i,r);var s=t.pixelFromPrice(0,a),o=t.layout.candleWidth-2;o<2&&(o=1),t.canvasColor("stx_histogram");var l=t.chart.context.fillStyle;t.chart.context.globalAlpha=1,t.startClip(i.panel);for(var h=0;h<r.length;h++){var u=r[h];u&&(u.candleWidth&&(o=Math.floor(Math.max(1,u.candleWidth-2))),u[i.name+"_hist1"]>0&&n(h,0,"Elder Bull Power","_hist1"),u[i.name+"_hist2"]<0&&n(h,0,"Elder Bear Power","_hist2"),u[i.name+"_hist1"]<0&&n(h,.1,"Elder Bull Power","_hist1"),u[i.name+"_hist2"]>0&&n(h,.1,"Elder Bear Power","_hist2"))}t.endClip(),t.chart.context.fillStyle=l},e.Studies.displayADX=function(t,i,r){if(e.Studies.createYAxis(t,i,r,t.panels[i.panel]),i.inputs.Series&&i.inputs.Shading){var n="+DI "+i.name,a="-DI "+i.name,s=e.Studies.determineColor(i.outputs[i.outputMap[n]]),o=e.Studies.determineColor(i.outputs[i.outputMap[a]]),l={topBand:n,bottomBand:a,topColor:s,bottomColor:o,skipTransform:t.panels[i.panel].name!=i.chart.name};e.fillIntersecting(t,i.panel,r,l)}var h=i.inputs.Series?.4:1;i.inputs.Histogram&&e.Studies.createHistogram(t,i,r,!1,h),!1!==i.inputs.Series?e.Studies.displaySeriesAsLine(t,i,r):i.inputs.Series||i.inputs.Histogram||t.watermark(i.panel,"center","bottom",t.translateIf("Nothing to display"))},e.Studies.displayMassIndex=function(t,i,r){e.Studies.displaySeriesAsLine(t,i,r);var n=i.inputs["Bulge Threshold"],a=t.panels[i.panel],s=t.chart.context.strokeStyle;t.chart.context.globalAlpha=.2,t.chart.context.strokeStyle=i.outputs.Result,t.chart.context.beginPath();var o=t.pixelFromPrice(n,a);t.chart.context.moveTo(0,o),t.chart.context.lineTo(t.chart.width,o),t.chart.context.stroke(),t.chart.context.closePath(),e.preparePeakValleyFill(t,r,{skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:n,direction:1,color:i.outputs.Result}),t.chart.context.strokeStyle=s,t.chart.context.globalAlpha=1},e.Studies.displayChannel=function(t,i,r){if(i.inputs["Channel Fill"]){var n={panelName:i.panel};for(var a in i.outputs){var s=a.split(" ").pop();"Top"==s||"High"==s?n.topBand=a+" "+i.name:"Bottom"==s||"Low"==s?n.bottomBand=a+" "+i.name:"Median"!=s&&"Channel"!=s||(n.color=e.Studies.determineColor(i.outputs[a]))}i.parameters.opacity&&(n.opacity=i.parameters.opacity),n.skipTransform=t.panels[i.panel].name!=i.chart.name,e.prepareChannelFill(t,r,n)}e.Studies.displaySeriesAsLine(t,i,r)},e.Studies.inputAttributeDefaultGenerator=function(t){return(t||0===t)&&t.constructor==Number?Math.floor(t)==t?t>0?{min:1,step:1}:{step:1}:t>0?{min:0,step:.01}:{step:.01}:{}},e.Studies.getStudyList=function(t){var i={},r={Directional:!0,Gopala:!0,vchart:!0};e.extend(r,t);for(var n in e.Studies.studyLibrary)r[n]||(i[e.Studies.studyLibrary[n].name]=n);return i},e.Studies.determineColor=function(t){return t?"object"==typeof t?t.color:t:null},e.Studies.studyLibrary={rsi:{name:"RSI",inputs:{Period:14},calculateFN:e.Studies.calculateRSI,range:"0 to 100",outputs:{RSI:"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},ma:{name:"Moving Average",overlay:!0,range:"bypass",calculateFN:e.Studies.calculateMovingAverage,inputs:{Period:50,Field:"field",Type:"ma",Offset:0,Underlay:!1},outputs:{MA:"#FF0000"}},macd:{name:"MACD",calculateFN:e.Studies.calculateMACD,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},outputs:{MACD:"auto",Signal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},stochastics:{name:"Stochastics",range:"0 to 100",initializeFN:e.Studies.initializeStochastics,calculateFN:e.Studies.calculateStochastics,inputs:{Period:14,Smooth:!0},outputs:{Fast:"auto",Slow:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Aroon:{name:"Aroon",range:"0 to 100",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Up":"#00DD00","Aroon Down":"#FF0000"}},"Aroon Osc":{name:"Aroon Oscillator",calculateFN:e.Studies.calculateAroon,outputs:{"Aroon Oscillator":"auto"}},"Lin R2":{name:"Linear Reg R2",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{RSquared:"auto"}},"Lin Fcst":{name:"Linear Reg Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"Lin Incpt":{name:"Linear Reg Intercept",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Intercept:"auto"}},"Time Fcst":{name:"Time Series Forecast",overlay:!0,calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Forecast:"auto"}},"VT HZ Filter":{name:"Vertical Horizontal Filter",calculateFN:e.Studies.calculateVerticalHorizontalFilter,inputs:{Period:28}},TRIX:{name:"TRIX",calculateFN:e.Studies.calculateTRIX},"STD Dev":{name:"Standard Deviation",calculateFN:e.Studies.calculateStandardDeviation,inputs:{Period:14,Field:"field","Standard Deviations":2,"Moving Average Type":"ma"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Trade Vol":{name:"Trade Volume Index",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{"Min Tick Value":.5}},Swing:{name:"Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Acc Swing":{name:"Accumulative Swing Index",calculateFN:e.Studies.calculateSwingIndex,inputs:{"Limit Move Value":.5}},"Price ROC":{name:"Price Rate of Change",calculateFN:e.Studies.calculateRateOfChange,inputs:{Field:"field",Period:14}},"Vol ROC":{name:"Volume Rate of Change",calculateFN:e.Studies.calculateRateOfChange},Momentum:{name:"Momentum Indicator",calculateFN:e.Studies.calculateRateOfChange,inputs:{Period:14},centerline:0},"Price Vol":{name:"Price Volume Trend",calculateFN:e.Studies.calculatePriceVolumeTrend,inputs:{Field:"field"}},"Pos Vol":{name:"Positive Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Field:"field","Moving Average Type":"ma",Period:255},outputs:{Index:"auto",MA:"#FF0000"}},"Neg Vol":{name:"Negative Volume Index",calculateFN:e.Studies.calculateVolumeIndex,inputs:{Field:"field","Moving Average Type":"ma",Period:255},outputs:{Index:"auto",MA:"#FF0000"}},"On Bal Vol":{name:"On Balance Volume",calculateFN:e.Studies.calculateOnBalanceVolume,inputs:{}},"Stch Mtm":{name:"Stochastic Momentum Index",calculateFN:e.Studies.calculateStochMomentum,inputs:{"%K Periods":10,"%K Smoothing Periods":3,"%K Double Smoothing Periods":3,"%D Periods":10,"%D Moving Average Type":"ema"},outputs:{"%K":"auto","%D":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:40,studyOverBoughtColor:"auto",studyOverSoldValue:-40,studyOverSoldColor:"auto"}}},"Hist Vol":{name:"Historical Volatility",calculateFN:e.Studies.calculateHistoricalVolatility,inputs:{Field:"field",Period:10,"Days Per Year":[252,365],"Standard Deviations":1},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Pretty Good":{name:"Pretty Good Oscillator",seriesFN:e.Studies.displayPrettyGoodOscillator,calculateFN:e.Studies.calculatePrettyGoodOscillator},Ultimate:{name:"Ultimate Oscillator",calculateFN:e.Studies.calculateUltimateOscillator,inputs:{"Cycle 1":7,"Cycle 2":14,"Cycle 3":28},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},"Vol Osc":{name:"Volume Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{"Short Cycle":12,"Long Cycle":26,"Points Or Percent":["Points","Percent"]},parameters:{init:{isVolume:!0}}},Twiggs:{name:"Twiggs Money Flow",calculateFN:e.Studies.calculateTwiggsMoneyFlow,inputs:{Period:21}},"Chaikin MF":{name:"Chaikin Money Flow",calculateFN:e.Studies.calculateChaikinMoneyFlow,inputs:{Period:20}},"Chaikin Vol":{name:"Chaikin Volatility",calculateFN:e.Studies.calculateChaikinVolatility,inputs:{Period:14,"Rate Of Change":2,"Moving Average Type":"ma"}},"Price Osc":{name:"Price Oscillator",calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Long Cycle":26,"Short Cycle":12,"Moving Average Type":"ema","Points Or Percent":["Points","Percent"]}},EOM:{name:"Ease of Movement",calculateFN:e.Studies.calculateEaseOfMovement,inputs:{Period:14,"Moving Average Type":"ma"}},CCI:{name:"Commodity Channel Index",calculateFN:e.Studies.calculateCCI,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:-100,studyOverSoldColor:"auto"}},attributes:{Period:{min:2}}},Detrended:{name:"Detrended Price Oscillator",calculateFN:e.Studies.calculateDetrendedPrice,inputs:{Field:"field",Period:14,"Moving Average Type":"ma"}},"True Range":{name:"True Range",calculateFN:e.Studies.calculateStudyATR,inputs:{},outputs:{"True Range":"auto"}},ATR:{name:"Average True Range",calculateFN:e.Studies.calculateStudyATR,outputs:{ATR:"auto"}},"Ehler Fisher":{name:"Ehler Fisher Transform",calculateFN:e.Studies.calculateEhlerFisher,inputs:{Period:10},outputs:{EF:"auto","EF Trigger":"#FF0000"}},Schaff:{name:"Schaff Trend Cycle",range:"0 to 100",calculateFN:e.Studies.calculateSchaff,inputs:{Field:"field",Period:10,"Short Cycle":23,"Long Cycle":50,"Moving Average Type":"ema"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:75,studyOverBoughtColor:"auto",studyOverSoldValue:25,studyOverSoldColor:"auto"}}},QStick:{name:"QStick",calculateFN:e.Studies.calculateQStick,inputs:{Period:8,"Moving Average Type":"ma"}},Coppock:{name:"Coppock Curve",calculateFN:e.Studies.calculateCoppock,inputs:{Field:"field","Short RoC":11,"Long RoC":14,Period:10}},"Chande Mtm":{name:"Chande Momentum Oscillator",calculateFN:e.Studies.calculateChandeMomentum,inputs:{Period:9},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:50,studyOverBoughtColor:"auto",studyOverSoldValue:-50,studyOverSoldColor:"auto"}}},"Chande Fcst":{name:"Chande Forecast Oscillator",calculateFN:e.Studies.calculateChandeForecast,inputs:{Field:"field",Period:14}},"Intraday Mtm":{name:"Intraday Momentum Index",calculateFN:e.Studies.calculateIntradayMomentum,inputs:{Period:20},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},RAVI:{name:"RAVI",seriesFN:e.Studies.displayRAVI,calculateFN:e.Studies.calculatePriceOscillator,inputs:{Field:"field","Moving Average Type":"vdma","Short Cycle":7,"Long Cycle":65},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:3,studyOverBoughtColor:"auto",studyOverSoldValue:-3,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.1"},studyOverSoldValue:{max:0,step:"0.1"}}},"Random Walk":{name:"Random Walk Index",calculateFN:e.Studies.calculateRandomWalk,outputs:{"Random Walk High":"#FF0000","Random Walk Low":"#0000FF"}},ADX:{name:"ADX/DMS",calculateFN:e.Studies.calculateADX,seriesFN:e.Studies.displayADX,inputs:{Period:14,"Smoothing Period":14,Series:!0,Shading:!1,Histogram:!1},outputs:{"+DI":"#00FF00","-DI":"#FF0000",ADX:"auto","Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"High Low":{name:"High Low Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:function(t,i){i.inputs["Moving Average Type"]="triangular",e.Studies.calculateMAEnvelope(t,i)},inputs:{Field:"field",Period:10,"Shift Percentage":5,"Channel Fill":!0},outputs:{"High Low Top":"auto","High Low Median":"auto","High Low Bottom":"auto"},attributes:{"Shift Percentage":{min:.1,step:.1}}},"High-Low":{name:"High Minus Low",calculateFN:function(t,e){for(var i=e.chart.scrubbed,r=e.startFrom;r<i.length;r++)i[r]["Result "+e.name]=i[r].High-i[r].Low},inputs:{}},"Med Price":{name:"Median Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14,Overlay:!1}},"MA Env":{name:"Moving Average Envelope",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateMAEnvelope,inputs:{Field:"field",Period:50,"Shift Type":["percent","points"],Shift:5,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"MA Env Top":"auto","MA Env Median":"auto","MA Env Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},"Fractal Chaos Bands":{name:"Fractal Chaos Bands",overlay:!0,calculateFN:e.Studies.calculateFractalChaos,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Fractal High":"auto","Fractal Low":"auto","Fractal Channel":"auto"}},"Fractal Chaos":{name:"Fractal Chaos Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculateFractalChaos,inputs:{},centerline:20},GAPO:{name:"Gopalakrishnan Range Index",calculateFN:e.Studies.calculateMaxHighMinLow},"Prime Number Bands":{name:"Prime Number Bands",overlay:!0,calculateFN:e.Studies.calculatePrimeNumber,seriesFN:e.Studies.displayChannel,inputs:{"Channel Fill":!0},outputs:{"Prime Bands Top":"auto","Prime Bands Bottom":"auto","Prime Bands Channel":"auto"}},"Prime Number":{name:"Prime Number Oscillator",range:"-1 to 1",calculateFN:e.Studies.calculatePrimeNumber,inputs:{"Tolerance Percentage":5},attributes:{"Tolerance Percentage":{min:.1,step:.1}}},"Bollinger Bands":{name:"Bollinger Bands",overlay:!0,calculateFN:e.Studies.calculateBollinger,seriesFN:e.Studies.displayChannel,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma","Channel Fill":!0},outputs:{"Bollinger Bands Top":"auto","Bollinger Bands Median":"auto","Bollinger Bands Bottom":"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Channel":{name:"Donchian Channel",overlay:!0,calculateFN:e.Studies.calculateMaxHighMinLow,seriesFN:e.Studies.displayChannel,inputs:{"High Period":20,"Low Period":20,"Channel Fill":!0},outputs:{"Donchian High":"auto","Donchian Median":"auto","Donchian Low":"auto"}},HHV:{name:"Highest High Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},LLV:{name:"Lowest Low Value",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14}},"Mass Idx":{name:"Mass Index",seriesFN:e.Studies.displayMassIndex,calculateFN:e.Studies.calculateMassIndex,inputs:{Period:25,"Bulge Threshold":27},attributes:{"Bulge Threshold":{min:20,max:35,step:.1}}},Keltner:{name:"Keltner Channel",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateKeltner,inputs:{Period:50,Shift:5,"Moving Average Type":"ema","Channel Fill":!0},outputs:{"Keltner Top":"auto","Keltner Median":"auto","Keltner Bottom":"auto"},attributes:{Shift:{min:.1,step:.1}}},PSAR:{name:"Parabolic SAR",overlay:!0,calculateFN:e.Studies.calculatePSAR,seriesFN:e.Studies.displayPSAR2,inputs:{"Minimum AF":.02,"Maximum AF":.2}},Klinger:{name:"Klinger Volume Oscillator",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateKlinger,inputs:{"Signal Periods":13,"Short Cycle":34,"Long Cycle":55},outputs:{Klinger:"auto",KlingerSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Ray":{name:"Elder Ray Index",seriesFN:e.Studies.displayElderRay,calculateFN:e.Studies.calculateElderRay,inputs:{Period:13},outputs:{"Elder Bull Power":"#00DD00","Elder Bear Power":"#FF0000"}},"Elder Force":{name:"Elder Force Index",calculateFN:e.Studies.calculateElderForce,seriesFN:e.Studies.displayElderForce,inputs:{Period:13}},"LR Slope":{name:"Linear Reg Slope",calculateFN:e.Studies.calculateLinearRegressionIndicator,inputs:{Period:14,Field:"field"},outputs:{Slope:"auto"}},COG:{name:"Center Of Gravity",calculateFN:e.Studies.calculateCenterOfGravity,inputs:{Period:10,Field:"field"}},"Typical Price":{name:"Typical Price",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14,Overlay:!1}},"Weighted Close":{name:"Weighted Close",calculateFN:e.Studies.calculateTypicalPrice,inputs:{Period:14,Overlay:!1}},"M Flow":{name:"Money Flow Index",range:"0 to 100",calculateFN:e.Studies.calculateMoneyFlowIndex,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},"Williams %R":{name:"Williams %R",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{Period:14},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:-20,studyOverBoughtColor:"auto",studyOverSoldValue:-80,studyOverSoldColor:"auto"}}},"W Acc Dist":{name:"Accumulation/Distribution",calculateFN:e.Studies.calculateAccumulationDistribution,inputs:{"Use Volume":!1}},volume:{name:"Volume Chart",range:"0 to max",yAxis:{ground:!0,initialMarginTop:0},seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},parameters:{zoom:0,widthFactor:1}},"vol undr":{name:"Volume Underlay",underlay:!0,seriesFN:e.Studies.createVolumeChart,calculateFN:e.Studies.calculateVolume,inputs:{},outputs:{"Up Volume":"#8cc176","Down Volume":"#b82c0c"},customRemoval:!0,removeFN:function(t,e){t.layout.volumeUnderlay=!1,t.changeOccurred("layout")},parameters:{init:{heightPercentage:.25},widthFactor:1}}},t},__drawingAdvanced_=function(t){var e=t.CIQ,i=t.timezoneJS;return e.Drawing.channel=function(){this.name="channel",this.dragToDraw=!1,this.p2=null},e.Drawing.channel.ciqInheritsFrom(e.Drawing.segment),e.Drawing.channel.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.channel.prototype.move=function(t,e,i){if(this.penDown){if(this.copyConfig(),null===this.p2)this.p1=[e,i];else{var r=i-(this.p1[1]-this.p0[1])/(this.p1[0]-this.p0[0])*(e-this.p1[0]);this.p2=[this.p1[0],r]}this.render(t)}},e.Drawing.channel.prototype.click=function(t,e,i){var r=this.stx.panels[this.panelName];if(r)return this.copyConfig(),this.penDown?this.accidentalClick(e,i)?(this.stx.undo(),!0):null!==this.p2?(this.setPoint(2,this.p2[0],this.p2[1],r.chart),!0):(this.setPoint(1,e,i,r.chart),this.p0[0]==this.p1[0]?(this.p1=null,!1):(this.p2=[this.p1[0],this.p1[1]],!1)):(this.setPoint(0,e,i,r.chart),this.penDown=!0,!1)},e.Drawing.channel.prototype.boxIntersection=function(t,e){return!!(this.p0&&this.p1&&this.p2)&&(!(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))&&((this.p1[0]-this.p0[0])*(e-this.p0[1])-(this.p1[1]-this.p0[1])*(t-this.p0[0]))*((this.p2[0]-this.p0[0])*(e-(this.p0[1]+this.p2[1]-this.p1[1]))-(this.p1[1]-this.p0[1])*(t-this.p0[0]))<0)},e.Drawing.channel.prototype.intersected=function(t,i,r){return this.p0&&this.p1&&this.p2?this.pointIntersection(this.p0[0],this.p0[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.pointIntersection(this.p2[0],this.p2[1],r)?(this.highlighted="p2",{action:"drag",point:"p2"}):this.boxIntersection(t,i)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null:null},e.Drawing.channel.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=null;this.p2&&(o=this.stx.pixelFromValueAdjusted(i,this.p2[0],this.p2[1]));var l=this.lineWidth,h=this.setLineColor(),u=this.fillColor;this.p2&&u&&!e.isTransparent(u)&&"auto"!=u&&(t.beginPath(),t.moveTo(r,a),t.lineTo(n,s),t.lineTo(n,o),t.lineTo(r,a+(o-s)),t.closePath(),t.globalAlpha=.2,t.fillStyle=u,t.fill(),t.globalAlpha=1);var c={pattern:this.pattern,lineWidth:l};if(this.stx.plotLine(r,n,a,s,h,"segment",t,i,c),this.p2&&this.stx.plotLine(r,n,a+(o-s),o,h,"segment",t,i,c),this.highlighted){var p="p0"==this.highlighted,d="p1"==this.highlighted,f="p2"==this.highlighted;this.littleCircle(t,r,a,p),this.littleCircle(t,n,s,d),this.littleCircle(t,n,o,f)}}},e.Drawing.channel.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i,s=e.value-r;"move"==e.action?(this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.setPoint(1,e.p1[0]-a,e.p1[1]-s,n.chart),this.setPoint(2,e.p2[0]-a,e.p2[1]-s,n.chart),this.render(t)):"drag"==e.action&&(this[e.point]=[i,r],this.setPoint(0,this.p0[0],this.p0[1],n.chart),this.setPoint(1,this.p1[0],this.p1[1],n.chart),this.setPoint(2,this.p2[0],this.p2[1],n.chart),this.render(t))}},e.Drawing.channel.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d1,this.v2,t.chart))},e.Drawing.channel.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.channel.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.pitchfork=function(){this.name="pitchfork",this.dragToDraw=!1,this.p2=null},e.Drawing.pitchfork.ciqInheritsFrom(e.Drawing.channel),e.Drawing.pitchfork.prototype.configs=["color","lineWidth","pattern"],e.Drawing.pitchfork.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),null===this.p2?this.p1=[e,i]:this.p2=[e,i],this.render(t))},e.Drawing.pitchfork.prototype.lineIntersection=function(t,i,r,n){var a=this.p0,s=this.p1,o=this.p2,l=this.stx.layout;return a&&s&&o&&e.boxIntersects(r.x0,r.y0,r.x1,r.y1,a[0],a[1],(s[0]+o[0])/2,(s[1]+o[1])/2,n,l.semiLog||"log"==l.chartScale)},e.Drawing.pitchfork.prototype.intersected=function(t,i,r){return this.p0&&this.p1&&this.p2?this.pointIntersection(this.p0[0],this.p0[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(this.p1[0],this.p1[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):this.pointIntersection(this.p2[0],this.p2[1],r)?(this.highlighted="p2",{action:"drag",point:"p2"}):this.lineIntersection(t,i,r,"ray")?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),p2:e.clone(this.p2),tick:t,value:i}):null:null},e.Drawing.pitchfork.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.p2;i||(i=this.p1);var r=this.stx.pixelFromTick(this.p0[0],e.chart),n=this.stx.pixelFromTick(this.p1[0],e.chart),a=this.stx.pixelFromTick(i[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(e,this.p1[0],this.p1[1]),l=this.stx.pixelFromValueAdjusted(e,i[0],i[1]),h=this.lineWidth,u=this.setLineColor(),c={pattern:this.pattern,lineWidth:h},p=50,d=2*s-o-l,f=2*r-n-a;if(f<0&&(p*=-1),d=p*d/f,this.stx.plotLine(r,(n+a)/2,s,(o+l)/2,u,"ray",t,e,c),this.stx.plotLine(n,a,o,l,u,"segment",t,e,c),n==a&&o==l||(this.stx.plotLine(n,n-p,o,o-d,u,"ray",t,e,c),this.stx.plotLine(a,a-p,l,l-d,u,"ray",t,e,c)),this.highlighted){var m="p0"==this.highlighted,g="p1"==this.highlighted,v="p2"==this.highlighted;this.littleCircle(t,r,s,m),this.littleCircle(t,n,o,g),this.littleCircle(t,a,l,v)}}},e.Drawing.pitchfork.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.setPoint(1,this.d1,this.v1,t.chart),this.setPoint(2,this.d2,this.v2,t.chart))},e.Drawing.pitchfork.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.d2=e.d2,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.tzo2=e.tzo2,this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.adjust()},e.Drawing.pitchfork.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,d2:this.d2,tzo0:this.tzo0,tzo1:this.tzo1,tzo2:this.tzo2,v0:this.v0,v1:this.v1,v2:this.v2}},e.Drawing.gartley=function(){this.name="gartley",this.dragToDraw=!1,this.maxSegments=4,this.shape=null,this.points=[]},e.Drawing.gartley.ciqInheritsFrom(e.Drawing.continuous),e.Drawing.gartley.prototype.check=function(t,e){if(!e)return!0;if(t[0]>=e[0]||t[1]==e[1])return!1;if(1==this.segment)t[1]<e[1]?this.shape="M":this.shape="W";else if(2==this.segment){if("M"==this.shape&&t[1]<e[1])return!1;if("W"==this.shape&&t[1]>e[1])return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[0][1]-t[1])>=.786)return!1}else if(3==this.segment){if("M"==this.shape&&t[1]>e[1])return!1;if("W"==this.shape&&t[1]<e[1])return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])<.618)return!1;if((e[1]-t[1])/(this.points[1][1]-t[1])>=.786)return!1}else if(4==this.segment){if("M"==this.shape&&(t[1]<e[1]||e[1]<this.points[0][1]))return!1;if("W"==this.shape&&(t[1]>e[1]||e[1]>this.points[0][1]))return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])<1.27)return!1;if((this.points[1][1]-e[1])/(this.points[1][1]-this.points[2][1])>=1.618)return!1}return!0},e.Drawing.gartley.prototype.click=function(t,e,i){var r=this.stx.panels[this.panelName];if(r){if(this.copyConfig(),!this.penDown)return this.setPoint(0,e,i,r.chart),this.pts=[],this.penDown=!0,this.segment=1,!1;if(this.accidentalClick(e,i))return this.penDown=!0,!1;if(this.check(this.p0,this.p1)){if(1==this.segment&&this.points.push(this.p0),this.points.push(this.p1),this.drawDropZones=!0,this.setPoint(1,e,i,r.chart),++this.segment>this.maxSegments)return this.setPoint(0,this.points[0][0],this.points[0][1],r.chart),!0;this.pts.push(this.d1,this.tzo1,this.v1),this.setPoint(0,e,i,r.chart)}return!1}},e.Drawing.gartley.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);if(2==this.segment)this.drawDropZone(t,.618*this.points[0][1]+.382*this.p0[1],.786*this.points[0][1]+.214*this.p0[1],this.p0[0]);else if(3==this.segment)this.drawDropZone(t,.618*this.points[1][1]+.382*this.p0[1],.786*this.points[1][1]+.214*this.p0[1],this.p0[0]);else if(4==this.segment){var o=1.618*this.points[2][1]-.618*this.points[1][1];o="M"==this.shape?Math.max(o,this.points[0][1]):Math.min(o,this.points[0][1]),this.drawDropZone(t,o,1.27*this.points[2][1]-.27*this.points[1][1],this.p0[0])}var l=this.lineWidth,h=this.setLineColor(),u={pattern:this.pattern,lineWidth:l};this.segment<=this.maxSegments&&this.stx.plotLine(r,n,a,s,h,this.name,t,i,u);var c=this.fillColor,p=[];if(this.points.length){t.beginPath();for(var d=1;d<this.points.length&&d<=4;d++){var f=this.stx.pixelFromTick(this.points[d-1][0],i.chart),m=this.stx.pixelFromTick(this.points[d][0],i.chart),g=this.stx.pixelFromValueAdjusted(i,this.points[d-1][0],this.points[d-1][1]),v=this.stx.pixelFromValueAdjusted(i,this.points[d][0],this.points[d][1]);1==d&&p.push(f,g),p.push(m,v),this.stx.plotLine(f,m,g,v,h,this.name,t,i,u)}if(2!=this.points.length&&4!=this.points.length||p.push(n,s),this.points[2]&&p.push(this.stx.pixelFromTick(this.points[2][0],i.chart),this.stx.pixelFromValueAdjusted(i,this.points[2][0],this.points[2][1])),c&&"auto"!=c&&!e.isTransparent(c)){for(var y=0;y<p.length;y+=2)0===y&&t.moveTo(p[0],p[1]),t.lineTo(p[y],p[y+1]);t.fillStyle=c,t.globalAlpha=.2,t.closePath(),t.fill(),t.globalAlpha=1}}}},e.Drawing.gartley.prototype.lineIntersection=function(t,i,r,n){var a=this.points,s=this.stx.layout;if(a.length!=this.maxSegments+1)return!1;for(var o=0;o<a.length-1;o++)if(e.boxIntersects(r.x0,r.y0,r.x1,r.y1,a[o][0],a[o][1],a[o+1][0],a[o+1][1],"segment",s.semiLog||"log"==s.chartScale))return!0;return!1},e.Drawing.gartley.prototype.boxIntersection=function(t,e){if(!this.p0||!this.p1)return!1;if(t>Math.max(this.p0[0],this.p1[0])||t<Math.min(this.p0[0],this.p1[0]))return!1;for(var i=Math.min(this.p0[1],this.p1[1]),r=Math.max(this.p0[1],this.p1[1]),n=0;n<this.points.length;n++)i=Math.min(i,this.points[n][1]),r=Math.max(r,this.points[n][1]);return!(e>r||e<i)},
e.Drawing.gartley.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i;e.tick=i;var s=e.value-r;if(e.value=r,"move"==e.action){this.pts=[];for(var o=0;o<this.points.length;o++)this.points[o][0]-=a,this.points[o][1]-=s,this.setPoint(1,this.points[o][0],this.points[o][1],n.chart),o&&o<this.points.length-1&&this.pts.push(this.d1,this.tzo1,this.v1),this.points[o]=this.p1;this.setPoint(0,this.points[0][0],this.points[0][1],n.chart),this.render(t)}}},e.Drawing.gartley.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.gartley.prototype.drawDropZone=function(t,e,i,r){var n=this.stx.panels[this.panelName];if(n){var a=this.stx.pixelFromPrice(e,n),s=this.stx.pixelFromPrice(i,n)-a,o=this.stx.pixelFromTick(r,n.chart),l=this.stx.chart.width-o;t.fillStyle="#008000",t.globalAlpha=.2,t.fillRect(o,a,l,s),t.globalAlpha=1}},e.Drawing.gartley.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.reconstructPoints(),this.setPoint(0,this.d0,this.v0,t.chart),this.points.unshift(this.p0),this.setPoint(1,this.d1,this.v1,t.chart),this.points.push(this.p1))},e.Drawing.gartley.prototype.reconstructPoints=function(){var t=this.stx.panels[this.panelName];if(t){this.points=[];for(var i=0;i<this.pts.length;i+=3){var r=e.strToDateTime(this.pts[i]);r.setMinutes(r.getMinutes()+Number(this.pts[i+1])-r.getTimezoneOffset()),this.points.push([this.stx.tickFromDate(e.yyyymmddhhmmssmmm(r),t.chart),this.pts[i+2]])}}},e.Drawing.gartley.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.pts=e.pts.split(","),this.adjust()},e.Drawing.gartley.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,pts:this.pts.join(",")}},e.Drawing.freeform=function(){this.name="freeform",this.splineTension=.3,this.dragToDraw=!0},e.Drawing.freeform.ciqInheritsFrom(e.Drawing.segment),e.Drawing.freeform.prototype.measure=function(){},e.Drawing.freeform.prototype.intersected=function(t,i,r){return t>this.hiX||t<this.lowX?null:i>this.hiY||i<this.lowY?null:(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),tick:t,value:i})},e.Drawing.freeform.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i,s=e.value-r;"move"==e.action&&(this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.adjust(),this.render(t))}},e.Drawing.freeform.prototype.click=function(t,i,r){var n=this.stx.panels[this.panelName];if(n){if(!1===this.penDown){this.copyConfig(),this.startX=Math.round(this.stx.resolveX(this.stx.pixelFromTick(i,n.chart))),this.startY=Math.round(this.stx.resolveY(this.stx.pixelFromValueAdjusted(n,i,r)));var a=this.stx.dateFromTick(i,n.chart,!0);return this.d0=e.yyyymmddhhmmssmmm(a),this.tzo0=a.getTimezoneOffset(),this.v0=r,this.p0=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.nodes=[this.p0[0],this.p0[1]],this.pNodes=[this.p0],this.candleWidth=this.stx.layout.candleWidth,this.multiplier=n.yAxis.multiplier,this.interval=this.stx.layout.interval,this.periodicity=this.stx.layout.periodicity,this.tempSplineTension=this.splineTension,this.splineTension=-1,document.body.style.cursor="pointer",this.penDown=!0,!1}return this.penDown=!1,this.splineTension=this.tempSplineTension,document.body.style.cursor="auto",!0}},e.Drawing.freeform.prototype.move=function(t,i,r){if(this.penDown){var n=this.stx.panels[this.panelName],a=this.stx.dateFromTick(i,n.chart,!0);return this.d1=e.yyyymmddhhmmssmmm(a),this.tzo1=a.getTimezoneOffset(),this.v1=r,this.p1=[e.ChartEngine.crosshairX-this.startX,e.ChartEngine.crosshairY-this.startY],this.pNodes.length>2&&(this.p1[0]==this.pNodes[this.pNodes.length-2][0]&&this.p1[0]==this.pNodes[this.pNodes.length-1][0]?(this.pNodes.length--,this.nodes.length-=2):this.p1[1]==this.pNodes[this.pNodes.length-2][1]&&this.p1[1]==this.pNodes[this.pNodes.length-1][1]&&(this.pNodes.length--,this.nodes.length-=2)),this.nodes.push(this.p1[0],this.p1[1]),this.pNodes.push(this.p1),this.render(t),!1}},e.Drawing.freeform.prototype.intervalRatio=function(t,i,r,n,a,s){function o(t,i){return e.Market.Symbology.isForexSymbol(i)?1440:390}var l=0;return t==i?l=1:isNaN(t)||isNaN(i)?isNaN(t)?"month"==t?"week"==i?l=5:"day"==i?l=30:isNaN(i)||(l=30*o(a,s)/i):"week"==t?("month"==i&&(l=.2),"day"==i?l=5:isNaN(i)||(l=5*o(a,s)/i)):"day"==t&&("week"==i?l=.2:"month"==i?l=1/30:isNaN(i)||(l=o(a,s)/i)):isNaN(t)||("month"==i?l=t/(30*o(a,s)):"week"==i?l=t/(5*o(a,s)):"day"==i&&(l=t/o(a,s))):l=t/i,l*=r/n},e.Drawing.freeform.prototype.render=function(t){var e=this.stx.panels[this.panelName];if(e){var i=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,e.chart.symbol);if(0!==i){var r=this.stx.layout.candleWidth/this.candleWidth,n=e.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,e.chart);for(var a=this.stx.pixelFromTick(this.p0[0],e.chart),s=this.stx.pixelFromValueAdjusted(e,this.p0[0],this.p0[1]),o=[],l=this.lineWidth,h=this.setLineColor(),u={pattern:this.pattern,lineWidth:l},c=0;c<this.pNodes.length;c++){var p=i*r*this.pNodes[c][0]+a,d=n*this.pNodes[c][1]+s;o.push(p,d)}o.length&&(this.splineTension<0?this.stx.connectTheDots(o,h,this.name,t,e,u):this.stx.plotSpline(o,this.splineTension,h,this.name,t,!0,u))}}},e.Drawing.freeform.prototype.adjust=function(){var t=this.stx.panels[this.panelName];if(t){var e=[this.nodes[0],this.nodes[1]];this.pNodes=[e],this.lowX=this.nodes[0],this.hiX=this.nodes[0],this.lowY=this.nodes[1],this.hiY=this.nodes[1];for(var i=2;i<this.nodes.length;i+=2){var r=[this.nodes[i],this.nodes[i+1]];this.pNodes.push(r),this.lowX=Math.min(this.lowX,r[0]),this.hiX=Math.max(this.hiX,r[0]),this.lowY=Math.max(this.lowY,r[1]),this.hiY=Math.min(this.hiY,r[1])}var n=this.intervalRatio(this.interval,this.stx.layout.interval,this.periodicity,this.stx.layout.periodicity,this.d0,t.chart.symbol);if(0!==n){var a=this.stx.layout.candleWidth/this.candleWidth,s=t.yAxis.multiplier/this.multiplier;this.setPoint(0,this.d0,this.v0,t.chart);var o=this.stx.pixelFromTick(this.p0[0],t.chart),l=this.stx.pixelFromValueAdjusted(t,this.p0[0],this.p0[1]);this.lowX=this.stx.tickFromPixel(Math.floor(n*a*this.lowX)+o,t.chart),this.hiX=this.stx.tickFromPixel(Math.ceil(n*a*this.hiX)+o,t.chart),this.lowY=this.stx.valueFromPixel(Math.floor(s*this.lowY)+l,t),this.hiY=this.stx.valueFromPixel(Math.ceil(s*this.hiY)+l,t)}}},e.Drawing.freeform.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,cw:Number(this.candleWidth.toFixed(4)),mlt:Number(this.multiplier.toFixed(4)),d0:this.d0,tzo0:this.tzo0,v0:this.v0,inter:this.interval,pd:this.periodicity,nodes:this.nodes}},e.Drawing.freeform.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.candleWidth=e.cw,this.multiplier=e.mlt,this.d0=e.d0,this.tzo0=e.tzo0,this.v0=e.v0,this.interval=e.inter,this.periodicity=e.pd,this.nodes=e.nodes,this.adjust()},e.Drawing.callout=function(){this.name="callout",this.arr=[],this.w=0,this.h=0,this.padding=4,this.text="",this.ta=null,this.fontSize=0,this.font={},this.stemEntry="",this.defaultWidth=50,this.defaultHeight=10},e.Drawing.callout.ciqInheritsFrom(e.Drawing.annotation),e.Drawing.callout.prototype.configs=["color","fillColor","lineWidth","pattern","font"],e.Drawing.callout.prototype.copyConfig=function(){e.Drawing.copyConfig(this),this.borderColor=this.color},e.Drawing.callout.prototype.move=function(t,e,i){this.penDown&&(this.copyConfig(),this.p0=[e,i],this.render(t))},e.Drawing.callout.prototype.onChange=function(t){if(this.stx.panels[this.panelName]){var i=t.target;this.w=i.clientWidth,this.h=i.clientHeight;var r=this.context||this.stx.chart.tempCanvas.context;e.clearCanvas(r.canvas,this.stx),this.render(r),this.edit(r)}},e.Drawing.callout.prototype.render=function(t){this.context=t;var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(!isNaN(n)){t.font=this.fontString,t.textBaseline="top";var a=r,s=n,o=this.w/2,l=this.h/2;this.penDown&&(o=this.defaultWidth,(l=this.defaultHeight)||(l=this.fontSize));var h=this.lineWidth;h||(h=1.1);var u=this.color;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor);var c=this.borderColor;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor),this.highlighted&&(c=this.stx.getCanvasColor("stx_highlight_vector"));var p,d,f,m,g=Math.min(Math.min(o,l)/2,8);if(this.stem){this.stem.d?(p=this.stx.pixelFromTick(this.stem.t),f=this.stx.pixelFromValueAdjusted(i,this.stem.t,this.stem.v)):this.stem.x&&(p=a,f=s,a+=this.stem.x,s+=this.stem.y);var v="";p>=a+o?(d=a+o,v="r"):p>a-o&&p<a+o?(d=a,v="c"):p<=a-o&&(d=a-o,v="l"),f>=s+l?(m=s+l,v+="b"):f>s-l&&f<s+l?(m=s,v+="m"):f<=s-l&&(m=s-l,v+="t"),this.stemEntry=v,"cm"!=v&&(p=Math.round(p),d=Math.round(d),f=Math.round(f),m=Math.round(m))}this.highlighted?this.stx.canvasColor("stx_annotation_highlight_bg",t):this.fillColor?(t.fillStyle=this.fillColor,t.globalAlpha=.4):this.stem&&(t.fillStyle=this.stx.containerColor),t.strokeStyle=c,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(h,this.pattern)),t.lineDashOffset=0),c&&(t.beginPath(),t.lineWidth=h,t.moveTo(a+o-g,s-l),"rt"!=this.stemEntry?t.quadraticCurveTo(a+o,s-l,a+o,s-l+g):(t.lineTo(p,f),t.lineTo(a+o,s-l+g)),t.lineTo(a+o,s-g/2),"rm"==this.stemEntry&&t.lineTo(p,f),t.lineTo(a+o,s+g/2),t.lineTo(a+o,s+l-g),"rb"!=this.stemEntry?t.quadraticCurveTo(a+o,s+l,a+o-g,s+l):(t.lineTo(p,f),t.lineTo(a+o-g,s+l)),t.lineTo(a+g/2,s+l),"cb"==this.stemEntry&&t.lineTo(p,f),t.lineTo(a-g/2,s+l),t.lineTo(a-o+g,s+l),"lb"!=this.stemEntry?t.quadraticCurveTo(a-o,s+l,a-o,s+l-g):(t.lineTo(p,f),t.lineTo(a-o,s+l-g)),t.lineTo(a-o,s+g/2),"lm"==this.stemEntry&&t.lineTo(p,f),t.lineTo(a-o,s-g/2),t.lineTo(a-o,s-l+g),"lt"!=this.stemEntry?t.quadraticCurveTo(a-o,s-l,a-o+g,s-l):(t.lineTo(p,f),t.lineTo(a-o+g,s-l)),t.lineTo(a-g/2,s-l),"ct"==this.stemEntry&&t.lineTo(p,f),t.lineTo(a+g/2,s-l),t.lineTo(a+o-g,s-l),t.fill(),t.globalAlpha=1,t.stroke()),this.highlighted?this.stx.canvasColor("stx_annotation_highlight",t):t.fillStyle=u,s+=this.padding;for(var y=0;y<this.arr.length;y++)t.fillText(this.arr[y],a-o+this.padding,s-l),s+=this.fontSize;if(t.textBaseline="alphabetic",this.highlighted){var x="p0"==this.highlighted;this.littleCircle(t,p,f,x)}}}},e.Drawing.callout.prototype.click=function(t,e,i){if(!this.stx.overXAxis&&!this.stx.overYAxis){var r=this.stx.panels[this.panelName];return this.copyConfig(),(this.setPoint(0,e,i,r.chart),this.penDown)?(this.adjust(),this.edit(t),this.penDown=!1,!1):(this.stem={d:this.d0,v:this.v0},this.penDown=!0,this.adjust(),!1)}},e.Drawing.callout.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName],a=e.tick-i,s=e.value-r;e.stem?("drag"==e.action?this.stem={d:this.stx.dateFromTick(i,n.chart,!0),v:r}:"move"==e.action&&(this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.stem={d:this.stx.dateFromTick(this.stx.tickFromDate(e.stem.d,n.chart)-a),v:e.stem.v-s}),this.adjust()):this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.render(t)}},e.Drawing.callout.prototype.lineIntersection=function(t,i,r,n){var a=this.stx.panels[this.panelName],s=this.stem,o=this.p0,l=this.stx.layout;if(!o||!s)return!1;var h=this.stx.tickFromDate(s.d,a.chart);return e.boxIntersects(r.x0,r.y0,r.x1,r.y1,o[0],o[1],h,s.v,n,l.semiLog||"log"==l.chartScale)},e.Drawing.callout.prototype.intersected=function(t,i,r){var n=this.stx.panels[this.panelName];if(!this.p0)return null;if(this.pointIntersection(this.stem.t,this.stem.v,r))return this.highlighted="p0",{action:"drag",stem:!0};var a=this.stx.pixelFromTick(this.p0[0],n.chart)-this.w/2,s=this.stx.pixelFromValueAdjusted(n,this.p0[0],this.p0[1])-this.h/2,o=a+this.w,l=s+this.h;this.stem&&this.stem.x&&(a+=this.stem.x,o+=this.stem.x,s+=this.stem.y,l+=this.stem.y);var h=this.stx.pixelFromTick(t,n.chart),u=this.stx.pixelFromValueAdjusted(n,t,i);return h>=a&&h<=o&&u>=s&&u<=l?(this.highlighted=!0,{p0:e.clone(this.p0),tick:t,value:i}):this.lineIntersection(t,i,r,"segment")?(this.highlighted=!0,{action:"move",stem:e.clone(this.stem),p0:e.clone(this.p0),tick:t,value:i}):null},e.Drawing.fibarc=function(){this.name="fibarc"},e.Drawing.fibarc.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibarc.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};var t=this.p0[1],i=this.p1[1],r=this.p0[0],n=this.p1[0],a=2*(t-i)+i,s=e.xIntersection({x0:r,x1:n,y0:t,y1:i},a);this.outer.p0[1]=a,this.outer.p0[0]=s},e.Drawing.fibarc.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=i.yAxis;if(this.p1){var n=this.stx.pixelFromTick(this.p0[0],i.chart),a=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=o<s,h=Math.abs((o-s)/(a-n)),u=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var c=this.color;("auto"==c||e.isTransparent(c))&&(c=this.stx.defaultColor);for(var p=0;p<this.parameters.fibs.length;p++){t.fillStyle=c;var d=this.parameters.fibs[p];if(!(d.level<0)&&d.display){var f=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*d.level,m=this.p1[1]+f*(l?-1:1),g=this.stx.pixelFromValueAdjusted(i,this.p0[0],m),v=e.xIntersection({x0:n,x1:a,y0:s,y1:o},g);if(this.parameters.printLevels){t.textAlign="center";var y=Math.round(1e3*d.level)/10+"%";this.parameters.printValues&&(t.fillStyle=c,this.stx.canvasFont("stx_yaxis",t)),t.fillText(y,a,Math.round(g-5))}if(t.textAlign="left",this.parameters.printValues&&v<this.stx.chart.width){var x=m;x=r.priceFormatter?r.priceFormatter(this.stx,i,x):this.stx.formatYAxisPrice(x,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,x,g,c,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var C=d.color;("auto"==C||e.isTransparent(C))&&(C=this.color),("auto"==C||e.isTransparent(C))&&(C=this.stx.defaultColor),t.strokeStyle=C;var S=d.color;("auto"==S||e.isTransparent(S))&&(S=this.fillColor),("auto"==S||e.isTransparent(S))&&(S=this.stx.defaultColor),t.fillStyle=S,t.globalAlpha=d.parameters.opacity,t.lineWidth=d.parameters.lineWidth,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(t.lineWidth,d.parameters.pattern)),t.lineDashOffset=0),t.save(),t.beginPath(),t.scale(1/h,1),t.arc(a*h,o,Math.abs(g-o),0,Math.PI,!l),t.stroke(),t.globalAlpha=.05,t.fill(),t.restore(),t.setLineDash&&t.setLineDash([]),t.globalAlpha=1}}if(t.textAlign="left",this.stx.plotLine(a,2*n-a,o,2*s-o,u,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var w="p0"==this.highlighted,D="p1"==this.highlighted;this.littleCircle(t,n,s,w),this.littleCircle(t,a,o,D)}}}},e.Drawing.fibfan=function(){this.name="fibfan"},e.Drawing.fibfan.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibfan.prototype.setOuter=function(){this.outer={p0:e.clone(this.p0),p1:e.clone(this.p1)};for(var t=this.p0[1],i=this.p1[1],r=this.p0[0],n=this.p1[0],a=0,s=0;s<this.parameters.fibs.length;s++){var o=this.parameters.fibs[s];if(!(o.level>=a)&&o.display){var l=(t-i)*o.level+i,h=e.xIntersection({x0:r,x1:n,y0:t,y1:i},l);a=o.level,this.outer.p1[1]=l,this.outer.p1[0]=h}}},e.Drawing.fibfan.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i){var r=i.yAxis;if(this.p1){var n=this.stx.pixelFromTick(this.p0[0],i.chart),a=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),o=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),l=Math.min(o,s),h=Math.max(o,s),u=h-l,c=(o-s)/(a-n)>0,p=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var d=t.measureText("161.8%").width+10,f=Number.MAX_VALUE,m=-1*Number.MAX_VALUE,g=this.color;("auto"==g||e.isTransparent(g))&&(g=this.stx.defaultColor);for(var v=0;v<this.parameters.fibs.length;v++){t.fillStyle=g;var y=this.parameters.fibs[v];if(y.display){var x=this.stx.pixelFromValueAdjusted(i,this.p0[0],(this.p0[1]-this.p1[1])*y.level+this.p1[1]),C=e.xIntersection({x0:a,x1:a,y0:s,y1:o},x),S=this.stx.chart.left;a>n&&(S+=this.stx.chart.width);var w=(S-n)*(x-s)/(C-n)+s;if(!(n>S-(this.parameters.printLevels?d+5:0)&&a>n||n<S+(this.parameters.printLevels?d+5:0)&&a<n)){if(this.parameters.printLevels){var D=Math.round(1e3*y.level)/10+"%";a>n?(S-=d,t.textAlign="left"):(S+=d,t.textAlign="right"),this.parameters.printValues&&(t.fillStyle=g,this.stx.canvasFont("stx_yaxis",t)),w=(S-n)*(x-s)/(C-n)+s,t.fillText(D,S,w),a>n?S-=5:S+=5}if(t.textAlign="left",this.parameters.printValues&&C<this.stx.chart.width){var b=this.stx.transformedPriceFromPixel(x,i);b=r.priceFormatter?r.priceFormatter(this.stx,i,b):this.stx.formatYAxisPrice(b,i),t==this.stx.chart.context&&this.stx.endClip(),this.stx.createYAxisLabel(i,b,x,g,null,t),t==this.stx.chart.context&&this.stx.startClip(i.name)}var T=y.color;("auto"==T||e.isTransparent(T))&&(T=this.color),("auto"==T||e.isTransparent(T))&&(T=this.stx.defaultColor);var M=y.color;("auto"==M||e.isTransparent(M))&&(M=this.fillColor),("auto"==M||e.isTransparent(M))&&(M=this.stx.defaultColor),t.fillStyle=M,this.parameters.printLevels&&(w=(S-n)*(x-s)/(C-n)+s),this.stx.plotLine(n,S,s,w,y.level||!this.highlighted?T:p,"segment",t,i,y.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(S,w),t.lineTo(n,s),t.lineTo(S,s),t.fill(),t.globalAlpha=1,x<f&&(f=x),x>m&&(m=x)}}}for(var k in{0:0,1:1}){var A=c?h-u*k:l+u*k;A=Math.round(A),A<f&&(f=A),A>m&&(m=A)}if(this.highlighted){var P="p0"==this.highlighted,_="p1"==this.highlighted;this.littleCircle(t,n,s,P),this.littleCircle(t,a,o,_)}}}},e.Drawing.fibtimezone=function(){this.name="fibtimezone"},e.Drawing.fibtimezone.ciqInheritsFrom(e.Drawing.fibonacci),e.Drawing.fibtimezone.prototype.render=function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=[1,0],l=this.setLineColor(this.parameters.trend.color);t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0],u=this.color;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor),t.textAlign="center";var c=r,p=this.stx.chart.panel.yAxis.height,d=0,f=this.parameters.timezone.color;("auto"==f||e.isTransparent(f))&&(f=this.color),("auto"==f||e.isTransparent(f))&&(f=this.stx.defaultColor);var m=this.parameters.timezone.color;("auto"==m||e.isTransparent(m))&&(m=this.fillColor),("auto"==m||e.isTransparent(m))&&(m=this.stx.defaultColor),this.parameters.printLevels&&(p-=13);do{if(c=this.stx.pixelFromTick(this.p0[0]+d*h,i.chart),r<n&&c>this.stx.chart.left+this.stx.chart.width)break;if(r>n&&c<this.stx.chart.left)break;this.parameters.printLevels&&(t.fillStyle=u,t.fillText(n>r?d:-1*d,c,p+7)),t.fillStyle=m,this.stx.plotLine(c,c,0,p,this.highlighted?l:f,"segment",t,i,this.parameters.timezone.parameters),t.globalAlpha=.05,t.beginPath(),t.moveTo(r,0),t.lineTo(c,0),t.lineTo(c,p),t.lineTo(r,p),t.fill(),t.globalAlpha=1,d=o[0]+o[1],o.unshift(d)}while(h);if(t.textAlign="left",this.stx.plotLine(r,n,a,s,l,"segment",t,i,this.parameters.trend.parameters),this.highlighted){var g="p0"==this.highlighted,v="p1"==this.highlighted;this.littleCircle(t,r,a,g),this.littleCircle(t,n,s,v)}}},e.Drawing.fibtimezone.prototype.intersected=function(t,i,r){var n=this.p0,a=this.p1,s=this.stx.layout;return n&&a?this.pointIntersection(n[0],n[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(a[0],a[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):e.boxIntersects(r.x0,r.y0,r.x1,r.y1,n[0],n[1],a[0],a[1],"segment",s.semiLog||"log"==s.chartScale)||r.x0<=n[0]&&r.x1>=n[0]?(this.highlighted=!0,{action:"move",p0:e.clone(n),p1:e.clone(a),tick:t,value:i}):null:null},e.Drawing.shape=function(){this.name="shape",this.radians=0,this.a=0,this.rotating=!1,this.textMeasure=!1,this.configurator="shape",this.dimension=[0,0],this.points=[]},e.Drawing.shape.ciqInheritsFrom(e.Drawing.BaseTwoPoint),e.Drawing.shape.prototype.measure=function(){},e.Drawing.shape.prototype.render=function(t){if(this.points.length){var i=this.stx.panels[this.panelName];if(i){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]);if(this.p1){var a=this.stx.pixelFromTick(this.p1[0],i.chart),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);t.globalAlpha=.5,t.fillStyle="#000000",this.rotating?(this.radians=Math.atan((s-n)/(a-r)),a<r?this.radians+=Math.PI:s<n&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.a%=360,this.radians=this.a*Math.PI/180,this.textMeasure&&t.fillText(this.a+"°",a+10,s+10)):this.penDown&&(this.sx=Math.max(1,parseFloat(Math.abs(2*(a-r)/this.dimension[0]).toFixed(1))),a<r&&(this.sx*=-1),this.sy=Math.max(1,parseFloat(Math.abs(2*(s-n)/this.dimension[1]).toFixed(1))),s<n&&(this.sy*=-1),this.textMeasure&&t.fillText(this.sx+"x,"+this.sy+"x",a+this.sx+5,s+this.sy+5)),t.globalAlpha=1}var o=this.lineWidth;o||(o=1.1);var l={pattern:this.pattern,lineWidth:o};this.highlighted&&"none"==l.pattern&&(l.pattern="solid",.1==l.lineWidth&&(l.lineWidth=1));var h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),this.highlighted&&(h=this.stx.getCanvasColor("stx_highlight_vector"),.1==o&&(o=1.1));var u=this.fillColor;o/=2*Math.abs(this.sx*this.sy)/(Math.abs(this.sx)+Math.abs(this.sy)),t.save(),t.translate(r,n),t.rotate(this.radians),t.scale(this.sx,this.sy);var c,p;for(c=0;c<this.points.length;c++){for(t.beginPath(),p=0;p<this.points[c].length;p++){var d,f,m,g,v,y;"M"==this.points[c][p]?(d=this.points[c][++p]-(this.dimension[0]-1)/2,f=this.points[c][++p]-(this.dimension[1]-1)/2,t.moveTo(d,f)):"L"==this.points[c][p]?(d=this.points[c][++p]-(this.dimension[0]-1)/2,f=this.points[c][++p]-(this.dimension[1]-1)/2,t.lineTo(d,f)):"Q"==this.points[c][p]?(m=this.points[c][++p]-(this.dimension[0]-1)/2,v=this.points[c][++p]-(this.dimension[1]-1)/2,d=this.points[c][++p]-(this.dimension[0]-1)/2,f=this.points[c][++p]-(this.dimension[1]-1)/2,t.quadraticCurveTo(m,v,d,f)):"B"==this.points[c][p]&&(m=this.points[c][++p]-(this.dimension[0]-1)/2,v=this.points[c][++p]-(this.dimension[1]-1)/2,g=this.points[c][++p]-(this.dimension[0]-1)/2,y=this.points[c][++p]-(this.dimension[1]-1)/2,d=this.points[c][++p]-(this.dimension[0]-1)/2,f=this.points[c][++p]-(this.dimension[1]-1)/2,t.bezierCurveTo(m,v,g,y,d,f))}t.closePath(),u&&!e.isTransparent(u)&&"auto"!=u&&(t.fillStyle=u,t.fill()),h&&"none"!=this.pattern&&(t.strokeStyle=h,t.lineWidth=o,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(o,this.pattern)),t.lineDashOffset=0),t.stroke())}if(t.restore(),t.save(),t.translate(r,n),t.rotate(this.radians),this.highlighted){var x="p0"==this.highlighted,C="p1"==this.highlighted,S="p2"==this.highlighted;this.littleCircle(t,0,0,x),this.mover(t,0,0,x),this.littleCircle(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,C),this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,C),this.littleCircle(t,this.sx*this.dimension[0]/2,0,S),this.rotator(t,this.sx*this.dimension[0]/2,0,S),t.globalAlpha=.5,t.fillStyle="#000000",this.textMeasure&&(t.fillText(this.sx+"x,"+this.sy+"x",this.sx*this.dimension[0]/2+12,this.sy*this.dimension[1]/2+5),t.fillText(this.a+"°",this.sx*this.dimension[0]/2+12,5)),t.globalAlpha=1}else this.penDown&&(this.rotating?this.rotator(t,this.sx*this.dimension[0]/2,0,!0):this.resizer(t,this.sx*this.dimension[0]/2,this.sy*this.dimension[1]/2,!0));t.restore()}}},e.Drawing.shape.prototype.reposition=function(t,e,i,r){if(e){var n=this.stx.panels[this.panelName];if("move"==e.action){var a=e.tick-i,s=e.value-r;this.setPoint(0,e.p0[0]-a,e.p0[1]-s,n.chart),this.render(t)}else{var o=this.stx.pixelFromTick(this.p0[0],n.chart),l=this.stx.pixelFromValueAdjusted(n,this.p0[0],this.p0[1]),h=this.stx.pixelFromTick(i,n.chart),u=this.stx.pixelFromValueAdjusted(n,i,r);"scale"==e.action?(this[e.point]=[i,r],this.sx=parseFloat((((h-o)*Math.cos(this.radians)+(u-l)*Math.sin(this.radians))/(this.dimension[0]/2)).toFixed(1)),Math.abs(this.sx)<1&&(this.sx/=Math.abs(this.sy)),this.sy=parseFloat((((u-l)*Math.cos(this.radians)-(h-o)*Math.sin(this.radians))/(this.dimension[1]/2)).toFixed(1)),Math.abs(this.sy)<1&&(this.sy/=Math.abs(this.sy)),this.render(t)):"rotate"==e.action&&(this[e.point]=[i,r],this.radians=Math.atan((u-l)/(h-o)),h<o?this.radians+=Math.PI:u<l&&(this.radians+=2*Math.PI),this.a=5*parseInt((36*this.radians/Math.PI).toFixed(0),10),this.sx<0&&(this.a=this.a+180),this.a%=360,this.radians=this.a*Math.PI/180,this.render(t))}}},e.Drawing.shape.prototype.intersected=function(t,i,r){if(!this.p0)return null;if(this.stx.repositioningDrawing==this&&this.stx.repositioningDrawing.repositioner)return this.stx.repositioningDrawing.repositioner;var n=this.stx.panels[this.panelName],a=this.stx.pixelFromTick(this.p0[0],n.chart),s=this.stx.pixelFromValueAdjusted(n,this.p0[0],this.p0[1]),o=this.stx.pixelFromTick(t,n.chart),l=this.stx.pixelFromValueAdjusted(n,t,i);o-=a,l-=s;var h=l,u=o;o=Math.cos(this.radians)*u+Math.sin(this.radians)*h,l=Math.cos(this.radians)*h-Math.sin(this.radians)*u,o/=this.sx,l/=this.sy;var c=Math.pow(e.touchDevice?25:5+this.littleCircleRadius(),2),p=Math.abs(c/(this.sx*this.sy)),d=Math.pow(this.dimension[0]/2,2)+Math.pow(this.dimension[1]/2,2)>Math.pow(o,2)+Math.pow(l,2),f=(c-(Math.pow(o*this.sx,2)+Math.pow(l*this.sy,2)))/Math.abs(this.sx*this.sy),m=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l-this.dimension[1]/2,2)),g=p-(Math.pow(o-this.dimension[0]/2,2)+Math.pow(l,2));return m>0&&m>=g&&m>=f?(this.highlighted="p1",{action:"scale"}):g>0&&g>=m&&g>=f?(this.highlighted="p2",{action:"rotate"}):f>0&&f>=m&&f>=g?(this.highlighted="p0",{action:"move",p0:e.clone(this.p0),tick:t,value:i}):d?(this.highlighted=!0,{}):null},e.Drawing.shape.prototype.configs=["color","fillColor","lineWidth","pattern"],e.Drawing.shape.prototype.littleCircleRadius=function(){return 3},e.Drawing.shape.prototype.click=function(t,e,i){if(!this.points.length)return!1;this.copyConfig();var r=this.stx.panels[this.panelName];return this.penDown?(this.setPoint(1,e,i,r.chart),this.rotating?(this.penDown=!1,this.rotating=!1,!0):(this.rotating=!0,!1)):(this.setPoint(0,e,i,r.chart),this.penDown=!0,!1)},e.Drawing.shape.prototype.adjust=function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.radians=Math.round(this.a/5)*Math.PI/36)},e.Drawing.shape.prototype.reconstruct=function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.v0=e.v0,this.tzo0=e.tzo0,this.a=e.a,this.sx=e.sx,this.sy=e.sy,this.adjust()},e.Drawing.shape.prototype.serialize=function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,v0:this.v0,tzo0:this.tzo0,a:this.a,sx:this.sx,sy:this.sy}},e.Drawing.xcross=function(){this.name="xcross",this.dimension=[7,7],this.points=[["M",1,0,"L",3,2,"L",5,0,"L",6,1,"L",4,3,"L",6,5,"L",5,6,"L",3,4,"L",1,6,"L",0,5,"L",2,3,"L",0,1,"L",1,0]]},e.Drawing.xcross.ciqInheritsFrom(e.Drawing.shape),e.Drawing.arrow=function(){this.name="arrow",this.dimension=[11,11],this.points=[["M",3,0,"L",7,0,"L",7,5,"L",10,5,"L",5,10,"L",0,5,"L",3,5,"L",3,0]]},e.Drawing.arrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.check=function(){this.name="check",this.dimension=[8,9],this.points=[["M",1,5,"L",0,6,"L",2,8,"L",7,1,"L",6,0,"L",2,6,"L",1,5]]},e.Drawing.check.ciqInheritsFrom(e.Drawing.shape),e.Drawing.star=function(){this.name="star",this.dimension=[12,12],this.points=[["M",0,4,"L",4,4,"L",5.5,0,"L",7,4,"L",11,4,"L",8,7,"L",9,11,"L",5.5,9,"L",2,11,"L",3,7,"L",0,4]]},e.Drawing.star.ciqInheritsFrom(e.Drawing.shape),e.Drawing.heart=function(){this.name="heart",this.dimension=[23,20],this.points=[["M",11,3,"B",11,2.4,10,0,6,0,"B",0,0,0,7.5,0,7.5,"B",0,11,4,15.4,11,19,"B",18,15.4,22,11,22,7.5,"B",22,7.5,22,0,16,0,"B",13,0,11,2.4,11,3]]},e.Drawing.heart.ciqInheritsFrom(e.Drawing.shape),e.Drawing.focusarrow=function(){this.name="focusarrow",this.dimension=[7,5],this.points=[["M",0,0,"L",2,2,"L",0,4,"L",0,0],["M",6,0,"L",4,2,"L",6,4,"L",6,0]]},e.Drawing.focusarrow.ciqInheritsFrom(e.Drawing.shape),e.Drawing.crossline=function(){this.name="crossline"},e.Drawing.crossline.ciqInheritsFrom(e.Drawing.horizontal),e.extend(e.Drawing.crossline.prototype,{measure:function(){},accidentalClick:function(t,e){return!1},adjust:function(){var t=this.stx.panels[this.panelName];t&&(this.setPoint(0,this.d0,this.v0,t.chart),this.p1=e.clone(this.p0))},intersected:function(t,i,r){if(!this.p0||!this.p1)return null;this.p1[0]+=1;var n=this.lineIntersection(t,i,r,"horizontal");return this.p1=e.clone(this.p0),n||(this.p1[1]+=1,n=this.lineIntersection(t,i,r,"vertical"),this.p1=e.clone(this.p0),n)?(this.highlighted=!0,{action:"move",p0:e.clone(this.p0),p1:e.clone(this.p1),tick:t,value:i}):null},render:function(t){var r=this.stx.panels[this.panelName];if(r){var n=this.stx.pixelFromTick(this.p0[0],r.chart),a=this.stx.pixelFromValueAdjusted(r,this.p0[0],this.p0[1]),s=this.setLineColor(),o={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(n,n+100,a,a,s,"horizontal",t,r,o),this.stx.plotLine(n,n,a,a+100,s,"vertical",t,r,o),this.axisLabel&&!this.highlighted){this.stx.endClip();var l=this.p0[1];if(r.chart.transformFunc&&(l=r.chart.transformFunc(this.stx,r.chart,l)),l=r.yAxis.priceFormatter?r.yAxis.priceFormatter(this.stx,r,l):this.stx.formatYAxisPrice(l,r),this.stx.createYAxisLabel(r,l,a,s),this.stx.startClip(r.name),this.p0[0]>=0&&!e.ChartEngine.hideDates()){var h,u;if(h=this.stx.dateFromTick(this.p0[0],r.chart,!0),e.ChartEngine.isDailyInterval(this.stx.layout.interval))h.setHours(0,0,0,0);else{var c=1e3*h.getSeconds()+h.getMilliseconds();this.stx.dataZone&&(u=new i.Date(h.getFullYear(),h.getMonth(),h.getDate(),h.getHours(),h.getMinutes(),this.stx.dataZone),h=new Date(u.getTime()+c)),this.stx.displayZone&&(u=new i.Date(h.getTime(),this.stx.displayZone),h=new Date(u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes()),h=new Date(h.getTime()+c))}var p=e.mmddhhmm(e.yyyymmddhhmm(h));if(r.chart.xAxis.formatter)p=r.chart.xAxis.formatter(h);else if(this.stx.internationalizer){var d;0!==h.getHours()||0!==h.getMinutes()?(d=this.stx.internationalizer.monthDay.format(h),d+=" "+this.stx.internationalizer.hourMinute.format(h)):d=this.stx.internationalizer.yearMonthDay.format(h),p=d}this.stx.endClip(),this.stx.createXAxisLabel(r,p,n,s,null,!0),this.stx.startClip(r.name)}}}}}),e.Drawing.speedarc=function(){this.name="speedarc",this.printLevels=!0},e.Drawing.speedarc.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.speedarc.prototype,{defaultOpacity:.25,configs:["color","fillColor","lineWidth","pattern"],lineIntersection:function(t,i,r,n){var a=this.p0,s=this.p1,o=this.stx.layout;return a&&s&&e.boxIntersects(r.x0,r.y0,r.x1,r.y1,a[0],a[1],s[0],s[1],"segment",o.semiLog||"log"==o.chartScale)},copyConfig:function(){this.color=this.stx.currentVectorParameters.currentColor,this.fillColor=this.stx.currentVectorParameters.fillColor,this.lineWidth=this.stx.currentVectorParameters.lineWidth,this.pattern=this.stx.currentVectorParameters.pattern},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){
var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=s<a,l=Math.abs((s-a)/(n-r)),h=this.color;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.strokeStyle=h;var u=this.fillColor;("auto"==u||e.isTransparent(u))&&(u=this.stx.defaultColor),t.fillStyle=u,t.setLineDash&&(t.setLineDash(e.borderPatternToArray(this.lineWidth,this.pattern)),t.lineDashOffset=0),this.stx.canvasFont("stx_yaxis",t);for(var c=1;c<3;c++){var p=Math.abs(this.p1[1]-this.p0[1])*Math.sqrt(2)*c/3,d=this.p1[1]+p*(o?-1:1),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],d);if(t.save(),t.beginPath(),t.scale(1/l,1),t.arc(n*l,s,Math.abs(f-s),0,Math.PI,!o),t.globalAlpha=this.defaultOpacity,t.stroke(),t.globalAlpha=.1,t.fill(),t.restore(),t.globalAlpha=1,this.printLevels){t.fillStyle=h,t.textAlign="center";var m=c+"/3";t.fillText(m,n,Math.round(f-5)),t.fillStyle=u}}t.textAlign="left";var g=this.setLineColor(),v={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity};if(this.stx.plotLine(r,n,a,s,g,"segment",t,i,v),t.setLineDash&&t.setLineDash([]),this.highlighted){var y="p0"==this.highlighted,x="p1"==this.highlighted;this.littleCircle(t,r,a,y),this.littleCircle(t,n,s,x)}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.fillColor=e.fc,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,fc:this.fillColor,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1}}}),e.Drawing.speedline=function(){this.name="speedline",this.printLevels=!0},e.Drawing.speedline.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.speedline.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.setLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;for(var u,c,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},d=["1","2/3","1/3","3/2","3"],f=[1,2/3,1/3,1.5,3],m=[],g=0;g<f.length;g++){var v=f[g];if(!(v>1)||this.extension){var y,x=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]-(this.p0[1]-this.p1[1])*v);v>1?(y=e.xIntersection({x0:r,x1:n,y0:a,y1:x},s),m.push(y)):(y=e.xIntersection({x0:n,x1:n,y0:a,y1:s},x),m.push(x));var C=v>1?y:n,S=v>1?s:x;if(this.confineToGrid||(C=this.stx.chart.left,n>r&&(C+=this.stx.chart.width),S=(C-r)*(x-a)/(n-r)+a),this.printLevels&&(1!=v||this.extension)){t.fillStyle=l;var w=0,D=0;a>s?(D=-5,t.textBaseline="bottom"):(D=5,t.textBaseline="top"),r>n?(w=5,t.textAlign="right"):(w=-5,t.textAlign="left"),v>1?t.fillText(d[g],y+(this.confineToGrid?0:w),s):t.fillText(d[g],n,x+(this.confineToGrid?0:D)),t.fillStyle=h}this.stx.plotLine(r,C,a,S,g||!this.highlighted?l:o,"segment",t,i,p),1==v&&(u=C,c=S),t.globalAlpha=.1,t.beginPath(),t.moveTo(C,S),t.lineTo(r,a),t.lineTo(u,c),t.fill(),t.globalAlpha=1}}if(t.textAlign="left",t.textBaseline="middle",this.confineToGrid&&(t.globalAlpha=.3,t.beginPath(),t.moveTo(r,a),t.lineTo(r,s),t.lineTo(n,s),t.lineTo(n,a),t.lineTo(r,a),t.moveTo(r,m[1]),t.lineTo(n,m[1]),t.moveTo(r,m[2]),t.lineTo(n,m[2]),this.extension&&(t.moveTo(m[3],a),t.lineTo(m[3],s),t.moveTo(m[4],a),t.lineTo(m[4],s)),t.stroke(),t.globalAlpha=1),this.highlighted){var b="p0"==this.highlighted,T="p1"==this.highlighted;this.littleCircle(t,r,a,b),this.littleCircle(t,n,s,T)}}}}),e.Drawing.gannfan=function(){this.name="gannfan",this.printLevels=!0},e.Drawing.gannfan.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.gannfan.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]);this.stx.canvasFont("stx_yaxis",t);var o=this.setLineColor(),l=this.color;("auto"==l||e.isTransparent(l))&&(l=this.stx.defaultColor),t.strokeStyle=l;var h=this.fillColor;("auto"==h||e.isTransparent(h))&&(h=this.stx.defaultColor),t.fillStyle=h;for(var u,c,p={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},d=[1,2,3,4,8,.5,1/3,.25,1/8],f=0;f<d.length;f++){var m=d[f],g=r+(n-r)/m,v=a-m*(a-s),y=this.stx.chart.left;n>r&&(y+=this.stx.chart.width);var x=(y-r)*(v-a)/(n-r)+a;if(this.printLevels){t.fillStyle=l;var C=0,S=0;a>s?(S=5,t.textBaseline="top"):(S=-5,t.textBaseline="botttom"),r>n?(C=5,t.textAlign="left"):(C=-5,t.textAlign="right"),m>1?t.fillText(m+"x1",g+C,s):t.fillText("1x"+1/m,n,v+S),t.fillStyle=h}this.stx.plotLine(r,y,a,x,f||!this.highlighted?l:o,"segment",t,i,p),1==m&&(u=y,c=x),t.globalAlpha=.1,t.beginPath(),t.moveTo(y,x),t.lineTo(r,a),t.lineTo(u,c),t.fill(),t.globalAlpha=1}if(t.textAlign="left",t.textBaseline="middle",this.highlighted){var w="p0"==this.highlighted,D="p1"==this.highlighted;this.littleCircle(t,r,a,w),this.littleCircle(t,n,s,D)}}}}),e.Drawing.timecycle=function(){this.name="timecycle",this.printLevels=!0},e.Drawing.timecycle.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.timecycle.prototype,{intersected:function(t,i,r){var n=this.p0,a=this.p1,s=this.stx.layout;return n&&a?this.pointIntersection(n[0],n[1],r)?(this.highlighted="p0",{action:"drag",point:"p0"}):this.pointIntersection(a[0],a[1],r)?(this.highlighted="p1",{action:"drag",point:"p1"}):e.boxIntersects(r.x0,r.y0,r.x1,r.y1,n[0],n[1],a[0],a[1],"segment",s.semiLog||"log"==s.chartScale)||r.x0<=this.p0[0]&&r.x1>=n[0]?(this.highlighted=!0,{action:"move",p0:e.clone(n),p1:e.clone(a),tick:t,value:i}):null:null},render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=this.stx.pixelFromValueAdjusted(i,this.p0[0],this.p0[1]),s=this.stx.pixelFromValueAdjusted(i,this.p1[0],this.p1[1]),o=0,l=this.setLineColor();t.textBaseline="middle",this.stx.canvasFont("stx_yaxis",t);var h=this.p1[0]-this.p0[0];t.textAlign="center";var u=r,c=this.stx.chart.panel.yAxis.height,p=this.color;("auto"==p||e.isTransparent(p))&&(p=this.stx.defaultColor);var d=this.fillColor;("auto"==d||e.isTransparent(d))&&(d=this.stx.defaultColor),this.printLevels&&(c-=13);var f={pattern:this.pattern,lineWidth:this.lineWidth,opacity:this.defaultOpacity},m=[];t.save(),t.fillStyle=d,t.globalAlpha=.05;do{if(u=this.stx.pixelFromTick(this.p0[0]+o*h,i.chart),o++,r<n&&u>this.stx.chart.left+this.stx.chart.width)break;if(r>n&&u<this.stx.chart.left)break;u<this.stx.chart.left||u>this.stx.chart.left+this.stx.chart.width||(t.beginPath(),t.moveTo(r,0),t.lineTo(u,0),t.lineTo(u,c),t.lineTo(r,c),t.fill(),m.push({c:o,x:u}))}while(h);t.globalAlpha=1;for(var g=0,v=0;v<m.length;v++)if(this.stx.plotLine(m[v].x,m[v].x,0,c,this.highlighted?l:p,"segment",t,i,f),this.printLevels){t.fillStyle=p;var y=this.stx.chart.context.measureText(m[v].c).width+3;y<this.stx.layout.candleWidth+g?(t.fillText(m[v].c,m[v].x,c+7),g=0):g+=this.stx.layout.candleWidth}if(t.restore(),t.textAlign="left",this.stx.plotLine(r,n,a,s,l,"segment",t,i,f),this.highlighted){var x="p0"==this.highlighted,C="p1"==this.highlighted;this.littleCircle(t,r,a,x),this.littleCircle(t,n,s,C)}}}}),e.Drawing.regression=function(){this.name="regression"},e.Drawing.regression.ciqInheritsFrom(e.Drawing.segment),e.extend(e.Drawing.regression.prototype,{click:function(t,e,i){if(!(e<0)){this.copyConfig();var r=this.stx.panels[this.panelName];return this.penDown?this.accidentalClick(e,i)?this.dragToDraw:(this.setPoint(1,e,i,r.chart),this.penDown=!1,!0):(this.setPoint(0,e,i,r.chart),this.penDown=!0,!1)}},lineIntersection:function(t,i,r,n){var a=this.p0,s=this.p1,o=this.stx.layout;return a&&s&&e.boxIntersects(r.x0,r.y0,r.x1,r.y1,a[0],a[1],s[0],s[1],"segment",o.semiLog||"log"==o.chartScale)},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<this.stx.chart.left&&r<this.stx.chart.left||i>this.stx.chart.right&&r>this.stx.chart.right)){for(var n=[],a=0,s=0,o=0,l=Math.min(this.p1[0],this.p0[0]);l<=Math.max(this.p1[0],this.p0[0]);l++){if(this.stx.chart.dataSet[l]){var h=this.stx.chart.dataSet[l].Close;(h||0===h)&&n.push(h)}o++}for(l=0;l<n.length;l++)s+=n.length*n[l]-a,a+=n[l];var u,c,p=n.length,d=p*(p+1)/2,f=Math.pow(d,2),m=d*(2*p+1)/3,g=(p*s-d*a)/(p*m-f),v=(a-g*d)/p;this.p0[0]<this.p1[0]?(u=this.stx.pixelFromValueAdjusted(e,this.p0[0],v),c=this.stx.pixelFromValueAdjusted(e,this.p1[0],g*o+v)):(u=this.stx.pixelFromValueAdjusted(e,this.p0[0],g*o+v),c=this.stx.pixelFromValueAdjusted(e,this.p1[0],v));var y=this.setLineColor(),x={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,r,u,c,y,"segment",t,e,x),this.stx.plotLine(i,i,u-20,u+20,y,"segment",t,e,x),this.stx.plotLine(r,r,c-20,c+20,y,"segment",t,e,x),this.highlighted){var C="p0"==this.highlighted,S="p1"==this.highlighted;this.littleCircle(t,i,u,C),this.littleCircle(t,r,c,S)}else this.p0[0]<this.p1[0]?(this.setPoint(0,this.p0[0],v,e.chart),this.setPoint(1,this.p1[0],g*o+v,e.chart)):(this.setPoint(0,this.p0[0],g*o+v,e.chart),this.setPoint(1,this.p1[0],v,e.chart))}}}}),e.Drawing.average=function(){this.name="average"},e.Drawing.average.ciqInheritsFrom(e.Drawing.regression),e.extend(e.Drawing.average.prototype,{configs:["color","lineWidth","pattern","axisLabel"],measure:function(){},render:function(t){var e=this.stx.panels[this.panelName];if(e&&this.p1&&!(this.p0[0]<0||this.p1[0]<0)){var i=this.stx.pixelFromTick(this.p0[0],e.chart),r=this.stx.pixelFromTick(this.p1[0],e.chart);if(!(i<this.stx.chart.left&&r<this.stx.chart.left||i>this.stx.chart.right&&r>this.stx.chart.right)){for(var n=0,a=0,s=0,o=Math.min(this.p1[0],this.p0[0]);o<=Math.max(this.p1[0],this.p0[0]);o++){if(this.stx.chart.dataSet[o]){var l=this.stx.chart.dataSet[o].Close;(l||0===l)&&(s++,n+=l)}a++}if(s){var h=n/s;y=this.stx.pixelFromValueAdjusted(e,this.p0[0],h);var u=this.setLineColor(),c={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(i,r,y,y,u,"segment",t,e,c),this.stx.plotLine(i,i,y-20,y+20,u,"segment",t,e,c),this.stx.plotLine(r,r,y-20,y+20,u,"segment",t,e,c),this.axisLabel&&!this.highlighted&&!this.penDown&&(i>=e.chart.left&&i<=e.chart.right||r>=e.chart.left&&r<=e.chart.right)){this.stx.endClip();var p=h;e.chart.transformFunc&&(p=e.chart.transformFunc(this.stx,e.chart,p)),p=e.yAxis.priceFormatter?e.yAxis.priceFormatter(this.stx,e,p):this.stx.formatYAxisPrice(p,e),this.stx.createYAxisLabel(e,p,y,u),this.stx.startClip(e.name)}if(this.highlighted){var d="p0"==this.highlighted,f="p1"==this.highlighted;this.littleCircle(t,i,y,d),this.littleCircle(t,r,y,f)}else this.setPoint(0,this.p0[0],h),this.setPoint(1,this.p1[0],h)}}}},reconstruct:function(t,e){this.stx=t,this.color=e.col,this.panelName=e.pnl,this.pattern=e.ptrn,this.lineWidth=e.lw,this.d0=e.d0,this.d1=e.d1,this.tzo0=e.tzo0,this.tzo1=e.tzo1,this.v0=e.v0,this.v1=e.v1,this.axisLabel=e.al,this.adjust()},serialize:function(){return{name:this.name,pnl:this.panelName,col:this.color,ptrn:this.pattern,lw:this.lineWidth,d0:this.d0,d1:this.d1,tzo0:this.tzo0,tzo1:this.tzo1,v0:this.v0,v1:this.v1,al:this.axisLabel}}}),e.Drawing.quadrant=function(){this.name="quadrant"},e.Drawing.quadrant.ciqInheritsFrom(e.Drawing.speedarc),e.extend(e.Drawing.quadrant.prototype,{render:function(t){var i=this.stx.panels[this.panelName];if(i&&this.p1){for(var r=this.stx.pixelFromTick(this.p0[0],i.chart),n=this.stx.pixelFromTick(this.p1[0],i.chart),a=null,s=null,o=Math.min(this.p1[0],this.p0[0]);o<=Math.max(this.p1[0],this.p0[0]);o++)if(this.stx.chart.dataSet[o]){var l=this.stx.chart.dataSet[o].Close;(l||0===l)&&((null===a||l>a)&&(a=l),(null===s||l<s)&&(s=l))}var h=(a+s)/2,u=this.stx.pixelFromValueAdjusted(i,this.p0[0],a),c=this.stx.pixelFromValueAdjusted(i,this.p0[0],(a+h)/2),p=this.stx.pixelFromValueAdjusted(i,this.p0[0],(2*a+s)/3),d=this.stx.pixelFromValueAdjusted(i,this.p0[0],h),f=this.stx.pixelFromValueAdjusted(i,this.p0[0],(a+2*s)/3),m=this.stx.pixelFromValueAdjusted(i,this.p0[0],(s+h)/2),g=this.stx.pixelFromValueAdjusted(i,this.p0[0],s),v=this.setLineColor(),y=this.fillColor;("auto"==y||e.isTransparent(y))&&(y=this.stx.defaultColor),t.fillStyle=y;var x={pattern:this.pattern,lineWidth:this.lineWidth};if(this.stx.plotLine(r,n,u,u,v,"segment",t,i,x),this.stx.plotLine(r,n,g,g,v,"segment",t,i,x),"quadrant"==this.name?(this.stx.plotLine(r,n,c,c,v,"segment",t,i,x),this.stx.plotLine(r,n,m,m,v,"segment",t,i,x)):"tirone"==this.name&&(this.stx.plotLine(r,n,p,p,v,"segment",t,i,x),this.stx.plotLine(r,n,f,f,v,"segment",t,i,x)),this.stx.plotLine(r,r,u,g,v,"segment",t,i,x),this.stx.plotLine(n,n,u,g,v,"segment",t,i,x),this.stx.plotLine(r,n,d,d,v,"segment",t,i,e.extend(x,{opacity:"tirone"==this.name?.2:1})),t.globalAlpha=.1,t.beginPath(),t.fillRect(r,u,n-r,g-u),"quadrant"==this.name?t.fillRect(r,c,n-r,m-c):"tirone"==this.name&&t.fillRect(r,p,n-r,f-p),t.globalAlpha=1,this.highlighted){var C="p0"==this.highlighted,S="p1"==this.highlighted;this.littleCircle(t,r,d,C),this.littleCircle(t,n,d,S)}else this.setPoint(0,this.p0[0],h,i.chart),this.setPoint(1,this.p1[0],h,i.chart)}}}),e.Drawing.tirone=function(){this.name="tirone"},e.Drawing.tirone.ciqInheritsFrom(e.Drawing.quadrant),t},__equations_=function(t){var e=t.CIQ,i=function(){function t(t){function e(){}return e.prototype=t,new e}function e(t,e,i,r){this.type_=t,this.index_=e||0,this.prio_=i||0,this.number_=void 0!==r&&null!==r?r:0,this.toString=function(){switch(this.type_){case L:return this.number_;case N:case O:case I:return this.index_;case H:return"CALL";default:return"Invalid Token"}}}function i(t,e,i,r){this.tokens=t,this.ops1=e,this.ops2=i,this.functions=r}function r(t){return"string"==typeof t?(z.lastIndex=0,z.test(t)?"'"+t.replace(z,function(t){var e=R[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+t+"'"):t}function n(t,e){return Number(t)+Number(e)}function a(t,e){return t-e}function s(t,e){return t*e}function o(t,e){return t/e}function l(t,e){return t%e}function h(t,e){return""+t+e}function u(t,e){return t==e}function c(t,e){return t!=e}function p(t,e){return t>e}function d(t,e){return t<e}function f(t,e){return t>=e}function m(t,e){return t<=e}function g(t,e){return Boolean(t&&e)}function v(t,e){return Boolean(t||e)}function y(t){return Math.sinh?Math.sinh(t):(Math.exp(t)-Math.exp(-t))/2}function x(t){return Math.cosh?Math.cosh(t):(Math.exp(t)+Math.exp(-t))/2}function C(t){return Math.tanh?Math.tanh(t):t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function S(t){return Math.asinh?Math.asinh(t):t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function w(t){return Math.acosh?Math.acosh(t):Math.log(t+Math.sqrt(t*t-1))}function D(t){return Math.atanh?Math.atanh(t):Math.log((1+t)/(1-t))/2}function b(t){return Math.log(t)*Math.LOG10E}function T(t){return-t}function M(t){return Math.trunc?Math.trunc(t):t<0?Math.ceil(t):Math.floor(t)}function k(t){return Math.random()*(t||1)}function A(t){t=Math.floor(t);for(var e=t;t>1;)e*=--t;return e}function P(){if(Math.hypot)return Math.hypot.apply(this,arguments);for(var t=0,e=arguments.length,i=0;i<e;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;t+=arguments[i]*arguments[i]}return Math.sqrt(t)}function _(t,e,i){return t?e:i}function F(t,e){return"[object Array]"!=Object.prototype.toString.call(t)?[t,e]:(t=t.slice(),t.push(e),t)}function E(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:y,cosh:x,tanh:C,asinh:S,acosh:w,atanh:D,sqrt:Math.sqrt,log:Math.log,lg:b,log10:b,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:M,"-":T,exp:Math.exp},this.ops2={"+":n,"-":a,"*":s,"/":o,"%":l,"^":Math.pow,",":F,"||":h,"==":u,"!=":c,">":p,"<":d,">=":f,"<=":m,and:g,or:v},this.functions={random:k,fac:A,min:Math.min,max:Math.max,hypot:P,pyt:P,pow:Math.pow,atan2:Math.atan2,if:_},this.consts={E:Math.E,PI:Math.PI}}var L=0,N=1,O=2,I=3,H=4,z=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,R={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};i.prototype={simplify:function(r){r=r||{};var n,a,s,o,l=[],h=[],u=this.tokens.length,c=0;for(c=0;c<u;c++){o=this.tokens[c];var p=o.type_;if(p===L)l.push(o);else if(p===I&&o.index_ in r)o=new e(L,0,0,r[o.index_]),l.push(o);else if(p===O&&l.length>1)a=l.pop(),n=l.pop(),s=this.ops2[o.index_],o=new e(L,0,0,s(n.number_,a.number_)),l.push(o);else if(p===N&&l.length>0)n=l.pop(),s=this.ops1[o.index_],o=new e(L,0,0,s(n.number_)),l.push(o);else{for(;l.length>0;)h.push(l.shift());h.push(o)}}for(;l.length>0;)h.push(l.shift());return new i(h,t(this.ops1),t(this.ops2),t(this.functions))},substitute:function(r,n){n instanceof i||(n=(new E).parse(String(n)));var a,s=[],o=this.tokens.length,l=0;for(l=0;l<o;l++){a=this.tokens[l];if(a.type_===I&&a.index_===r)for(var h=0;h<n.tokens.length;h++){var u=n.tokens[h],c=new e(u.type_,u.index_,u.prio_,u.number_);s.push(c)}else s.push(a)}return new i(s,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t){t=t||{};var e,i,r,n,a=[],s=this.tokens.length,o=0;for(o=0;o<s;o++){n=this.tokens[o];var l=n.type_;if(l===L)a.push(n.number_);else if(l===O)i=a.pop(),e=a.pop(),r=this.ops2[n.index_],a.push(r(e,i));else if(l===I)if(n.index_ in t)a.push(t[n.index_]);else{if(!(n.index_ in this.functions))throw new Error("undefined variable: "+n.index_);a.push(this.functions[n.index_])}else if(l===N)e=a.pop(),r=this.ops1[n.index_],a.push(r(e));else{if(l!==H)throw new Error("invalid Expression");if(e=a.pop(),r=a.pop(),!r.apply||!r.call)throw new Error(r+" is not a function");"[object Array]"==Object.prototype.toString.call(e)?a.push(r.apply(void 0,e)):a.push(r.call(void 0,e))}}if(a.length>1)throw new Error("invalid Expression (parity)");return a[0]},toString:function(t){var e,i,n,a,s=[],o=this.tokens.length,l=0;for(l=0;l<o;l++){a=this.tokens[l];var h=a.type_;if(h===L)s.push(r(a.number_));else if(h===O)i=s.pop(),e=s.pop(),n=a.index_,t&&"^"==n?s.push("Math.pow("+e+","+i+")"):s.push("("+e+n+i+")");else if(h===I)s.push(a.index_);else if(h===N)e=s.pop(),n=a.index_,"-"===n?s.push("("+n+e+")"):s.push(n+"("+e+")");else{if(h!==H)throw new Error("invalid Expression");e=s.pop(),n=s.pop(),s.push(n+"("+e+")")}}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]},variables:function(){for(var t=this.tokens.length,e=[],i=0;i<t;i++){var r=this.tokens[i];r.type_===I&&-1==e.indexOf(r.index_)&&e.push(r.index_)}return e}},E.parse=function(t){return(new E).parse(t)},E.evaluate=function(t,e){return E.parse(t).evaluate(e)},E.Expression=i,E.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:y,cosh:x,tanh:C,asinh:S,acosh:w,atanh:D,sqrt:Math.sqrt,log:Math.log,lg:b,log10:b,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:M,random:k,fac:A,exp:Math.exp,min:Math.min,max:Math.max,hypot:P,pyt:P,pow:Math.pow,atan2:Math.atan2,if:_,E:Math.E,PI:Math.PI};return E.prototype={parse:function(r){this.errormsg="",this.success=!0;var n=[],a=[];this.tmpprio=0;var s=77,o=0;for(this.expression=r,this.pos=0;this.pos<this.expression.length;){var l;if(this.isOperator())this.isSign()&&64&s?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",o++,this.addfunc(a,n,N)),s=77):this.isComment()||(0==(2&s)&&this.error_parsing(this.pos,"unexpected operator"),o+=2,this.addfunc(a,n,O),s=77);else if(this.isNumber())0==(1&s)&&this.error_parsing(this.pos,"unexpected number"),l=new e(L,0,0,this.tokennumber),a.push(l),s=50;else if(this.isString())0==(1&s)&&this.error_parsing(this.pos,"unexpected string"),l=new e(L,0,0,this.tokennumber),a.push(l),s=50;else if(this.isLeftParenth())0==(8&s)&&this.error_parsing(this.pos,'unexpected "("'),128&s&&(o+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(a,n,H)),s=333;else if(this.isRightParenth())256&s?(l=new e(L,0,0,[]),a.push(l)):0==(16&s)&&this.error_parsing(this.pos,'unexpected ")"'),s=186;else if(this.isComma())0==(32&s)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(a,n,O),o+=2,s=77;else if(this.isConst()){0==(1&s)&&this.error_parsing(this.pos,"unexpected constant");var h=new e(L,0,0,this.tokennumber);a.push(h),s=50}else if(this.isOp2())0==(4&s)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(a,n,O),o+=2,s=8;else if(this.isOp1())0==(4&s)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(a,n,N),o++,s=8;else if(this.isVar()){0==(1&s)&&this.error_parsing(this.pos,"unexpected variable");var u=new e(I,this.tokenindex,0,0);a.push(u),s=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');n.length>0;){var c=n.pop();a.push(c)}return o+1!==a.length&&this.error_parsing(this.pos,"parity"),new i(a,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(t,e){return this.parse(t).evaluate(e)},error_parsing:function(t,e){throw this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,this.column=t,new Error(this.errormsg)},addfunc:function(t,i,r){for(var n=new e(r,this.tokenindex,this.tokenprio+this.tmpprio,0);i.length>0&&n.prio_<=i[i.length-1].prio_;)t.push(i.pop());i.push(n)},isNumber:function(){for(var t=!1,e="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(i>=48&&i<=57||46===i))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},unescape:function(t,e){for(var i=[],r=!1,n=0;n<t.length;n++){var a=t.charAt(n);if(r){switch(a){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var s=parseInt(t.substring(n+1,n+5),16);i.push(String.fromCharCode(s)),n+=4;break;default:throw this.error_parsing(e+n,"Illegal escape sequence: '\\"+a+"'")}r=!1}else"\\"==a?r=!0:i.push(a)}return i.join("")},isString:function(){var t=!1,e="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){var r=this.expression.charAt(this.pos);if("'"==r&&"\\"!=e.slice(-1)){this.pos++,this.tokennumber=this.unescape(e,i),t=!0;break}e+=this.expression.charAt(this.pos),this.pos++}return t},isConst:function(){var t;for(var e in this.consts){var i=e.length;if(t=this.expression.substr(this.pos,i),e===t)return this.tokennumber=this.consts[e],this.pos+=i,!0}return!1},isOperator:function(){var t=this.expression.charCodeAt(this.pos);if(43===t)this.tokenprio=2,this.tokenindex="+";else if(45===t)this.tokenprio=2,this.tokenindex="-";else if(62===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex=">="):(this.tokenprio=1,this.tokenindex=">");else if(60===t)61===this.expression.charCodeAt(this.pos+1)?(this.pos++,this.tokenprio=1,this.tokenindex="<="):(this.tokenprio=1,this.tokenindex="<");else if(124===t){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="||"}else if(61===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="=="}else if(33===t){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=1,this.tokenindex="!="}else if(97===t){if(110!==this.expression.charCodeAt(this.pos+1)||100!==this.expression.charCodeAt(this.pos+2))return!1;this.pos++,this.pos++,this.tokenprio=0,this.tokenindex="and"}else if(111===t){if(114!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="or"}else if(42===t||8729===t||8226===t)this.tokenprio=3,this.tokenindex="*";else if(47===t)this.tokenprio=4,this.tokenindex="/";else if(37===t)this.tokenprio=4,this.tokenindex="%";else{if(94!==t)return!1;this.tokenprio=5,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var t=this.expression.charCodeAt(this.pos-1);return 45===t||43===t},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var t=this.expression.charCodeAt(this.pos);return(32===t||9===t||10===t||13===t)&&(this.pos++,!0)},isOp1:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops1&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isOp2:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&t in this.ops2&&(this.tokenindex=t,this.tokenprio=5,this.pos+=t.length,!0)},isVar:function(){for(var t="",e=this.pos;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()&&(e===this.pos||"_"!=i&&(i<"0"||i>"9")))break;t+=i}return t.length>0&&(this.tokenindex=t,this.tokenprio=4,this.pos+=t.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},E};return e.formatEquation=function(t){for(var e="",i=[],r="",n=!1,a=1;a<t.length;a++){var s=t[a].toUpperCase();"["!=s||n?"]"==s&&n?(n=!1,""!==r&&(i.push(r),e+="["+r+"]"),r=""):n?r+=s:"+"==s||"-"==s||"*"==s||"/"==s||":"==s||"%"==s||"("==s||")"==s?(""!==r&&isNaN(r)?(i.push(r),e+="["+r+"]"):e+=r,":"==s&&(s="/"),e+=s,r=""):" "!=s&&(r+=s):n=!0}return""!==r&&isNaN(r)?(i.push(r),e+="["+r+"]"):e+=r,{equation:e,symbols:i}},e.fetchEquationChart=function(t,i){var r=e.formatEquation(t.symbol),n=r.symbols,a=[],s=t.stx;t.stx=null;for(var o=0;o<n.length;o++){var l=e.shallowClone(t);l.stx=s,l.symbol=n[o],a.push(l)}t.stx=s,s.quoteDriver.quoteFeed.multiFetch(a,function(n){var s={};t.loadMoreReplace=!0;for(var o={charge:0},l=0;l<n.length;l++){var h=n[l];if(h.dataCallback.error)return void i({error:h.dataCallback.error});s[h.params.symbol]=h.dataCallback.quotes,t.loadMoreReplace=t.loadMoreReplace&&h.params.loadMoreReplace,t.moreToLoad=t.moreToLoad||h.dataCallback.moreAvailable,h.dataCallback.attribution.charge&&(o.charge+=h.dataCallback.attribution.charge)}if(a.length||!t.loadMore&&!t.update)try{var u=e.computeEquationChart(r.equation,s);i({quotes:u,moreAvailable:t.moreToLoad,attribution:o})}catch(t){var c={error:"Invalid equation: "+r.equation};t.name&&"NoException"==t.name&&(c.suppressAlert=!0),i(c)}})},e.computeEquationChart=function(t,r){function n(t){if(t.i++,r[t.s]){if(t.i>=r[t.s].length)return 0;l=r[t.s][t.i]}return l.DT||(l.DT=e.strToDateTime(l.Date)),t.d=l.DT,1}t=t.replace(/[:]/,"/").toUpperCase();var a=0;for(var s in r){var o=new RegExp("\\["+s.replace("$","\\$").replace("^","\\^").replace(/[+\-*\/%()]/g,"\\$&")+"\\]","g");t=t.replace(o,"symbol"+a),a++}var l,h=i().parse(t),u=[],c={},p=0,d=null,f=!1;for(s in r)c[s]={i:0,s:s},r[s]?(p++,l=r[s][0]):1==p&&(f=s),l.DT||(l.DT=e.strToDateTime(l.Date)),c[s].d=l.DT,d||(d=c[s]);var m=0===p,g=1==p&&-1==t.indexOf("%");t:for(;;){var v=function(){var t=null,e=null;for(var i in c)e?c[i].d.getTime()<e.d.getTime()?t=e=c[i]:c[i].d.getTime()>e.d.getTime()&&(t=e):e=c[i];return t?n(t)?-1:0:1}();if(!v)break;if(1==v){var y;if(f){var x=h.evaluate({symbol0:r[d.s][d.i].Close,symbol1:r[d.s][d.i][f]});x=Number(x.toFixed(8)),y={DT:d.d,Close:x,Adj_Close:x},y[d.s]=r[d.s][d.i].Close,isNaN(x)||x==1/0||u.push(y)}else{if(m){var C=h.evaluate({});throw e.alert(t+"="+C),{name:"NoException",message:""}}a=0;var S={Adj_Close:{},Close:{},Open:{},High:{},Low:{},Volume:{}};for(s in r){for(var w in S)S[w]["symbol"+a]=r[s][c[s].i][w];a++}y={DT:d.d},y.Adj_Close=h.evaluate(S.Adj_Close),y.Close=h.evaluate(S.Close),y.Open=h.evaluate(S.Open),y.Volume=h.evaluate(S.Volume),isNaN(y.Volume)&&(y.Volume=0),g?(y.High=h.evaluate(S.High),y.Low=h.evaluate(S.Low)):(y.High=Math.max(y.Open,y.Close),y.Low=Math.min(y.Open,y.Close)),isNaN(y.Close)||y.Close==1/0||u.push(y),isNaN(y.High)||(y.High=Number(y.High.toFixed(8))),isNaN(y.Low)||(y.Low=Number(y.Low.toFixed(8))),isNaN(y.Open)||(y.Open=Number(y.Open.toFixed(8))),isNaN(y.Close)||(y.Close=Number(y.Close.toFixed(8))),isNaN(y.Adj_Close)?y.Adj_Close=y.Close:y.Adj_Close=Number(y.Adj_Close.toFixed(8))}for(s in r)if(!n(c[s]))break t}}return u},t},__renderersAdvanced_=function(t){var e=t.CIQ;return e.Renderer.Shading=function(t){this.construct(t),this.shading=null,this.errTimeout=null},e.Renderer.Shading.ciqInheritsFrom(e.Renderer.Lines,!1),e.Renderer.Shading.prototype.setShading=function(t){t.constructor!=Array&&(t=[t]),this.shading=t},e.Renderer.Shading.prototype.draw=function(){if(!this.shading&&!this.errTimeout){console.log("Warning: no shading scheme set.  Use myRenderer.setShading(scheme) to set.");var t=this;this.errTimeout=setTimeout(function(){t.errTimeout=null},1e4)}var i,r=this.stx.panels[this.params.panel].chart,n={};for(i=0;i<this.seriesParams.length;i++)if(r.series[this.seriesParams[i].field]){var a=e.clone(r.series[this.seriesParams[i].field].parameters);n[this.seriesParams[i].field]={parameters:e.extend(e.extend(a,this.params),this.seriesParams[i]),yValueCache:this.caches[this.seriesParams[i].field],useChartLegend:!1}}this.stx.drawSeries(r,n,this.params.yAxis);for(i in n)this.caches[i]=n[i].yValueCache;for(i=0;i<this.shading.length;i++){var s=this.shading[i];if(s.greater||(s.greater=s.color),s.lesser||(s.lesser=s.color),s.primary||(s.primary="Close"),s.secondary||(s.secondary=this.seriesParams[0].field),s.secondary&&s.greater&&s.lesser&&(n[s.primary]||"Close"==s.primary)&&n[s.secondary]&&("Close"!=s.primary||this.params.yAxis==r.yAxis)){var o={topBand:s.primary,topColor:s.greater,topAxis:this.params.yAxis,bottomBand:s.secondary,bottomColor:s.lesser,bottomAxis:"Close"==s.primary?null:this.params.yAxis};e.fillIntersecting(this.stx,this.params.panel,r.dataSegment,o)}}},e.Renderer.Histogram=function(t){this.construct(t),this.params.type="histogram",this.params.highlightable=!1},e.Renderer.Histogram.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Histogram.prototype.performCalculations=function(){if(this.params.yAxis){for(var t=this.stx.panels[this.params.panel],e=[],i=0;i<this.seriesParams.length;i++)e.push(this.seriesParams[i].field);var r=this.stx.determineMinMax(this.stx.chart.dataSegment,e,"stacked"==this.params.subtype,!0);this.stx.calculateYAxisRange(t,this.params.yAxis,0,r[1]);var n=this.params.heightPercentage?this.params.heightPercentage:1;this.params.yAxis.high=r[1]/n,this.params.yAxis.min=0,this.params.bindToYAxis=!0}},e.Renderer.Histogram.prototype.draw=function(){
this.stx.drawHistogram(e.clone(this.params),this.seriesParams)},e.Renderer.Heatmap=function(t){this.construct(t),this.params.type="heatmap",this.params.highlightable=!1},e.Renderer.Heatmap.ciqInheritsFrom(e.Renderer,!1),e.Renderer.Heatmap.prototype.performCalculations=function(){for(var t=this.stx.panels[this.params.panel],e=this.params.yAxis?this.params.yAxis:t.yAxis,i=[],r=0;r<this.seriesParams.length;r++)i.push(this.seriesParams[r].field);var n=this.stx.determineMinMax(this.stx.chart.dataSegment,i,!1,!0);this.params.yAxis?this.stx.calculateYAxisRange(t,e,n[0],n[1]):this.params.panel==this.stx.chart.panel.name?(this.stx.chart.lowValue=Math.min(this.stx.chart.lowValue,n[0]),this.stx.chart.highValue=Math.max(this.stx.chart.highValue,n[1])):(this.stx.calculateYAxisRange(t,e,n[0],n[1]),t.lowValue=t.yAxis.low,t.highValue=t.yAxis.high)},e.Renderer.Heatmap.prototype.draw=function(){this.stx.drawHeatmap(e.clone(this.params),this.seriesParams)},t},__share_=function(t){function e(t,e,i){e||(e={});var r=document.querySelector("body");if(e.hide&&e.hide instanceof Array)for(var s=e.hide.join(", "),o=document.querySelectorAll(s),l=0;l<o.length;l++)a.appendClassName(o[l],"ciq-no-share");a.appendClassName(r,"sharing"),n(t.chart.container,{allowTaint:!1,logging:!1,width:e.width?e.width:null,height:e.height?e.height:null,background:e.background?e.background:null,useCORS:!0}).then(function(t){if(i)return a.unappendClassName(r,"sharing"),e.data?i(null,t.toDataURL("image/png")):i(null,t)})}function i(t){if("undefined"!=typeof html2canvas)return n=html2canvas,t();if("undefined"!=typeof requirejs)try{return requirejs(["html2canvas"],function(e){return n=e,t()})}catch(t){console.warn("Require loading has failed, attempting to load html2canvas manually.")}a.loadScript(r()+"/html2canvas.js",function(){return n=html2canvas,t()})}function r(){if(a.Share.html2canvasLocation)return a.Share.html2canvasLocation;for(var t=document.getElementsByTagName("script"),e=0;e<t.length;e++){var i=t[e];if(i.src&&i.src.indexOf("share.js")>-1)return i.src.replace(/advanced\/share\.js/,"")+"thirdparty/"}return"js/thirdparty/"}var n,a=t.CIQ;return a.Share=function(){},t.STXSocial=a.Share,a.Share.FullChart2PNG=function(t,r,a){if(t&&t.chart){if("undefined"==typeof html2canvas)return i(function(){return e(t,r,a)});n=html2canvas,e(t,r,a)}},a.Share.createImage=function(t,e,i){var r=[].slice.call(arguments);i=r.pop(),null!==e&&"object"==typeof e||(e={widthPX:r[1],heightPX:r[2],imageType:r[3]});var n=e.widthPX,s=e.heightPX,o=e.imageType,l=t.chart.canvas.height,h=t.chart.canvas.width;t.chart.canvas.style.height&&(l=a.stripPX(t.chart.canvas.style.height),h=a.stripPX(t.chart.canvas.style.width)),n&&s?(l=s,h=n):s?h=t.chart.canvas.width*(l/t.chart.canvas.height):n&&(h=n,l=t.chart.canvas.height*(n/t.chart.canvas.width));var u=o?"image/"+o:"image/png",c=document.createElement("img");c.onload=function(){a.Share.FullChart2PNG(t,{image:this,width:h,height:l,hide:e.hide},function(t,e){try{i(e.toDataURL(u))}catch(t){console.warn("Safari devices do not handle CORS enabled images. Using the charts' canvas as a fallback."),i(c.src)}})},c.src=t.chart.canvas.toDataURL(u)},a.Share.uploadImage=function(t,e,i,r){i||(i={}),i.image=t,a.postAjax(e,JSON.stringify(i),function(t,e){if(200!=t)return void r(t,null);r(null,e)})||r(0,null)},a.Share.shareChart=function(t,e,i){a.Share.createImage(t,{},function(r){var n=a.uniqueID(),s="https://share.chartiq.com",o=s+"/upload/"+n;e&&(e.host&&(s=e.host),e.path&&(o=s+e.path+"/"+n));var l=t.getStartDateOffset(),h={layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:l,startDate:t.chart.dataSegment[l].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:n,symbol:t.chart.symbol},u={id:n,image:r,config:h};a.Share.uploadImage(r,o,u,function(t,e){null!==t?a.alert("error sharing chart: ",t):i(s+e)})})},t},__studiesAdvanced_=function(t){var e=t.CIQ;return e.Studies.calculateValuationLines=function(t,e,i){for(var r="field"==e.inputs.Field?"Close":e.inputs.Field,n=e.inputs["Average Type"],a=e.inputs["Display Average"],s=e.inputs["Display 1 Standard Deviation (1σ)"],o=e.inputs["Display 2 Standard Deviation (2σ)"],l=e.inputs["Display 3 Standard Deviation (3σ)"],h=[],u=0;u<i.length;++u)i[u]&&h.push(i[u][r]);var c=function(t,e){var i=t.length,r=0,n=0,a=0;switch(e){case"mean":for(n=i;a<i;++a)r+=t[a];break;case"harmonic":for(r=i;a<i;++a)n+=1/t[a];break;case"median":var s=Math.floor(i/2),o=t.slice().sort(function(t,e){return t>e?1:t<e?-1:0});i%1==0?(r=o[s]+o[s-1],n=2):(r=o[s],n=1)}return r/n}(h,n),p=!(s||o||l)||function(t,e){for(var i=t.length,r=0,n=0;n<i;++n)r+=Math.pow(t[n]-e,2);return Math.sqrt(r/i)}(h,c);e.data={Average:a?[c]:null,"1 Standard Deviation (1σ)":s?[c+p,c-p]:null,"2 Standard Deviation (2σ)":o?[c+2*p,c-2*p]:null,"3 Standard Deviation (3σ)":l?[c+3*p,c-3*p]:null}},e.Studies.displayValuationLines=function(t,i){var r,n,a,s,o,l,h,u,c,p=t.panels[i.panel],d=i.chart.context,f=i.data,m=i.parameters.labels,g=i.inputs["Average Type"],v={mean:"AVG",median:"MED",harmonic:"HAVG"},y=t.canvasStyle("ciq-valuation-average-line"),x=t.canvasStyle("ciq-valuation-deviation-line"),C=t.getCanvasFontSize("stx_yaxis")+6;for(var S in f)if(f[S])for(r="Average"==S,n=e.Studies.determineColor(i.outputs[S]),a=f[S],s=0;s<a.length;++s)o=a[s],(l=t.pixelFromTransformedValue(o,p))<=p.top||l>=p.yAxis.bottom||(c=r?{pattern:"none"!=y.borderStyle?y.borderStyle||"solid":"solid",lineWidth:parseFloat(y.borderWidth)||1,opacity:parseFloat(y.opacity)||1}:{pattern:"none"!=x.borderStyle?x.borderStyle||"dashed":"dashed",lineWidth:parseFloat(x.borderWidth)||1,opacity:parseFloat(x.opacity)||1},t.plotLine(p.left,p.right,l,l,n,"line",d,p,c),"yaxis"!==m?(l+=Math.floor(c.lineWidth/2))+C>=p.yAxis.bottom||(h=(r?v[g]+": ":S[0]+"σ: ")+t.formatYAxisPrice(o,p),u=d.measureText(h).width,d.strokeText(h,p.right-u-3,l+C/2+.5)):t.createYAxisLabel(p,t.formatYAxisPrice(o,p),l,n,null,d))},e.Studies.calculateCorrelationCoefficient=function(t,e){var i=e.chart.scrubbed,r=e.days;if(i.length<r+1)return void(e.error=!0);if(e.compare=e.inputs["Compare To"],!e.compare){e.compare=[],e.outputs={},e.outputMap={};for(var n in t.chart.series){var a=t.chart.series[n];a.parameters.color&&(e.compare.push(a.display),e.outputs["Result "+a.display]=a.parameters.color,e.outputMap["Result "+a.display+" "+e.name]="Result "+a.display)}}if(!e.compare.length)return void(e.error="Correlation Coefficient requires at least one comparison symbol");for(var s=0;s<e.compare.length;s++)for(var o=0,l=0,h=0,u=0,c=0,p=e.compare[s],d=0,f=e.startFrom-r;f<i.length;f++)if(i[f]){var m=i[f][p];if(m||(m=f>0&&i[f-1]&&i[f-1]["_temps "+e.name].c?i[f-1]["_temps "+e.name].c:0),i[f]["_temps "+e.name]={},o+=i[f]["_temps "+e.name].b=i[f].Close,l+=i[f]["_temps "+e.name].c=m,h+=i[f]["_temps "+e.name].b2=Math.pow(i[f].Close,2),u+=i[f]["_temps "+e.name].c2=Math.pow(m,2),c+=i[f]["_temps "+e.name].bc=i[f].Close*m,d>=r){o-=i[f-r]["_temps "+e.name].b,l-=i[f-r]["_temps "+e.name].c,h-=i[f-r]["_temps "+e.name].b2,u-=i[f-r]["_temps "+e.name].c2,c-=i[f-r]["_temps "+e.name].bc;var g=h/r-Math.pow(o/r,2),v=u/r-Math.pow(l/r,2),y=c/r-o*l/Math.pow(r,2),x=y/Math.sqrt(g*v);i[f]["Result "+p+" "+e.name]=x}d++}},e.Studies.prettify=e.extend({"2-exponential":"dema","3-exponential":"tema",hull:"hma"},e.Studies.prettify),e.extend(e.Studies.movingAverage,{conversions:{hma:"hull",dema:"2-exponential",tema:"3-exponential"},translations:{hull:"Hull","2-exponential":"Double Exponential","3-exponential":"Triple Exponential"},typeMap:{hma:"Hull",hull:"Hull",dema:"DoubleExponential","2-exponential":"DoubleExponential",tema:"TripleExponential","3-exponential":"TripleExponential"}}),e.Studies.calculateMovingAverageHull=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA("wma",i.days,n,0,"_WMA1",t,i),e.Studies.MA("wma",Math.ceil(i.days/2),n,0,"_WMA2",t,i);var a,s;for(a=i.startFrom-1;a>=0&&(!(s=r[a][n])&&0!==s);a--);for(a++;a<r.length;a++){var o=r[a];o["_MMA "+i.name]=2*o["_WMA2 "+i.name]-o["_WMA1 "+i.name]}var l=parseInt(i.inputs.Offset,10);isNaN(l)&&(l=0),e.Studies.MA("wma",Math.sqrt(i.days),"_MMA "+i.name,l,"_HMA",t,i);var h=i.name;for(var u in i.outputs)h=u+" "+h;for(a=i.startFrom;a<r.length;a++)r[a][h]=r[a]["_HMA "+i.name]},e.Studies.calculateMovingAverageDoubleExponential=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA("ema",i.days,n,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i);var a=parseInt(i.inputs.Offset,10);isNaN(a)&&(a=0);var s,o,l=a;for(s=i.startFrom-1;s>=0;s--)if((o=r[s][n])||0===o){if(!(l>0))break;l--}var h=i.name;for(var u in i.outputs)h=u+" "+h;for(s++;s<r.length;s++){var c=r[s];r[s+a]&&(r[s+a][h]=2*c["_EMA1 "+i.name]-c["_EMA2 "+i.name])}},e.Studies.calculateMovingAverageTripleExponential=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA("ema",i.days,n,0,"_EMA1",t,i),e.Studies.MA("ema",i.days,"_EMA1 "+i.name,0,"_EMA2",t,i),e.Studies.MA("ema",i.days,"_EMA2 "+i.name,0,"_EMA3",t,i);var a=parseInt(i.inputs.Offset,10);isNaN(a)&&(a=0);var s,o,l=a;for(s=i.startFrom-1;s>=0;s--)if((o=r[s][n])||0===o){if(!(l>0))break;l--}var h=i.name;for(var u in i.outputs)h=u+" "+h;for(s++;s<r.length;s++){var c=r[s];r[s+a]&&(r[s+a][h]=3*c["_EMA1 "+i.name]-3*c["_EMA2 "+i.name]+c["_EMA3 "+i.name])}},e.Studies.calculateATRBands=function(t,i){e.Studies.calculateStudyATR(t,i);var r=i.inputs.Field;r&&"field"!=r||(r="Close"),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Shift,r,"ATR "+i.name)},e.Studies.calculateSTARCBands=function(t,i){e.Studies.calculateStudyATR(t,i),e.Studies.MA("simple",i.inputs["MA Period"],"Close",0,"_MA",t,i),e.Studies.calculateGenericEnvelope(t,i,i.inputs.Multiplier,"_MA "+i.name,"ATR "+i.name)},e.Studies.calculateATRStops=function(t,i){var r=i.chart.scrubbed;if(r){e.Studies.calculateStudyATR(t,i);for(var n=i.inputs.HighLow,a=Math.max(i.startFrom-1,1);a<r.length-1;a++){var s=r[a],o=r[a-1],l=s["Buy Stops "+i.name];if(l||(l=s["Sell Stops "+i.name]),l||(l=0),s&&o){var h=s.Close,u=h,c=s["ATR "+i.name]*i.inputs.Multiplier;s.Close>l&&o.Close>l?(n&&(h=s.High),u=Math.max(l,h-c)):s.Close<=l&&o.Close<=l?(n&&(h=s.Low),u=Math.min(l,h+c)):s.Close>l?(n&&(h=s.High),u=h-c):s.Close<=l&&(n&&(h=s.Low),u=h+c),h<=u?(r[a+1]["Buy Stops "+i.name]=u,delete r[a+1]["Sell Stops "+i.name]):h>u&&(r[a+1]["Sell Stops "+i.name]=u,delete r[a+1]["Buy Stops "+i.name]),r[a+1]["All Stops "+i.name]=u,i.referenceOutput="All Stops"}}}},e.Studies.calculateAwesomeOscillator=function(t,i){var r=i.chart.scrubbed;if(r.length<33)return void(i.error=!0);e.Studies.MA("simple",5,"hl/2",0,"_MA5",t,i),e.Studies.MA("simple",34,"hl/2",0,"_MA34",t,i);for(var n=Math.max(i.startFrom,33);n<r.length;n++)r[n]&&(r[n][i.name+"_hist"]=r[n]["_MA5 "+i.name]-r[n]["_MA34 "+i.name])},e.Studies.calculateRelativeVolatility=function(t,i){i.days=Number(i.inputs["Smoothing Period"]);var r=Number(i.inputs["STD Period"]),n=i.chart.scrubbed;if(n.length<i.days+r)return void(i.error=!0);var a=i.inputs.Field;a&&"field"!=a||(a="Close"),i.std=new e.Studies.StudyDescriptor(i.name,"sdev",i.panel),i.std.chart=i.chart,i.std.days=r,i.std.startFrom=i.startFrom,i.std.inputs={Field:a,"Standard Deviations":1,Type:"ma"},i.std.outputs={STD:null},e.Studies.calculateStandardDeviation(t,i.std);var s=0,o=0;i.startFrom>1&&(s=n[i.startFrom-1]["_avgG "+i.name],o=n[i.startFrom-1]["_avgL "+i.name]);for(var l=Math.max(i.startFrom,i.days);l<n.length;l++){var h=n[l];h[a]>n[l-1][a]?(s=(s*(i.days-1)+h["STD "+i.name])/i.days,o=o*(i.days-1)/i.days):(o=(o*(i.days-1)+h["STD "+i.name])/i.days,s=s*(i.days-1)/i.days),h["Rel Vol "+i.name]=function(t,e){return t+e===0?100:100*t/(t+e)}(s,o),h["_avgG "+i.name]=s,h["_avgL "+i.name]=o}i.zoneOutput="Rel Vol"},e.Studies.calculatePMO=function(t,i){var r={Smooth:Number(i.inputs["Smoothing Period"])-1,Double:Number(i.inputs["Double Smoothing Period"])-1,Signal:Number(i.inputs["Signal Period"])},n=i.chart.scrubbed;if(n.length<r.Smooth+r.Double)return void(i.error=!0);var a=i.inputs.Field;a&&"field"!=a||(a="Close");var s;for(s=i.startFrom;s<n.length;s++)if(n[s]&&n[s-1]){var o=n[s-1][a];o&&(n[s]["_ROCx10 "+i.name]=1e3*(n[s][a]/o-1))}e.Studies.MA("exponential",r.Smooth,"_ROCx10 "+i.name,0,"_EMAx10",t,i),e.Studies.MA("exponential",r.Double,"_EMAx10 "+i.name,0,"PMO",t,i),e.Studies.MA("exponential",r.Signal,"PMO "+i.name,0,"PMOSignal",t,i),i.zoneOutput="PMO"},e.Studies.calculateElderImpulse=function(t,i){var r=i.chart.scrubbed,n=i.outputs.Bullish,a=i.outputs.Bearish,s=i.outputs.Neutral;e.Studies.MA("exponential",13,"Close",0,"_MA",t,i),i.macd=new e.Studies.StudyDescriptor("_"+i.name,"macd",i.panel),i.macd.chart=i.chart,i.macd.days=i.days,i.macd.startFrom=i.startFrom,i.macd.inputs={"Fast MA Period":12,"Slow MA Period":26,"Signal Period":9},i.macd.outputs={_MACD:null,_Signal:null},e.Studies.calculateMACD(t,i.macd);for(var o,l=i.startFrom;l<r.length;l++)o=0===l?s:r[l]["_MA "+i.name]>r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]>r[l-1]["_"+i.name+"_hist"]?n:r[l]["_MA "+i.name]<r[l-1]["_MA "+i.name]&&r[l]["_"+i.name+"_hist"]<r[l-1]["_"+i.name+"_hist"]?a:s,r[l]["Result "+i.name]=o},e.Studies.calculatePivotPoints=function(t,i){function r(){u.pivotPoint=(u.high+u.low+n[c-1].Close)/3,u.prevHigh=u.high,u.prevLow=u.low,u.hlSpread=u.high-u.low,u.high=u.low=0}var n=i.chart.scrubbed,a="day";if("day"==t.layout.interval)a="month";else if(e.ChartEngine.isDailyInterval(t.layout.interval))a="year";else if("second"==t.layout.interval||"millisecond"==t.layout.interval||"second"==t.layout.timeUnit||"millisecond"==t.layout.timeUnit)a="15min";else{var s=t.layout.periodicity;"minute"!=t.layout.interval&&(s*=t.layout.interval),s>=30&&(a="week")}var o=e.Market.Symbology.isForexSymbol(t.chart.symbol),l=e.Market.Symbology.isForexMetal(t.chart.symbol),h=null,u={pivotPoint:NaN,high:0,low:0,prevHigh:0,prevLow:0,hlSpread:0};i.startFrom>1&&(u=e.clone(n[i.startFrom-1]["_pointers "+i.name]));for(var c=Math.max(1,i.startFrom);c<n.length;c++)if(n[c-1]){if(u.high=Math.max(u.high,n[c-1].High),u.low=Math.min(u.low>0?u.low:n[c-1].Low,n[c-1].Low),i.inputs.Continuous)r();else if("year"==a&&n[c].DT.getYear()!=n[c-1].DT.getYear())r();else if("month"==a&&n[c].DT.getMonth()!=n[c-1].DT.getMonth())r();else if("week"==a&&n[c].DT.getDay()<n[c-1].DT.getDay())r();else if("day"==a){null===h&&(h=function(i){var r="America/New_York";if(!o)if(t.chart.market)r=t.chart.market.market_tz;else{var n=e.Market.Symbology.isForeignSymbol(t.chart.symbol)&&t.chart.symbol.split(".").pop();r=e&&e.realTimeDataSource?(new e.QuoteFeed[e.realTimeDataSource]).exchangeZones[n]:e.QuoteFeed.Xignite.Utility.timeZone[n]}var a=new Date(i.getTime()+6e4*i.getTimezoneOffset());return r&&-1!=r.indexOf("UTC")||(a=e.convertTimeZone(a,"UTC",r)),new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()).getTime()-i.getTime()}(n[c].DT),o&&(h+=l?216e5:252e5));var p=new Date(new Date(+n[c].DT).setMilliseconds(n[c].DT.getMilliseconds()+h)),d=new Date(new Date(+n[c-1].DT).setMilliseconds(n[c-1].DT.getMilliseconds()+h));d.getDate()!=p.getDate()&&0!==p.getDay()&&6!=p.getDay()&&(h=null,r())}else"15min"!=a||n[c].DT.getHours()==n[c-1].DT.getHours()&&Math.floor(n[c].DT.getMinutes()/15)==Math.floor(n[c-1].DT.getMinutes()/15)||r();n[c]["Pivot "+i.name]=u.pivotPoint,"fibonacci"==i.inputs.Type.toLowerCase()?(n[c]["Resistance 1 "+i.name]=u.pivotPoint+.382*u.hlSpread,n[c]["Resistance 2 "+i.name]=u.pivotPoint+.618*u.hlSpread,n[c]["Resistance 3 "+i.name]=u.pivotPoint+u.hlSpread,n[c]["Support 1 "+i.name]=u.pivotPoint-.382*u.hlSpread,n[c]["Support 2 "+i.name]=u.pivotPoint-.618*u.hlSpread,n[c]["Support 3 "+i.name]=u.pivotPoint-u.hlSpread):(n[c]["Resistance 1 "+i.name]=2*u.pivotPoint-u.prevLow,n[c]["Resistance 2 "+i.name]=u.pivotPoint+u.hlSpread,n[c]["Resistance 3 "+i.name]=u.pivotPoint+2*u.hlSpread,n[c]["Support 1 "+i.name]=2*u.pivotPoint-u.prevHigh,n[c]["Support 2 "+i.name]=u.pivotPoint-u.hlSpread,n[c]["Support 3 "+i.name]=u.pivotPoint-2*u.hlSpread),n[c]["_pointers "+i.name]=e.clone(u)}},e.Studies.calculateVWAP=function(t,i){var r=i.chart.scrubbed;if(e.ChartEngine.isDailyInterval(t.layout.interval))return void(i.error="VWAP is Intraday Only");var n=e.Market.Symbology.isForexSymbol(t.chart.symbol),a=e.Market.Symbology.isForexMetal(t.chart.symbol),s=null,o=0,l=0,h=!1;i.startFrom>1&&(o=r[i.startFrom-1]["_V "+i.name],l=r[i.startFrom-1]["_VxP "+i.name]);for(var u=i.startFrom;u<r.length;u++){if(null===s&&(s=function(i){var r="America/New_York";if(!n)if(t.chart.market)r=t.chart.market.market_tz;else{var a=e.Market.Symbology.isForeignSymbol(t.chart.symbol)&&t.chart.symbol.split(".").pop();r=e&&e.realTimeDataSource?(new e.QuoteFeed[e.realTimeDataSource]).exchangeZones[a]:e.QuoteFeed.Xignite.Utility.timeZone[a]}var s=new Date(i.getTime()+6e4*i.getTimezoneOffset());return r&&-1!=r.indexOf("UTC")||(s=e.convertTimeZone(s,"UTC",r)),new Date(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()).getTime()-i.getTime()}(r[u].DT),n&&(s+=a?216e5:252e5)),r[u-1]&&r[u-1].DT){var c=new Date(new Date(+r[u].DT).setMilliseconds(r[u].DT.getMilliseconds()+s));new Date(new Date(+r[u-1].DT).setMilliseconds(r[u-1].DT.getMilliseconds()+s)).getDate()!=c.getDate()&&0!==c.getDay()&&6!=c.getDay()&&(s=null,o=l=0)}var p=r[u]["hlc/3"];o+=r[u].Volume,l+=r[u].Volume*p,o&&(r[u]["VWAP "+i.name]=l/o,r[u]["_V "+i.name]=o,r[u]["_VxP "+i.name]=l,h=!0)}h||(i.error="VWAP Requires Volume")},e.Studies.calculateMFI=function(t,e){var i,r=e.chart.scrubbed,n=0,a=e.inputs["Scale Factor"];a||(a=e.study.inputs["Scale Factor"]);var s=Math.pow(10,Number(a));e.startFrom>1&&(n=r[e.startFrom-1]["_high "+e.name]);var o;for(o=e.startFrom;o<r.length;o++)r[o]&&r[o].Volume&&(r[o][e.name+"_hist"]=i=s*(r[o].High-r[o].Low)/r[o].Volume,r[o]["_high "+e.name]=n=Math.max(n,i))},e.Studies.calculateAlligator=function(t,i){var r={J:Number(i.inputs["Jaw Period"]),T:Number(i.inputs["Teeth Period"]),L:Number(i.inputs["Lips Period"])},n=i.chart.scrubbed;if(n.length<Math.max(r.J,r.T,r.L)+1)return void(i.error=!0);e.Studies.MA("welles wilder",r.J,"hl/2",i.inputs["Jaw Offset"],"Jaw",t,i),e.Studies.MA("welles wilder",r.T,"hl/2",i.inputs["Teeth Offset"],"Teeth",t,i),e.Studies.MA("welles wilder",r.L,"hl/2",i.inputs["Lips Offset"],"Lips",t,i);for(var a=i.startFrom;a<n.length;a++)if(n[a]&&("Gator"==i.type&&(n[a][i.name+"_hist1"]=Math.abs(n[a]["Jaw "+i.name]-n[a]["Teeth "+i.name]),n[a][i.name+"_hist2"]=-Math.abs(n[a]["Teeth "+i.name]-n[a]["Lips "+i.name])),i.inputs["Show Fractals"])){if(!(n[a-2]&&n[a-1]&&n[a]&&n[a+1]&&n[a+2]))continue;n[a-2].High&&n[a-1].High&&n[a].High&&n[a+1].High&&n[a+2].High&&n[a].High>n[a-1].High&&n[a].High>n[a-2].High&&n[a].High>n[a+1].High&&n[a].High>n[a+2].High&&(n[a]["Fractal High "+i.name]=1),n[a-2].Low&&n[a-1].Low&&n[a].Low&&n[a+1].Low&&n[a+2].Low&&n[a].Low<n[a-1].Low&&n[a].Low<n[a-2].Low&&n[a].Low<n[a+1].Low&&n[a].Low<n[a+2].Low&&(n[a]["Fractal Low "+i.name]=1)}},e.Studies.calculateRelativeVigor=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n;for(n=i.startFrom;n<r.length;n++)r[n]["_Change "+i.name]=r[n].Close-r[n].Open,r[n]["_Range "+i.name]=r[n].High-r[n].Low;e.Studies.MA("triangular",4,"_Change "+i.name,0,"_Numer",t,i),e.Studies.MA("triangular",4,"_Range "+i.name,0,"_Denom",t,i);var a=[],s=[];for(n=Math.max(i.startFrom-i.days,0);n<r.length;n++){a.push(r[n]["_Numer "+i.name]),s.push(r[n]["_Denom "+i.name]),a.length>i.days&&(a.shift(),s.shift());var o,l=0,h=0;for(o=0;o<a.length;o++)l+=a[o];for(o=0;o<s.length;o++)h+=s[o];0===h&&(h=1e-8),n<i.startFrom||(r[n]["Rel Vig "+i.name]=l/h)}for(e.Studies.MA("triangular",4,"Rel Vig "+i.name,0,"RelVigSignal",t,i),n=i.startFrom;n<r.length;n++)r[n][i.name+"_hist"]=r[n]["Rel Vig "+i.name]-r[n]["RelVigSignal "+i.name]},e.Studies.calculateUlcerIndex=function(t,i){var r=i.chart.scrubbed;if(r.length<2*i.days-1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close");var a;for(a=Math.max(i.startFrom,i.days-1);a<r.length;a++)r[a]["_PD2 "+i.name]=Math.pow(100*(r[a][n]/function(t,e,i){for(var n=null,a=e-t+1;a<=e;a++)a<0||(n=null===n?r[a][i]:Math.max(n,r[a][i]));return n}(i.days,a,n)-1),2);for(e.Studies.MA("simple",i.days,"_PD2 "+i.name,0,"_MA",t,i),a=Math.max(i.startFrom,2*(i.days-1));a<r.length;a++)r[a]["Result "+i.name]=Math.sqrt(r[a]["_MA "+i.name])},e.Studies.calculateChoppiness=function(t,i){e.Studies.calculateStudyATR(t,i);var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);for(var n=Math.max(i.startFrom,i.days);n<r.length;n++)if(r[n]){var a=function(t,e){for(var i=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,a=e-t+1;a<=e;a++)a<0||(i=Math.max(i,r[a].High),n=Math.min(n,r[a].Low));return[n,i]}(i.days,n);r[n]["Sum True Range "+i.name]?r[n]["Result "+i.name]=100*Math.log(r[n]["Sum True Range "+i.name]/Math.max(1e-6,a[1]-a[0]))/Math.log(i.days):r[n]["Result "+i.name]=0}},e.Studies.calculateDisparity=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA(i.inputs["Moving Average Type"],i.days,n,0,"_MA",t,i);for(var a=Math.max(i.startFrom,i.days-1);a<r.length;a++)r[a]&&(r[a]["Result "+i.name]=100*(r[a][n]/r[a]["_MA "+i.name]-1))},e.Studies.calculateRainbow=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close");for(var a=n,s=1;s<=10;s++)e.Studies.MA("simple",i.days,a,0,"SMA"+s,t,i),a="SMA"+s+" "+i.name;for(var o=Math.max(i.startFrom,10);o<r.length;o++)if(r[o]){var l=0,h=-1*Number.MAX_VALUE,u=Number.MAX_VALUE;for(s=1;s<=10;s++){var c=r[o]["SMA"+s+" "+i.name];l+=c,h=Math.max(h,c),u=Math.min(u,c)}if(i.name.indexOf("Osc")>-1){var p=function(t,e){for(var i=-1*Number.MAX_VALUE,n=Number.MAX_VALUE,a=e-t+1;a<=e;a++)a<0||(i=Math.max(i,r[a].Close),n=Math.min(n,r[a].Close));return[n,i]}(i.inputs["HHV/LLV Lookback"],o);r[o][i.name+"_hist"]=100*(r[o][n]-l/10)/Math.max(1e-6,p[1]-p[0]),r[o]["Over "+i.name]=100*(h-u)/Math.max(1e-6,p[1]-p[0]),r[o]["Under "+i.name]=-r[o]["Over "+i.name],r[o]["Zero "+i.name]=0}}},e.Studies.calculateKST=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close");var a={},s={};a[1]=Number(i.inputs["Lightest Rate of Change Period"]),a[2]=Number(i.inputs["Light Rate of Change Period"]),a[3]=Number(i.inputs["Heavy Rate of Change Period"]),a[4]=Number(i.inputs["Heaviest Rate of Change Period"]),s[1]=Number(i.inputs["Lightest SMA Period"]),s[2]=Number(i.inputs["Light SMA Period"]),s[3]=Number(i.inputs["Heavy SMA Period"]),s[4]=Number(i.inputs["Heaviest SMA Period"]);var o,l,h=Number(i.inputs["Signal Period"]);for(o=i.startFrom;o<r.length;o++)if(r[o])for(l=1;l<=4;l++)o>=a[l]&&r[o-a[l]]&&r[o-a[l]][n]&&(r[o]["_ROC"+l+" "+i.name]=100*(r[o][n]/r[o-a[l]][n]-1));for(l=1;l<=4;l++)e.Studies.MA("simple",s[l],"_ROC"+l+" "+i.name,0,"_SMA"+l,t,i);for(o=i.startFrom;o<r.length;o++)for(r[o]["KST "+i.name]=0,l=1;l<=4;l++)r[o]["KST "+i.name]+=l*r[o]["_SMA"+l+" "+i.name];e.Studies.MA("simple",h,"KST "+i.name,0,"KSTSignal",t,i)},e.Studies.calculateSpecialK=function(t,i){var r=i.chart.scrubbed,n=i.inputs.Field;n&&"field"!=n||(n="Close");var a=i.inputs.Interval;a||(a="daily");var s,o,l={daily:[10,15,20,30,50,65,75,100,195,265,390,530],weekly:[4,5,6,8,10,13,15,20,39,52,78,104]},h={daily:[10,10,10,15,50,65,75,100,130,130,130,195],weekly:[4,5,6,8,10,13,15,20,26,26,26,39]};for(s=i.startFrom;s<r.length;s++)if(r[s])for(o=0;o<l[a].length;o++)s>=l[a][o]&&r[s-l[a][o]]&&r[s-l[a][o]][n]&&(r[s]["_ROC"+o+" "+i.name]=100*(r[s][n]/r[s-l[a][o]][n]-1));for(o=0;o<h[a].length;o++)e.Studies.MA("daily"==a?"simple":"exponential",h[a][o],"_ROC"+o+" "+i.name,0,"_MA"+o,t,i);for(s=i.startFrom;s<r.length;s++)for(r[s]["Result "+i.name]=0,o=0;o<h[a].length;o++)r[s]["Result "+i.name]+=(o%4+1)*r[s]["_MA"+o+" "+i.name]},e.Studies.calculateDarvas=function(t,i){var r=i.chart.scrubbed,n=0,a=parseInt(i.inputs["ATH Lookback Period"],10);i.inputs["Volume Spike"]&&e.Studies.MA("simple",a,"Volume",0,"ADV",t,i);var s,o=parseFloat(i.inputs["Volume % of Avg"])/100,l="none",h={},u=null,c=null,p=null,d=parseFloat(i.inputs["Level Offset"]),f={};for(["Darvas","Ghost","Profit","Loss","ATH","ADV","Spike"].forEach(function(t){f[t]=t+" "+i.name}),s=i.startFrom-1;s>0;s--){var m=r[s];if(!m[f.Darvas]&&!m[f.Ghost]){n=m[f.ATH]||0,c=m[f.Profit],p=m[f.Loss];break}for(var g in f)m[g]=null}for(s;s<r.length;s++){var v=r[s];if(v){if(parseFloat(i.inputs["Price Minimum"])<=r[n].Close){if(!u||u.End&&s!=u.End+1||(r[s-1].Close>h.High?h={State:1,High:2*h.High-h.Low,Low:h.High,Start:s,End:2*h.End-h.Start+1}:u=null,u&&(v[f.Ghost]=e.clone(h),h.State=0,r[h.End]&&(r[h.End][f.Ghost]=e.clone(h)),u={Start:h.Start,End:h.End},c=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),v[f.Profit]=c,v[f.Loss]=p,v.Close>=c?c=null:"high/low"==i.inputs["Exit Field"]&&v.High>=c&&(c=null),"none"==l&&s==n+3&&!r[n+2][f.Darvas]&&!r[n+1][f.Darvas]&&!r[n][f.Darvas]&&r[n].High>v.High&&(l="high"),"high"==l&&(v.High>r[n].High?l="none":r[s-3].Low<r[s-2].Low&&r[s-3].Low<r[s-1].Low&&r[s-3].Low<v.Low&&(h={State:1,High:r[n].High,Low:r[s-3].Low,Start:n},r[n][f.Darvas]=e.clone(h),l="darvas",u&&(u.End>s&&r[u.Start]&&(v[f.Ghost]=e.clone(r[u.Start][f.Ghost]),v[f.Ghost].End=s,r[u.End]&&delete r[u.End][f.Ghost]),v[f.Ghost].State=0,r[u.Start][f.Ghost].End=s,u=null),c=h.High+d,(!p||p<h.Low-d)&&(p=h.Low-d))),"darvas"==l&&(v.Close>h.High?u={}:"high/low"==i.inputs["Exit Field"]&&v.High>h.High?u={}:v.Close<h.Low?l="none":"high/low"==i.inputs["Exit Field"]&&v.Low<h.Low&&(l="none"),u?l="none":"none"==l&&(c=null,p=null),i.inputs["Ghost Boxes"]||(u=null),"none"==l)){for(var y=h.Start+1;y<s;y++)r[y][f.Darvas]=e.clone(h);h.State=0,h.End=s,v[f.Darvas]=e.clone(h),v[f.ATH]=n;continue}p&&(v.Close<h.Low||"high/low"==i.inputs["Exit Field"]&&v.Low<h.Low)&&("darvas"==l&&(l="none"),(v.Close<p||"high/low"==i.inputs["Exit Field"]&&v.Low<p)&&(c=null,p=null),u&&(u.End>s&&r[u.Start]&&(v[f.Ghost]=e.clone(r[u.Start][f.Ghost]),v[f.Ghost].End=s,r[u.End]&&delete r[u.End][f.Ghost]),v[f.Ghost].State=0,r[u.Start][f.Ghost].End=s,u=null))}if(v.High>=r[n].High&&(n=s),(s<3||v.High>=r[s-1].High&&v.High>=r[s-2].High&&v.High>=r[s-3].High)&&s-n>=a){n=s;for(var x=0;x<a&&!(s-x<0);x++)r[s-x].High>r[n].High&&(n=s-x)}i.inputs["Volume Spike"]&&s>a&&s==n&&v[f.ADV]*o<v.Volume&&(v[f.Spike]=1),v[f.ATH]=n}}},e.Studies.calculateSupertrend=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);e.Studies.calculateStudyATR(t,i);for(var n=i.startFrom;n<r.length;n++){var a=r[n];if(a){var s=(a.High+a.Low)/2,o=i.inputs.Multiplier*a["ATR "+i.name],l=s-o,h=s+o;n&&(r[n-1]&&r[n-1].Close&&r[n-1].Close>r[n-1]["_Uptrend "+i.name]&&r[n-1]["_Uptrend "+i.name]>l&&(l=r[n-1]["_Uptrend "+i.name]),r[n-1]&&r[n-1].Close&&r[n-1].Close<r[n-1]["_Downtrend "+i.name]&&r[n-1]["_Downtrend "+i.name]<h&&(h=r[n-1]["_Downtrend "+i.name])),a["_Direction "+i.name]=1,n&&(a["_Direction "+i.name]=r[n-1]["_Direction "+i.name],a.Close>r[n-1]["_Downtrend "+i.name]?a["_Direction "+i.name]=1:a.Close<r[n-1]["_Uptrend "+i.name]&&(a["_Direction "+i.name]=-1)),a["_Uptrend "+i.name]=l,a["_Downtrend "+i.name]=h,a["Trend "+i.name]=a["_Direction "+i.name]>0?l:h}}i.outputMap={},i.outputMap["Trend "+i.name]="Trend"},e.Studies.fetchAdditionalInstruments=function(t,i,r,n){function a(){t.createDataSet(),t.draw()}if(!t.quoteDriver)return void console.log("CIQ.Studies.fetchAdditionalInstruments: No quotefeed to fetch symbol");var s=t.panels[i.panel].chart;i.symbols=r;var o,l,h;for(o=0;o<r.length;o++){l=h=r[o],"object"==typeof h?l=h.symbol:h={symbol:l};var u={symbol:l,symbolObject:h,bucket:"study",studyName:i.name,chartName:s.name,action:"add-study"};t.currentlyImporting&&(u.loadData=!1),e.extend(u,n),i.series=t.addSeries(null,u,a)}},e.Studies.initPriceRelative=function(t,i,r,n,a,s){var o=e.Studies.initializeFN(t,i,r,n,a,s),l=[o.inputs["Comparison Symbol"].toUpperCase()];return e.Studies.fetchAdditionalInstruments(t,o,l),o},e.Studies.calculatePriceRelative=function(t,i){var r=i.chart.scrubbed,n=i.inputs["Comparison Symbol"].toUpperCase();n||(n=i.study.inputs["Comparison Symbol"]);var a={},s=t.chart.symbol.replace(/=/,"");if(s=s.replace(/[+\-*\\%]/g,""),a[s]=r.slice(i.startFrom),a[s].length){s!=n&&(a[n]=null);for(var o=e.computeEquationChart("["+s+"]/["+n+"]",a),l=0,h=i.startFrom;h<r.length&&l<o.length;h++){for(;l<o.length&&r[h].DT.getTime()>o[l].DT.getTime();)l++;r[h].DT.getTime()<o[l].DT.getTime()||(r[h]["Result "+i.name]=o[l].Close,l++)}}},e.Studies.calculatePerformance=function(t,i){var r=i.chart.scrubbed,n=i.inputs["Comparison Symbol"].toUpperCase();if(n||(n=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),r.length<i.days+1)return void(i.error=!0);e.Studies.MA("ma",i.days,"Close",0,"_MA Base",t,i),e.Studies.MA("ma",i.days,n,0,"_MA Comp",t,i);for(var a=i.startFrom;a<r.length;a++)r[a]["Result "+i.name]=r[a].Close/r[a][n]*(r[a]["_MA Comp "+i.name]/r[a]["_MA Base "+i.name])},e.Studies.calculateBeta=function(t,i){var r=i.chart.scrubbed,n=i.inputs["Comparison Symbol"].toUpperCase();if(n||(n=i.study.inputs["Comparison Symbol"]),i.days||(i.days=i.study.inputs.Period),r.length<i.days+1)return void(i.error=!0);for(var a=Math.max(i.startFrom,1);a<r.length;a++)r[a]["_BaseChange "+i.name]=r[a].Close/r[a-1].Close-1,r[a]["_CompChange "+i.name]=r[a][n]/r[a-1][n]-1;for(e.Studies.MA("ma",i.days,"_BaseChange "+i.name,0,"_MA Base",t,i),e.Studies.MA("ma",i.days,"_CompChange "+i.name,0,"_MA Comp",t,i),a=Math.max(i.startFrom,i.days);a<r.length;a++)r[a]["_COVARn "+i.name]=(r[a]["_BaseChange "+i.name]-r[a]["_MA Base "+i.name])*(r[a]["_CompChange "+i.name]-r[a]["_MA Comp "+i.name]),r[a]["_VARn "+i.name]=Math.pow(r[a]["_CompChange "+i.name]-r[a]["_MA Comp "+i.name],2);for(e.Studies.MA("ma",i.days,"_COVARn "+i.name,0,"_COVAR",t,i),e.Studies.MA("ma",i.days,"_VARn "+i.name,0,"_VAR",t,i),a=Math.max(i.startFrom,2*i.days-1);a<r.length;a++)r[a]["Result "+i.name]=r[a]["_COVAR "+i.name]/r[a]["_VAR "+i.name]},e.Studies.calculateVortex=function(t,i){var r=i.chart.scrubbed,n=i.days;if(r.length<n+1)return void(i.error=!0);var a={tr:0,vmPlus:0,vmMinus:0};i.startFrom>1&&(a=e.clone(r[i.startFrom-1]["_totals "+i.name]));for(var s=Math.max(i.startFrom,1);s<r.length;s++){var o=r[s],l=r[s-1],h=Math.abs(o.High-l.Low),u=Math.abs(o.Low-l.High),c=Math.max(o.High,l.Close)-Math.min(o.Low,l.Close);a.tr+=c,a.vmPlus+=h,a.vmMinus+=u,s>n&&(a.tr-=r[s-n]["_True Range "+i.name],a.vmPlus-=r[s-n]["_VMPlus "+i.name],a.vmMinus-=r[s-n]["_VMMinus "+i.name]),o["_True Range "+i.name]=c,o["_VMPlus "+i.name]=h,o["_VMMinus "+i.name]=u,s>=n&&(o["+VI "+i.name]=a.vmPlus/a.tr,o["-VI "+i.name]=a.vmMinus/a.tr),o["_totals "+i.name]=e.clone(a)}},e.Studies.calculateBalanceOfPower=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);for(var n=i.startFrom;n<r.length;n++){var a=r[n];a["_Ratio "+i.name]=a.Close-a.Open,0!==a["_Ratio "+i.name]&&(a["_Ratio "+i.name]/=a.High-a.Low)}e.Studies.MA(i.inputs["Moving Average Type"],i.days,"_Ratio "+i.name,0,"Result",t,i)},e.Studies.calculateTrendIntensity=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close"),e.Studies.MA("ma",i.days,n,0,"_SMA",t,i);var a,s,o=0,l=0,h=[],u=Math.ceil(i.days/2);for(a=Math.max(0,i.startFrom-u);a<r.length;a++)(r[a]["_SMA "+i.name]||0===r[a]["_SMA "+i.name])&&(s=r[a][n]-r[a]["_SMA "+i.name],s<0?l+=-1*s:o+=s,h.push(s),h.length>u&&(s=h.shift(),s<0?l-=-1*s:o-=s),a<i.startFrom||(r[a]["TII "+i.name]=function(t,e){return Math.abs(e)<1e-8?100:100-100/(1+t/e)}(o,l)));e.Studies.MA("ema",i.inputs["Signal Period"],"TII "+i.name,0,"Signal",t,i),i.zoneOutput="TII"},e.Studies.calculateZigZag=function(t,e){function i(t,i){for(var n=t+1;n<i;n++)r[n]["ShadowResult "+e.name]=(r[i]["Result "+e.name]-r[t]["Result "+e.name])*(n-t)/(i-t)+r[t]["Result "+e.name]}var r=e.chart.scrubbed;if(r&&r.length){
for(var n=e.highLowChart,a=null,s=null,o=e.inputs["Distance(%)"],l=0,h=0,u=0,c=null,p=null,d=0,f=Math.min(r.length-1,e.startFrom);f>=0;f--)if(d=f,r[f]["_state "+e.name]){var m=r[f]["_state "+e.name];a=m[0],s=m[1],l=m[2],h=m[3],u=m[4],c=m[5],p=m[6];break}for(var g=d;g<r.length;g++){var v=r[g][n?"High":"Close"],y=r[g][n?"Low":"Close"];if(null===s||s<v)if(s=v,l<0&&(a=y),c=(1-o/100)*s,l>-1){if(null!==p&&s>p){r[h]["Result "+e.name]=r[h][n?"Low":"Close"],i(u,h),l=-1,a=y,u=h,h=g;continue}}else h=g;if(null===a||a>y)if(a=y,l>0&&(s=v),p=(1+o/100)*a,l<1){if(null!==c&&a<c){r[h]["Result "+e.name]=r[h][n?"High":"Close"],i(u,h),l=1,s=v,u=h,h=g;continue}}else h=g}r[h]["Result "+e.name]=r[h][n?1==l?"Low":"High":"Close"],r[h]["_state "+e.name]=[a,s,l,h,u,c,p],i(u,h),r[r.length-1]["Result "+e.name]=r[r.length-1][n?1==l?"High":"Low":"Close"],i(h,r.length-1)}},e.Studies.calculatePsychologicalLine=function(t,e){var i=e.chart.scrubbed;if(i.length<e.days+1)return void(e.error=!0);for(var r=[],n=100/e.days,a=0,s=Math.max(e.startFrom-e.days,1);s<i.length;s++){var o=Number(i[s].Close>i[s-1].Close);o&&(a+=n),r.push(o),r.length>e.days&&(a-=r.shift()*n),s<e.startFrom||(i[s]["Result "+e.name]=a)}},e.Studies.calculateMADev=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n=i.inputs.Field;n&&"field"!=n||(n="Close");var a=i.inputs["Points Or Percent"];a||(a="Points");var s=i.inputs["Moving Average Type"];s||(s="exponential"),e.Studies.MA(s,i.days,n,0,"_MA",t,i);for(var o=i.name+"_hist",l=Math.max(i.startFrom,i.days-1);l<r.length;l++){var h=r[l];h[o]="Points"==a?h[n]-h["_MA "+i.name]:100*(h[n]/h["_MA "+i.name]-1)}},e.Studies.calculateShinohara=function(t,i){var r=i.chart.scrubbed;if(r.length<i.days+1)return void(i.error=!0);var n={weakNum:0,weakDen:0,strongNum:0,strongDen:0};i.startFrom>1&&(n=e.clone(r[i.startFrom-1]["_accums "+i.name]));for(var a=i.startFrom;a<r.length;a++)n.weakNum+=r[a].High-r[a].Close,n.weakDen+=r[a].Close-r[a].Low,a>0&&(n.strongNum+=r[a].High-r[a-1].Close,n.strongDen+=r[a-1].Close-r[a].Low),a>=i.days&&(n.weakNum-=r[a-i.days].High-r[a-i.days].Close,n.weakDen-=r[a-i.days].Close-r[a-i.days].Low,r[a]["Weak Ratio "+i.name]=100*n.weakNum/n.weakDen,a>i.days&&(n.strongNum-=r[a-i.days].High-r[a-i.days-1].Close,n.strongDen-=r[a-i.days-1].Close-r[a-i.days].Low,r[a]["Strong Ratio "+i.name]=100*n.strongNum/n.strongDen)),r[a]["_accums "+i.name]=e.clone(n)},e.Studies.calculateIchimoku=function(t,e){function i(t,e){for(var i=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,n=e-t+1;n<=e;n++)n<0||(i=Math.min(i,a[n].Low),r=Math.max(r,a[n].High));return[i,r]}var r,n,a=e.chart.scrubbed,s={Base:Number(e.inputs["Base Line Period"]),Conv:Number(e.inputs["Conversion Line Period"]),LeadB:Number(e.inputs["Leading Span B Period"]),Lag:Number(e.inputs["Lagging Span Period"])};for(r=e.startFrom;r<a.length;r++)a[r]&&(n=i(s.Conv,r),a[r]["Conversion Line "+e.name]=(n[1]+n[0])/2,n=i(s.Base,r),a[r]["Base Line "+e.name]=(n[1]+n[0])/2,r<s.Lag||(a[r-s.Lag]["Lagging Span "+e.name]=a[r].Close));for(e.futureA=[],e.futureB=[],r=Math.max(0,e.startFrom-s.Base);r<a.length;r++){n=i(s.LeadB,r);var o=(a[r]["Conversion Line "+e.name]+a[r]["Base Line "+e.name])/2,l=(n[1]+n[0])/2;a[r+s.Base]?(a[r+s.Base]["Leading Span A "+e.name]=o,a[r+s.Base]["Leading Span B "+e.name]=l):(e.futureA.push(o),e.futureB.push(l))}},e.Studies.displayIchimoku=function(t,i,r){function n(r,n){var a={color:!1===n?l:n?o:"transparent",opacity:.3,panelName:i.panel};e.fillArea(t,r,a),t.endClip()}var a="Leading Span A "+i.name,s="Leading Span B "+i.name,o=e.Studies.determineColor(i.outputs[i.outputMap[a]]),l=e.Studies.determineColor(i.outputs[i.outputMap[s]]),h={topBand:a,bottomBand:s,topColor:o,bottomColor:l,skipTransform:t.panels[i.panel].name!=i.chart.name};e.fillIntersecting(t,i.panel,r,h);var u=t.panels[i.panel],c=t.pixelFromBar(r.length-1,u.chart),p=t.pixelFromPrice(r[r.length-1][a],u),d=t.pixelFromPrice(r[r.length-1][s],u),f=[[c,d],[c,p]],m=null,g=i.futureA,v=i.futureB;if(i.chart.dataSegment.length>=i.chart.scroll){for(var y=0;g&&y<g.length-1;y++)if(null!==g[y]&&!isNaN(g[y])&&null!==v[y]&&!isNaN(v[y])){var x=t.pixelFromBar(r.length+y,u.chart),C=t.pixelFromBar(r.length+y+1,u.chart),S=t.pixelFromPrice(g[y],u),w=t.pixelFromPrice(g[y+1],u),D=t.pixelFromPrice(v[y],u),b=t.pixelFromPrice(v[y+1],u);if(f.push([x,S]),f.unshift([x,D]),(m=S<D)&&w>b||!m&&w<b){var T=e.intersectLineLineX(x,C,S,w,x,C,D,b),M=e.intersectLineLineY(x,C,S,w,x,C,D,b);f.push([T,M]),n(f,m),f=[[T,M]],m=null}}f.length>2&&n(f,m)}e.Studies.displaySeriesAsLine(t,i,r)},e.Studies.displayDarvas=function(t,i,r){var n=i.outputs.Levels;n&&"auto"!=n&&!e.isTransparent(n)||(n=t.defaultColor);var a=i.outputs.Darvas;a&&"auto"!=a&&!e.isTransparent(a)||(a=t.defaultColor);var s=i.outputs.Ghost;s&&"auto"!=s&&!e.isTransparent(s)||(s=t.defaultColor);var o,l,h,u=t.panels[i.panel],c=t.layout.candleWidth-2;if(c<2&&(c=1),t.startClip(i.panel),i.inputs["Stop Levels"]){for(t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=n,t.chart.context.beginPath(),o=0;o<r.length;o++){l=r[o];var p=r[o-1];if(l){h=l["Loss "+i.name]?Math.floor(t.pixelFromPrice(l["Loss "+i.name],u)):null;var d=p&&p["Loss "+i.name]?Math.floor(t.pixelFromPrice(p["Loss "+i.name],u)):null;if(h){l.candleWidth&&(c=Math.floor(Math.max(1,l.candleWidth)));var f=Math.floor(t.pixelFromBar(o,u.chart)+c/2),m=Math.floor(t.pixelFromBar(o,u.chart)-c/2);d&&d>=h?t.chart.context.lineTo(m,h):0===o?t.chart.context.moveTo(t.chart.left,h):t.chart.context.moveTo(m,h),t.chart.context.lineTo(f,h)}}}t.chart.context.stroke(),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}var g,v,y,x,C=-10,S=0,w=-10,D=0,b=!1,T=!1,M=t.chart.context.measureText("▲").width/2;for(o=0;o<r.length;o++)if(r[o]){if(r[o]["Spike "+i.name]){t.chart.context.fillStyle=a,t.chart.context.textBaseline="bottom";var k=t.pixelFromPrice(r[o].High,t.chart.panel);t.chart.context.fillText("▼",t.pixelFromBar(o)-M,k-5)}r[o].candleWidth&&(c=Math.floor(Math.max(1,r[o].candleWidth))),r[o]["Darvas "+i.name]&&(l=r[o]["Darvas "+i.name],1!=l.State||b?0===l.State&&(S=Math.floor(t.pixelFromBar(o,u.chart)+c/2)-C,g=Math.floor(t.pixelFromPrice(l.High,u)),v=Math.floor(t.pixelFromPrice(l.Low,u))-g,t.chart.context.strokeStyle=a,t.chart.context.fillStyle=a,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(C,g,S,v),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(C,g,S,v),t.chart.context.globalAlpha=1,b=!1):(C=Math.floor(t.pixelFromBar(o,u.chart)-c/2),g=Math.floor(t.pixelFromPrice(l.High,u)),v=Math.floor(t.pixelFromPrice(l.Low,u))-g,b=!0)),r[o]["Ghost "+i.name]&&i.inputs["Ghost Boxes"]&&(l=r[o]["Ghost "+i.name],1!=l.State||T?0===l.State&&(l.Start==l.End&&(w=Math.floor(t.pixelFromBar(o,u.chart)-c/2)),D=Math.floor(t.pixelFromBar(o,u.chart)+c/2)-w,y=Math.floor(t.pixelFromPrice(l.High,u)),x=Math.floor(t.pixelFromPrice(l.Low,u))-y,t.chart.context.strokeStyle=s,t.chart.context.fillStyle=s,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(w,y,D,x),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(w,y,D,x),t.chart.context.globalAlpha=1,T=!1):(w=Math.floor(t.pixelFromBar(o,u.chart)-c/2),y=Math.floor(t.pixelFromPrice(l.High,u)),D=Math.floor((l.End-l.Start+1)*t.layout.candleWidth+c/2),x=Math.floor(t.pixelFromPrice(l.Low,u))-y,T=!0))}if(b&&(S=Math.floor(t.pixelFromBar(o,u.chart)+c/2)-C,t.chart.context.strokeStyle=a,t.chart.context.fillStyle=a,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.beginPath(),t.chart.context.moveTo(C+2*S,g),t.chart.context.lineTo(C,g),t.chart.context.lineTo(C,g+v),t.chart.context.lineTo(C+2*S,g+v),t.chart.context.stroke(),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(C,g,2*S,v),t.chart.context.globalAlpha=1),T&&(t.chart.context.strokeStyle=s,t.chart.context.fillStyle=s,i.inputs["Stop Levels"]?t.chart.context.globalAlpha=.3:(t.chart.context.strokeRect(w,y,D,x),t.chart.context.globalAlpha=.2),t.chart.context.fillRect(w,y,D,x),t.chart.context.globalAlpha=1),b||T){if(i.inputs["Stop Levels"]){t.chart.context.setLineDash&&t.chart.context.setLineDash([2,2]),t.chart.context.lineWidth=2,t.chart.context.strokeStyle=n;var A=Math.floor(t.pixelFromBar(o-1,u.chart)+c/2);h&&(t.chart.context.beginPath(),t.chart.context.moveTo(A,h),t.chart.context.lineTo(b?C+2*S:w+D,h),t.chart.context.stroke()),t.chart.context.setLineDash&&t.chart.context.setLineDash([]),t.chart.context.lineWidth=1}b=!1,T=!1}t.endClip()},e.Studies.displaySupertrend=function(t,e,i){function r(t,i,r){return i&&i["_Direction "+e.name]<0?e.outputs.Downtrend:e.outputs.Uptrend}var n=t.panels[e.panel],a={skipProjections:!0,label:t.preferences.labels},s=t.chart.context;s.strokeStyle=r(t,i[i.length-1]),s.lineWidth=2,e.highlight&&(s.lineWidth=3);for(var o="Trend "+e.name,l=0;n.chart.transformFunc&&l<i.length;l++){var h=i[l];h&&h.transform&&(h.transform[o]=n.chart.transformFunc(t,n.chart,h[o]))}t.plotDataSegmentAsLine(o,n,a,r),s.lineWidth=1,t.startClip(e.panel);var u,c=t.chart.context.measureText("▲").width/2;for(u=0;u<i.length;u++)if(i[u]&&i[u-1])if(i[u-1]["_Direction "+e.name]>i[u]["_Direction "+e.name]){t.chart.context.fillStyle=e.outputs.Downtrend,t.chart.context.textBaseline="bottom";for(var p=t.pixelFromPrice(i[u].High,t.chart.panel),d=5;d<=45;d+=10)t.chart.context.fillText("▼",t.pixelFromBar(u)-c,p-d)}else if(i[u-1]["_Direction "+e.name]<i[u]["_Direction "+e.name]){t.chart.context.fillStyle=e.outputs.Uptrend,t.chart.context.textBaseline="top";for(var f=t.pixelFromPrice(i[u].Low,t.chart.panel),m=5;m<=45;m+=10)t.chart.context.fillText("▲",t.pixelFromBar(u)-c,f+m)}t.endClip()},e.Studies.displayVWAP=function(t,i,r){i.error?t.watermark(i.panel,{h:"center",v:"top",text:t.translateIf(i.error),vOffset:50}):e.Studies.displaySeriesAsLine(t,i,r)},e.Studies.displayVsComparisonSymbol=function(t,i,r){var n=i.inputs["Comparison Symbol"].toUpperCase();if(!t.getSeries({symbol:n,chart:i.chart}).length)return void t.watermark(i.panel,"center","bottom",t.translateIf(i.study.name+" Not Available"));for(var a={skipTransform:t.panels[i.panel].name!=i.chart.name,panelName:i.panel,band:"Result "+i.name,threshold:i.study.centerline},s=r.length-1;s>=0;s--)if(r[s]&&r[s][n])return e.Studies.displaySeriesAsLine(t,i,r),void((i.study.centerline||0===i.study.centerline)&&(i.outputs.Gain&&e.preparePeakValleyFill(t,r,e.extend(a,{direction:1,color:i.outputs.Gain})),i.outputs.Loss&&e.preparePeakValleyFill(t,r,e.extend(a,{direction:-1,color:i.outputs.Loss}))))},e.Studies.displayMFI=function(t,i,r){var n=t.panels[i.panel];n.yAxis.min=0,e.Studies.displaySeriesAsLine(t,i,r);var a=n.yAxis.bottom,s=t.layout.candleWidth-2;s<2&&(s=1);var o=i.outputs.Green,l=i.outputs.Fade,h=i.outputs.Fake,u=i.outputs.Squat;t.canvasColor("stx_histogram"),t.chart.context.globalAlpha=1,t.chart.context.fillStyle="#CCCCCC",t.startClip(i.panel);for(var c=0;c<r.length;c++){var p=r[c];p&&r[c-1]&&(0===c||(r[c-1][i.name+"_hist"]<p[i.name+"_hist"]?r[c-1].Volume<p.Volume?t.chart.context.fillStyle=o:r[c-1].Volume>p.Volume&&(t.chart.context.fillStyle=h):r[c-1][i.name+"_hist"]>p[i.name+"_hist"]&&(r[c-1].Volume<p.Volume?t.chart.context.fillStyle=u:r[c-1].Volume>p.Volume&&(t.chart.context.fillStyle=l))),p.candleWidth&&(s=Math.floor(Math.max(1,p.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(c,n.chart)-s/2),Math.floor(a),Math.floor(s),Math.floor(t.pixelFromPrice(p[i.name+"_hist"],n)-a)))}t.endClip()},e.Studies.displayAwesomeOscillator=function(t,i,r){e.Studies.determineMinMax(t,i,r);var n=t.panels[i.panel];n.yAxis.low=n.min=Math.min(0,n.min),n.yAxis.high=n.max=Math.max(0,n.max),e.Studies.displaySeriesAsLine(t,i,r);var a=t.pixelFromPrice(0,n),s=t.layout.candleWidth-2;s<2&&(s=1);var o=e.Studies.determineColor(i.outputs["Increasing Bar"]),l=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),t.chart.context.globalAlpha=1,t.chart.context.fillStyle="#CCCCCC",t.startClip(i.panel);for(var h=0;h<r.length;h++){var u=r[h];u&&r[h-1]&&(0===h||(r[h-1][i.name+"_hist"]<u[i.name+"_hist"]?t.chart.context.fillStyle=o:r[h-1][i.name+"_hist"]>u[i.name+"_hist"]&&(t.chart.context.fillStyle=l)),u.candleWidth&&(s=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(h,n.chart)-s/2),Math.floor(a),Math.floor(s),Math.floor(t.pixelFromPrice(u[i.name+"_hist"],n)-a)))}t.endClip()},e.Studies.displayGator=function(t,i,r){e.Studies.determineMinMax(t,i,r);var n=t.panels[i.panel];n.yAxis.low=n.min=Math.min(0,n.min),n.yAxis.high=n.max=Math.max(0,n.max),e.Studies.displaySeriesAsLine(t,i,r);var a=t.pixelFromPrice(0,n),s=t.layout.candleWidth-2;s<2&&(s=1);var o=e.Studies.determineColor(i.outputs["Increasing Bar"]),l=e.Studies.determineColor(i.outputs["Decreasing Bar"]);t.canvasColor("stx_histogram"),t.chart.context.globalAlpha=1,t.chart.context.fillStyle="#CCCCCC",t.startClip(i.panel);for(var h=1;h<r.length;h++){var u=r[h];if(u&&r[h-1])for(var c=1;c<=2;c++)Math.abs(r[h-1][i.name+"_hist"+c])<Math.abs(u[i.name+"_hist"+c])?t.chart.context.fillStyle=o:Math.abs(r[h-1][i.name+"_hist"+c])>Math.abs(u[i.name+"_hist"+c])&&(t.chart.context.fillStyle=l),u.candleWidth&&(s=Math.floor(Math.max(1,u.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(h,n.chart)-s/2),Math.floor(a),Math.floor(s),Math.floor(t.pixelFromPrice(u[i.name+"_hist"+c],n)-a))}t.endClip()},e.Studies.displayElderImpulse=function(t,e,i){t.chart.customChart={chartType:"colored_bar",colorFunction:function(t,i,r){return i["Result "+e.name]}}},e.Studies.displayPivotPoints=function(t,i,r){if(i.noSlopes=!i.inputs.Continuous,e.Studies.displaySeriesAsLine(t,i,r),i.inputs.Shading){var n={noSlopes:i.noSlopes,opacity:i.parameters.opacity?i.parameters.opacity:.2,skipTransform:t.panels[i.panel].name!=i.chart.name};e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Resistance 3 "+i.name,bottomBand:"Resistance 2 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 3"])},n)),e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Resistance 2 "+i.name,bottomBand:"Resistance 1 "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 2"])},n)),e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Resistance 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Resistance 1"])},n)),e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Support 1 "+i.name,bottomBand:"Pivot "+i.name,color:e.Studies.determineColor(i.outputs["Support 1"])},n)),e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Support 2 "+i.name,bottomBand:"Support 1 "+i.name,color:e.Studies.determineColor(i.outputs["Support 2"])},n)),e.prepareChannelFill(t,r,e.extend({panelName:i.panel,topBand:"Support 3 "+i.name,bottomBand:"Support 2 "+i.name,color:e.Studies.determineColor(i.outputs["Support 3"])},n))}},e.Studies.displayAlligator=function(t,i,r){function n(e,i){var n;"high"==e?(t.chart.context.fillStyle=t.defaultColor,t.chart.context.textBaseline="bottom",n=t.pixelFromPrice(r[i].High,t.chart.panel),t.chart.context.fillText("▲",t.pixelFromBar(s,t.chart)-t.chart.context.measureText("▲").width/2+1,n-5)):"low"==e&&(t.chart.context.fillStyle=t.defaultColor,t.chart.context.textBaseline="top",n=t.pixelFromPrice(r[i].Low,t.chart.panel),t.chart.context.fillText("▼",t.pixelFromBar(s,t.chart)-t.chart.context.measureText("▼").width/2+1,n+5))}var a=t.panels[i.panel];if(e.Studies.displayIndividualSeriesAsLine(t,i,a,"Jaw "+i.name,r),e.Studies.displayIndividualSeriesAsLine(t,i,a,"Lips "+i.name,r),e.Studies.displayIndividualSeriesAsLine(t,i,a,"Teeth "+i.name,r),i.inputs["Show Fractals"]){t.startClip(i.panel);for(var s=2;s<r.length-2;s++)r[s]&&(r[s]["Fractal High "+i.name]&&n("high",s),r[s]["Fractal Low "+i.name]&&n("low",s));t.endClip()}},e.Studies.displayRainbowMA=function(t,i,r){for(var n=t.panels[i.panel],a=10;a>0;a--)e.Studies.displayIndividualSeriesAsLine(t,i,n,"SMA"+a+" "+i.name,r)},e.Studies.displayRainbowOsc=function(t,i,r){var n=t.panels[i.panel];n.min=-100,n.max=100,n.yAxis.low=n.min=Math.min(0,n.min),n.yAxis.high=n.max=Math.max(0,n.max),e.Studies.displaySeriesAsLine(t,i,r),t.startClip(i.panel);var a=t.pixelFromPrice(0,n);t.plotDataSegmentAsLine("Zero "+i.name,n,{noDraw:!0,skipTransform:!0,label:!1});var s=e.Studies.determineColor(i.outputs["Positive Bar"]);t.chart.context.strokeStyle=s,t.plotDataSegmentAsLine("Over "+i.name,n,{skipTransform:!0,label:!1});var o=t.panels[i.panel].name!=i.chart.name,l=t.chart.context.createLinearGradient(0,a,0,n.yAxis.top);l.addColorStop(0,t.containerColor),l.addColorStop(1,s),e.prepareChannelFill(t,r,{skipTransform:o,color:l,opacity:1,panelName:i.name,topBand:"Over "+i.name,bottomBand:"Zero "+i.name});var h=e.Studies.determineColor(i.outputs["Negative Bar"]);t.chart.context.strokeStyle=h,t.plotDataSegmentAsLine("Under "+i.name,n,{skipTransform:!0,label:!1});var u=t.chart.context.createLinearGradient(0,a,0,n.yAxis.bottom);u.addColorStop(0,t.containerColor),u.addColorStop(1,h),e.prepareChannelFill(t,r,{skipTransform:o,color:u,opacity:1,panelName:i.name,topBand:"Zero "+i.name,bottomBand:"Under "+i.name});var c=t.layout.candleWidth-2;c<2&&(c=1),t.canvasColor("stx_histogram"),t.chart.context.globalAlpha=1,t.chart.context.fillStyle="#CCCCCC";for(var p=0;p<r.length;p++){var d=r[p];d&&(d[i.name+"_hist"]>0?t.chart.context.fillStyle=s:d[i.name+"_hist"]<0&&(t.chart.context.fillStyle=h),d.candleWidth&&(c=Math.floor(Math.max(1,d.candleWidth-2))),t.chart.context.fillRect(Math.floor(t.pixelFromBar(p,n.chart)-c/2),Math.floor(a),Math.floor(c),Math.floor(t.pixelFromPrice(d[i.name+"_hist"],n)-a)))}t.endClip()},e.Studies.displayZigZag=function(t,i,r){var n=t.highLowBars[t.layout.chartType];i.highLowChart!=n&&(i.highLowChart=n,i.startFrom=0,i.study.calculateFN(t,i));for(var a=t.chart,s=0;s<r.length;s++)r[s]&&r[s]["_shadowCopy "+i.name]&&(delete r[s]["Result "+i.name],r[s].transform&&delete r[s].transform["Result "+i.name],delete r[s]["_shadowCopy "+i.name]);var o=r[0],l=r[r.length-1];o&&!o["Result "+i.name]&&o["ShadowResult "+i.name]&&(o["Result "+i.name]=o["ShadowResult "+i.name],o.transform&&(o.transform["Result "+i.name]=a.transformFunc(t,a,o["ShadowResult "+i.name])),o["_shadowCopy "+i.name]=1),l&&!l["Result "+i.name]&&l["ShadowResult "+i.name]&&(l["Result "+i.name]=l["ShadowResult "+i.name],l.transform&&(l.transform["Result "+i.name]=a.transformFunc(t,a,l["ShadowResult "+i.name])),l["_shadowCopy "+i.name]=1),e.Studies.displaySeriesAsLine(t,i,r)},e.Studies.displayVolumeProfile=function(t,i,r){function n(t,i){i||(b-=2),A.canvasColor(t),e.isIE8&&(C.globalAlpha=.5),C.beginPath();for(var r=c[0][0],n=b,a=1;a<c.length;a++){if(c[a][1]){var s=Math.round(b-c[a][1]*T/d)-.5,o=Math.round(A.pixelFromTransformedValue(r,w))+.5,l=Math.round(A.pixelFromTransformedValue(c[a][0],w))+.5;if(i||(o-=.5,l+=.5,s+=.5),o>D&&(o=D),l<D)if(C.moveTo(b,o),C.lineTo(b,l),C.lineTo(s,l),C.lineTo(s,o),i)(n>s||1==a)&&C.lineTo(n,o);else if(C.lineTo(b,o),h){var u=e.condenseInt(c[a][1]),p=o-l;if(S<=p-2){var f;try{f=C.measureText(u).width}catch(t){f=0}C.textBaseline="top";var m=C.fillStyle;C.fillStyle=M,C.fillText(u,s-f-3,l+(p/2-S/2)),C.fillStyle=m}}n=s}else n=b;r=c[a][0]}i||C.fill(),C.strokeStyle=M,i&&C.stroke(),C.closePath()}if(t&&t.chart.dataSet){var a=t.chart,s=i.parameters.numberOfBars,o=i.parameters.widthPercentage,l=i.parameters.displayBorder,h=i.parameters.displayVolume;(!s||s<0)&&(s=30),s=Math.ceil(s),(!o||o<0)&&(o=.25),!1!==l&&(l=!0),!0!==h&&(h=!1);var u=(a.highValue-a.lowValue)/s;if(0!==u){for(var c=[],p=a.lowValue;p<a.highValue+.1;p+=u)c.push([p,0]);if(c.length<2)return void t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"));for(var d=0,f=0;f<r.length;f++){var m=r[f];if(m){var g=m.Volume;i.panel==a.name&&m.transform&&(m=m.transform);for(var v=c[0][0],y=0,x=1;x<c.length;x++)y=c[x][0],(m.Low>=v&&m.Low<=y||m.Low<v&&m.High>y||m.High>=v&&m.High<=y)&&(c[x][1]+=g,c[x][1]>d&&(d=c[x][1])),v=y}}if(0===d)return void t.watermark("chart","center","top",t.translateIf("Not enough data to render the Volume Profile"));t.setStyle("stx_volume_profile","color",e.Studies.determineColor(i.outputs["Bars Color"]));var C=a.context;t.canvasFont("stx-float-date",C);var S=t.getCanvasFontSize("stx-float-date"),w=a.panel,D=w.yAxis.bottom,b=Math.round(a.width)-.5,T=a.width*o,M=t.canvasStyle("stx_volume_profile").borderColor,k=!e.isTransparent(t.canvasStyle("stx_volume_profile").borderColor)&&l,A=t;n("stx_volume_profile",!1),k&&n("stx_volume_profile",!0),C.globalAlpha=1}}},e.Studies.studyLibrary=e.extend(e.Studies.studyLibrary,{"val lines":{name:"Valuation Lines",calculateFN:function(){},seriesFN:function(t,i,r){e.Studies.calculateValuationLines(t,i,r),e.Studies.displayValuationLines(t,i)},overlay:!0,inputs:{Field:"field","Average Type":["mean","median","harmonic"],"Display Average":!0,"Display 1 Standard Deviation (1σ)":!1,"Display 2 Standard Deviation (2σ)":!1,"Display 3 Standard Deviation (3σ)":!1},outputs:{Average:"#00afed","1 Standard Deviation (1σ)":"#e1e1e1","2 Standard Deviation (2σ)":"#85c99e","3 Standard Deviation (3σ)":"#fff69e"}},correl:{name:"Correlation Coefficient",range:"-1 to 1",calculateFN:e.Studies.calculateCorrelationCoefficient,outputs:{}},PMO:{name:"Price Momentum Oscillator",calculateFN:e.Studies.calculatePMO,inputs:{Field:"field","Smoothing Period":35,"Double Smoothing Period":20,"Signal Period":10},outputs:{PMO:"auto",PMOSignal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:2.5,studyOverBoughtColor:"auto",studyOverSoldValue:-2.5,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:0,step:"0.05"},studyOverSoldValue:{max:0,step:"0.05"}}},"Rel Vol":{name:"Relative Volatility",range:"0 to 100",calculateFN:e.Studies.calculateRelativeVolatility,inputs:{Field:"field","STD Period":10,"Smoothing Period":14},outputs:{"Rel Vol":"auto"},centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:70,studyOverBoughtColor:"auto",studyOverSoldValue:30,studyOverSoldColor:"auto"}}},Awesome:{name:"Awesome Oscillator",seriesFN:e.Studies.displayAwesomeOscillator,calculateFN:e.Studies.calculateAwesomeOscillator,inputs:{},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"W MFI":{name:"Market Facilitation Index",seriesFN:e.Studies.displayMFI,calculateFN:e.Studies.calculateMFI,yAxis:{ground:!0},range:"0 to max",inputs:{"Scale Factor":6},outputs:{Green:"#8bc176",Fade:"#ab611f",Fake:"#5f7cb8",Squat:"#ffd0cf"}},"ATR Bands":{name:"ATR Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateATRBands,inputs:{Period:5,Shift:3,Field:"field","Channel Fill":!0},outputs:{"ATR Bands Top":"auto","ATR Bands Bottom":"auto","ATR Bands Channel":"auto"},attributes:{Shift:{min:.1,step:.1}}},"STARC Bands":{name:"STARC Bands",overlay:!0,seriesFN:e.Studies.displayChannel,calculateFN:e.Studies.calculateSTARCBands,inputs:{Period:15,"MA Period":5,Multiplier:1.3,"Channel Fill":!0},outputs:{"STARC Bands Top":"auto","STARC Bands Median":"auto","STARC Bands Bottom":"auto"},attributes:{Multiplier:{min:.1,step:.1}}},"ATR Trailing Stop":{name:"ATR Trailing Stops",overlay:!0,seriesFN:e.Studies.displayPSAR2,calculateFN:e.Studies.calculateATRStops,inputs:{Multiplier:3,Period:21,"Plot Type":["points","squarewave"],HighLow:!1},outputs:{"Buy Stops":"#FF0000","Sell Stops":"#00FF00"},attributes:{Multiplier:{min:.1,step:.1}}},"Boll %b":{name:"Bollinger %b",calculateFN:e.Studies.calculateBollinger,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma"},outputs:{"%b":"auto"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:100,studyOverBoughtColor:"auto",studyOverSoldValue:0,studyOverSoldColor:"auto"}},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Boll BW":{name:"Bollinger Bandwidth",calculateFN:e.Studies.calculateBollinger,inputs:{Field:"field",Period:20,"Standard Deviations":2,"Moving Average Type":"ma"},outputs:{Bandwidth:"auto"},attributes:{"Standard Deviations":{min:.1,step:.1}}},"Donchian Width":{name:"Donchian Width",calculateFN:e.Studies.calculateMaxHighMinLow,inputs:{"High Period":20,"Low Period":20}},"Rel Vig":{name:"Relative Vigor Index",seriesFN:e.Studies.displayHistogramWithSeries,calculateFN:e.Studies.calculateRelativeVigor,inputs:{Period:10},outputs:{"Rel Vig":"auto",RelVigSignal:"#FF0000","Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},"Elder Impulse":{name:"Elder Impulse System",calculateFN:e.Studies.calculateElderImpulse,seriesFN:e.Studies.displayElderImpulse,customRemoval:!0,underlay:!0,inputs:{},outputs:{Bullish:"#8BC176",Bearish:"#DD3E39",Neutral:"#5F7CB8"},removeFN:function(t,e){t.chart.customChart=null}},"Pivot Points":{name:"Pivot Points",overlay:!0,seriesFN:e.Studies.displayPivotPoints,calculateFN:e.Studies.calculatePivotPoints,inputs:{Type:["standard","fibonacci"],Continuous:!1,Shading:!1},outputs:{Pivot:"auto","Resistance 1":"rgb(184,44,11)","Support 1":"rgb(105,145,88)","Resistance 2":"rgb(227,100,96)","Support 2":"rgb(179,217,135)","Resistance 3":"rgb(255,208,207)","Support 3":"rgb(211,232,174)"},parameters:{init:{opacity:.2}}},VWAP:{name:"VWAP",overlay:!0,seriesFN:e.Studies.displayVWAP,calculateFN:e.Studies.calculateVWAP,inputs:{},outputs:{VWAP:"#FF0000"}},Alligator:{name:"Alligator",overlay:!0,seriesFN:e.Studies.displayAlligator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3,"Show Fractals":!1},outputs:{Jaw:"#0000FF",Teeth:"#FF0000",Lips:"#00DD00"}},Gator:{name:"Gator Oscillator",seriesFN:e.Studies.displayGator,calculateFN:e.Studies.calculateAlligator,inputs:{"Jaw Period":13,"Jaw Offset":8,"Teeth Period":8,"Teeth Offset":5,"Lips Period":5,"Lips Offset":3},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"},centerline:0},"Ichimoku Clouds":{name:"Ichimoku Clouds",overlay:!0,range:"bypass",calculateFN:e.Studies.calculateIchimoku,seriesFN:e.Studies.displayIchimoku,inputs:{"Conversion Line Period":9,"Base Line Period":26,"Leading Span B Period":52,"Lagging Span Period":26},outputs:{"Conversion Line":"#0000FF","Base Line":"#FF0000","Leading Span A":"#00FF00","Leading Span B":"#FF0000","Lagging Span":"#808000"}},"P Rel":{name:"Price Relative",initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePriceRelative,inputs:{"Comparison Symbol":"SPY"},deferUpdate:!0},"Perf Idx":{name:"Performance Index",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculatePerformance,inputs:{Period:120,"Comparison Symbol":"SPY"},outputs:{Result:"auto",Gain:"#00DD00",Loss:"#FF0000"},deferUpdate:!0},Beta:{name:"Beta",centerline:1,initializeFN:e.Studies.initPriceRelative,seriesFN:e.Studies.displayVsComparisonSymbol,calculateFN:e.Studies.calculateBeta,inputs:{Period:20,"Comparison Symbol":"SPY"},deferUpdate:!0},Ulcer:{name:"Ulcer Index",calculateFN:e.Studies.calculateUlcerIndex,inputs:{Field:"field",Period:14}},"Bal Pwr":{name:"Balance of Power",range:"-1 to 1",calculateFN:e.Studies.calculateBalanceOfPower,inputs:{Period:14,"Moving Average Type":"ma"}},"Trend Int":{name:"Trend Intensity Index",calculateFN:e.Studies.calculateTrendIntensity,range:"0 to 100",inputs:{Field:"field",Period:14,"Signal Period":9},outputs:{TII:"auto",Signal:"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:80,studyOverBoughtColor:"auto",studyOverSoldValue:20,studyOverSoldColor:"auto"}}},Choppiness:{name:"Choppiness Index",calculateFN:e.Studies.calculateChoppiness,centerline:50,parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:61.8,studyOverBoughtColor:"auto",studyOverSoldValue:38.2,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:50,step:"0.1"},studyOverSoldValue:{max:50,step:"0.1"}}},Disparity:{name:"Disparity Index",calculateFN:e.Studies.calculateDisparity,inputs:{Field:"field",Period:14,"Moving Average Type":"ma"}},"Rainbow MA":{name:"Rainbow Moving Average",overlay:!0,calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowMA,inputs:{Field:"field",Period:2,Underlay:!1},outputs:{SMA1:"#FF0000",SMA2:"#FF7F00",SMA3:"#FFFF00",SMA4:"#7FFF00",SMA5:"#00FF7F",SMA6:"#00FFFF",SMA7:"#007FFF",SMA8:"#0000FF",SMA9:"#7F00FF",SMA10:"#FF00FF"}},"Rainbow Osc":{name:"Rainbow Oscillator",calculateFN:e.Studies.calculateRainbow,seriesFN:e.Studies.displayRainbowOsc,inputs:{Field:"field",Period:2,"HHV/LLV Lookback":10},outputs:{"Positive Bar":"#00DD00","Negative Bar":"#FF0000"}},"Pring KST":{name:"Pring's Know Sure Thing",calculateFN:e.Studies.calculateKST,inputs:{Field:"field","Lightest Rate of Change Period":10,"Lightest SMA Period":10,"Light Rate of Change Period":15,"Light SMA Period":10,"Heavy Rate of Change Period":20,"Heavy SMA Period":10,"Heaviest Rate of Change Period":30,"Heaviest SMA Period":15,"Signal Period":9},outputs:{KST:"#00DD00",KSTSignal:"#FF0000"}},"Pring Sp-K":{name:"Pring's Special K",calculateFN:e.Studies.calculateSpecialK,inputs:{Field:"field",Interval:["daily","weekly"]}},Darvas:{name:"Darvas Box",underlay:!0,calculateFN:e.Studies.calculateDarvas,seriesFN:e.Studies.displayDarvas,inputs:{"ATH Lookback Period":100,"Exit Field":["close","high/low"],"Ghost Boxes":!0,"Stop Levels":!1,"Level Offset":.01,"Price Minimum":5,"Volume Spike":!1,"Volume % of Avg":400},outputs:{Darvas:"#5F7CB8",Ghost:"#699158",Levels:"auto"},customRemoval:!0,attributes:{"Price Minimum":{min:.01,step:.01}}},Supertrend:{name:"Supertrend",overlay:!0,seriesFN:e.Studies.displaySupertrend,calculateFN:e.Studies.calculateSupertrend,inputs:{Period:7,Multiplier:3},outputs:{Uptrend:"#8cc176",Downtrend:"#b82c0c"},attributes:{Multiplier:{min:.1,step:.1}}},"vol profile":{name:"Volume Profile",overlay:!0,seriesFN:e.Studies.displayVolumeProfile,calculateFN:null,inputs:{},outputs:{"Bars Color":"#b64a96"},customRemoval:!0,parameters:{init:{displayBorder:!0,displayVolume:!1,numberOfBars:30,widthPercentage:.25}}},Vortex:{name:"Vortex Indicator",calculateFN:e.Studies.calculateVortex,centerline:1,outputs:{"+VI":"#00FF00","-VI":"#FF0000"},parameters:{template:"studyOverZones",init:{studyOverZonesEnabled:!0,studyOverBoughtValue:1.1,studyOverBoughtColor:"auto",studyOverSoldValue:.9,studyOverSoldColor:"auto"}},attributes:{studyOverBoughtValue:{min:1,step:"0.01"},studyOverSoldValue:{max:1,step:"0.01"}}},ZigZag:{name:"ZigZag",overlay:!0,seriesFN:e.Studies.displayZigZag,calculateFN:e.Studies.calculateZigZag,inputs:{"Distance(%)":10},parameters:{init:{label:!1}},customRemoval:!0,attributes:{"Distance(%)":{min:.1,step:.1}}},PSY:{name:"Psychological Line",range:"0 to 100",calculateFN:e.Studies.calculatePsychologicalLine,inputs:{Period:20}},"MA Dev":{name:"Moving Average Deviation",calculateFN:e.Studies.calculateMADev,seriesFN:e.Studies.displayHistogramWithSeries,inputs:{Field:"field",Period:12,"Moving Average Type":"ma","Points Or Percent":["Points","Percent"]},outputs:{"Increasing Bar":"#00DD00","Decreasing Bar":"#FF0000"}},Shinohara:{name:"Shinohara Intensity Ratio",calculateFN:e.Studies.calculateShinohara,inputs:{Period:26},outputs:{"Strong Ratio":"#E99B54","Weak Ratio":"#5F7CB8"}}}),t},__core_=function(t,e){t.SplinePlotter||(t.SplinePlotter={});var i=t.CIQ,r=t.$$$,n=t.SplinePlotter,a=function(t,e,i,r){window.splineWarning||console.log("Warning: Cannot find implementation of splining.  Try loading splines.js"),window.splineWarning=1;var n=0;i.moveTo(t[0],t[1]);for(var a=2;a<t.length;a+=2){if(r&&n<r.length){var s=r[n];s.coord[0]==t[a-2]&&s.coord[1]==t[a-1]&&(i.stroke(),i.strokeStyle=s.color,i.setLineDash(s.pattern),i.lineDashOffset=0,i.beginPath(),i.moveTo(t[a-2],t[a-1]),n++)}i.lineTo(t[a],t[a+1])}};return t.SplinePlotter.plotSpline||(t.SplinePlotter.plotSpline=a),i.getETDateTime=function(){var t=new Date
;return i.convertTimeZone(new Date(t.getTime()+6e4*t.getTimezoneOffset()),"UTC","America/New_York")},i.fromET=function(t){var e=new Date,i=4;(e.getMonth()<2||2==e.getMonth()&&e.getDate()<11||e.getMonth()>10||10==e.getMonth()&&e.getDate()>=4)&&(i=5);var r=t.getTime()+36e5*i;return new Date(r)},i.convertFutureMonth=function(t){var e=t.toString();if(e.length<=0||e.length>2)return"";switch(e){case"1":return"F";case"2":return"G";case"3":return"H";case"4":return"J";case"5":return"K";case"6":return"M";case"7":return"N";case"8":return"Q";case"9":return"U";case"10":return"V";case"11":return"X";case"12":return"Z";case"F":return"1";case"G":return"2";case"H":return"3";case"J":return"4";case"K":return"5";case"M":return"6";case"N":return"7";case"Q":return"8";case"U":return"9";case"V":return"10";case"X":return"11";case"Z":return"12"}return e},i.money=function(t,e,r){return r||(r="$"),3==r.length&&(r+=" "),e||0===e||(e=2),r+i.commas((Math.round(1e4*t)/1e4).toFixed(e))},i.convertCurrencyCode=function(t){var e={JPY:"¥",USD:"$",AUD:"A$",BRL:"R$",CAD:"CA$",CNY:"CN¥",CZK:"Kč",DKK:"kr",EUR:"€",GBP:"£",HKD:"HK$",HUF:"Ft",ILS:"₪",INR:"₹",KRW:"₩",MXN:"MX$",NOK:"kr",NZD:"NZ$",PLN:"zł",RUB:"руб",SAR:"﷼",SEK:"kr",SGD:"S$",THB:"฿",TRY:"₺",TWD:"NT$",VND:"₫",XAF:"FCFA",XCD:"EC$",XOF:"CFA",XPF:"CFPF",ZAR:"R"},i=e[t];return i||t},i.commas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},i.alert=function(t){alert(t)},i.withinElement=function(t,e,i){var r=t.getBoundingClientRect();return!(e<=r.left)&&(!(i<=r.top)&&(!(e>=r.left+t.offsetWidth)&&!(i>=r.top+t.offsetHeight)))},i.efficientDOMUpdate=function(t,e,i){t[e]!==i&&(t[e]=i)},i.safeMouseOut=function(t,e){t.addEventListener("mouseout",function(t,e){return function(r){void 0===r.pageX&&(r.pageX=r.clientX,r.pageY=r.clientY),i.withinElement(t,r.pageX,r.pageY)||(t.stxMouseOver=!1,e(r))}}(t,e))},i.safeMouseOver=function(t,e){t.addEventListener("mouseover",function(t,e){return function(r){if(void 0===r.pageX&&(r.pageX=r.clientX,r.pageY=r.clientY),i.withinElement(t,r.pageX,r.pageY)){if(t.stxMouseOver)return;t.stxMouseOver=!0,e(r)}}}(t,e))},i.installTapEvent=function(t,e){var r=function(t){var i=document.createEvent("Event");i.initEvent("stxtap",!0,!0),void 0===t.pageX&&(t.pageX=t.clientX,t.pageY=t.clientY),i.pageX=t.pageX,i.pageY=t.pageY,t.target.dispatchEvent(i),e&&e.stopPropagation&&t.stopPropagation()};i.safeClickTouch(t,r,e)},i.safeClickTouch=function(t,e,r){function n(t,r,n){return function(a){if(!i.safeClickTouchEvent){if(!n.t)return;var s=n.t;if(n.t=null,s+1e3<(new Date).getTime())return}if(!(r.safety&&r.safety.recentlyDragged||(a||(a=event),a.which&&a.which>=2||a.button&&a.button>=2))){if(r.preventUnderlayClick)"INPUT"!==a.target.tagName&&a.preventDefault();else{if(r.lastType!=t&&Date.now()<r.allowAnotherDevice)return;r.lastType=t,r.allowAnotherDevice=Date.now()+1e3}e(a)}}}function a(t,e){return function(i){var r=i.clientX?i.clientX:i.pageX,n=i.clientY?i.clientY:i.pageY;e?(t.t=(new Date).getTime(),t.x=r,t.y=n):t.x&&Math.pow(t.x-r,2)+Math.pow(t.y-n,2)>16&&(t.t=null)}}r||(r={});var s={};r.allowMultiple||i.clearSafeClickTouches(t),!1!==r.preventUnderlayClick&&(r.preventUnderlayClick=!0),!1!==r.absorbDownEvent&&(r.absorbDownEvent=!0),r.allowAnotherDevice=0,r.registeredClick=!1;var o=t.safeClickTouchEvents;o||(o=t.safeClickTouchEvents=[]);var l=n("mouseup",r,s),h=n("touchend",r,s),u=n("pointerup",r,s),c=function(t){t.stopPropagation()},p={};if(i.safeClickTouchEvent){var d=n(i.safeClickTouchEvent,r);t.addEventListener(i.safeClickTouchEvent,d),p[i.safeClickTouchEvent]=d,o.push(p)}else"onpointerup"in document?(t.addEventListener("pointerdown",a(s,!0)),t.addEventListener("pointermove",a(s)),t.addEventListener("pointerup",u),p.pointerup=u,r.absorbDownEvent&&(t.addEventListener("pointerdown",c),p.pointerdown=c),o.push(p)):(t.addEventListener("mousedown",a(s,!0)),t.addEventListener("mousemove",a(s)),t.addEventListener("touchstart",a(s,!0)),t.addEventListener("touchmove",a(s)),t.addEventListener("mouseup",l),t.addEventListener("touchend",h),p.mouseup=l,p.touchend=h,r.absorbDownEvent&&(t.addEventListener("mousedown",c),p.mousedown=c,t.addEventListener("touchstart",c),p.touchstart=c),o.push(p))},i.clearSafeClickTouches=function(t){var e=t.safeClickTouchEvents;if(e){for(var i=0;i<e.length;i++){var r=e[i];for(var n in r){var a=r[n];t.removeEventListener(n,a)}}t.safeClickTouchEvents=null}},i.safeDrag=function(t,e,r,n){function a(t){function a(t){if(t.touches){if(t.touches.length>=1)return t.touches[0].pageX;if(t.changedTouches&&t.changedTouches.length>=1)return t.changedTouches[0].pageX}return void 0===t.pageX?t.clientX:t.pageX}function c(t){if(t.touches){if(t.touches.length>=1)return t.touches[0].pageY;if(t.changedTouches&&t.changedTouches.length>=1)return t.changedTouches[0].pageY}return void 0===t.pageY?t.clientY:t.pageY}var p={mousedown:{move:"mousemove",up:"mouseup"},pointerdown:{move:"pointermove",up:"pointerup"},touchstart:{move:"touchmove",up:"touchend"}};return function(d){if(!o){o=!0,i.ChartEngine.ignoreTouch=!0;var f=function(t){t&&t.preventDefault&&t.preventDefault(),u.recentlyDragged=!0,t.displacementX=a(t)-l,t.displacementY=c(t)-h,r(t)};r&&document.body.addEventListener(p[t].move,f),document.body.addEventListener(p[t].up,function(e){i.ChartEngine.ignoreTouch=!1,r&&document.body.removeEventListener(p[t].move,f),document.body.removeEventListener(p[t].up,arguments.callee),e.displacementX=a(e)-l,e.displacementY=c(e)-h,n&&n(e),setTimeout(function(t){return function(){t.recentlyDragged=!1}}(u),50)}),setTimeout(function(){o=!1},s),l=a(d),h=c(d),e&&e(d)}}}var s=100,o=!1,l=0,h=0,u={recentlyDragged:!1};return t.addEventListener("mousedown",a("mousedown")),t.addEventListener("pointerdown",a("pointerdown")),t.addEventListener("touchstart",a("touchstart")),u},i.isSurface&&(i.gesture=new MSGesture,i.gesture.target=document.body,i.gesturePointerId=null),i.inputKeyEvents=function(t,e){t.addEventListener("keyup",function(i){switch(window.event?event.keyCode:i.keyCode){case 13:e();break;case 27:t.value=""}},!1)},i.fixScreen=function(){window.scrollTo(0,0)},i.setCaretPosition=function(t,e){if(t.style.zIndex=5e3,t.setSelectionRange){i.focus(t);try{t.setSelectionRange(e,e)}catch(t){}}else if(t.createTextRange){var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",e),r.moveStart("character",e),r.select()}},i.setValueIfNotActive=function(t,e){document.activeElement!=t&&(t.value=e)},i.hideKeyboard=function(t){var e=document.activeElement;"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName||(e.blur(),window.focus(),t&&(t===document.body||document.body.contains(t))&&t.focus())},i.boxIntersects=function(t,e,r,n,a,s,o,l,h,u){function c(t,e){return(s-l)*t+(o-a)*e+(a*l-o*s)}var p=a,d=o;if(a>o&&(p=o,d=a),d>r&&(d=r),p<t&&(p=t),"segment"==h&&p>d)return!1;u&&(s=i.log10(s),l=i.log10(l),e=i.log10(e),n=i.log10(n));var f=s,m=l,g=o-a;if(Math.abs(g)>1e-7){var v=(l-s)/g,y=s-v*a;f=v*p+y,m=v*d+y}if(f>m){var x=m;m=f,f=x}if(m>e&&(m=e),f<n&&(f=n),"segment"==h)return f<=m;var C={a:c(t,e),b:c(t,n),c:c(r,e),d:c(r,n)};return!(C.a>0&&C.b>0&&C.c>0&&C.d>0)&&!(C.a<0&&C.b<0&&C.c<0&&C.d<0)},i.linesIntersect=function(t,e,i,r,n,a,s,o,l){var h=(o-s)*(e-t)-(a-n)*(r-i),u=(a-n)*(i-s)-(o-s)*(t-n),c=(e-t)*(i-s)-(r-i)*(t-n);if(0===h)return 0===u&&0===c;var p=u/h,d=c/h;if("segment"==l){if(p>=0&&p<=1&&d>=0&&d<=1)return!0}else if("line"==l||"horizontal"==l||"vertical"==l){if(p>=0&&p<=1)return!0}else if("ray"==l&&p>=0&&p<=1&&d>=0)return!0;return!1},i.yIntersection=function(t,e){var i=t.x0,r=t.x1,n=e,a=e,s=t.y0,o=t.y1,l=1e4*(r-i)-(a-n)*(o-s),h=(a-n)*(s-0)-1e4*(i-n),u=h/l;if(0===l){if(0!==h)return null;u=1}return s+u*(o-s)},i.xIntersection=function(t,e){var i=t.x0,r=t.x1,n=t.y0,a=t.y1,s=e,o=e,l=(o-s)*(r-i)-1e4*(a-n),h=1e4*(n-s)-(o-s)*(i-0),u=h/l;if(0===l){if(0!==h)return null;u=1}return i+u*(r-i)},i.intersectLineLineX=function(t,e,i,r,n,a,s,o){return t+((a-n)*(i-s)-(o-s)*(t-n))/((o-s)*(e-t)-(a-n)*(r-i))*(e-t)},i.intersectLineLineY=function(t,e,i,r,n,a,s,o){return i+((a-n)*(i-s)-(o-s)*(t-n))/((o-s)*(e-t)-(a-n)*(r-i))*(r-i)},i.privateBrowsingAlert=!1,i.localStorage="undefined"!=typeof localStorage?localStorage:{},i.localStorageSetItem=function(t,e){try{i.localStorage.setItem(t,e)}catch(t){i.privateBrowsingAlert||(i.alert("No storage space available.  Possible causes include browser being in Private Browsing mode, or maximum storage space has been reached."),i.privateBrowsingAlert=!0)}},i.loadUI=function(t,e){var r=document.createElement("iframe"),n=function(){var t=null;try{t=r.contentDocument||r.contentWindow.document}catch(t){return e(t)}if(t&&!t.title){var n=t.body.innerHTML,a=document.createElement("div");document.body.removeChild(r),i.innerHTML(a,n);for(var s=0;s<a.children.length;s++){var o=a.children[s].cloneNode(!0);document.body.appendChild(o)}e(null)}else e(new Error("iFrame not found or document has a title"))};r.src=t+"?"+i.uniqueID(),r.hidden=!0,r.addEventListener("load",n,!1),document.body.appendChild(r)},i.loadScript=function(t,e){if(i.loadedScripts||(i.loadedScripts={}),i.loadedScripts[t])return void(e&&e());var r=document.createElement("SCRIPT");r.async=!0,r.onload=function(){i.loadedScripts[t]=!0,e&&e()},"undefined"!=typeof isIE8&&(r.onreadystatechange=function(){"loaded"==r.readyState&&(i.loadedScripts[t]=!0,e&&setTimeout(e,0))});var n=t;n=-1==n.indexOf("?")?n+"?"+Date.now():n+"&"+Date.now(),r.src=n;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a.nextSibling)},i.loadStylesheet=function(t,e){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.media="screen",i.href=t+"?"+Date.now(),i.onload=function(){e&&e()};var r=document.getElementsByTagName("link"),n=r[r.length-1];n.parentNode.insertBefore(i,n.nextSibling)},i.loadWidget=function(t,e){i.loadStylesheet(t+".css",function(){i.loadUI(t+".html",function(r){r?e(r):i.loadScript(t+".js",e)})})},i.fillTransparentCanvas=function(t,e,i,r){var n=t.globalCompositeOperation;t.globalCompositeOperation="destination-over",t.fillStyle=e,t.fillRect(0,0,i,r),t.globalCompositeOperation=n},i.tickedRect=function(t){i.rect(t);var e=Math.round(t.top+t.height/2)+.5;t.ctx.beginPath(),t.ctx.moveTo(t.x-2,e),t.ctx.lineTo(t.x,e),t.ctx.stroke(),t.ctx.closePath()},i.roundRect=function(t,e){9===arguments.length&&(t={ctx:arguments[0],x:arguments[1],top:arguments[2],width:arguments[3],height:arguments[4],radius:arguments[5],fill:arguments[6],stroke:arguments[7],edge:arguments[8]});var r=t.stroke,n=t.x,a=t.top,s=t.width,o=t.height,l=t.radius,h=t.fill,u=t.ctx;void 0===r&&(r=!0),void 0===l&&(l=5,s<0&&(l=-5));var c=s<0?-1*l:l;l&&!e&&(n-=1);var p=n+l,d=n+s,f=a+c,m=a+o,g=d-l,v=m-c;if(u.beginPath(),u.moveTo(p,a),u.lineTo(g,a),u.quadraticCurveTo(d,a,d,f),u.lineTo(d,v),u.quadraticCurveTo(d,m,g,m),u.lineTo(p,m),"flush"==e)u.lineTo(n,m),u.lineTo(n,a);else if("arrow"==e){u.quadraticCurveTo(n,m,n-l,v);var y=s<0?1:-1;u.lineTo(n+o/2*y,a+o/2),u.lineTo(n-l,f),u.quadraticCurveTo(n,a,p,a)}else u.quadraticCurveTo(n,m,n,v),u.lineTo(n,f),u.quadraticCurveTo(n,a,p,a);u.closePath(),t.backgroundColor&&(u.fillStyle=t.backgroundColor),r&&u.stroke(),h&&u.fill(),t.txt&&i.createLabel(t)},i.createLabel=function(t){t.ctx.textBaseline="middle",t.ctx.fillStyle=t.color?t.color:i.chooseForegroundColor(t.backgroundColor),t.ctx.fillStyle===t.backgroundColor&&("#FFFFFF"==t.backgroundColor.toUpperCase()?t.ctx.fillStyle="#000000":t.ctx.fillStyle="#FFFFFF"),t.ctx.fillText(t.txt,t.x+t.margin.left,t.y+t.margin.top),t.ctx.textAlign="left"},i.roundRectArrow=function(t){i.roundRect(t,"arrow")},i.semiRoundRect=function(t){i.roundRect(t,"flush")},i.rect=function(t){t.radius=0,i.roundRect(t)},i.noop=function(t){i.createLabel(t)},i.getLines=function(t,e,i){for(var r=e.split(" "),n=[],a="",s=0,o=!1,l=0;l<r.length;l++){var h=r[l];if(s=t.measureText(a+h).width,s<i?(o&&(a+=" "),o=!0,a+=h):(n.push(a),a=h),l===r.length-1){n.push(a);break}}return n},i.readablePeriodicity=function(t){var e=t.layout.periodicity,i=t.layout.interval;return"number"==typeof t.layout.interval&&t.layout.timeUnit?(e=t.layout.interval*t.layout.periodicity,i=t.layout.timeUnit):"number"!=typeof t.layout.interval||t.layout.timeUnit||(e=t.layout.interval*t.layout.periodicity,i="minute"),e%60==0&&"minute"==i&&(e/=60,i="hour"),e+" "+t.translateIf(i.capitalize())},i.translatableTextNode=function(t,e,i){if(t.translationCallback){var r=document.createElement("translate");return r.setAttribute("original",e),r.innerHTML=t.translationCallback(e,i),r}return document.createTextNode(e)},i.clearCanvas=function(t,e){t.isDirty=!1;var r=t.context;if(r.clearRect(0,0,t.width,t.height),i.isAndroid&&!i.is_chrome){i.ChartEngine.useOldAndroidClear&&e&&(r.fillStyle=e.containerColor,r.fillRect(0,0,t.width,t.height),r.clearRect(0,0,t.width,t.height));var n=t.width;t.width=1,t.width=n}},i.monthLetters=["J","F","M","A","M","J","J","A","S","O","N","D"],i.monthAbv=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i.MILLISECOND=1,i.SECOND=1e3,i.MINUTE=60*i.SECOND,i.HOUR=60*i.MINUTE,i.DAY=24*i.HOUR,i.WEEK=7*i.DAY,i.MONTH=31*i.DAY,i.YEAR=366*i.DAY,i.DECADE=10*i.YEAR-7*i.DAY,i.monthAsDisplay=function(t,e,r){return e?r&&r.monthLetters?r.monthLetters[t]:i.monthLetters[t]:r&&r.monthAbv?r.monthAbv[t]:i.monthAbv[t]},i.timeAsDisplay=function(t,e,r){var n=e?e.internationalizer:null;if(n)return r==i.SECOND?n.hourMinuteSecond.format(t):r==i.MILLISECOND?n.hourMinuteSecond.format(t)+"."+t.getMilliseconds():n.hourMinute.format(t);var a=t.getMinutes();a<10&&(a="0"+a);var s=t.getHours()+":"+a,o="";if(r<=i.SECOND&&(o=t.getSeconds(),o<10&&(o="0"+o),s+=":"+o),r==i.MILLISECOND){var l=t.getMilliseconds();l<10?l="00"+l:l<100&&(l="0"+l),s+="."+l}return s},i.displayableDate=function(t,e,r){function n(t){return t<10?"0"+t:t}var a="",s=t.layout.interval,o=i.ChartEngine.isDailyInterval(s);if(e.xAxis.formatter)a=e.xAxis.formatter(r);else if(t.internationalizer)a=t.internationalizer.monthDay.format(r),o?a="month"==s?t.internationalizer.yearMonth.format(r):t.internationalizer.yearMonthDay.format(r):a+=" "+t.internationalizer.hourMinute.format(r);else{var l=n(r.getMonth()+1),h=n(r.getDate()),u=n(r.getHours()),c=n(r.getMinutes());if(o)a="month"==s?l+"-":l+"-"+h+"-",a+=r.getFullYear();else{a=l+"/"+h+" "+u+":"+c;var p=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=i.SECOND||"second"==t.layout.timeUnit,d=e.xAxis.activeTimeUnit&&e.xAxis.activeTimeUnit<=i.MILLISECOND||"millisecond"==t.layout.timeUnit;if(p||d){var f=n(r.getSeconds());if(a+=":"+f,d){var m=n(r.getMilliseconds());m<100&&(m="0"+m),a+=":"+m}}}}return a},i.fixPrice=function(t){if(!t&&0!==t)return null;for(var e=t.toFixed(10),i=e.length-1;i>1&&"0"==e.charAt(i);i--);return e=e.substring(0,i+1),parseFloat(e)},i.condenseInt=function(t){return null===t||void 0===t?"":t===1/0||t===-1/0?"n/a":t=t>0?t>1e12?Math.round(t/1e11)/10+"t":t>1e11?Math.round(t/1e9)+"b":t>1e10?(Math.round(t/1e8)/10).toFixed(1)+"b":t>1e9?(Math.round(t/1e7)/100).toFixed(2)+"b":t>1e8?Math.round(t/1e6)+"m":t>1e7?(Math.round(t/1e5)/10).toFixed(1)+"m":t>1e6?(Math.round(t/1e4)/100).toFixed(2)+"m":t>1e5?Math.round(t/1e3)+"k":t>1e4?(Math.round(t/100)/10).toFixed(1)+"k":t>1e3?(Math.round(t/10)/100).toFixed(2)+"k":t.toString():t<-1e12?Math.round(t/1e11)/10+"t":t<-1e9?Math.round(t/1e8)/10+"b":t<-1e6?Math.round(t/1e5)/10+"m":t<-1e3?Math.round(t/100)/10+"k":t.toString()},i.calculateTradingDecimalPlaces=function(t){var e=t.chart,i=2,r=e.masterData;if(r&&r.length>50)for(var n=2;n<50;n++){var a=r.length-n;if(a<0)break;var s=r[a];if(s.Close&&"number"==typeof s.Close){var o=s.Close.toString(),l=o.indexOf(".");if(-1!=l){var h=o.length-l-1;h>i&&(i=h)}}}var u=e.yAxis.maxDecimalPlaces;return i>u&&(i=u),i},i.fillArea=function(t,e,i){if(e.length){var r=t.chart.context,a=r.globalAlpha,s=arguments[2],o=arguments[3],l=arguments[4],h=0;i&&"object"==typeof i&&(s=i.color,o=i.opacity,h=i.tension,l=i.panelName),o||0===o||(o=.2),"auto"==s&&(s=t.defaultColor),r.globalAlpha=o,s&&(r.fillStyle=s);var u=Number.MAX_VALUE,c=-1*u,p=t.panels[l];p&&(c=p.yAxis.top,u=p.yAxis.bottom,r.save(),r.beginPath(),r.rect(p.left,c,p.width,u-c),r.clip()),r.beginPath();var d;if(h){var f=[];for(d=0;d<e.length-2;d++)f.push(e[d][0],e[d][1]);for(n.plotSpline(f,h,r),d=e.length-2;d<e.length;d++)r.lineTo(Math.round(e[d][0]),Math.round(e[d][1]))}else for(r.moveTo(e[0][0],e[0][1]),d=1;d<e.length;d++)r.lineTo(e[d][0],e[d][1]);r.closePath(),r.fill(),p&&r.restore(),r.globalAlpha=a}},i.prepareChannelFill=function(t,e,r){for(var n=t.panels[r.panelName],a=(n.yAxis,t.chart),s=(a.context.strokeStyle,i.extend({noDraw:!0,gaps:{}},r)),o=t.plotDataSegmentAsLine(r.topBand,n,s),l=t.plotDataSegmentAsLine(r.bottomBand,n,s),h=[],u=0;u<o.points.length;u+=2)h.push([o.points[u],o.points[u+1]]);for(var c=l.points.length-1;c>=0;c-=2)h.push([l.points[c-1],l.points[c]]);i.fillArea(t,h,r)},i.preparePeakValleyFill=function(t,e,r){var n=t.panels[r.panelName],a=n.yAxis,s=t.chart,o=(s.context.strokeStyle,t.plotDataSegmentAsLine(r.band,n,i.extend({noDraw:!0,gaps:{}},r))),l=r.threshold,h=r.direction,u=r.reverse,c=r.gaps;r.yAxis&&(a=r.yAxis);var p=-Number.MAX_VALUE,d=Number.MAX_VALUE,f=u?p:d;(l||0===l)&&(f=t.pixelFromPrice(l,n,a));for(var m=[],g=o.points.length,v=0;v<g;v+=2){var y,x,C=o.points[v],S=o.points[v+1];S>f&&h>0||S<f&&h<0||(m.push([C,S]),p=Math.max(S,p),d=Math.min(S,d)),v<g-3&&(y=o.points[v+2],x=o.points[v+3],(S<f&&x>f||S>f&&x<f)&&(C+=(f-S)*(y-C)/(x-S),m.push([C,f])))}if(g=m.length){if(r.edgeHighlight){var w=r.edgeParameters;w.lineWidth>100&&(w.lineWidth=1);for(var D=0;D<g-1;D++){var b=m[D],T=m[D+1];if(b[1]!=f||T[1]!=f){if(b[0]==T[0]&&t.layout.candleWidth>=1){if(b[1]==f&&m[D-1]&&m[D-1][1]==f)continue;if(T[1]==f&&m[D+2]&&m[D+2][1]==f)continue}t.plotLine(b[0],T[0],b[1],T[1],r.edgeHighlight,"segment",s.context,!0,w)}}}l||0===l||(f=u?Math.min(d,a.top):Math.max(p,a.bottom)),m.push([m[g-1][0],f],[m[0][0],f]);var M=r.opacity;if(M||0===M||(r.opacity=.3),i.fillArea(t,m,r),c&&c.color&&c.fillMountain&&!r.tension&&!i.isTransparent(c.color)&&!i.isTransparent(r.color)){s.context.fillStyle instanceof CanvasGradient?s.context.fillStyle.addColorStop(0,c.color):s.context.fillStyle=c.color;var k=[],A={opacity:r.opacity,panelName:r.panelName};for(v=0;v<o.gapAreas.length;v++){var P=o.gapAreas[v],_=P.start,F=P.end,E=P.threshold;_?k=[[_[0],_[1]],[_[0],E]]:k.push([F[0],E],[F[0],F[1]]),4==k.length&&i.fillArea(t,k,A)}}r.opacity=M}},i.fillIntersecting=function(t,e,r,n){var a=n.topBand,s=n.bottomBand,o=n.topColor,l=n.bottomColor,h=e;h.panel&&(h.outputs&&h.outputMap&&(o||(o=h.outputs[h.outputMap[a]]),l||(l=h.outputs[h.outputMap[s]])),h=h.panel),h=t.panels[h];var u=t.chart.context,c=t.scratchContext;if(!c){var p=u.canvas.cloneNode(!0);c=t.scratchContext=p.getContext("2d"),c.canvas=p}c.canvas.height=u.canvas.height,c.canvas.width=u.canvas.width,c.drawImage(u.canvas,0,0),u.clearRect(0,0,u.canvas.width,u.canvas.height);var d=.3;n.opacity&&(d=n.opacity),u.save(),u.globalCompositeOperation="xor";var f={band:a,color:o,opacity:1,panelName:h.name,yAxis:n.topAxis,skipTransform:n.skipTransform};i.preparePeakValleyFill(t,r,f),i.extend(f,{band:s,color:l,yAxis:n.bottomAxis}),i.preparePeakValleyFill(t,r,f),u.globalAlpha=d,u.globalCompositeOperation="copy",u.scale(1/t.adjustedDisplayPixelRatio,1/t.adjustedDisplayPixelRatio),u.drawImage(u.canvas,0,0),u.globalAlpha=1,u.globalCompositeOperation="destination-over",u.drawImage(t.scratchContext.canvas,0,0),u.restore()},i.drawLegendItem=function(t,e,i,r,n){n||(n=1);var a=e[0],s=e[1],o=t.chart.context;return o.globalAlpha=n,o.fillStyle=r,o.fillRect(a,s,10,10),o.globalAlpha=1,a+=12,o.fillStyle=t.defaultColor,o.fillText(i,a,s),a+=o.measureText(i).width+6,[a,s]},i.drawLegend=function(t,e){var r=e.coordinates,n=t.chart.context;n.textBaseline="top";var a=n.font;t.canvasFont("stx-legend",n),r||(r=e.chart.legend);var s=[r.x,r.y],o=t.defaultColor,l=t.layout.chartType;if(t.chart.customChart&&t.chart.customChart.chartType&&(l=t.chart.customChart.chartType),!e.noBase){var h;if(t.chart.baseLegendColors instanceof Array){var u=t.chart.baseLegendColors;if(u.length>1){var c=n.createLinearGradient(s[0],s[1],s[0]+10,s[1]);for(h=0;h<u.length;h++)c.addColorStop(h/(u.length-1),u[h]);o=c}else o=u.length>0?u[0]:t.getCanvasColor("stx_line_chart")}else if("mountain"==l){h=t.canvasStyle("stx_mountain_chart");var p=h.borderTopColor;p&&"transparent"!=p&&(o=p)}else o=null;if(o){var d;d=e.chart.symbolDisplay?e.chart.symbolDisplay:e.chart.symbol,s=i.drawLegendItem(t,s,d,o)}}for(var f in e.legendColorMap){var m=f;e.legendColorMap[f].display&&(m=e.legendColorMap[f].display),s=i.drawLegendItem(t,s,m,e.legendColorMap[f].color,e.legendColorMap[f].opacity)}n.font=a},i.minMax=function(t,e){for(var i=Number.MAX_VALUE,r=-1*Number.MAX_VALUE,n=0;n<t.length;n++){var a=t[n];if(a){var s=a[e];(s||0===s)&&(isNaN(s)||(i=Math.min(i,s),r=Math.max(r,s)))}}return[i,r]},i.destroy=function(t,e){for(var n=i.ChartEngine.registeredContainers,a=0;a<n.length;a++)if(n[a]==t.chart.container){n.splice(a,1);break}if(t.styles={},t.destroy(),t=null,i.ThemeManager&&i.ThemeManager.destroy(),i.MenuManager&&i.MenuManager.destroy(),e){for(var s=r(".stx-wrapper").childNodes,o=r(".stx-wrapper").querySelectorAll(e),l=0;l<o.length;l++)o[l].parentNode==r(".stx-wrapper")&&i.appendClassName(o[l],"stx-passover");for(var h=s.length-1;h>=0;h--)i.hasClassName(s[h],"stx-passover")?i.unappendClassName(s[h],"stx-passover"):s[h].parentNode.removeChild(s[h])}else r(".stx-wrapper").parentNode.removeChild(r(".stx-wrapper"))},i.symbolEqual=function(t,e){if(!t||!e)return!1;if("object"!=typeof t&&(t={symbol:t}),"object"!=typeof e&&(e={symbol:e}),"function"==typeof t.equals)return t.equals(e);var i=t.symbol,r=e.symbol;return i&&(i=i.toUpperCase()),r&&(r=r.toUpperCase()),i==r&&t.source==e.source},i.addMemberToMasterdata=function(t){function e(t,e){if(s&&s.length)if("*"==s[0])i.extend(t,e);else for(var r=0;r<s.length;r++)t[s[r]]=e[s[r]];else o?t[n]=e:l?t[n]=e[l]:v&&g&&void 0!==e[g]?t[n]=e[g]:m.adj&&void 0!==e.Adj_Close?t[n]=e.Adj_Close:void 0!==e.Close?t[n]=e.Close:void 0!==e.Value?t[n]=e.Value:t[n]=e[n]}t.constructor===i.ChartEngine&&(t={stx:arguments[0],label:arguments[1],data:arguments[2],fields:arguments[3],createObject:arguments[4],fieldForLabel:arguments[5]});var r=t.stx,n=t.label,a=t.data,s=t.fields,o=t.createObject,l=t.fieldForLabel;if(a&&a.constructor==Object&&(a=[a]),a&&a.length){r.doCleanupDates(a,r.layout.interval);var h,u,c=t.chart?t.chart:r.chart,p=0,d=0,f=c.masterData,m=r.layout;f||(f=[]);for(var g=r.chart&&r.chart.defaultPlotField?r.chart.defaultPlotField:null,v=!r.highLowBars[r.layout.chartType];a&&p<f.length&&d<a.length;)u=a[d],h=f[p],u.DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=i.yyyymmddhhmmssmmm(u.DT))):u.DT=i.strToDateTime(u.Date),+u.DT!=+h.DT?u.DT<h.DT?f.splice(p,0,{DT:u.DT,Date:u.Date}):p++:(e(h,u),d++,p++);if(p>=f.length)for(;a&&d<a.length;)u=a[d],u.DT&&void 0!==u.DT?("number"==typeof u.DT&&(u.DT=new Date(u.DT)),u.Date&&17==u.Date.length||(u.Date=i.yyyymmddhhmmssmmm(u.DT))):u.DT=i.strToDateTime(u.Date),h={DT:u.DT,Date:u.Date},e(h,u),f.push(h),d++;if(t.fillGaps&&f.length)for(var y=f[0],x=1;x<f.length;x++){var C=f[x];if(s)for(var S=0;S<s.length;S++){var w=s[S];void 0===C[w]&&(C[w]=y[w])}else void 0===C[n]&&(C[n]=y[n]);y=C}c.series[n]&&(c.series[n].lastQuote=h[n]),r.setMasterData(f,c)}},i.ThemeHelper=function(t){this.params=t;var e=t.stx,r="#FFFFFF";e.chart.container&&(r=getComputedStyle(e.chart.container).backgroundColor,i.isTransparent(r)&&(r=e.containerColor)),this.settings.chart.Background.color=i.hexToRgba(r),this.settings.chart["Grid Lines"].color=i.hexToRgba(e.canvasStyle("stx_grid").color),this.settings.chart["Grid Dividers"].color=i.hexToRgba(e.canvasStyle("stx_grid_dark").color),this.settings.chart["Axis Text"].color=i.hexToRgba(e.canvasStyle("stx_xaxis").color),this.settings.chartTypes["Candle/Bar"].up.color=i.hexToRgba(e.canvasStyle("stx_candle_up").color),this.settings.chartTypes["Candle/Bar"].down.color=i.hexToRgba(e.canvasStyle("stx_candle_down").color),this.settings.chartTypes["Candle/Bar"].up.wick=i.hexToRgba(e.canvasStyle("stx_candle_shadow_up").color),this.settings.chartTypes["Candle/Bar"].down.wick=i.hexToRgba(e.canvasStyle("stx_candle_shadow_down").color),this.settings.chartTypes["Candle/Bar"].up.border=i.hexToRgba(e.canvasStyle("stx_candle_up").borderLeftColor),this.settings.chartTypes["Candle/Bar"].down.border=i.hexToRgba(e.canvasStyle("stx_candle_down").borderLeftColor),i.isTransparent(e.canvasStyle("stx_candle_up").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].up.border=null),i.isTransparent(e.canvasStyle("stx_candle_down").borderLeftColor)&&(this.settings.chartTypes["Candle/Bar"].down.border=null),this.settings.chartTypes.Line.color=i.hexToRgba(e.canvasStyle("stx_line_chart").color),this.settings.chartTypes.Mountain.color=i.hexToRgba(e.canvasStyle("stx_mountain_chart").backgroundColor)},i.ThemeHelper.prototype.settings={chart:{Background:{color:null},"Grid Lines":{color:null},"Grid Dividers":{color:null},"Axis Text":{color:null}},chartTypes:{"Candle/Bar":{up:{color:null,wick:null,border:null},down:{color:null,wick:null,border:null}},Line:{color:null},Mountain:{color:null}}},i.ThemeHelper.prototype.update=function(t){function e(e,i,n){var a=r[e];for(var s in a)t.setStyle(s,i,n)}t||(t=this.params.stx);var r={stx_candle_up:{stx_candle_up:!0,stx_bar_up:!0,stx_hollow_candle_up:!0,stx_line_up:!0,stx_baseline_up:!0},stx_candle_down:{stx_candle_down:!0,stx_bar_down:!0,stx_hollow_candle_down:!0,stx_line_down:!0,stx_baseline_down:!0},stx_shadow_up:{stx_candle_shadow_up:!0},stx_shadow_down:{stx_candle_shadow_down:!0},stx_line_chart:{stx_bar_chart:!0,stx_line_chart:!0},stx_grid:{stx_grid:!0},stx_grid_dark:{stx_grid_dark:!0},stx_xaxis:{stx_xaxis_dark:!0,stx_xaxis:!0,stx_yaxis:!0,stx_yaxis_dark:!0,stx_grid_border:!0},stx_mountain_chart:{stx_mountain_chart:!0},stx_market_session:{stx_market_session:!0}};t.chart.container.style.backgroundColor=this.settings.chart.Background.color,e("stx_grid","color",this.settings.chart["Grid Lines"].color),e("stx_grid_dark","color",this.settings.chart["Grid Dividers"].color),e("stx_xaxis","color",this.settings.chart["Axis Text"].color),e("stx_candle_up","color",this.settings.chartTypes["Candle/Bar"].up.color),e("stx_candle_down","color",this.settings.chartTypes["Candle/Bar"].down.color),e("stx_shadow_up","color",this.settings.chartTypes["Candle/Bar"].up.wick),e("stx_shadow_down","color",this.settings.chartTypes["Candle/Bar"].down.wick),t.setStyle("stx_candle_up","borderLeftColor",this.settings.chartTypes["Candle/Bar"].up.border),t.setStyle("stx_candle_down","borderLeftColor",this.settings.chartTypes["Candle/Bar"].down.border),e("stx_line_chart","color",this.settings.chartTypes.Line.color),t.setStyle("stx_mountain_chart","borderTopColor",this.settings.chartTypes.Mountain.color),t.setStyle("stx_mountain_chart","backgroundColor",i.hexToRgba(this.settings.chartTypes.Mountain.color,.8)),t.setStyle("stx_mountain_chart","color",i.hexToRgba(this.settings.chartTypes.Mountain.color,.1)),t.draw()},i.NameValueStore=function(){},i.NameValueStore.prototype.toJSONIfNecessary=function(t){if(t.constructor==String)return t;try{return JSON.stringify(t)}catch(e){return console.log("Cannot convert to JSON: "+t),null}},i.NameValueStore.prototype.fromJSONIfNecessary=function(t){try{return JSON.parse(t)}catch(e){return t}},i.NameValueStore.prototype.get=function(t,e){var r=i.localStorage.getItem(t);e&&e(null,this.fromJSONIfNecessary(r))},i.NameValueStore.prototype.set=function(t,e,r){i.localStorage.setItem(t,this.toJSONIfNecessary(e)),r&&r(null)},i.NameValueStore.prototype.remove=function(t,e){i.localStorage.removeItem(t),e&&e(null)},i.Plotter=function(){this.seriesArray=[],this.seriesMap={}},i.Plotter.prototype={Series:function(t,e,r,n,a,s){this.name=t,this.strokeOrFill=e,this.color=r,this.moves=[],this.text=[],(!n||n>1||n<0)&&(n=1),this.opacity=n,(!a||a>25||a<1)&&(a=1),this.width=a,this.pattern=i.borderPatternToArray(a,s)},newSeries:function(t,e,i,r,n){var a;a=i.constructor==String?new this.Series(t,e,i,r,n):new this.Series(t,e,i.color,i.opacity,n,i.borderTopStyle),this.seriesArray.push(a),this.seriesMap[t]=a},reset:function(t){for(var e in this.seriesMap)if(!t||t==e){var i=this.seriesMap[e];i&&(i.moves=[],i.text=[])}},moveTo:function(t,e,i){this.seriesMap[t].moves.push({action:"moveTo",x:e,y:i})},lineTo:function(t,e,i){var r=this.seriesMap[t],n=r.pattern;r.moves.push({action:"lineTo",x:e,y:i,pattern:n})},dashedLineTo:function(t,e,i,r){this.seriesMap[t].moves.push({action:"lineTo",x:e,y:i,pattern:r})},quadraticCurveTo:function(t,e,i,r,n){var a=this.seriesMap[t],s=a.pattern;a.moves.push({action:"quadraticCurveTo",x0:e,y0:i,x:r,y:n,pattern:s})},bezierCurveTo:function(t,e,i,r,n,a,s){var o=this.seriesMap[t],l=o.pattern;o.moves.push({action:"bezierCurveTo",x0:e,y0:i,x1:r,y1:n,x:a,y:s,pattern:l})},addText:function(t,e,i,r,n,a,s){this.seriesMap[t].text.push({text:e,x:i,y:r,bg:n})},drawText:function(t,e){for(var i=0;i<e.text.length;i++){var r=e.text[i];if(r.bg){var n=r.width?r.width:t.measureText(r.text).width,a=r.height?r.height:12,s=t.fillStyle;t.fillStyle=r.bg,"right"==t.textAlign?t.fillRect(r.x,r.y+a/2,-n,-a):t.fillRect(r.x,r.y+a/2,n,a),t.fillStyle=s}t.fillText(r.text,r.x,r.y)}},draw:function(t,e){for(var i=t.lineWidth,r=t.fillStyle,n=t.strokeStyle,a=t.globalAlpha,s=0;s<this.seriesArray.length;s++){var o=this.seriesArray[s];if(!e||o.name==e){t.beginPath(),t.lineWidth=o.width,t.globalAlpha=o.opacity,t.fillStyle=o.color,t.strokeStyle=o.color,t.save();for(var l=0;l<o.moves.length;l++){var h=o.moves[l];h.pattern?(t.setLineDash(h.pattern),t.lineDashOffset=0):t.setLineDash([]),"quadraticCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x,h.y):"bezierCurveTo"==h.action?t[h.action](h.x0,h.y0,h.x1,h.y1,h.x,h.y):t[h.action](h.x,h.y)}"fill"==o.strokeOrFill?t.fill():t.stroke(),t.closePath(),t.restore(),this.drawText(t,o),t.lineWidth=1}}t.lineWidth=i,t.fillStyle=r,t.strokeStyle=n,t.globalAlpha=a}},i.EaseMachine=function(t,e,i,r){this.fc=t,this.ms=e,(i||0===i)&&this.reset(i,r)},i.EaseMachine.prototype.reset=function(t,e){t||0===t||(t=this.currentValues),this.hasCompleted=!1,this.running=!1,this.okayToRun=!0,this.useNameValuePairs="object"==typeof e,this.startTime=Date.now(),this.useNameValuePairs?(this.startValues=t,this.endValues=e):(this.startValues={default:t},this.endValues={default:e}),this.changeValues={},this.currentValues={};for(var i in this.startValues)this.changeValues[i]=this.endValues[i]-this.startValues[i]},i.EaseMachine.prototype.next=function(){var t=Date.now();t>=this.startTime+this.ms&&(t=this.startTime+this.ms,this.hasCompleted=!0,this.running=!1),this.currentValues={};for(var e in this.changeValues)this.currentValues[e]=this.fc(t-this.startTime,this.startValues[e],this.changeValues[e],this.ms);return this.useNameValuePairs?this.currentValues:this.currentValues.default},i.EaseMachine.prototype.hasCompleted=!1,i.EaseMachine.prototype.run=function(t,e,i,r){function n(){if(a.afid=null,a.okayToRun){var e=a.next();t(e),a.hasCompleted||(a.afid=requestAnimationFrame(n))}}this.afid&&cancelAnimationFrame(this.afid),this.running=!0,e||0===e?this.reset(e,i):(i||0===i)&&this.reset(this.currentValues,i);var a=this;r?this.afid=requestAnimationFrame(n):n()},i.EaseMachine.prototype.stop=function(){return this.afid&&cancelAnimationFrame(this.afid),this.afid=null,this.okayToRun=!1,this.running=!1,void 0===this.useNameValuePairs?{}:this.useNameValuePairs?this.currentValues:this.currentValues.default},i.Renderer=function(){},i.Renderer.prototype.performCalculations=function(){},i.Renderer.prototype.draw=function(){},i.Renderer.prototype.construct=function(t){var e=t.params?t.params:{};e.name||(e.name=i.uniqueID()),e.heightPercentage||(e.heightPercentage=.7),e.opacity||(e.opacity=1),e.type||(e.type="line"),"legacy"!=e.type&&"line"!=e.type&&"mountain"!=e.type||(e.highlightable=!0),e.panel||(e.panel="chart"),this.cb=t.callback,this.params=e,this.seriesParams=[],this.caches={},this.colors={}},
i.Renderer.prototype.attachSeries=function(t,e){if(!this.stx||!this.stx.chart.series[t])return this;var i={field:t,chartType:this.params.type,display:this.stx.chart.series[t].parameters.display,border_color_up:this.params.defaultBorders?"auto":null,fill_color_up:this.stx.chart.series[t].parameters.color,opacity_up:this.params.opacity,border_color_down:this.params.defaultBorders?"auto":null,fill_color_down:this.stx.chart.series[t].parameters.color,opacity_down:this.params.opacity,color:this.stx.chart.series[t].parameters.color};if("string"==typeof e)i.color=i.fill_color_down=i.fill_color_up=e;else if("object"==typeof e){for(var r in e)i[r]=e[r];i.field=t,i.color&&(i.fill_color_up||(i.fill_color_up=i.color),i.fill_color_down||(i.fill_color_down=i.color))}return this.removeSeries(t,!0).seriesParams.push(i),i.fill_color_up!=i.fill_color_down?(this.colors[t+" up"]={color:i.fill_color_up,opacity:i.opacity_up,display:i.display?i.display+" up":t+" up"},this.colors[t+" dn"]={color:i.fill_color_down,opacity:i.opacity_down,display:i.display?i.display+" down":t+" down"}):this.colors[t]={color:i.fill_color_up,opacity:i.opacity_up,display:i.display?i.display:t},this.params.yAxis&&this.stx.addYAxis(this.stx.panels[this.params.panel],this.params.yAxis),this},i.Renderer.prototype.removeSeries=function(t,e){for(var i=0;i<this.seriesParams.length;i++)if(this.seriesParams[i].field==t){this.seriesParams.splice(i,1);break}if(delete this.colors[t+" up"],delete this.colors[t+" dn"],delete this.colors[t],!e){var r=!1;for(var n in this.stx.chart.seriesRenderers){for(var a=this.stx.chart.seriesRenderers[n],s=0;s<a.seriesParams.length;s++)if(a.seriesParams[s].field==t){r=!0;break}if(r)break}r||this.stx.deleteSeries(t,this.stx.chart)}return this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},i.Renderer.prototype.removeAllSeries=function(t){if(t){for(var e=[],i=0;i<this.seriesParams.length;i++)e.push(this.seriesParams[i].field);for(var r=0;r<e.length;r++)this.removeSeries(e[r])}return this.seriesParams=[],this.colors={},this.stx.deleteYAxisIfUnused(this.stx.panels[this.params.panel],this.params.yAxis),this},i.Renderer.prototype.ready=function(){return this.stx.createDataSet(),this.stx.draw(),this},i.Renderer.Lines=function(t){this.construct(t)},i.Renderer.Lines.ciqInheritsFrom(i.Renderer,!1),i.Renderer.Lines.prototype.performCalculations=function(){var t=this.params.yAxis,e=this.stx;if(t){for(var i=e.panels[this.params.panel],r=[],n=0;n<this.seriesParams.length;n++)r.push(this.seriesParams[n].field);var a=e.determineMinMax(e.chart.dataSegment,r,!1,!0);e.calculateYAxisRange(i,t,a[0],a[1])}},i.Renderer.Lines.prototype.draw=function(){var t,e=this.stx.panels[this.params.panel].chart,r={},n=this.seriesParams;for(t=0;t<n.length;t++)if(e.series[n[t].field]){var a=i.clone(e.series[n[t].field].parameters);r[n[t].field]={parameters:i.extend(i.extend(a,this.params),n[t]),yValueCache:this.caches[n[t].field]}}this.stx.drawSeries(e,r,this.params.yAxis);for(t in r)this.caches[t]=r[t].yValueCache},t},__engine_=function(t,e){Math.easeOutCubic=function(t,e,i,r){return t/=r,t--,i*(t*t*t+1)+e};var i=t.CIQ,r=t.$$,n=t.$$$,a=t.SplinePlotter,s=t.timezoneJS;return i.ChartEngine=function(t){if(t||(t={container:null}),t.constructor==HTMLDivElement){t={container:t}}if(this.markers={},this.panels={},this.overlays={},this.charts={},this.eventListeners=[],this.animations={zoom:new i.EaseMachine(Math.easeOutCubic,400)},this.callbacks={studyOverlayEdit:null,studyPanelEdit:null,tap:null,rightClick:null,longhold:null,move:null,layout:null,drawing:null,preferences:null,theme:null,symbolChange:null,symbolImport:null,calculateTradingDecimalPlaces:i.calculateTradingDecimalPlaces},this.controls={},this.goneVertical=!1,this.pinchingScreen=!1,this.grabbingScreen=!1,this.grabStartX=0,this.grabStartY=0,this.grabStartScrollX=0,this.grabStartScrollY=0,this.swipe={},this.yTolerance=100,this.minimumLeftBars=1,this.grabStartCandleWidth=0,this.grabStartZoom=0,this.grabOverrideClick=!1,this.grabMode="",this.vectorsShowing=!1,this.mouseMode=!0,this.reverseMouseWheel=!1,this.mouseWheelAcceleration=!0,this.minimumCandleWidth=1,this.minimumZoomTicks=9,this.allowZoom=!0,this.allowScroll=!0,this.allowSideswipe=!0,this.bypassRightClick=!1,this.anyHighlighted=!1,this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime(),this.displayCrosshairs=!0,this.hrPanel=null,this.editingAnnotation=!1,this.openDialog="",this.displayIconsUpDown=!0,this.displayIconsSolo=!0,this.displayIconsClose=!0,this.displayPanelResize=!0,this.soloPanelToFullScreen=!1,this.markerDelay=0,this.useBackingStore=!0,this.disableBackingStoreDuringTouch=i.isMobile,this.manageTouchAndMouse=!0,this.captureTouchEvents=!0,this.captureMouseWheelEvents=!0,this.touches=[],this.changedTouched=[],this.crosshairTick=null,this.crosshairValue=null,this.yaxisLabelStyle="roundRectArrow",this.axisBorders=null,this.pt={x1:-1,x2:-1,y1:-1,y2:-1},this.moveA=-1,this.moveB=-1,this.touchStartTime=-1,this.gestureStartDistance=-1,this.grabStartPeriodicity=1,this.grabEndPeriodicity=-1,this.scrollEvent=null,this.cmd=!1,this.ctrl=!1,this.shift=!1,this.userPointerDown=!1,this.cloneDrawing=!1,this.crosshairXOffset=-40,this.crosshairYOffset=-40,this.displayInitialized=!1,this.cx=null,this.cy=null,this.extendLastTick=!1,this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.cancelTouchSingleClick=!1,this.layout={interval:"day",periodicity:1,timeUnit:null,candleWidth:8,volumeUnderlay:!1,adj:!0,crosshair:!1,chartType:"candle",extended:!1,marketSessions:{},aggregationType:"ohlc",chartScale:"linear",studies:{},panels:{}},this.preferences={highlightsRadius:10,highlightsTapRadius:30,currentPriceLine:!1,magnet:!1,horizontalCrosshairField:null,labels:!0,language:null,timeZone:null,whitespace:50,zoomInSpeed:null,zoomOutSpeed:null,zoomAtCurrentMousePosition:!1},this.streamParameters={count:0,maxWait:1e3,maxTicks:100,timeout:-1,fillGaps:!0},this.translationCallback=null,this.locale=null,this.dataZone=null,this.displayZone=null,this.timeZoneOffset=0,this.changeCallback=null,this.masterData=null,this.transformDataSetPre=null,this.transformDataSetPost=null,this.transformMasterDataQuote=null,this.dataCallback=null,this.dontRoll=!1,this.allowEquations=!0,this.drawingObjects=[],this.undoStamps=[],this.cleanupGaps=!1,this.maxDataSetSize=2e4,this.maxMasterDataSize=0,this.resizeDetectMS=1e3,this.xAxisAsFooter=!0,this.xaxisHeight=30,this.displayGridLinesInStudies=!1,this.escapeOnSerialize=!0,this.chart=new i.ChartEngine.Chart,this.chart.name="chart",this.chart.canvas=null,this.chart.tempCanvas=null,this.chart.container=t.container,this.chart.market=new i.Market,this.candleWidthPercent=.65,this.colorByCandleDirection=!1,this.noWicksOnCandles={renko:!0,linebreak:!0},this.fetchMaximumBars={rangebars:!0,kagi:!0,renko:!0,linebreak:!0,pandf:!0},this.highLowBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,wave:!0},this.standaloneBars={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0},this.barsHaveWidth={bar:!0,colored_bar:!0,candle:!0,hollow_candle:!0,volume_candle:!0,hlc:!0,colored_hlc:!0,hlc_box:!0,hlc_shaded_box:!0,histogram:!0,scatterplot:!0,wave:!0},this.autoPickCandleWidth={turnOn:!1,candleWidth:5},this.staticRangePeriodicityMap=[{rangeInMS:i.WEEK,periodicity:1,interval:5,timeUnit:"minute"},{rangeInMS:i.MONTH,periodicity:1,interval:30,timeUnit:"minute"},{rangeInMS:i.YEAR,periodicity:1,interval:"day"},{rangeInMS:i.DECADE,periodicity:1,interval:"week"},{rangeInMS:10*i.DECADE,periodicity:1,interval:"month"},{rangeInMS:Number.MAX_VALUE,periodicity:12,interval:"month"}],this.dynamicRangePeriodicityMap=[{interval:1,timeUnit:"minute",rangeInMS:i.MINUTE},{interval:5,timeUnit:"minute",rangeInMS:5*i.MINUTE},{interval:30,timeUnit:"minute",rangeInMS:30*i.MINUTE},{interval:60,timeUnit:"minute",rangeInMS:60*i.MINUTE},{interval:"day",rangeInMS:i.DAY},{interval:"month",rangeInMS:i.MONTH},{interval:"year",rangeInMS:i.YEAR}],this.charts.chart=this.chart,this.styles={},this.currentVectorParameters=i.clone(i.ChartEngine.currentVectorParameters),i.extend(this,t),t.container&&(this.registerHTMLElements(),this.chart.width=this.chart.container.clientWidth-this.chart.yAxis.width,this.setCandleWidth(this.layout.candleWidth,this.chart),this.chart.canvasHeight=this.chart.container.clientHeight,i.useOldWheelLogic&&!i.FireFoxWheelWorkaround)){var e;e=i.isIE?function(t){if(i.ChartEngine.insideChart){t.preventDefault();for(var e=0;e<i.ChartEngine.registeredContainers.length;e++){var r=i.ChartEngine.registeredContainers[e].stx;i.ChartEngine.crosshairX>=r.left&&i.ChartEngine.crosshairX<=r.right&&i.ChartEngine.crosshairY>=r.top&&i.ChartEngine.crosshairY<=r.bottom&&r.mouseWheel(t,"onmousewheel")}}}:function(t){i.ChartEngine.insideChart&&t.preventDefault()},this.addDomEventListener(document.body,"wheel",e),i.FireFoxWheelWorkaround=!0}this.construct()},i.ChartEngine.drawingLine=!1,i.ChartEngine.resizingPanel=null,i.ChartEngine.vectorType="",i.ChartEngine.crosshairX=0,i.ChartEngine.crosshairY=0,i.ChartEngine.insideChart=!1,i.ChartEngine.overXAxis=!1,i.ChartEngine.overYAxis=!1,i.ChartEngine.currentColor="auto",i.ChartEngine.drawingTools={},i.ChartEngine.useAnimation=!0,i.ChartEngine.ipadMaxTicks=1500,i.ChartEngine.enableCaching=!1,i.ChartEngine.ignoreTouch=!1,i.ChartEngine.useOldAndroidClear=!0,i.ChartEngine.currentVectorParameters={vectorType:null,pattern:"solid",lineWidth:1,fillColor:"#7DA6F5",currentColor:"auto",axisLabel:!0,fibonacci:{trend:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},fibs:[{level:-.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:-.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:-.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:0,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.5,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:.786,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:1,color:"auto",parameters:{pattern:"solid",lineWidth:1},display:!0},{level:1.382,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:1.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1},display:!0},{level:2.618,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},{level:4.236,color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}],extendLeft:!1,printLevels:!0,printValues:!1,timezone:{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}}},annotation:{font:{style:null,size:null,weight:null,family:null}}},i.ChartEngine.defaultDisplayTimeZone=null,i.ChartEngine.Chart=function(){this.xAxis=new i.ChartEngine.XAxis,this.yAxis=new i.ChartEngine.YAxis,this.symbolObject={symbol:null},this.series={},this.seriesRenderers={},this.xaxis=[],this.state={},this.defaultChartStyleConfig={},this.baseline=i.clone(this.baseline)},i.ChartEngine.YAxis=function(t){for(var e in t)this[e]=t[e]},i.ChartEngine.XAxis=function(t){for(var e in t)this[e]=t[e]},i.ChartEngine.Panel=function(t,e){this.yAxis=e||new i.ChartEngine.YAxis,this.name=t,this.state={}},i.ChartEngine.YAxis.prototype={high:null,low:null,shadow:null,logHigh:null,logLow:null,logShadow:null,multiplier:null,bottom:null,top:null,height:null,left:null,width:null},i.ChartEngine.YAxis.prototype.maxDecimalPlaces=5,i.ChartEngine.YAxis.prototype.max=null,i.ChartEngine.YAxis.prototype.min=null,i.ChartEngine.YAxis.prototype.decimalPlaces=null,i.ChartEngine.YAxis.prototype.idealTickSizePixels=null,i.ChartEngine.YAxis.prototype.minimumPriceTick=null,i.ChartEngine.YAxis.prototype.fractional=null,i.ChartEngine.YAxis.prototype.displayBorder=!0,i.ChartEngine.YAxis.prototype.displayGridLines=!0,i.ChartEngine.YAxis.prototype.noDraw=null,i.ChartEngine.YAxis.prototype.drawCurrentPriceLabel=!0,i.ChartEngine.YAxis.prototype.drawSeriesPriceLabels=!0,i.ChartEngine.YAxis.prototype.drawPriceLabels=!0,i.ChartEngine.YAxis.prototype.goldenRatioYAxis=!0,i.ChartEngine.YAxis.prototype.yaxisLabelStyle=null,i.ChartEngine.YAxis.prototype.justifyRight=null,i.ChartEngine.YAxis.prototype.textBackground=!1,i.ChartEngine.YAxis.prototype.priceFormatter=null,i.ChartEngine.YAxis.prototype.bottomOffset=0,i.ChartEngine.YAxis.prototype.topOffset=0,i.ChartEngine.YAxis.prototype.initialMarginTop=10,i.ChartEngine.YAxis.prototype.initialMarginBottom=10,i.ChartEngine.YAxis.prototype.zoom=0,i.ChartEngine.YAxis.prototype.scroll=0,i.ChartEngine.YAxis.prototype.width=50,i.ChartEngine.YAxis.prototype.textStyle=null,i.ChartEngine.YAxis.prototype.position=null,i.ChartEngine.YAxis.defaultShadowBreaks=[[1e3,2],[1,4]],i.ChartEngine.YAxis.smallChartShadowBreaks=[[10,2],[1,4]],i.ChartEngine.YAxis.prototype.pretty=!0,i.ChartEngine.YAxis.prototype.increments=[1,2.5,5],i.ChartEngine.YAxis.prototype.prettySemiLog=!0,i.ChartEngine.YAxis.prototype.shadowBreaks=i.ChartEngine.YAxis.defaultShadowBreaks,i.ChartEngine.Panel.prototype={name:null,display:null,chart:null,yAxis:null,shareChartXAxis:null,top:null,bottom:null,height:null,percent:null},i.ChartEngine.XAxis.prototype={formatter:null,adjustTimeZone:!0,idealTickSizePixels:null,timeUnit:null,timeUnitMultiplier:null,displayBorder:!0,displayGridLines:!0,noDraw:null,minimumLabelWidth:50,futureTicks:!0,futureTicksInterval:1},i.ChartEngine.Chart.prototype={symbol:null,symbolObject:{symbol:null},symbolDisplay:null,series:{},seriesRenderers:{},scroll:0,standStill:0,maxTicks:0,tension:null,masterData:null,dataSet:null,scrubbed:null,dataSegment:null,segmentImage:null,baseline:{includeInDataSegment:!1,defaultLevel:null,userLevel:null,actualLevel:null},xAxis:null,xaxis:[],xaxisFactor:30,decimalPlaces:2,roundit:100,legendRenderer:i.drawLegend,customChart:null,yaxisPaddingRight:null,yaxisPaddingLeft:null,tickCache:{},allowScrollPast:!0,allowScrollFuture:!0,hideDrawings:!1,defaultPlotField:"Close",defaultChartStyleConfig:{},lockScroll:!1,includeOverlaysInMinMax:!0,gaplines:null,lineStyle:null,lineApproximation:!0},i.ChartEngine.prototype.convertToDataZone=function(t){if(this.dataZone){var e=i.convertTimeZone(t,null,this.dataZone);t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}return t},i.ChartEngine.isDailyInterval=function(t){return"day"==t||("week"==t||"month"==t)},i.ChartEngine.prototype.needDifferentData=function(t){var e=this.layout,r=i.ChartEngine.isDailyInterval(t.interval),n=i.ChartEngine.isDailyInterval(e.interval),a=!1;return this.dontRoll||!n?e.interval!=t.interval&&(a=!0):r!=n&&(a=!0),r||t.timeUnit||(t.timeUnit="minute"),n||e.timeUnit||(e.timeUnit="minute"),t.timeUnit!=e.timeUnit&&(a=!0),a},i.ChartEngine.chartShowsHighs=function(t){return console.warn("CIQ.ChartEngine.chartShowsHighs() has been deprecated. Please check one of the appropriate CIQ.ChartEngine instance objects for chartType property instead: stxx.highLowBars, stxx.standaloneBars, or stxx.barsHaveWidth."),1!={line:1,colored_line:1,mountain:1,colored_mountain:1,baseline_delta:1,baseline_delta_mountain:1,histogram:1,scatterplot:1,step:1,colored_step:1}[t]},i.ChartEngine.prototype.debug=function(){},i.ChartEngine.prototype.fps=function(t,e){function r(){var o=((new Date).getTime()-n)/1e3;if(o>t){var l=a/o;return console.log("FPS="+l),void(e&&e(l))}s.draw(),a++,i.ChartEngine.useAnimation?requestAnimationFrame(r):setTimeout(r,0)}t=t||5;var n=(new Date).getTime(),a=0,s=this;console.log("Running fps() for "+t+" seconds"),r()},t.STXChart=i.ChartEngine,i.ChartEngine.DrawingDescriptor={name:"",render:null,intersected:null,click:null,abort:null},i.ChartEngine.prototype.prepend=function(t,e){var r,n="prepend"+t;return this instanceof i.ChartEngine?(r=this.hasOwnProperty(n)?this[n]:[],this[n]=[e].concat(r)):(r=i.ChartEngine.prototype[n]||[],i.ChartEngine.prototype[n]=[e].concat(r)),{method:n,func:e}},i.ChartEngine.prototype.append=function(t,e){var r,n="append"+t;return this instanceof i.ChartEngine?(r=this.hasOwnProperty(n)?this[n]:[],this[n]=r.concat(e)):(r=i.ChartEngine.prototype[n]||[],i.ChartEngine.prototype[n]=r.concat(e)),{method:n,func:e}},i.ChartEngine.prototype.removeInjection=function(t){var e,r=t.method;if(this instanceof i.ChartEngine){if(!this[r])return;for(e=0;e<this[r].length;e++)if(this[r][e]==t.func)return void this[r].splice(e,1)}else{if(!i.ChartEngine.prototype[r])return;for(e=0;e<i.ChartEngine.prototype[r].length;e++)if(i.ChartEngine.prototype[r][e]==t.func)return void i.ChartEngine.prototype[r].splice(e,1)}},i.ChartEngine.prototype.remove=function(t){this instanceof i.ChartEngine?(delete this["append"+t],delete this["prepend"+t]):(delete i.ChartEngine.prototype["append"+t],delete i.ChartEngine.prototype["prepend"+t])},i.ChartEngine.registeredContainers=[],i.ChartEngine.handleContextMenu=function(t){t||(t=event);for(var e=0;e<i.ChartEngine.registeredContainers.length;e++){var r=i.ChartEngine.registeredContainers[e].stx;if(r&&r.anyHighlighted)return t.preventDefault&&t.preventDefault(),!1}},i.ChartEngine.prototype.positionMarkers=function(){},i.ChartEngine.prototype.plugins={},i.ChartEngine.htmlControls={annotationSave:'<span class="stx-btn stx_annotation_save" style="display: none;">save</span>',annotationCancel:'<span class="stx-btn stx_annotation_cancel" style="display: none; margin-left:10px;">cancel</span>',mSticky:'<div id="mSticky"> <span id="mStickyInterior"></span> <span id="mStickyRightClick" class=""><span class="overlayEdit stx-btn" style="display:none"><span>&nbsp;</span></span> <span id="overlayTrashCan" class="stx-btn" style="display:none"><span>&nbsp;</span></span> <span id="mouseDeleteInstructions"><span>(</span><span id="mouseDeleteText">right-click to delete</span><span id="mouseManageText">right-click to manage</span><span>)</span></span></span></div>',crossX:'<div class="stx_crosshair stx_crosshair_x" style="display: none;"></div>',crossY:'<div class="stx_crosshair stx_crosshair_y" style="display: none;"></div>',chartControls:'<div class="stx_chart_controls" style="display: none; bottom: 22px;"><div id="chartSize"><span id="zoomOut" class="stx-zoom-out"></span><span id="zoomIn" class="stx-zoom-in"></span></div></div>',home:'<div id="home" class="stx_jump_today home" style="display:none"><span></span></div>',floatDate:'<div class="stx-float-date" style="visibility: hidden;"></div>',handleTemplate:'<div class="stx-ico-handle" style="display: none;"><span></span></div> ',iconsTemplate:'<div class="stx-panel-control"><div class="stx-panel-title"></div><div class="stx-btn-panel"><span class="stx-ico-up"></span></div><div class="stx-btn-panel"><span class="stx-ico-focus"></span></div><div class="stx-btn-panel"><span class="stx-ico-down"></span></div><div class="stx-btn-panel"><span class="stx-ico-edit"></span></div><div class="stx-btn-panel"><span class="stx-ico-close"></span></div></div>',baselineHandle:'<div class="stx-baseline-handle" style="display: none;"></div>'},i.ChartEngine.prototype.registerHTMLElements=function(){var t=this.chart.container;for(var e in i.ChartEngine.htmlControls)if(void 0===this.chart[e]&&void 0===this.controls[e]){if(!this.allowZoom&&"chartControls"==e)continue;var r=n("#"+e,t);if(r)this.chart[e]=r,this.controls[e]=r;else{var a=i.ChartEngine.htmlControls[e],s=document.createElement("DIV");s.innerHTML=a,r=s.firstChild,t.appendChild(r),this.chart[e]=r,this.controls[e]=r,r.id=e}}if(this.controls.chartControls){var o=n("#zoomIn",this.controls.chartControls),l=n("#zoomOut",this.controls.chartControls);i.safeClickTouch(o,function(t){return function(e){t.zoomIn(e),e.stopPropagation()}}(this)),i.safeClickTouch(l,function(t){return function(e){t.zoomOut(e),e.stopPropagation()}}(this)),i.touchDevice||(this.makeModal(o),this.makeModal(l))}this.controls.home&&(i.safeClickTouch(this.controls.home,function(t){return function(e){t.home({animate:!0}),e.stopPropagation()}}(this)),i.touchDevice||this.makeModal(this.controls.home))},i.ChartEngine.prototype.makeModal=function(t){var e=this;t.onmouseover=function(t){e.modalBegin()},t.onmouseout=function(t){e.modalEnd()}},i.ChartEngine.prototype.cloneStyle=function(t){function e(t){return t[1].toUpperCase()}var r={},n=!1;for(var a in t){var s=t[a];if("backgroundAttachment"==a&&(n=!0),n)s&&s.constructor==String&&isNaN(a)&&(r[a]=s);else if(isNaN(a)){var o=a.replace(i.camelCaseRegExp,e);r[o]=s}else{var l=t.getPropertyValue(s);if(l){s=s.split("-");for(var h=0,u=s.length,c=s[0];++h<u;)c+=s[h].charAt(0).toUpperCase()+s[h].slice(1);r[c]=l}}}return r},i.ChartEngine.prototype.canvasStyle=function(t){var e=this.styles[t];if(!e){var i=document.createElement("div");i.className=t,this.container.appendChild(i);var r=getComputedStyle(i);e=this.styles[t]=this.cloneStyle(r),this.container.removeChild(i),r||(this.styles[t]=null)}return e},i.ChartEngine.prototype.colorOrStyle=function(t){return-1!=t.indexOf("#")?t:-1!=t.indexOf("(")?t:"transparent"==t?t:this.canvasStyle(t)},i.ChartEngine.prototype.clearStyles=function(){this.styles={}},i.ChartEngine.prototype.setStyle=function(t,e,r){this.styles[t]||this.canvasStyle(t),this.styles[t]||(this.styles[t]={}),this.styles[t][i.makeCamelCase(e)]=r},i.ChartEngine.prototype.canvasFont=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var r=i.fontStyle+" "+i.fontWeight+" "+i.fontSize+" "+i.fontFamily;-1==r.indexOf("undefined")?e.font=r:(this.styles[t]=null,console.log("bad css style for class "+t))}},i.ChartEngine.prototype.canvasColor=function(t,e){e||(e=this.chart.context);var i=this.canvasStyle(t);if(i){var r=i.color;r||(r=this.defaultColor),e.globalAlpha=1,e.fillStyle=r,e.strokeStyle=r;var n=i.opacity;void 0!==n&&(e.globalAlpha=n)}},i.ChartEngine.prototype.getCanvasFontSize=function(t){var e=this.canvasStyle(t),r=e.fontSize;return r||(r="12"),parseInt(i.stripPX(r),10)},i.ChartEngine.prototype.getCanvasColor=function(t){return this.canvasStyle(t).color},i.ChartEngine.hideDates=function(){return!1},i.ChartEngine.prototype.runPrepend=function(t,e,r){var n="prepend"+t,a=this.hasOwnProperty(n)?this[n]:[];if(a=a.concat(i.ChartEngine.prototype[n]||[]),!a.length)return!1;r||(r=this);for(var s=0;s<a.length;s++){var o=a[s].apply(r,e);if(o)return o}return!1},i.ChartEngine.prototype.runAppend=function(t,e,r){var n="append"+t,a=this.hasOwnProperty(n)?this[n]:[];if(a=a.concat(i.ChartEngine.prototype[n]||[]),!a.length)return!1;r||(r=this);for(var s=0;s<a.length;s++){var o=a[s].apply(r,e);if(o)return o}return!1},i.ChartEngine.registerDrawingTool=function(t,e){i.ChartEngine.drawingTools[t]=e},i.ChartEngine.prototype.createBlock=function(t,e,i,r,n,a){a||(a=this.chart.context),void 0!==r&&(this.canvasColor(n,a),a.fillRect(t,i,e,r),a.globalAlpha=1)},i.ChartEngine.prototype.changeOccurred=function(t){if(!this.currentlyImporting){this.changeCallback&&(console.warn("CIQ.ChartEngine.changeCallback has been deprecated. Please use addEventListener()"),this.changeCallback(this,t));var e={stx:this,symbol:this.chart.symbol,symbolObject:this.chart.symbolObject,layout:this.layout,drawings:this.drawingObjects};"layout"==t?this.dispatch("layout",e):"vector"==t?this.dispatch("drawing",e):"theme"==t?this.dispatch("theme",e):"preferences"==t&&this.dispatch("preferences",e)}},i.ChartEngine.prototype.setChartType=function(t){var e=this.layout,i=this.chart;"ohlc"!=e.aggregationType&&(e.aggregationType="ohlc",i.canvas&&this.createDataSet()),e.chartType=t,i.defaultChartStyleConfig={type:t},this.displayInitialized&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.setAggregationType=function(t){this.layout.chartType="candle";var e=this.chart;!1!==e.baseline.userLevel&&(e.baseline.userLevel=e.baseline.defaultLevel,e.panel.yAxis.scroll=i.ChartEngine.YAxis.prototype.scroll),this.layout.aggregationType=t,e.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},i.ChartEngine.prototype.setChartScale=function(t){var e=this.chart;if(t||(t="linear"),"percent"==t)e.isComparison||this.setComparison(!0,e);else if("percent"==this.layout.chartScale){var i=!1;for(var r in e.series)e.series[r].parameters.isComparison&&(i=!0);i||this.setComparison(!1,e)}this.layout.chartScale=t,e.canvas&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.setAdjusted=function(t){this.layout.adj=t,this.chart.canvas&&(this.createDataSet(),this.draw()),this.changeOccurred("layout")},i.ChartEngine.prototype.setVolumeUnderlay=function(t){this.layout.volumeUnderlay=t,this.chart.canvas&&this.draw(),this.changeOccurred("layout")},i.ChartEngine.prototype.serializeDrawings=function(){return console.warn("CIQ.ChartEngine.serializeDrawings() has been deprecated. Please use exportDrawings()"),this.exportDrawings()},i.ChartEngine.prototype.exportDrawings=function(){for(var t=[],e=0;e<this.drawingObjects.length;e++)t.push(this.drawingObjects[e].serialize());return t},i.ChartEngine.prototype.abortDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++)this.drawingObjects[t].abort(!0);this.drawingObjects=[]},i.ChartEngine.prototype.reconstructDrawings=function(t){console.warn("CIQ.ChartEngine.reconstructDrawings() has been deprecated. Please use importDrawings()"),this.importDrawings(t)},i.ChartEngine.prototype.importDrawings=function(t){if(i.Drawing)for(var e=0;e<t.length;e++){var r=t[e];"fibonacci"==r.name&&(r.name="retracement");var n=i.ChartEngine.drawingTools[r.name];if(n||i.Drawing[r.name]&&(n=i.Drawing[r.name],i.ChartEngine.registerDrawingTool(r.name,n)),n){var a=new n;a.reconstruct(this,r),this.drawingObjects.push(a)}}},i.ChartEngine.prototype.clearDrawings=function(t){var e=i.shallowClone(this.drawingObjects);this.abortDrawings(),t?this.undoStamps=[]:this.undoStamp(e,i.shallowClone(this.drawingObjects)),this.changeOccurred("vector"),this.cancelTouchSingleClick=!0,i.clearCanvas(this.chart.tempCanvas,this),this.draw(),this.controls.mSticky&&(this.controls.mSticky.style.display="none",this.controls.mSticky.children[0].innerHTML="")},i.ChartEngine.prototype.createDrawing=function(t,e){if(i.Drawing){var r=new i.Drawing[t];r.reconstruct(this,e);var n=new i.Drawing[t];n.stx=this,n.copyConfig();for(var a in n)r[a]=r[a]||n[a];return this.drawingObjects.push(r),this.draw(),r}},i.ChartEngine.prototype.removeDrawing=function(t){for(var e=0;e<this.drawingObjects.length;e++)if(this.drawingObjects[e]==t)return this.drawingObjects.splice(e,1),this.changeOccurred("vector"),void this.draw()},i.ChartEngine.prototype.dateFromTick=function(t,e,r){e||(e=this.chart);var n,a,s,o=e.dataSet.length,l=!1;return 0===o&&(e.dataSet[0]={},e.dataSet[0].DT=new Date,o=e.dataSet.length,l=!0),t<0?(a=this.standardMarketIterator(e.dataSet[0].DT),n=a.previous(Math.abs(t))):t>=o?(a=this.standardMarketIterator(e.dataSet[o-1].DT),n=a.next(t-(o-1))):n=e.dataSet[t].DT,s=r?new Date(n.getTime()):i.yyyymmddhhmm(n),l&&delete e.dataSet[0].DT,s},i.ChartEngine.prototype.calculateYAxisMargins=function(t){t.zoom=t.initialMarginTop+t.initialMarginBottom,t.scroll=(t.initialMarginTop-t.initialMarginBottom)/2,t.zoom>t.height&&(t.zoom=0,t.scroll=0)},i.ChartEngine.prototype.getLabelOffsetInPixels=function(t,e,i){var r=!this.standaloneBars[i];if(!("roundRectArrow"!=t.yaxisLabelStyle||r&&t.extendLastTick&&0!==e.yaxisPaddingRight)){return.66*(t.getCanvasFontSize("stx_yaxis")+6)}return 0},i.ChartEngine.prototype.home=function(t){function e(t){for(var e in t.panels)"chart"!=e&&t.calculateYAxisMargins(t.panels[e].yAxis)}this.swipe.amplitude=0,this.grabbingScreen=!1;var r=this.layout;if(i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"),"object"!=typeof t&&(t={maintainWhitespace:t}),void 0===t.maintainWhitespace&&(t.maintainWhitespace=!0),this.cancelTouchSingleClick=!0,!this.chart.dataSet||!this.chart.dataSet.length)return void this.draw();this.micropixels=0;var n=Math.floor(this.chart.width/r.candleWidth);for(var a in this.charts){var s=this.charts[a];if(!t.chart||t.chart==s){var o=0;t.maintainWhitespace&&this.preferences.whitespace>=0&&(o=this.preferences.whitespace),(t.whitespace||0===t.whitespace)&&(o=t.whitespace);var l=this.getLabelOffsetInPixels(this,s,r.chartType);l>o&&(o=l);var h=Math.min(n,s.dataSet.length);for(this.chart.allowScrollPast&&(h=n),this.micropixels=this.chart.width-h*r.candleWidth-o,this.preferences.whitespace=o;this.micropixels>r.candleWidth;)h++,this.micropixels-=r.candleWidth;for(;this.micropixels<0;)h--,this.micropixels+=r.candleWidth;if(this.micropixels-=r.candleWidth,h++,this.standaloneBars[r.chartType]||(this.micropixels+=r.candleWidth/2),t.animate){var u=this;this.scrollTo(s,h,function(t,i,r){return function(){t.calculateYAxisMargins(i.panel.yAxis),e(t),i.scroll=r,t.draw()}}(u,s,h))}else s.scroll=h,this.calculateYAxisMargins(s.panel.yAxis),e(this)}}this.draw()},i.ChartEngine.prototype.isHome=function(){var t=this.chart,e=t.dataSet;return this.pixelFromTick(e.length-1,t)<t.width},i.ChartEngine.prototype.tickFromDate=function(t,e,r,n){if(e||(e=this.chart),!e.dataSet||!e.dataSet.length)return 0;r||(r=0),e||(e=this.chart);var a=t.constructor==Date?t:i.strToDateTime(t);i.ChartEngine.isDailyInterval(this.layout.interval)||a.setMinutes(a.getMinutes()+r);var s=a.getTime(),o=e.tickCache[s];if(o||0===o)return o;var l=e.dataSet[0].DT,h=e.dataSet[e.dataSet.length-1].DT;if(a>=l&&a<=h)for(var u=0;u<e.dataSet.length;u++){var c=e.dataSet[u].DT;if(c.getTime()==a.getTime())return e.tickCache[s]=u,u;if(c>a)return e.tickCache[s]=n?u:u-1,e.tickCache[s]}var p=a<l,d=p?l:h,f=this.standardMarketIterator(d),m=f.futureTick({end:a});return o=p?-1*m:e.dataSet.length-1+m,e.tickCache[s]=o,o},i.ChartEngine.XAxisLabel=function(t,e,i){this.hz=t,this.grid=e,this.text=i},i.ChartEngine.prototype.createXAxis=function(t){if(t.dataSegment.length<=0)return null;if(i.ChartEngine.hideDates())return null;var e=[t],r=this.runPrepend("createXAxis",e);return r||(r=this.createTickXAxisWithDates(t),this.headsUpHR(),this.runAppend("createXAxis",e),r)},i.ChartEngine.prototype.adjustYAxisHeightOffset=function(t,e){e.bottomOffset=0,this.xaxisHeight||0===this.xaxisHeight||(this.xaxisHeight=this.getCanvasFontSize("stx_xaxis")+4,(this.chart.xAxis.displayBorder||this.axisBorders)&&(this.xaxisHeight+=3)),!0===this.xAxisAsFooter&&t.bottom>this.chart.canvasHeight-this.xaxisHeight?e.bottomOffset=this.xaxisHeight:!0!==this.xAxisAsFooter&&"chart"==t.name&&(e.bottomOffset=this.xaxisHeight),e.bottom=t.bottom-e.bottomOffset},i.ChartEngine.prototype.plotYAxisGrid=function(t){if(!this.runPrepend("plotYAxisGrid",arguments)){var e=this.chart.context;t.yAxis.yAxisPlotter.draw(e,"grid"),this.runAppend("plotYAxisGrid",arguments)}},i.ChartEngine.prototype.plotYAxisText=function(t){if(!this.runPrepend("plotYAxisText",arguments)){for(var e=t.yaxisLHS.concat(t.yaxisRHS),i=0;i<e.length;i++){var r=e[i];if(r.yAxisPlotter&&!r.noDraw){this.canvasFont("stx_yaxis"),this.canvasColor("stx_yaxis");var n=this.chart.context;n.textBaseline="middle",r.justifyRight?n.textAlign="right":n.textAlign="left",r.yAxisPlotter.draw(n,"text"),n.textBaseline="alphabetic",n.textAlign="left"}}this.runAppend("plotYAxisText",arguments)}},i.ChartEngine.prototype.formatYAxisPrice=function(t,e,r,n){if(null===t||void 0===t||isNaN(t))return"";var a=n||e.yAxis,s=r;if(s||0===s||(s=a.printDecimalPlaces),s||0===s||(s=a.priceTick<.01?4:a.priceTick<.1?2:a.priceTick<1?1:0),e.name!=e.chart.name&&a.priceTick>=1e3)return i.condenseInt(t);var o=this.internationalizer;if(o){var l=o.priceFormatters.length;s>=l&&(s=l-1),t=o.priceFormatters[s].format(t)
}else t=t.toFixed(s);return t},i.ChartEngine.prototype.padOutPrice=function(t,e){if(0!==t&&(!t||"number"!=typeof t))return"";e||0===e||(e=t);var i=""+e,r=i.substring(i.indexOf(".")).length-1;r=e>=1e3?Math.max(r,0):e<2?Math.max(r,4):Math.max(r,2);var n=this.internationalizer;if(n){var a=n.priceFormatters.length;r>=a&&(r=a-1),t=n.priceFormatters[r].format(t)}else t=t.toFixed(r);return t},i.ChartEngine.prototype.formatPrice=function(t,e){if(0!==t&&(!t||void 0===t))return"";if(e||(e=this.currentPanel),e||(e=this.chart.panel),!e)return t;var i=e.decimalPlaces;if(i||0===i||(i=e.chart.decimalPlaces),!i&&0!==i)return t;var r=this.internationalizer;if(r){var n=r.priceFormatters.length;i>=n&&(i=n-1),t=r.priceFormatters[i].format(t)}else t=t.toFixed(i);return t},i.ChartEngine.prototype.createCrosshairs=function(){this.runPrepend("createCrosshairs",arguments)||this.controls.crossX.onmousedown||(this.controls.crossY.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1},this.controls.crossX.onmousedown=function(t){return t||(t=event),t.preventDefault&&t.preventDefault(),!1},this.runAppend("createCrosshairs",arguments))},i.ChartEngine.prototype.determineMinMax=function(t,e,i,r,n){var a=-1*Number.MAX_VALUE,s=Number.MAX_VALUE,o=!1,l=t.length;n&&(l=n);for(var h=0;h<=l+1;h++){var u;if(u=h==l?this.getPreviousBar(this.chart,e[0],0):h==l+1?this.getNextBar(this.chart,e[0],l-1):t[h]){if(!r)if(u.transform)o=!0,u=u.transform;else if(o)continue;for(var c=0,p=0;p<e.length;p++){var d=u[e[p]];if(d){"number"==typeof d&&(d=[d]);for(var f=0;f<d.length;f++){var m=d[f];(m||0===m)&&(i?(c+=m,c>a&&(a=c),c<s&&(s=c)):(m>a&&(a=m),m<s&&(s=m)))}}}}}return a==-1*Number.MAX_VALUE&&(a=0),s==Number.MAX_VALUE&&(s=0),[s,a]},i.ChartEngine.prototype.calculateYAxisRange=function(t,e,i,r){i==Number.MAX_VALUE&&(i=0,r=0);var n=t.height,a=null,s=null;this.adjustYAxisHeightOffset(t,e),e.top=t.top,e.height=e.bottom-e.top;var o=Math.round(Math.abs(n/5));if(n-Math.abs(e.scroll)<o&&(e.scroll=(n-o)*(e.scroll<0?-1:1)),i||0===i){if(r-i==0){var l=Math.pow(10,-(i.toString()+".").split(".")[1].length);1==l&&(l=100),a=i+l,s=i-l}else if((this.layout.semiLog||"log"==this.layout.chartScale)&&a){var h=Math.log(i)/Math.LN10,u=Math.log(r)/Math.LN10;a=Math.pow(10,u),s=Math.pow(10,h)}else a=r,s=i;e.high=a,e.low=s}if((e.max||0===e.max)&&(e.high=e.max),(e.min||0===e.min)&&(e.low=e.min),e.shadow=e.high-e.low,t.chart.name===t.name&&t.yAxis===e){var c=this.layout.semiLog||"log"==this.layout.chartScale;(t.chart.isComparison||"pandf"==this.layout.aggregationType)&&(c=!1),e.semiLog!=c&&(this.clearPixelCache(),e.semiLog=c)}},i.ChartEngine.prototype.renderYAxis=function(t){if(!this.runPrepend("renderYAxis",arguments)){var e,i=t.panel,r=i.yaxisRHS.concat(i.yaxisLHS);for(e=0;e<r.length;e++){var n=r[e],a=null,s=null;i.yAxis===n&&(a=t.lowValue,s=t.highValue),this.calculateYAxisRange(i,n,a,s)}var o={};for(e=0;e<r.length;e++)o.yAxis=r[e],this.createYAxis(i,o),this.drawYAxis(i,o);this.runAppend("renderYAxis",arguments)}},i.ChartEngine.prototype.initializeDisplay=function(t){if(!this.runPrepend("initializeDisplay",arguments)){var e=[];for(var i in t.series)t.series[i].parameters.shareYAxis&&e.push(i);if(t.panel=this.panels[t.name],t.includeOverlaysInMinMax)for(var r in this.overlays){var n=this.overlays[r];if(n.panel==t.name)for(var a in n.outputMap)e.push(a)}var s,o=null,l=Math.floor((t.width-this.micropixels)/this.layout.candleWidth);if(t.scroll>t.maxTicks&&t.maxTicks>l+1&&(o=t.dataSegment.length-1),this.highLowBars[this.layout.chartType])e.push("Close","Open","High","Low"),s=this.determineMinMax(t.dataSegment,e,null,!this.chart.transformFunc,o);else{var h=this.chart.defaultPlotField||"Close";if(e.push(h),s=this.determineMinMax(t.dataSegment,e,null,!t.transformFunc,o),"baseline_delta"==this.layout.chartType){var u=t.baseline.actualLevel;if(u||0===u){t.transformFunc&&(u=t.transformFunc(this,t,u));var c=Math.max(u-s[0],s[1]-u);this.repositioningBaseline?s=[t.lowValue,t.highValue]:(s[0]=u-c,s[1]=u+c)}}}t.lowValue=s[0],t.highValue=s[1];var p=t.state.aggregation;p&&p.box&&(t.lowValue-=p.box/2,t.highValue+=p.box/2),this.runAppend("initializeDisplay",arguments)}},i.ChartEngine.prototype.computePosition=function(t,e){return void 0===e&&(e=0),t*this.layout.candleWidth+e+this.micropixels},i.ChartEngine.prototype.computeColor=function(t,e){return t<e?"stx_candle_up":t>e?"stx_candle_down":"stx_candle_shadow"},i.ChartEngine.prototype.computeLength=function(t,e){var i=this.pixelFromPrice(t);return this.pixelFromPrice(e)-i},i.ChartEngine.prototype.setSeriesRenderer=function(t){var e=t.params;return this.chart.seriesRenderers[t.params.name]?this.chart.seriesRenderers[t.params.name]:(e.yAxis&&this.addYAxis(this.panels[e.panel],e.yAxis),t.stx=this,this.chart.seriesRenderers[t.params.name]=t,t)},i.ChartEngine.prototype.setMarket=function(t,e){e||(e=this.chart),e.market=new i.Market(t);for(var r in this.layout.marketSessions)e.market.disableSession(r,this.layout.marketSessions[r])},i.ChartEngine.prototype.setMarketFactory=function(t){this.marketFactory=t},i.ChartEngine.prototype.removeSeriesRenderer=function(t){for(var e in this.chart.seriesRenderers)if(t.params.name===this.chart.seriesRenderers[e].params.name){var i=this.chart.seriesRenderers[t.params.name],r=i.params.yAxis,n=this.panels[i.params.panel];return delete this.chart.seriesRenderers[t.params.name],void this.deleteYAxisIfUnused(n,r)}},i.ChartEngine.prototype.getSeriesRenderer=function(t){return this.chart.seriesRenderers[t]},i.ChartEngine.prototype.startClip=function(t,e){t||(t="chart");var i=this.panels[t],r=i.yAxis;this.chart.context.save(),this.chart.context.beginPath();var n=i.left,a=i.width;e&&(n=0,a=this.width),this.chart.context.rect(n,i.top,a,r.height),this.chart.context.clip()},i.ChartEngine.prototype.endClip=function(){this.chart.context.restore()},i.ChartEngine.prototype.setLineStyle=function(t,e){var r={};t&&"object"==typeof t?r=t:r.color=t,r.color||r.pattern||r.width||(r=null),e||(e=this.chart);var n=1;r&&r.width&&(n=r.width),r&&r.pattern&&(r.pattern=i.borderPatternToArray(n,r.pattern)),e.lineStyle=r},i.ChartEngine.prototype.setGapLines=function(t,e){var r={};t&&"object"==typeof t?r=t:r.color=t,r.color||r.pattern||r.fillMountain||(r=null),e||(e=this.chart),r&&r.pattern&&(r.pattern=i.borderPatternToArray(r.pattern)),e.gaplines=r},i.ChartEngine.prototype.getGapColorFunction=function(t,e,i,r,n){return function(a,s,o){var l=n?n(a,s,o):e;return l.color&&(l=l.color),o||!s[t]&&0!==s[t]?r?("object"!=typeof r&&(r="string"==typeof r?{color:r}:{}),{color:r.color||l,pattern:r.pattern||i}):null:{color:l,pattern:i}}},i.ChartEngine.prototype.drawLineChart=function(t,e,r,n){var a=r,s=this.chart,o=s.context,l=s.lineStyle||{},h=this.canvasStyle(e);this.startClip(t.name);var u=l.width||h.width;u&&parseInt(u,10)<=25?o.lineWidth=Math.max(1,i.stripPX(u)):o.lineWidth=1,n||(n={});var c=n.pattern||l.pattern||h.borderTopStyle;c=i.borderPatternToArray(o.lineWidth,c),o.setLineDash(c),o.lineDashOffset=0,this.canvasColor(e),l.color&&(o.strokeStyle=l.color),n.skipProjections=!0;var p=t.chart.defaultPlotField,d=n.gaps;d||(d=s.gaplines),d&&(a=this.getGapColorFunction(p,o.strokeStyle,c,d,r)),t.chart.tension&&(n.tension=t.chart.tension);var f=this.plotDataSegmentAsLine(p,t,n,a);return o.lineWidth=1,this.endClip(),f.colors},i.ChartEngine.prototype.getPreviousBar=function(t,e,i){return this.getNextBarInternal(t,e,i,-1)},i.ChartEngine.prototype.getNextBar=function(t,e,i){return this.getNextBarInternal(t,e,i,1)},i.ChartEngine.prototype.getNextBarInternal=function(t,e,i,r){var n=t.dataSegment&&t.dataSegment[i];if(n)for(var a=n.tick;a>0&&a<t.dataSet.length-1;){a+=r;var s=t.dataSet[a];if(s&&s[e])return s}return null},i.ChartEngine.prototype.updateFloatHRLabel=function(t){var e=t.yaxisLHS.concat(t.yaxisRHS),r=this.crossYActualPos?this.crossYActualPos:this.cy;if(this.floatCanvas.isDirty&&i.clearCanvas(this.floatCanvas,this),"none"!=this.controls.crossX.style.display){if(this.controls.crossY){var n=t.width;"roundRectArrow"==this.yaxisLabelStyle&&(n-=7),this.controls.crossY.style.left=t.left+"px",this.controls.crossY.style.width=n+"px"}for(var a=0;a<e.length;a++){var s=e[a],o=this.transformedPriceFromPixel(r,t,s);if(!isNaN(o)&&!((t.min||0===t.min)&&o<t.min||(t.max||0===t.max)&&o>t.max)){var l=null;s!==t.chart.yAxis&&(l=0,s.shadow<1e3&&(l=2),s.shadow<5&&(l=4),(s.decimalPlaces||0===s.decimalPlaces)&&(l=s.decimalPlaces)),o=s.priceFormatter?s.priceFormatter(this,t,o):this.formatYAxisPrice(o,t,l,s);var h=this.canvasStyle("stx-float-price");this.createYAxisLabel(t,o,r,h.backgroundColor,h.color,this.floatCanvas.context,s),this.floatCanvas.isDirty=!0}}}},i.ChartEngine.prototype.headsUpHR=function(){function t(t){i.efficientDOMUpdate(n,"innerHTML",t)}if(!this.runPrepend("headsUpHR",arguments)){var e=this.currentPanel;if(e){var r=e.chart;this.updateFloatHRLabel(e);var n=this.controls.floatDate;if(n&&!i.ChartEngine.hideDates()){var a=this.barFromPixel(this.cx),s=r.xaxis[a];t(s&&s.DT?i.displayableDate(this,r,s.DT):s&&s.index?s.index:"")}this.runAppend("headsUpHR",arguments)}}},i.ChartEngine.prototype.setCrosshairColors=function(){},i.ChartEngine.prototype.magnetize=function(){if(this.magnetizedPrice=null,!this.runPrepend("magnetize",arguments)){var t=this.currentVectorParameters.vectorType;if(("annotation"!=t&&"callout"!=t||!i.ChartEngine.drawingLine)&&"projection"!=t&&"freeform"!=t){var e=this.currentPanel;if(e.name==e.chart.name){var r=e.chart,n=this.tickFromPixel(i.ChartEngine.crosshairX-this.left,r);if(n>r.dataSet.length)return;var a=r.dataSet[n];if(!a)return;var s=this.valueFromPixel(this.cy,e);this.magnetizedPrice=a.Close;var o=this.layout.chartType;if("bar"==o||"candle"==o||"colored_bar"==o||"hollow_candle"==o||"volume_candle"==o)for(var l=["Open","High","Low","Close"],h=1e9,u=0;u<l.length;u++){var c=a[l[u]];Math.abs(s-c)<h&&(h=Math.abs(s-c),this.magnetizedPrice=c)}var p=this.pixelFromTick(n,r),d=this.pixelFromPrice(this.magnetizedPrice,this.currentPanel),f=this.chart.tempCanvas.context;f.beginPath(),f.lineWidth=1;var m=Math.max(this.layout.candleWidth,12)/3;f.arc(p,d,Math.min(m,8),0,2*Math.PI,!1),f.fillStyle="#FFFFFF",f.strokeStyle="#000000",f.fill(),f.stroke(),f.closePath()}this.runAppend("magnetize",arguments)}}},i.ChartEngine.prototype.positionCrosshairsAtPointer=function(){var t=this.currentPanel;if(t&&!this.runPrepend("positionCrosshairsAtPointer",arguments)){var e=t.chart,r=this.container.getBoundingClientRect();this.top=r.top,this.left=r.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cy=this.crossYActualPos=this.backOutY(i.ChartEngine.crosshairY),this.cx=this.backOutX(i.ChartEngine.crosshairX);var n=this.crosshairTick=this.tickFromPixel(this.cx,e),a=this.pixelFromTick(n,e)-.5;if(this.controls.crossX.style.left=a+"px",a>=t.right||a<=t.left)return void this.undisplayCrosshairs();var s="chart"==t.name?this.preferences.horizontalCrosshairField:t.horizontalCrosshairField,o=e.dataSet;s&&o&&n<o.length&&n>-1&&(this.crossYActualPos=this.pixelFromPrice(o[n][s],t)),this.controls.crossY.style.top=this.crossYActualPos+"px",this.runAppend("positionCrosshairsAtPointer",arguments)}},i.ChartEngine.prototype.doDisplayCrosshairs=function(){if(!this.runPrepend("doDisplayCrosshairs",arguments)){if(this.displayInitialized){var t=this.floatCanvas,e=this.currentVectorParameters.vectorType;if(this.layout.crosshair||""!==e&&e)if(i.Drawing&&i.Drawing[e]&&(new i.Drawing[e]).dragToDraw)this.undisplayCrosshairs();else{var r=this.controls,n=r.crossX,a=r.crossY;""!==n.style.display&&(n.style.display="",a.style.display="",this.preferences.magnet&&e?(i.unappendClassName(this.container,"stx-crosshair-on"),this.chart.tempCanvas.style.display="block"):i.appendClassName(this.container,"stx-crosshair-on")),r.floatDate&&!i.ChartEngine.hideDates()&&(r.floatDate.style.visibility="",this.currentPanel&&this.updateFloatHRLabel(this.currentPanel)),t&&(t.style.display="block")}else this.undisplayCrosshairs()}this.runAppend("doDisplayCrosshairs",arguments)}},i.ChartEngine.prototype.undisplayCrosshairs=function(){if(!this.runPrepend("undisplayCrosshairs",arguments)){var t=this.controls,e=t.crossX,r=t.crossY;e&&"none"!=e.style.display&&(e.style.display="none",r.style.display="none"),this.displayInitialized&&t.floatDate&&(t.floatDate.style.visibility="hidden"),i.unappendClassName(this.container,"stx-crosshair-on");var n=this.floatCanvas;if(n&&n.isDirty&&(i.clearCanvas(n,this),"none"!=n.style.display&&(n.style.display="none")),!this.activeDrawing&&!this.repositioningDrawing&&!this.editingAnnotation){var a=this.chart.tempCanvas;a&&"none"!=a.style.display&&(a.style.display="none")}this.runAppend("undisplayCrosshairs",arguments)}},i.ChartEngine.prototype.modalBegin=function(){this.openDialog="modal",this.undisplayCrosshairs()},i.ChartEngine.prototype.modalEnd=function(){this.cancelTouchSingleClick=!0,this.openDialog="",this.doDisplayCrosshairs()},i.ChartEngine.prototype.updateChartAccessories=function(){if(null!==this.accessoryTimer&&clearTimeout(this.accessoryTimer),!i.ChartEngine.drawingLine&&i.touchDevice&&(new Date).getTime()-this.lastAccessoryUpdate<100)return void(this.accessoryTimer=setTimeout(function(t){return function(){t.updateChartAccessories()}}(this),10));if(this.chart.dataSet&&!this.runPrepend("updateChartAccessories",arguments)){this.positionCrosshairsAtPointer(),this.accessoryTimer=null,this.lastAccessoryUpdate=(new Date).getTime();var t=this.controls.floatDate;if(t){var e=this.currentPanel;if(e||(e=this.chart.panel),e){var r=e.chart,n=!0===this.xAxisAsFooter?0:this.chart.canvasHeight-e.chart.bottom,a=this.pixelFromTick(this.crosshairTick,r)-t.offsetWidth/2-.5;a<0&&(a=0),i.efficientDOMUpdate(t.style,"left",a+"px"),i.efficientDOMUpdate(t.style,"bottom",n+"px")}}this.headsUpHR(),this.runAppend("updateChartAccessories",arguments)}},i.ChartEngine.prototype.mousemove=function(t){var e=t||event;i.ChartEngine.crosshairX=e.clientX,i.ChartEngine.crosshairY=e.clientY,this.runPrepend("mousemove",arguments)||this.displayInitialized&&""===this.openDialog&&(this.mousemoveinner(e.clientX,e.clientY),this.runAppend("mousemove",arguments))},i.ChartEngine.prototype.setResizeTimer=function(t){this.resizeDetectMS=t,t?(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),this.resizeTimeout=window.setInterval(function(t){return function(){t.chart.canvas&&(i.isAndroid||t.chart.canvas.height==Math.floor(t.devicePixelRatio*t.chart.container.clientHeight)&&t.chart.canvas.width==Math.floor(t.devicePixelRatio*t.chart.container.clientWidth)||t.resizeChart())}}(this),t)):(this.resizeTimeout&&window.clearInterval(this.resizeTimeout),this.resizeTimeout=null)},i.ChartEngine.prototype.whichYAxis=function(t,e){if(void 0===e&&(e=this.cx),t)for(var i=t.yaxisLHS.concat(t.yaxisRHS),r=0;r<i.length;r++){var n=i[r];if(n.left<=e&&n.left+n.width>=e)return n}return this.chart.panel.yAxis},i.ChartEngine.prototype.findHighlights=function(t,e){function r(t,e,r,n){function a(t){return t?s.transformFunc&&n==s.yAxis?t.transform&&t.transform[r]?t.transform[r]:s.transformFunc(this,s,t[r]):t[r]:null}var s=this.chart,o=this.currentPanel;n||(n=s.yAxis);var l=s.dataSegment[S],h=this.getPreviousBar.call(this,s,r,S),u=this.getNextBar.call(this,s,r,S);if(!h&&!u)return!1;var c=a(l),p=a(h),d=a(u);if(p||0===p||(p=0,h=s.dataSet[0]),d||0===d||(d=c||0===c?c:p,u=s.dataSet[s.dataSet.length-1]),c||0===c||(c=d,l=u),o.name==s.name){var f=this.pixelFromTransformedValue.bind(this),m=this.valueFromPixel.bind(this);c=m(f(c,o,n),o),p=m(f(p,o,n),o),d=m(f(d,o,n),o)}return!(!i.boxIntersects(e.x0,e.y0,e.x1,e.y1,h.tick,p,l.tick,c,"segment")&&!i.boxIntersects(e.x0,e.y0,e.x1,e.y1,l.tick,c,u.tick,d,"segment"))}var n=this.preferences.highlightsRadius;t&&(n=this.preferences.highlightsTapRadius);var a=this.cy,s=this.cx;if(this.anyHighlighted=!1,this.currentPanel){this.preferences.magnet&&!this.activeDrawing&&i.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing&&(e=!0);var o=!1,l=null,h=e?null:["","",!0,null,"drawing"],u=this.currentPanel.chart,c={x0:this.tickFromPixel(s-n,u),x1:this.tickFromPixel(s+n,u),y0:this.valueFromPixel(a-n,this.currentPanel),y1:this.valueFromPixel(a+n,this.currentPanel)};this.repositioningDrawing&&c.x1-c.x0<2?(c.x1++,c.x0--):c.x1==c.x0&&(c.x0-=.5,c.x1+=.5);for(var p=0;p<this.drawingObjects.length;p++){var d=this.drawingObjects[p];if(!d.permanent&&(this.panels[d.panelName]&&(!this.repositioningDrawing||this.repositioningDrawing==d))){var f=d.highlighted,m=d.panelName==this.currentPanel.name;d.repositioner=d.intersected(this.crosshairTick,this.crosshairValue,c),m=m&&d.repositioner,!e&&m?(f?l=d:f!=d.highlight(!0)&&(l||(l=d),o=!0),this.anyHighlighted=!0):f!=d.highlight(!1)&&(o=!0)}}var g,v,y;for(g in this.overlays)v=this.overlays[g],v.prev=v.highlight,v.highlight=!1;for(g in u.seriesRenderers)for(var x=u.seriesRenderers[g],C=0;C<x.seriesParams.length;C++)y=x.seriesParams[C],y.prev=y.highlight,y.highlight=!1;if(!e){var S=this.barFromPixel(s);if(S<u.dataSegment.length){var w;for(g in this.overlays)if(v=this.overlays[g],v.panel==this.currentPanel.name&&!1!==v.study.isHighlighted)if("function"!=typeof v.study.isHighlighted){var D=u.dataSegment[S];if(D){for(var b in v.outputMap)if(r.call(this,S,c,b,this.panels[v.panel].yAxis)){v.highlight=!0,this.anyHighlighted=!0;break}if(v.highlight)break}}else v.study.isHighlighted(this,s,a)&&(v.highlight=!0,this.anyHighlighted=!0);for(g in u.seriesRenderers){var T=u.seriesRenderers[g];if(T.params.highlightable&&T.params.panel==this.currentPanel.name)for(var M=0;M<T.seriesParams.length;M++)if(y=T.seriesParams[M],("step"==T.params.subtype||"step"==y.type)&&S>0){if(!T.caches[y.field])continue;if(!(w=T.caches[y.field][S])&&0!==w)continue;var k=T.caches[y.field][S-1];((k||0===k)&&a+n>=w&&a-n<=k||a-n<=w&&a+n>=k)&&(y.highlight=!0,this.anyHighlighted=!0)}else r.call(this,S,c,y.field,T.params.yAxis)&&(y.highlight=!0,this.anyHighlighted=!0)}}}for(g in this.overlays){if(v=this.overlays[g],v.highlight){this.anyHighlighted=!0;var A=v.inputs.display||v.name;A=this.translateIf(A),h=[A,null,null,v.permanent,"study"],l=null}v.prev!=v.highlight&&(o=!0)}for(g in u.seriesRenderers){var P=u.seriesRenderers[g];if(P.params.highlightable)for(var _=0;_<P.seriesParams.length;_++)y=P.seriesParams[_],y.highlight&&(this.anyHighlighted=!0,h=[y.display?y.display:y.symbol,y.color,!1,y.permanent,"series"],l=null),y.prev!=y.highlight&&(o=!0)}o&&(this.draw(),this.displaySticky.apply(this,this.anyHighlighted?h:null),this.clearMeasure(),l&&l.measure()),this.anyHighlighted||this.setMeasure()}},i.ChartEngine.prototype.positionSticky=function(t){var e=Math.max(this.cy-t.offsetHeight-60,0),i=Math.min(this.chart.canvasWidth-(this.cx-50),this.chart.canvasWidth-t.offsetWidth);t.style.top=e+"px",t.style.right=i+"px"},i.ChartEngine.prototype.displaySticky=function(t,e,r,a,s){var o=this.controls.mSticky;if(o){var l=n("#mStickyInterior",o);if(l){var h=n("#overlayTrashCan",o),u=n(".overlayEdit",o),c=n("#mouseDeleteInstructions",o);r||t?(t||(t=""),r&&!t?(l.style.backgroundColor="",l.style.color="",l.style.display="none"):e?(l.style.backgroundColor=e,l.style.color=i.chooseForegroundColor(e),l.style.display="inline-block"):(l.style.backgroundColor="",l.style.color="",l.style.display="inline-block"),l.innerHTML=t,s&&(n("#mStickyRightClick",o).className="rightclick_"+s),o.style.display="inline-block",this.positionSticky(o),a||this.bypassRightClick?this.controls.mSticky.style.display="none":i.touchDevice?(h&&(h.style.display="inline-block"),u&&(u.style.display="inline-block"),c&&(c.style.display="none")):c&&(c.style.display="block")):(l.innerHTML="",o.style.display="none",i.touchDevice?(h&&(h.style.display="none"),u&&(u.style.display="none")):i.touchDevice||c&&(c.style.display="none"))}}},i.ChartEngine.prototype.setMeasure=function(t,e,i,n,a){if(!this.runPrepend("setMeasure",arguments)){var s=r("mMeasure"),o="";if(t){var l=Math.round(Math.abs(t-e)*this.chart.roundit)/this.chart.roundit;l=l.toFixed(this.chart.yAxis.printDecimalPlaces),this.internationalizer?o+=this.internationalizer.numbers.format(l):o+=l;var h=(e-t)/t;h=Math.abs(h)>.1?Math.round(100*h):Math.abs(h)>.01?Math.round(1e3*h)/10:Math.round(1e4*h)/100,this.internationalizer?h=this.internationalizer.percent.format(h/100):h+="%",o+=" ("+h+")";var u=Math.abs(n-i);u=Math.round(u)+1;o+=" "+u+" "+this.translateIf("Bars"),s&&("measureLit"!=s.className&&(s.className="measureLit"),s.innerHTML=o)}else s&&"measureUnlit"!=s.className&&(s.className="measureUnlit"),this.anyHighlighted||""!==this.currentVectorParameters.vectorType||this.clearMeasure();this.activeDrawing||(s=this.controls.mSticky,s&&(a?(s.style.display="inline-block",s.children[0].style.display="inline-block",t&&(s.children[0].innerHTML=o),this.positionSticky(s)):(s.style.display="none",s.children[0].innerHTML="")),this.runAppend("setMeasure",arguments))}},i.ChartEngine.prototype.clearMeasure=function(){var t=r("mMeasure");t&&("measureUnlit"!=t.className&&(t.className="measureUnlit"),t.innerHTML="")},i.ChartEngine.prototype.pixelFromBar=function(t,e){e||(e=this.chart);var i=0,r=this.chart.segmentImage;return i=r&&r[t]&&r[t].leftOffset?r[t].leftOffset:(t+.5)*this.layout.candleWidth,i=e.panel.left+Math.floor(i+this.micropixels)-1},i.ChartEngine.prototype.barFromPixel=function(t,e){e||(e=this.chart);var i=this.chart.segmentImage,r=this.micropixels,n=this.layout.candleWidth;if(i){var a,s,o,l=t-e.panel.left-r,h=2,u=i.length,c=Math.round(u/h),p=i[u-1].leftOffset+i[u-1].candleWidth/2;if(l>p)return u+Math.floor((t-p-e.panel.left-r)/n);for(var d=1;d<u&&(h*=2,a=i[c]);d++){s=a.leftOffset,o=a.candleWidth/2;var f=s-o,m=s+o;if(0===c||l>=f&&l<m)break;l<f?c-=Math.max(1,Math.round(u/h)):c+=Math.max(1,Math.round(u/h)),c=Math.max(0,Math.min(u-1,c))}if(!i[c])for(d=0;d<u;d++)if(a=i[d]){if(s=a.leftOffset,o=a.candleWidth/2,l<s-o)return Math.max(0,d-1);if(l<s+o)return d;if(l>=s+o)return d+1}return c}return Math.floor((t-e.panel.left-r)/n)},i.ChartEngine.prototype.tickFromPixel=function(t,e){e||(e=this.chart);var i=e.dataSet.length-e.scroll;return e.segmentImage?i+=this.barFromPixel(t,e):i+=Math.floor((t-e.panel.left-this.micropixels)/this.layout.candleWidth),i},i.ChartEngine.prototype.pixelFromTick=function(t,e){e||(e=this.chart);var i=e.dataSegment,r=e.dataSet,n=e.segmentImage,a=this.micropixels,s=i?i.length:0,o=e.panel,l=e.scroll,h=t-r.length+l,u=s?i[h]:null;if(n&&(u=n[h]),u&&u.leftOffset)return o.left+Math.floor(u.leftOffset+a);var c=0,p=0;return u=s?i[s-1]:null,n&&(u=n[s-1]),u&&u.leftOffset&&s<t-r.length+l&&(c=u.leftOffset-u.candleWidth/2,p=s),c+o.left+Math.floor((t-p-r.length+l+.5)*this.layout.candleWidth+a)},i.ChartEngine.prototype.pixelFromDate=function(t,e){return this.pixelFromTick(this.tickFromDate(t,e),e)},i.ChartEngine.prototype.transformedPriceFromPixel=function(t,e,i){e||(e=this.chart.panel);var r=i||e.yAxis;if(t=r.bottom-t,!r.multiplier)return null;var n=r.low+t/r.multiplier;if(r.semiLog){var a=r.logLow+t*r.logShadow/r.height;n=Math.pow(10,a)}return n},i.ChartEngine.prototype.priceFromPixel=function(t,e,i){e||(e=this.chart.panel);var r=this.transformedPriceFromPixel(t,e,i);return this.charts[e.name]&&e.chart.untransformFunc&&(r=e.chart.untransformFunc(this,e.chart,r,i)),r},i.ChartEngine.prototype.valueFromPixel=function(t,e,r){return e||(e=this.whichPanel(t)),e||(e=t<=0?this.panels[i.first(this.panels)]:this.panels[i.last(this.panels)]),this.priceFromPixel(t,e,r)},i.ChartEngine.prototype.valueFromPixelUntransform=function(t,e,i){return this.valueFromPixel(t,e,i)},i.ChartEngine.prototype.pixelFromPriceTransform=function(t,e,i){return this.pixelFromPrice(t,e,i)},i.ChartEngine.prototype.pixelFromTransformedValue=function(t,e,i){e||(e=this.chart.panel);var r=i||e.yAxis,n=(r.high-t)*r.multiplier;if(r.semiLog){var a=Math.max(t,0),s=Math.log(a)/Math.LN10,o=r.height;n=o-o*(s-r.logLow)/r.logShadow}return n+=r.top},i.ChartEngine.prototype.pixelFromPrice=function(t,e,i){return e||(e=this.chart.panel),this.charts[e.name]&&e.chart.transformFunc&&(t=e.chart.transformFunc(this,e.chart,t,i)),this.pixelFromTransformedValue(t,e,i)},i.ChartEngine.prototype.pixelFromValueAdjusted=function(t,e,i,r){if(this.layout.adj||!this.charts[t.name])return this.pixelFromPrice(i,t,r);var n,a=Math.round(e);return a>0&&a<t.chart.dataSet.length&&(n=t.chart.dataSet[a].ratio)?this.pixelFromPrice(i*n,t,r):this.pixelFromPrice(i,t,r)},i.ChartEngine.prototype.adjustIfNecessary=function(t,e,i){if(this.layout.adj)return i;if(!t||!this.charts[t.name])return i;var r,n=Math.round(e);return n>0&&n<t.chart.dataSet.length&&(r=t.chart.dataSet[n].ratio)?i/r:i},i.ChartEngine.prototype.setTransform=function(t,e,i){t.transformFunc=e,t.untransformFunc=i},i.ChartEngine.prototype.unsetTransform=function(t){delete t.transformFunc,delete t.untransformFunc;for(var e=0;e<t.dataSet.length;e++)t.dataSet[e].transform=null},i.ChartEngine.prototype.undo=function(){this.runPrepend("undo",arguments)||(this.activeDrawing&&(this.activeDrawing.abort(),this.activateDrawing(null),i.clearCanvas(this.chart.tempCanvas,this),this.draw(),i.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),i.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing"),i.ChartEngine.drawingLine=!1),this.runAppend("undo",arguments))},i.ChartEngine.prototype.undoStamp=function(t,e){this.undoStamps.push(t),this.dispatch("undoStamp",{before:t,after:e,stx:this})},i.ChartEngine.prototype.undoLast=function(){this.activeDrawing?this.undo():this.undoStamps.length&&(this.drawingObjects=this.undoStamps.pop(),this.changeOccurred("vector"),this.draw())},i.ChartEngine.prototype.addDrawing=function(t){var e=i.shallowClone(this.drawingObjects);this.drawingObjects.push(t),this.undoStamp(e,i.shallowClone(this.drawingObjects))},i.ChartEngine.prototype.connectTheDots=function(t,e,r,n,a,s){if(s||(s={}),"none"!=s.pattern&&(!0===a&&(a=this.chart.panel),null!==n&&void 0!==n||(n=this.chart.context),!(t.length<4))){var o=0,l=this.chart.canvasHeight,h=this.chart.width;a&&(l=a.yAxis.bottom,o=a.yAxis.top),n.lineWidth=1.1,"object"==typeof e?(n.strokeStyle=e.color,e.opacity?n.globalAlpha=e.opacity:n.globalAlpha=1,n.lineWidth=parseInt(i.stripPX(e.width),10)):!e||"auto"==e||i.isTransparent(e)?n.strokeStyle=this.defaultColor:n.strokeStyle=e,s.opacity&&(n.globalAlpha=s.opacity),s.lineWidth&&(n.lineWidth=s.lineWidth);var u=i.borderPatternToArray(n.lineWidth,s.pattern);n.beginPath();for(var c=0;c<t.length-2;c+=2){var p=t[c],d=t[c+1],f=t[c+2],m=t[c+3];if(isNaN(p)||isNaN(f)||isNaN(d)||isNaN(m))return;for(var g,v,y,x=0,C=1,S=f-p,w=m-d,D=0;D<4;D++){if(0===D&&(g=-S,v=-(0-p)),1==D&&(g=S,v=h-p),2==D&&(g=-w,v=-(o-d)),3==D&&(g=w,v=l-d),y=v/g,(m||0===m)&&0===g&&v<0)return!1;if(g<0){if(y>C)return!1;y>x&&(x=y)}else if(g>0){if(y<x)return!1;y<C&&(C=y)}}var b=p+x*S,T=d+x*w,M=p+C*S,k=d+C*w;try{u&&u.length?n.dashedLineTo(b,T,M,k,u):(n.moveTo(b,T),n.lineTo(M,k))}catch(t){}}n.stroke(),n.closePath(),n.globalAlpha=1,n.lineWidth=1}},i.ChartEngine.prototype.plotSpline=function(t,e,r,n,s,o,l){if(l||(l={}),"none"!=l.pattern){!0===o&&(o=this.chart.panel),null!==s&&void 0!==s||(s=this.chart.context),s.save(),s.lineWidth=1.1,"object"==typeof r?(s.strokeStyle=r.color,r.opacity?s.globalAlpha=r.opacity:s.globalAlpha=1,s.lineWidth=parseInt(i.stripPX(r.width),10)):!r||"auto"==r||i.isTransparent(r)?s.strokeStyle=this.defaultColor:s.strokeStyle=r,l.opacity&&(s.globalAlpha=l.opacity),l.lineWidth&&(s.lineWidth=l.lineWidth);var h=i.borderPatternToArray(s.lineWidth,l.pattern);l.pattern&&s.setLineDash&&(s.setLineDash(h),s.lineDashOffset=0),s.beginPath(),a.plotSpline(t,e,s),s.stroke(),s.closePath(),s.restore()}},i.ChartEngine.prototype.repositionDrawing=function(t){var e=this.panels[t.panelName],r=this.adjustIfNecessary(e,this.crosshairTick,this.valueFromPixel(this.backOutY(i.ChartEngine.crosshairY),e));this.preferences.magnet&&this.magnetizedPrice&&e.name==e.chart.name&&(r=this.adjustIfNecessary(e,this.crosshairTick,this.magnetizedPrice));var n=this.chart.tempCanvas;i.clearCanvas(n,this),t.reposition(n.context,t.repositioner,this.crosshairTick,r),t.measure&&t.measure()},i.ChartEngine.prototype.activateRepositioning=function(t){this.repositioningDrawing=t;t&&(this.draw(),this.repositionDrawing(t)),this.chart.tempCanvas.style.display=t?"block":"none"},i.ChartEngine.prototype.activateDrawing=function(t,e){if(!t)return this.activeDrawing=null,this.chart.tempCanvas.style.display="none",!1;e||(e=this.chart.panel);var r=i.ChartEngine.drawingTools[t];return r||i.Drawing[t]&&(r=i.Drawing[t],i.ChartEngine.registerDrawingTool(t,r)),r&&(this.activeDrawing=new r,this.activeDrawing.construct(this,e),!this.charts[e.name]&&this.activeDrawing.chartsOnly)?(this.activeDrawing=null,!1):(this.chart.tempCanvas.style.display="block",!0)},i.ChartEngine.prototype.drawingClick=function(t,e,r){if(i.Drawing){if(!this.activeDrawing){if(!t)return;if(!this.activateDrawing(this.currentVectorParameters.vectorType,t))return}if(this.activeDrawing){if(this.userPointerDown&&!this.activeDrawing.dragToDraw)return void(i.ChartEngine.drawingLine||this.activateDrawing(null));var n=this.tickFromPixel(e,t.chart),a=this.panels[this.activeDrawing.panelName],s=this.adjustIfNecessary(a,n,this.valueFromPixel(r,a));return this.preferences.magnet&&this.magnetizedPrice&&(s=this.adjustIfNecessary(a,n,this.magnetizedPrice)),this.activeDrawing.click(this.chart.tempCanvas.context,n,s)?this.activeDrawing&&(i.ChartEngine.drawingLine=!1,i.clearCanvas(this.chart.tempCanvas,this),this.addDrawing(this.activeDrawing),this.activateDrawing(null),this.adjustDrawings(),this.draw(),this.changeOccurred("vector"),i.swapClassName(this.controls.crossX,"stx_crosshair","stx_crosshair_drawing"),i.swapClassName(this.controls.crossY,"stx_crosshair","stx_crosshair_drawing")):(this.changeOccurred("drawing"),i.ChartEngine.drawingLine=!0,i.swapClassName(this.controls.crossX,"stx_crosshair_drawing","stx_crosshair"),i.swapClassName(this.controls.crossY,"stx_crosshair_drawing","stx_crosshair")),!0}return!1}},i.ChartEngine.prototype.whichPanel=function(t){for(var e in this.panels){var i=this.panels[e];if(!i.hidden&&(t>i.top&&t<i.bottom))return i}return null},i.ChartEngine.prototype.mouseup=function(t){if(!this.runPrepend("mouseup",arguments)){if(this.swipe.end=!0,this.cancelLongHold=!0,this.repositioningDrawing){if(!this.currentVectorParameters.vectorType||Date.now()-this.mouseTimer>250)return this.changeOccurred("vector"),i.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.adjustDrawings(),void this.draw();this.activateRepositioning(null)}if(this.repositioningBaseline)return this.repositioningBaseline=null,"baseline_delta"==this.layout.chartType&&(this.chart.panel.yAxis.scroll=this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel)-(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2),void this.draw();var e=this.userPointerDown;if(this.userPointerDown=!1,this.displayInitialized){if(this.grabbingScreen=!1,""!==this.openDialog)return void(i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"));if(this.grabOverrideClick)return this.swipeRelease(),i.unappendClassName(this.container,"stx-drag-chart"),this.grabOverrideClick=!1,this.doDisplayCrosshairs(),void this.updateChartAccessories();if(i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"),i.ChartEngine.resizingPanel)return void this.releaseHandle({});if(t||(t=event),t.which&&t.which>=2||t.button&&t.button>=2||t.ctrlKey)return this.anyHighlighted&&!this.bypassRightClick?(this.rightClickHighlighted(),t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t.stopPropagation(),!1):(this.dispatch("rightClick",{stx:this,panel:this.currentPanel,x:n,y:r}),!0);if(!(t.clientX<this.left||t.clientX>this.right||t.clientY<this.top||t.clientY>this.bottom)){var r=this.backOutY(t.clientY),n=this.backOutX(t.clientX);!e||this.longHoldTookEffect&&!this.activeDrawing||this.drawingClick(this.currentPanel,n,r),this.activeDrawing||this.longHoldTookEffect||this.dispatch("tap",{stx:this,
panel:this.currentPanel,x:n,y:r}),this.runAppend("mouseup",arguments)}}}},i.ChartEngine.prototype.grabbingHand=function(){this.allowScroll&&this.grabbingScreen&&(i.touchDevice||i.appendClassName(this.container,"stx-drag-chart"))},i.ChartEngine.prototype.mousedown=function(t){if(!this.runPrepend("mousedown",arguments)&&(this.grabOverrideClick=!1,this.displayInitialized&&this.displayCrosshairs&&!this.repositioningDrawing&&!(this.editingAnnotation||(t||(t=event),t.which&&t.which>=2||t.button&&t.button>=2)))){var e=this.container.getBoundingClientRect();if(this.top=e.top,this.left=e.left,this.right=this.left+this.width,this.bottom=this.top+this.height,!(t.clientX>=this.left&&t.clientX<=this.right&&t.clientY>=this.top&&t.clientY<=this.bottom))return void(i.ChartEngine.insideChart=!1);if(i.ChartEngine.insideChart=!0,this.currentPanel){this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.hasDragged=!1,this.userPointerDown=!0;for(var r=this.currentPanel.chart,n=0;n<this.drawingObjects.length;n++){var a=this.drawingObjects[n];if(a.highlighted){if(this.cloneDrawing){var s=i.ChartEngine.drawingTools[a.name],o=new s;return o.reconstruct(this,a.serialize()),this.drawingObjects.push(o),this.activateRepositioning(o),void(o.repositioner=a.repositioner)}var l=this.currentVectorParameters.vectorType;if(!(i.Drawing&&l&&i.Drawing[l]&&(new i.Drawing[l]).dragToDraw))return void this.activateRepositioning(a)}}if(("baseline_delta"==this.layout.chartType||"baseline_delta_mountain"==this.layout.chartType)&&!1!==r.baseline.userLevel){var h=this.valueFromPixel(this.cy-5,this.currentPanel),u=this.valueFromPixel(this.cy+5,this.currentPanel),c=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10);if(r.baseline.actualLevel<h&&r.baseline.actualLevel>u&&this.cx>c)return void(this.repositioningBaseline={lastDraw:Date.now()})}this.drawingClick(this.currentPanel,this.cx,this.cy),this.activeDrawing&&this.activeDrawing.dragToDraw||(this.grabbingScreen=!0,r.spanLock=!1,this.yToleranceBroken=!1,t||(t=event),this.grabStartX=t.clientX,this.grabStartY=t.clientY,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=r.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(this.currentPanel),this.grabStartZoom=this.grabStartYAxis.zoom,this.grabStartPanel=this.currentPanel,setTimeout(function(t){return function(){t.grabbingHand()}}(this),100),this.swipeStart(r),this.longHoldTime&&this.startLongHoldTimer(),this.runAppend("mousedown",arguments))}}},i.ChartEngine.prototype.startLongHoldTimer=function(){var t=this;this.cancelLongHold=!1,this.longHoldTimeout&&clearTimeout(this.longHoldTimeout),this.longHoldTimeout=setTimeout(function(){t.cancelLongHold||(t.dispatch("longhold",{stx:t,panel:t.currentPanel,x:t.cx,y:t.cy}),t.longHoldTookEffect=!0)},this.longHoldTime)},i.ChartEngine.prototype.changeVectorType=function(t){this.currentVectorParameters.vectorType=t,i.ChartEngine.drawingLine&&this.undo(),this.setCrosshairColors(),i.ChartEngine.insideChart&&this.doDisplayCrosshairs()},i.ChartEngine.prototype.changeVectorParameter=function(t,e){"axisLabel"==t?e="true"===e.toString()||Number(e):"lineWidth"==t?e=Number(e):"fontSize"==t&&(e=parseInt(e,10)+"px");var i=this.currentVectorParameters;return void 0!==i[t]?(i[t]=e,!0):"font"==t.substr(0,4)&&(t=t.substr(4).toLowerCase(),"family"==t&&"default"==e.toLowerCase()&&(e=null),i=i.annotation.font,void 0!==i[t])&&(i[t]=e,!0)},i.ChartEngine.prototype.rightClickOverlay=function(t,e){if(!this.runPrepend("rightClickOverlay",arguments)){var i=this.overlays[t];i.editFunction?i.editFunction(e):this.removeOverlay(t),this.runAppend("rightClickOverlay",arguments)}},i.ChartEngine.prototype.removeOverlay=function(t){if(!this.runPrepend("removeOverlay",arguments)){var e=this.overlays[t];for(var r in this.overlays){var n=this.overlays[r],a=["Field"];i.Studies&&(a=i.Studies.getFieldInputs(n));for(var s=0;s<a.length;s++)e.outputMap[n.inputs[a[s]]]&&this.removeOverlay(n.name)}if(i.Studies){var o=this.layout.studies[t];i.deleteRHS(i.Studies.studyPanelMap,o),e&&this.cleanupRemovedStudy(e)}delete this.overlays[t],this.displaySticky(),this.createDataSet(),this.changeOccurred("layout"),this.runAppend("removeOverlay",arguments)}},i.ChartEngine.prototype.addSeries=function(t,e,r){function n(e,r){if(r.parameters.color){var n=e.getSeriesRenderer("_generic_series");n||(n=e.setSeriesRenderer(new i.Renderer.Lines({params:{panel:r.parameters.panel,type:"legacy",name:"_generic_series",overChart:!0,useChartLegend:!0}}))),n.attachSeries(t,r.parameters).ready()}}function a(t){return function(a){a.error||(i.addMemberToMasterdata({stx:p,label:l,fieldForLabel:e.field,data:a.quotes,fillGaps:e.fillGaps}),n(p,o)),null===e.action||c||p.dispatch("symbolChange",{stx:p,symbol:t.symbol,symbolObject:t.symbolObject,action:e.action}),r&&r.call(p,a.error,o)}}if(!this.runPrepend("addSeries",arguments)){var s=t||null;t||(t=i.uniqueID());var o={parameters:e?i.clone(e):{},yValueCache:[],display:s,id:t};e=o.parameters;var l=t;e.symbol&&(l=e.symbol),i.ensureDefaults(e,{chartName:this.chart.name,symbolObject:{symbol:l},chartType:"line",panel:this.chart.panel.name,action:"add-series"}),"display"in e&&(o.display=e.display),e.isComparison&&(e.shareYAxis=!0);var h=this.charts[e.chartName],u=e.symbolObject;l=e.symbol=u.symbol,o.display||(o.display=l);var c=this.getSeries({symbolObject:u,chart:h,includeMaster:!0}).length;h.series[t]=o;var p=this;e.isComparison&&this.setComparison(!0,h);var d=h.masterData;d||(d=h.masterData=this.masterData=[]);var f=d.length;if(e.data&&!e.data.useDefaultQuoteFeed)i.addMemberToMasterdata({stx:this,label:l,fieldForLabel:e.field,data:e.data,fillGaps:e.fillGaps}),n(this,o),r&&r.call(this,null,o);else if(c)n(this,o),r&&setTimeout(function(){r.call(p,null,o)},0);else if(this.quoteDriver&&!1!==e.loadData){var m=this.quoteDriver,g=m.makeParams(l,u,h);f&&(g.startDate=d[0].DT,g.endDate=this.convertToDataZone(new Date)),g.stx.isEquationChart(g.symbol)?i.fetchEquationChart(g,a(g)):i.ChartEngine.Driver.fetchData(i.QuoteFeed.SERIES,m.quoteFeed,g,a(g))}else n(this,o),r&&r.call(this,null,o);return this.runAppend("addSeries",arguments),o}},i.ChartEngine.prototype.getSeries=function(t){var e=t.chart?t.chart:this.chart,r=e.series,n=t.symbolObject;n||(n={symbol:t.symbol});var a=[];for(var s in r){var o=r[s];i.symbolEqual(n,o.parameters.symbolObject)&&a.push(o)}return t.includeMaster&&i.symbolEqual(n,e.symbolObject)&&a.push({}),a},i.ChartEngine.prototype.isEquationChart=function(t){return!(!this.allowEquations||!i.computeEquationChart)&&!(!t||"="!=t[0])},i.ChartEngine.prototype.getDataFields=function(t){t||(t=this.chart);var e=t.defaultPlotField;e||(e="Close");var i=["Open","High","Low"];i.push(e);for(var r in t.series){var n=t.series[r].parameters;i.push(n.symbol)}return i},i.ChartEngine.prototype.cleanMasterData=function(t,e){function i(t,e){for(var i=0;i<e.length;i++){if(void 0!==t[e[i]])return!1}return!0}var r=t.symbol,n=e.masterData;if(n&&n.length){var a=this.getDataFields(e),s=0;do{var o=n[s];delete o[r],i.call(this,o,a)?n.splice(s,1):s++}while(s<n.length);n=this.doCleanupGaps(n),this.setMasterData(n,e)}},i.ChartEngine.prototype.deleteSeries=function(t,e,i){if(!this.runPrepend("deleteSeries",arguments)){i=i||{};var r=i.action?i.action:"remove-series",n="object"==typeof t?t.id:t;e||(e=this.chart);var a=e.series[n];if(a){var s=a.parameters.symbolObject;delete e.series[n];var o=this.getSeries({symbolObject:s,includeMaster:!0});if(o.length||this.cleanMasterData(s,e),"percent"!=this.layout.chartScale){var l=!1;for(var h in e.series)e.series[h].parameters.isComparison&&(l=!0);l||this.setComparison(!1,e)}this.createDataSet(),o.length||this.dispatch("symbolChange",{stx:this,symbol:s.symbol,symbolObject:s,action:r}),this.quoteDriver&&this.quoteDriver.updateSubscriptions(),this.runAppend("deleteSeries",arguments)}}},i.ChartEngine.prototype.removeSeries=function(t,e){if(!this.runPrepend("removeSeries",arguments)){var i="object"==typeof t?t.id:t;e||(e=this.chart);var r=!1;for(var n in e.seriesRenderers)for(var a=e.seriesRenderers[n],s=a.seriesParams.length-1;s>=0;s--){var o=a.seriesParams[s];o.field===i&&(a.removeSeries(i),a.seriesParams.length<1&&this.removeSeriesRenderer(a),r=!0)}r||this.deleteSeries(i,e),this.draw(),this.runAppend("removeSeries",arguments)}},i.ChartEngine.prototype.isDailyInterval=function(t){return console.warn("CIQ.ChartEngine.prototype.isDailyInterval has been deprecated. Use use static version insted"),i.ChartEngine.isDailyInterval(t)},i.ChartEngine.prototype.setPeriodicity=function(t,e){if(!this.runPrepend("setPeriodicity",arguments)){var r,n,a=null;if(t&&"object"==typeof t?(r=t.period,n=t.interval,a=t.timeUnit):(r=t,n=e,e=arguments[arguments.length-1],arguments.length>3&&(a=arguments[2])),"function"!=typeof e&&(e=null),n||(n=1),!isNaN(n)&&a&&"minute"!=a&&"second"!=a&&"millisecond"!=a&&(n=a),r){var s=this.layout,o=s.candleWidth;delete s.setSpan,"year"==n&&(n="month",r||(r=1),r*=12),i.ChartEngine.isDailyInterval(n)?a=null:"tick"==n?a=null:a||isNaN(n)||(a="minute");var l=!1;if(this.chart.symbol&&(l=this.needDifferentData({periodicity:r,interval:n,timeUnit:a})),s.periodicity=r,s.interval=n,s.timeUnit=a,l)if(this.changeOccurred("layout"),this.quoteDriver)for(var h in this.charts)this.charts[h].symbol&&(this.displayInitialized?this.quoteDriver.newChart({symbol:this.charts[h].symbol,symbolObject:this.charts[h].symbolObject,chart:this.charts[h]},e):this.newChart(this.charts[h].symbol,null,this.charts[h],e));else this.dataCallback?(this.dataCallback(),e&&e(null)):console.log("cannot change periodicity because neither dataCallback or quoteDriver are set");else{var u,c;for(u in this.charts){c=this.charts[u];var p,d=c.dataSegment,f=c.dataSet,m=c.maxTicks,g=c.scroll,v=d?d.length:0,y=f?f.length:0,x=Math.round(c.maxTicks/2);this.setCandleWidth(o,c);var C=!0,S=!1;if(g<=m?C=!1:d&&!d[x]&&(C=!1,S=g-y),C&&v>0&&(m<(Math.round(this.chart.width/o-.499)-1)/2&&(x=v-1),x>=v?(p=d[v-1].DT,x=v-1):p=d[x].DT),this.createDataSet(),C){if(v>0)for(var w=y-1;w>=0;w--){var D=f[w].DT;if(D.getTime()<p.getTime()){c.scroll=y-w+x;break}}}else if(S)c.scroll=f.length+S;else{var b=Math.round(this.preferences.whitespace/o);c.scroll=m-b-1}}if(this.displayInitialized&&this.draw(),this.changeOccurred("layout"),this.quoteDriver)for(u in this.charts)c=this.charts[u],c.symbol&&c.moreAvailable&&this.quoteDriver.checkLoadMore(c);e&&e(null),this.runAppend("setPeriodicity",arguments)}}}},i.ChartEngine.prototype.setPeriodicityV2=function(t,e,i,r){"function"==typeof i&&(r=i,i=null),this.runPrepend("setPeriodicityV2",arguments)||(this.setPeriodicity(t,e,i,r),this.runAppend("setPeriodicityV2",arguments))},i.ChartEngine.prototype.drawVectors=function(){if(!this.vectorsShowing&&!this.runPrepend("drawVectors",arguments)){if(this.vectorsShowing=!0,!this.chart.hideDrawings){var t,e,i={};for(e=0;e<this.drawingObjects.length;e++){var r=this.drawingObjects[e];this.repositioningDrawing!==r&&(t=r.panelName,this.panels[r.panelName]&&!this.panels[r.panelName].hidden&&(i[t]||(i[t]=[]),i[t].push(r)))}for(t in i){this.startClip(t);var n=i[t];for(e=0;e<n.length;e++)n[e].render(this.chart.context);this.endClip()}}this.runAppend("drawVectors",arguments)}},i.ChartEngine.NONE=0,i.ChartEngine.CLOSEUP=1,i.ChartEngine.CLOSEDOWN=2,i.ChartEngine.CLOSEEVEN=4,i.ChartEngine.CANDLEUP=8,i.ChartEngine.CANDLEDOWN=16,i.ChartEngine.CANDLEEVEN=32,i.ChartEngine.prototype.displayChart=function(t){function e(t,e,r,n){var a=e.color;if(r&&(a=e["border-left-color"],a||(a=e.borderLeftColor),!a))return null;if(!n)return a;var s=t.pixelFromTransformedValue(o.chart.highValue,o);isNaN(s)&&(s=0);var l=e.backgroundColor;if(a&&!i.isTransparent(a)){var h=t.chart.context.createLinearGradient(0,s,0,2*o.yAxis.bottom-s);return h.addColorStop(0,a),h.addColorStop(1,l),h}return l}var r=this.layout.candleWidth-t.tmpWidth<2&&t.tmpWidth<=3;if(!t.panel.hidden&&!this.runPrepend("displayChart",arguments)){var n=this.layout,a=n.chartType,s=null,o=t.panel,l=this.containerColor,h=this.colorByCandleDirection;this.controls.baselineHandle.style.display="none";var u,c,p,d,f,m=this.noWicksOnCandles;t.customChart&&(t.customChart.chartType&&(a=t.customChart.chartType),t.customChart.colorFunction&&(s=t.customChart.colorFunction));var g=this.chart.baseLegendColors=[];t.state.chartType||(t.state.chartType={});var v,y=t.state.chartType.pass={},x=this.chart.defaultPlotField;if("kagi"==n.aggregationType&&"none"!=a)this.drawKagiSquareWave(o,"stx_kagi_up","stx_kagi_down"),g.push(this.getCanvasColor("stx_kagi_up")),g.push(this.getCanvasColor("stx_kagi_down"));else if("pandf"==n.aggregationType&&"none"!=a)this.drawPointFigureChart(o,"stx_pandf_up","X"),g.push(this.getCanvasColor("stx_pandf_up")),this.drawPointFigureChart(o,"stx_pandf_down","O"),g.push(this.getCanvasColor("stx_pandf_down"));else if("line"==a||"step"==a)this.drawLineChart(o,"stx_line_chart",null,{step:"step"==a});else if("mountain"==a)g=null,this.drawMountainChart(o);else if("colored_mountain"==a||"colored_line"==a||"colored_step"==a){v="colored_mountain"==a?"drawMountainChart":"drawLineChart";var C="colored_mountain"==a?"stx_colored_mountain_chart":"stx_line_chart";u=this.getCanvasColor("stx_line_up"),c=this.getCanvasColor("stx_line_down"),p=this.getCanvasColor("stx_line_chart"),s||(s=function(t,e,i){return e.iqPrevClose||0===e.iqPrevClose?e.Close>e.iqPrevClose?u:e.Close<e.iqPrevClose?c:p:p});var S=this[v](o,C,s,{step:"colored_step"==a});for(var w in S)g.push(w)}else if("wave"==a)this.drawWaveChart(o);else if("bar"==a||"hlc"==a)this.startClip(o.name),v="bar"==a?"drawBarChartHighPerformance":"drawHLCChart",this[v](o,"stx_bar_chart"),this.endClip();else if("colored_bar"==a||"colored_hlc"==a){if(this.startClip(o.name),v="colored_bar"==a?"drawBarChartHighPerformance":"drawHLCChart",s){var D="colored_hlc"==a?"hlc":null,b=this.drawBarChart(o,"stx_bar_chart",s,{type:D});for(var T in b)g.push(T)}else this[v](o,"stx_bar_up",h?8:1),g.push(this.getCanvasColor("stx_bar_up")),this[v](o,"stx_bar_down",h?16:2),g.push(this.getCanvasColor("stx_bar_down")),y.even&&(this[v](o,"stx_bar_even",h?32:4),g.push(this.getCanvasColor("stx_bar_even")));this.endClip()}else if("hollow_candle"==a||"volume_candle"==a){if(this.startClip(o.name),s)m[n.aggregationType]||this.drawShadows(o,s),this.drawCandles(o,s,!1),this.drawCandles(o,s,!0);else{m[n.aggregationType]||(this.drawShadowsHighPerformance(o,"stx_hollow_candle_up",1),this.drawShadowsHighPerformance(o,"stx_hollow_candle_down",2),y.even&&this.drawShadowsHighPerformance(o,"stx_hollow_candle_even",4));var M=this.getCanvasColor("stx_hollow_candle_up"),k=this.getCanvasColor("stx_hollow_candle_down"),A=this.getCanvasColor("stx_hollow_candle_even"),P=this.styles.stx_hollow_candle_up.borderColor,_=this.styles.stx_hollow_candle_down.borderColor,F=this.styles.stx_hollow_candle_even.borderColor,E=i.isTransparent(M),L=i.isTransparent(k),N=i.isTransparent(A);this.drawCandlesHighPerformance(o,M,E?P:"transparent",17),this.drawCandlesHighPerformance(o,k,L?_:"transparent",18),y.even&&this.drawCandlesHighPerformance(o,A,N?F:"transparent",20),this.drawCandlesHighPerformance(o,l,E?P:M,9),this.drawCandlesHighPerformance(o,l,L?_:k,10),y.even&&this.drawCandlesHighPerformance(o,l,N?F:A,12),g.push(M),g.push(k),y.even&&g.push(A)}this.endClip()}else if("candle"==a){if(this.startClip(o.name),s)m[n.aggregationType]||this.drawShadows(o,s),this.drawCandles(o,s,!1),r||this.drawCandles(o,s,!0);else{if(!m[n.aggregationType]){var O=this.getCanvasColor("stx_candle_shadow_up"),I=this.getCanvasColor("stx_candle_shadow_down");i.colorsEqual(O,I)&&i.colorsEqual(O,this.defaultColor)?this.drawShadowsHighPerformance(o,"stx_candle_shadow"):(this.drawShadowsHighPerformance(o,"stx_candle_shadow_up",8),this.drawShadowsHighPerformance(o,"stx_candle_shadow_down",16),this.drawShadowsHighPerformance(o,"stx_candle_shadow",32))}f=this.canvasStyle("stx_candle_up");var H=f.color;r&&i.isTransparent(f.color)&&(f.color=f.borderLeftColor),this.drawCandlesHighPerformance(o,e(this,f,!1),e(this,f,!r),8),g.push(f.color),f.color=H,f=this.canvasStyle("stx_candle_down"),H=f.color,r&&i.isTransparent(f.color)&&(f.color=f.borderLeftColor),this.drawCandlesHighPerformance(o,e(this,f,!1),e(this,f,!r),16),g.push(f.color),f.color=H}this.endClip()}else if("histogram"==a){if(this.startClip(o.name),s)this.drawCandles(o,s,!1,!0),r||this.drawCandles(o,s,!0,!0);else for(var z=[["stx_histogram_up",8],["stx_histogram_down",16],["stx_histogram_even",32]],R=0;R<z.length;R++){var V=z[R][1],B=z[R][0];f=this.canvasStyle(B),this.drawCandlesHighPerformance(o,e(this,f,!1,!0),e(this,f,!r,!0),V,!0),g.push(f.color)}this.endClip()}else if("baseline_delta"==a||"baseline_delta_mountain"==a){var W="baseline_delta_mountain"==a;if(null!==(d=t.baseline.actualLevel)&&!isNaN(d)){W&&this.drawMountainChart(o,"stx_baseline_delta_mountain"),this.startClip(o.name),d=this.pixelFromPrice(d,t.panel);var U={over:"stx_baseline_up",under:"stx_baseline_down"},j=0;for(var Y in U){var X={panelName:"chart",band:x,threshold:t.baseline.actualLevel,color:W?"transparent":this.getCanvasColor(U[Y]),direction:"over"==Y?1:-1,edgeHighlight:this.getCanvasColor(U[Y]),edgeParameters:{pattern:"solid",lineWidth:parseInt(this.canvasStyle(U[Y]).width,10)+.1,opacity:1},gaps:t.gaplines},q=X.color;if(!W&&q&&"transparent"!=q){var Z=t.context.createLinearGradient(0,"over"==Y?0:2*d,0,d);Z.addColorStop(0,i.hexToRgba(q,60)),Z.addColorStop(1,i.hexToRgba(q,10)),X.color=Z,X.opacity=1}g.push(q),i.preparePeakValleyFill(this,t.dataSegment,X),t.gaplines&&(t.gaplines.fillMountain||(this.setStyle("stx_baseline_trace","color","transparent"),this.drawLineChart(o,"stx_baseline_trace",null,{width:X.edgeParameters.lineWidth,gaps:this.containerColor})),t.gaplines.color||(t.gaplines.color=this.defaultColor)),j+=X.edgeParameters.lineWidth}this.setStyle("stx_baseline_trace","color","transparent"),this.drawLineChart(o,"stx_baseline_trace",null,{width:Math.round(j/2)+.1}),this.plotLine(0,1,d,d,l,"line",t.context,!0,{pattern:"solid",lineWidth:"1.1",opacity:1}),this.plotLine(0,1,d,d,this.getCanvasColor("stx_baseline"),"line",t.context,!0,{pattern:"dotted",lineWidth:"2.1",opacity:.5}),!1!==this.chart.baseline.userLevel&&(this.controls.baselineHandle.style.top=d-parseInt(getComputedStyle(this.controls.baselineHandle).height,10)/2+"px",this.controls.baselineHandle.style.left=this.chart.right-parseInt(getComputedStyle(this.controls.baselineHandle).width,10)+"px",this.controls.baselineHandle.style.display="block"),this.endClip()}}else"scatterplot"==a?(this.startClip(o.name),this.scatter(o),this.endClip()):a&&"none"!=a?(console.log('Invalid chart layout.chartType: "'+a+'". Defaulting to Line Chart.'),n.chartType="line",this.drawLineChart(o,"stx_line_chart")):this.chart.baseLegendColors=null;this.runAppend("displayChart",arguments)}},i.ChartEngine.prototype.calculateATR=function(t,e,i){i||(i=t.dataSet);var r=t.state.calculations.atr;r||(r=t.state.calculations.atr={}),e||(e=20);var n=[];r.accum&&(n=r.accum);for(var a,s=0;s<i.length;s++){var o=i[s];if(a=s?i[s-1]:r.q1){var l=Math.max(o.High-o.Low,Math.abs(o.High-a.Close),Math.abs(o.Low-a.Close));if(n.length<e){if(n.push(l)==e){for(var h=0,u=0;u<n.length;u++)h+=n[u];o.atr=h/e}}else o.atr=(a.atr*(e-1)+l)/e;o.trueRange=l}}t.state.calculations.atr={accum:n,q1:a}},i.ChartEngine.prototype.calculateMedianPrice=function(t,e){e||(e=t.dataSet);for(var i,r=0;r<e.length;++r)i=e[r],i["hl/2"]=(i.High+i.Low)/2},i.ChartEngine.prototype.calculateTypicalPrice=function(t,e){e||(e=t.dataSet);for(var i,r=0;r<e.length;++r)i=e[r],i["hlc/3"]=(i.High+i.Low+i.Close)/3},i.ChartEngine.prototype.calculateWeightedClose=function(t,e){e||(e=t.dataSet);for(var i,r=0;r<e.length;++r)i=e[r],i["hlcc/4"]=(i.High+i.Low+2*i.Close)/4},i.ChartEngine.prototype.calculateOHLC4=function(t,e){e||(e=t.dataSet);for(var i,r=0;r<e.length;++r)i=e[r],i["ohlc/4"]=(i.Open+i.High+i.Low+i.Close)/4},i.ChartEngine.prototype.currentQuote=function(){if(!this.chart.dataSet)return null;for(var t=this.chart.dataSet.length-1;t>=0;t--)if(this.chart.dataSet[t])return this.chart.dataSet[t];return null},i.ChartEngine.prototype.correctIfOffEdge=function(t){if(!this.runPrepend("correctIfOffEdge",arguments)){for(var e in this.charts){var i=this.charts[e],r=i.dataSet,n=i.maxTicks,a=this.layout,s=this.minimumLeftBars;this.standaloneBars[a.chartType]||s--;var o=Math.min(s,n);if(i.allowScrollPast){var l=n-o;o>r.length&&(l=n-r.length),i.scroll-l>=r.length&&(i.scroll=r.length+l-1,this.micropixels=0),i.scroll<=o&&(i.scroll=o,this.micropixels=0)}else i.scroll<o&&(i.scroll=o),i.scroll>r.length&&(i.scroll=r.length);if(!1===i.allowScrollFuture){var h=this.getLabelOffsetInPixels(this,i,a.chartType),u=n-Math.round(h/a.candleWidth)-1;i.scroll<u&&(i.scroll=u,this.micropixels=0)}}this.runAppend("correctIfOffEdge",arguments)}},i.ChartEngine.prototype.createDataSegment=function(t){if(!this.runPrepend("createDataSegment",arguments)){var e;for(var r in this.charts){e=this.charts[r],t&&(e=t),e.isComparison&&i.Comparison.createComparisonSegmentInner(this,e);var n=e.dataSet,a=e.baseline,s=e.scroll,o=e.maxTicks,l=this.layout,h=l.candleWidth;a.actualLevel=a.userLevel?a.userLevel:a.defaultLevel;for(var u,c=a.includeInDataSegment&&!this.standaloneBars[l.chartType],p=e.dataSegment=[],d=n.length-1-s-1,f=e.defaultPlotField,m=-1;m<s&&m<o;m++)if(d++,-1!=m||c)if(d<n.length&&d>=0){if(u=n[d],u.candleWidth=null,p.push(u),null===a.actualLevel&&m>=0)if(f&&"Close"!=f){var g=n[d-1];(g[f]||0===g[f])&&(a.actualLevel=g[f])}else(u.iqPrevClose||0===u.iqPrevClose)&&(a.actualLevel=u.iqPrevClose)}else d<0&&p.push(null);if(e.segmentImage=null,"volume_candle"==l.chartType){for(var v=0,y=e.width-(o-p.length-1)*l.candleWidth,x=0;x<p.length;x++)(u=p[x])&&(v+=u.Volume);var C=0;e.segmentImage=[];for(var S=0;S<p.length;S++){u=p[S],e.segmentImage[S]={};var w=null;u?(u.Volume?(u.candleWidth=y*u.Volume/v,w=C+u.candleWidth/2,C+=u.candleWidth):(u.candleWidth=h,w=C+h/2,C+=h),e.segmentImage[S]={tick:u.tick,candleWidth:u.candleWidth,leftOffset:w}):C+=h}}if(t)break}e&&e.isComparison&&this.clearPixelCache(),this.positionCrosshairsAtPointer(),this.runAppend("createDataSegment",arguments)}},i.ChartEngine.prototype.leftTick=function(){return this.chart.dataSet.length-this.chart.scroll},i.ChartEngine.prototype.getStartDateOffset=function(){for(var t=0;t<this.chart.dataSegment.length;t++)if(this.chart.dataSegment[t])return t;return 0},i.ChartEngine.prototype.setStartDate=function(t){for(var e=0;e<this.chart.dataSet.length;e++){if(this.chart.dataSet[e].DT.getTime()==t.getTime())return this.chart.scroll=this.chart.dataSet.length-e,void this.draw()}},i.ChartEngine.prototype.updateListeners=function(t){for(var e in this.plugins){var i=this.plugins[e];i.display&&i.listener&&i.listener(this,t)}},i.ChartEngine.prototype.clearPixelCache=function(){for(var t in this.panels){var e=this.panels[t];e.cacheHigh=null,e.cacheLow=null,e.cacheLeft=1e6,e.cacheRight=-1}for(var i in this.charts){var r=this.charts[i];if(r.dataSet)for(var n=0;n<r.dataSet.length;n++)r.dataSet[n].cache={}}},i.ChartEngine.prototype.createYAxisLabel=function(t,e,r,n,a,s,o){if(!1!==t.yAxis.drawPriceLabels){var l=o||t.yAxis,h=s||this.chart.context,u=this.getCanvasFontSize("stx_yaxis")+6;this.canvasFont("stx_yaxis",h);var c=l.displayBorder;!1===this.axisBorders&&(c=!1),!0===this.axisBorders&&(c=!0);var p,d=c?3:0;try{p=h.measureText(e).width+d+6}catch(t){p=l.width}var f=l.left-3+3,m=f+3+d,g=3;"left"===(null===l.position?t.chart.yAxis.position:l.position)&&(f=l.left+l.width+3-3,p*=-1,m=f,g=-3,h.textAlign="right"),r+u/2>l.bottom&&(r=l.bottom-u/2),r-u/2<l.top&&(r=l.top+u/2),void 0===i[this.yaxisLabelStyle]&&(this.yaxisLabelStyle="roundRectArrow");var v=this.yaxisLabelStyle;l.yaxisLabelStyle&&(v=l.yaxisLabelStyle);var y={ctx:h,x:f,y:r,top:r-u/2,width:p,height:u,radius:g,backgroundColor:n,fill:!0,stroke:!1,margin:{left:m-f,top:1},txt:e,color:a};i[v](y)}},i.ChartEngine.prototype.createXAxisLabel=function(t,e,r,n,a,s){var o=this.chart.context,l=this.getCanvasFontSize("stx-float-date")+4;this.canvasFont("stx-float-date",o);var h;try{h=o.measureText(e).width+4}catch(t){h=0}var u=t.top+t.height-l;if(!(r+h/2<t.left||r-h/2>t.right)){s||(r+h/2>t.right&&(r=t.right-h/2),r-h/2<t.left&&(r=t.left+h/2)),o.fillStyle=n,i.roundRect({ctx:o,x:r-h/2,top:u,width:h,height:l,radius:3,fill:!0});var c=t.bottom-t.yAxis.bottom-l;o.beginPath(),s?(o.moveTo(r-c,u),o.lineTo(r,u-c-1),o.lineTo(r+c,u),o.closePath(),o.fill()):(o.moveTo(r,u),o.lineTo(r,u-c),o.strokeStyle=n,o.stroke()),o.textBaseline="top",o.fillStyle=a||i.chooseForegroundColor(n),o.fillStyle==n&&("#FFFFFF"==n.toUpperCase()?o.fillStyle="#000000":o.fillStyle="#FFFFFF"),o.fillText(e,r-h/2+2,u+2)}},i.ChartEngine.prototype.drawCurrentHR=function(){if(!this.runPrepend("drawCurrentHR",arguments)){var t,e;for(var i in this.charts){var r=this.charts[i],n=r.panel,a=n.yAxis;if(!n.hidden&&(!1!==a.drawCurrentPriceLabel&&(!r.customChart||"none"!=r.customChart.chartType))){var s=a.whichSet;s||(s="dataSet");var o=r[s].length,l=this.layout.candleWidth;if("dataSegment"==s)for(;o>(r.width-this.micropixels+l/2+1)/l;)o--;if(o&&r[s][o-1]){var h=r.defaultPlotField;h&&!this.highLowBars[this.layout.chartType]||(h="Close");var u,c;do{if(u=r[s][o-1][h],c=u,0==--o)break}while(null===c);if("dataSet"==s&&r.currentQuote)c=r.currentQuote[h];else if(r[s].length>=2){var p=r[s][o-2];p&&(u=p[h])}c<u?(t=this.canvasStyle("stx_current_hr_down").backgroundColor,e=this.canvasStyle("stx_current_hr_down").color):(t=this.canvasStyle("stx_current_hr_up").backgroundColor,e=this.canvasStyle("stx_current_hr_up").color),r.transformFunc&&(c=r.transformFunc(this,r,c));var d,f=Math.max(n.yAxis.printDecimalPlaces,n.chart.decimalPlaces);(a.maxDecimalPlaces||0===a.maxDecimalPlaces)&&(f=Math.min(f,a.maxDecimalPlaces)),d=a.priceFormatter?a.priceFormatter(this,n,c,f):this.formatYAxisPrice(c,n,f);var m=this.pixelFromTransformedValue(c,n);this.createYAxisLabel(n,d,m,t,e),!0===this.preferences.currentPriceLine&&this.isHome()&&(n.chart.context.globalCompositeOperation="destination-over",this.plotLine(n.left,n.right,m,m,t,"line",n.chart.context,n,{pattern:"dashed",lineWidth:1,opacity:.8}),n.chart.context.globalCompositeOperation="source-over")}}}this.runAppend("drawCurrentHR",arguments)}},i.ChartEngine.prototype.getDefaultColor=function(){this.defaultColor="#000000";for(var t=null,e=this.chart.container;!t||i.isTransparent(t);){var r=getComputedStyle(e);if(!r)return;if(t=r.backgroundColor,i.isTransparent(t)&&(t="transparent"),!(e=e.parentNode)||!e.tagName)break}if(t)if("transparent"==t&&(t="#FFFFFF"),this.containerColor=t,i.isTransparent(t))this.defaultColor="#000000";else{var n=i.hsv(t),a=n[2];this.defaultColor=a>.65?"#000000":"#FFFFFF"}else this.containerColor="#FFFFFF"},i.ChartEngine.prototype.startAsyncAction=function(){this.pendingAsyncs||(this.pendingAsyncs=[]),this.pendingAsyncs.push(!0)},i.ChartEngine.prototype.registerChartDrawnCallback=function(t){return this.asyncCallbacks||(this.asyncCallbacks=[]),this.asyncCallbacks.push(t),{fc:t}},i.ChartEngine.prototype.unregisterChartDrawnCallback=function(t){for(var e=0;e<this.asyncCallbacks.length;e++)if(this.asyncCallbacks[e]==t.fc)return void this.asyncCallbacks.splice(e,1)},i.ChartEngine.prototype.makeAsyncCallbacks=function(){if(this.asyncCallbacks&&(!this.pendingAsyncs||!this.pendingAsyncs.length))for(var t=0;t<this.asyncCallbacks.length;t++)this.asyncCallbacks[t]()},i.ChartEngine.prototype.completeAsyncAction=function(){this.pendingAsyncs.pop(),this.makeAsyncCallbacks()},i.ChartEngine.prototype.draw=function(){if(this.debug(),this.chart.canvas&&this.chart.dataSet&&this.chart.canvasHeight&&(this.offset=this.layout.candleWidth*this.candleWidthPercent/2,i.clearCanvas(this.chart.canvas,this),this.masterData&&this.masterData.length&&!this.runPrepend("draw",arguments))){this.getDefaultColor(),this.vectorsShowing=!1,this.drawPanels(),this.yAxisLabels=[];var t,e,r,n;for(r in this.charts){e=this.charts[r],this.correctIfOffEdge(),this.createDataSegment();var a=this.createXAxis(e);this.initializeDisplay(e),this.rendererAction(e,"calculate"),this.renderYAxis(e),this.drawXAxis(e,a),e.tmpWidth=Math.floor(this.layout.candleWidth*this.candleWidthPercent),e.tmpWidth%2==0&&(e.tmpWidth+=1,e.tmpWidth>this.layout.candleWidth&&(e.tmpWidth-=2)),e.tmpWidth<.5&&(e.tmpWidth=.5);for(t in this.plugins)n=this.plugins[t],n.display&&n.drawUnder&&n.drawUnder(this,e);this.chart.legend&&(this.chart.legend.colorMap=null),this.rendererAction(e,"yaxis"),this.rendererAction(e,"underlay"),i.Studies&&i.Studies.displayStudies(this,e,!0),this.displayChart(e),i.Studies&&i.Studies.displayStudies(this,e,!1),this.rendererAction(e,"overlay"),e.legend&&e.legend.colorMap&&e.legendRenderer&&e.legendRenderer(this,{chart:e,legendColorMap:e.legend.colorMap,coordinates:{x:e.legend.x,y:e.legend.y+e.panel.yAxis.top}})}for(r in this.charts){e=this.charts[r];for(t in this.plugins)n=this.plugins[t],n.display&&n.drawOver&&n.drawOver(this,e)}for(var s in this.panels)this.panels[s].hidden||this.plotYAxisText(this.panels[s]);for(var o=0;o<this.yAxisLabels.length;o++){var l=this.yAxisLabels[o];"series"==l.src&&l.args[6]&&!1===l.args[6].drawSeriesPriceLabels||this.createYAxisLabel.apply(this,l.args)}this.createCrosshairs(),this.drawVectors(),this.drawCurrentHR(),this.displayInitialized=!0,this.controls.home&&(this.controls.home.style.display=this.isHome()?"none":"block"),this.positionMarkers();for(r in this.charts)e=this.charts[r],this.quoteDriver&&this.quoteDriver.checkLoadMore(e);this.runAppend("draw",arguments),this.makeAsyncCallbacks()}},i.ChartEngine.prototype.adjustBackingStore=function(t,e){this.devicePixelRatio=window.devicePixelRatio||1,this.devicePixelRatio<1&&(this.devicePixelRatio=1);var r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,n=this.devicePixelRatio/r;if(!this.useBackingStore)return void(this.devicePixelRatio=this.adjustedDisplayPixelRatio=1);if(!i.isAndroid||i.is_chrome){var a=t.width,s=t.height;t.width=a*n,t.height=s*n,t.style.width=a+"px",t.style.height=s+"px",e.scale(n,n),this.adjustedDisplayPixelRatio=n,this.backing={ratio:n,width:t.width,height:t.height,styleWidth:a,styleHeight:s}}},i.ChartEngine.prototype.reconstituteBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.width&&(t.width=this.backing.width,t.height=this.backing.height,t.context.scale(this.backing.ratio,this.backing.ratio),this.adjustedDisplayPixelRatio=this.backing.ratio,this.draw())}},i.ChartEngine.prototype.disableBackingStore=function(){if(this.useBackingStore){var t=this.chart.canvas;t.width!=this.backing.styleWidth&&(t.width=this.backing.styleWidth,t.height=this.backing.styleHeight,t.context.scale(1,1),this.adjustedDisplayPixelRatio=1,this.draw())}},i.ChartEngine.prototype.resizeCanvas=function(){this.chart.panel||(this.chart.panel=this.panels.chart);var t=this.chart.canvas,e=this.chart.context;t&&e&&(this.floatCanvas.height=this.chart.tempCanvas.height=t.height=this.chart.container.clientHeight,this.floatCanvas.width=this.chart.tempCanvas.width=t.width=this.chart.container.clientWidth,this.adjustBackingStore(t,e),this.adjustBackingStore(this.chart.tempCanvas,this.chart.tempCanvas.context),this.adjustBackingStore(this.floatCanvas,this.floatCanvas.context));var i=this.container.getBoundingClientRect();this.top=i.top,this.left=i.left,this.canvasWidth=this.chart.canvasWidth=this.chart.container.clientWidth,this.right=this.left+this.canvasWidth,this.height=this.chart.container.clientHeight,this.width=this.right-this.left,0!==this.width||this.container.dimensionlessCanvas||console.log("warning: zero width chart. Check CSS for chart container."),this.bottom=this.top+this.height,this.calculateYAxisPositions(),this.chart.canvasRight=this.right,
this.chart.canvasHeight=this.height;var r=this.layout.candleWidth;void 0===r&&(r=8);for(var n in this.charts){var a=this.charts[n];if(this.setCandleWidth(r,a),a.scroll<a.width/r){a.scroll=Math.floor(a.width/r);var s=Math.round(this.preferences.whitespace/this.layout.candleWidth);a.scroll-=s}var o,l=10;try{o=2*e.measureText("10:00").width}catch(t){o=100}for(;l>1&&!(this.chart.width/o>l);)l/=1.5;a.xAxis.autoComputedTickSizePixels=Math.round(this.chart.width/l),a.xAxis.autoComputedTickSizePixels<1&&(a.xAxis.autoComputedTickSizePixels=1)}},i.ChartEngine.prototype.setCandleWidth=function(t,e){e||(e=this.chart),t<this.minimumCandleWidth&&(t=this.minimumCandleWidth),this.layout.candleWidth=t,e.maxTicks=Math.round(e.width/t)+1},i.ChartEngine.prototype.resizeChart=function(t){if(!this.runPrepend("resizeChart",arguments)){!1!==t&&(t=!0),t&&this.preAdjustScroll();var e=this.chart.canvasHeight;this.resizeCanvas(),t&&this.postAdjustScroll(),this.displayInitialized?(this.adjustPanelPositions(),this.draw()):0!==this.chart.canvasHeight&&0===e&&(this.adjustPanelPositions(),this.draw()),this.doDisplayCrosshairs(),this.updateChartAccessories(),this.runAppend("resizeChart",arguments)}},i.ChartEngine.prototype.newChart=function(t,e,r,n,a){r||(r=this.chart),a||(a={});var s=this.layout,o=a.periodicity;o&&(o.interval&&(s.interval=o.interval),o.period&&(s.periodicity=o.period),o.periodicity&&(s.periodicity=o.periodicity),s.timeUnit=o.timeUnit);var l=r.symbol,h=i.clone(r.symbolObject),u=r.market,c=r.dataSet,p=r.moreAvailable;if(r.dataSet=[],r.moreAvailable=null,t?"object"==typeof t?(r.symbol=t.symbol,r.symbolObject=t):(r.symbol=t,r.symbolObject.symbol=t):(r.symbol=null,r.symbolObject={symbol:null}),this.marketFactory){var d=this.marketFactory(r.symbolObject);this.setMarket(d,r)}var f=this;if(!e&&this.quoteDriver){var m=function(t){t&&"orphaned"!=t&&(r.symbol=l,r.symbolObject=h,r.market=u,r.dataSet=c,r.moreAvailable=p),f.dispatch(f.currentlyImporting?"symbolImport":"symbolChange",{stx:f,symbol:f.chart.symbol,symbolObject:f.chart.symbolObject,action:"master"}),n&&n.call(f,t)},g=a.span;!g&&s&&(g=s.setSpan),g&&g.base?(g.multiplier=g.multiplier||1,this.chart.masterData=null,this.displayInitialized=!1,o&&(g.maintainPeriodicity=!0),g.forceLoad=!0,this.setSpan(g,m)):this.quoteDriver.newChart({symbol:r.symbol,symbolObject:r.symbolObject,chart:r,initializeChart:!0},function(t){t||(f.adjustPanelPositions(),f.quoteDriver.updateSubscriptions(),a.stretchToFillScreen&&f.fillScreen()),m.apply(f,arguments)})}else{e||console.log("Warning: No masterData specified and no QuoteFeed configured"),r.symbol||(r.symbol=""),this.doCleanupDates(e,s.interval),this.setMasterData(e,r),this.createDataSet(),this.initializeChart();var v=a.span;v&&v.multiplier&&v.base?this.setSpan({maintainPeriodicity:!0,multiplier:v.multiplier,base:v.base}):a.stretchToFillScreen?this.fillScreen():e&&e.length?this.draw():this.clear(),this.adjustPanelPositions(),n&&n.call(f)}},i.ChartEngine.prototype.clear=function(){this.displayInitialized=!1;for(var t in this.layout.studies){var e=this.layout.studies[t];i.Studies.removeStudy(this,e)}this.controls.chartControls.style.display="none",this.panels.chart.title.innerHTML="",this.panels.chart.title.appendChild(document.createTextNode(this.panels.chart.display))},i.ChartEngine.prototype.fillScreen=function(){var t=this.chart,e=this.layout.candleWidth,i=t.width-this.preferences.whitespace,r=t.dataSet.length;if(r*e>=i)return void this.draw();this.standaloneBars[this.layout.chartType]||r--;var n=i/r;this.setCandleWidth(n,t),this.home({maintainWhitespace:!0})},i.ChartEngine.prototype.setMasterData=function(t,e){if(e||(e=this.chart),this.marketFactory){var r=this.marketFactory(e.symbolObject);this.setMarket(r,e)}e.masterData=t,"chart"==e.name&&(this.masterData=t);var n;for(n=0;t&&n<t.length;n++){this.transformMasterDataQuote&&(t[n]=this.transformMasterDataQuote(t[n]));var a=t[n];a.DT?("[object Date]"!=Object.prototype.toString.call(a.DT)&&(a.DT=new Date(a.DT)),a.Date&&17==a.Date.length||(a.Date=i.yyyymmddhhmmssmmm(a.DT))):a.Date?a.DT=i.strToDateTime(a.Date):console.log("setMasterData : Missing DT and Date on masterData object"),a.Volume&&"number"!=typeof a.Volume&&(a.Volume=parseInt(a.Volume,10))}e.decimalPlaces=this.callbacks.calculateTradingDecimalPlaces({stx:this,chart:e,symbol:e.symbolObject.symbol,symbolObject:e.symbolObject}),i.ChartEngine.isDailyInterval(this.layout.interval)||this.setDisplayDates(t),this.chart.roundit=Math.pow(10,e.decimalPlaces);for(n in this.plugins){var s=this.plugins[n];s.display&&s.setMasterData&&s.setMasterData(this,e)}},i.ChartEngine.prototype.setMasterDataRender=function(t,e,i){i||(i=this.chart),i.symbol||(i.symbol=""),this.setMasterData(e,i),e&&e.length&&(i.symbol=t),this.createDataSet(),this.initializeChart(),this.draw(),e&&e.length||(i.symbol=null,this.clear()),this.adjustPanelPositions()},i.ChartEngine.prototype.getSymbols=function(t){function e(t,e,i){return{symbol:t,symbolObject:e,periodicity:i.periodicity,interval:i.interval,timeUnit:i.timeUnit,setSpan:i.setSpan}}t||(t={});var r,n,a,s=[],o=this.layout;for(var l in this.charts){var h=this.charts[l];h.symbolObject&&h.symbolObject.symbol&&s.push(e(h.symbol,h.symbolObject,o));for(var u in h.series){var c=h.series[u],p=c.parameters;p.data&&!p.data.useDefaultQuoteFeed||(a=p.symbolObject,n=p.symbol,r=e(n,a,o),t["include-parameters"]&&(r.parameters=p),t["exclude-studies"]&&"study"==p.bucket||s.push(r))}}for(var d=s.length-1;d>=0;d--)if(n=s[d].symbol,this.isEquationChart(n)){var f=i.formatEquation(n);if(f){for(var m=0;m<f.symbols.length;m++)r=e(f.symbols[m],s[d].symbolObject,s[d]),s.push(r);s.splice(d,1)}}return s},i.ChartEngine.prototype.setDisplayDate=function(t){var e,i=t.DT,r=1e3*i.getSeconds()+i.getMilliseconds();this.dataZone&&(e=new s.Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),this.dataZone),i=new Date(e.getTime()+r)),this.displayZone&&(e=new s.Date(i.getTime(),this.displayZone),i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),i=new Date(i.getTime()+r)),t.displayDate=i},i.ChartEngine.prototype.setDisplayDates=function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];i.DT&&this.setDisplayDate(i)}},i.ChartEngine.prototype.streamTrade=function(t,e,i,r){var n=this.chart;r||(r={}),r.chart&&(n=r.chart),r.fillGaps=this.streamParameters.fillGaps;var a="object"==typeof t,s=a?t.last:arguments[0],o=a?t.volume:arguments[1],l=a?t.bid:null,h=a?t.ask:null;a||(e=arguments[2],i=arguments[3]),i&&(r.secondarySeries=i);var u={DT:e,Last:s,Volume:o,Bid:l,Ask:h};this.appendMasterData(u,n,r)},i.ChartEngine.prototype.appendMasterData=function(t,e,r){r||(r={}),e||(e=this.chart);var n=!1,a=!1,s=e.masterData,o=this.layout,l=this.dataZone;if(r.useAsLastSale||t.constructor==Object&&void 0!==t.Last&&null!==t.Last){if(n=!0,r.useAsLastSale&&r.useAsLastSale.aggregatedVolume&&(a=!0),t.constructor===Array){var h=t[t.length-1];t={},h.DT?t.DT=h.DT:t.DT=i.strToDateTime(h.Date),t.Close=h.Close,t.Volume=h.Volume}else t.Last&&(t.Close=t.Last,delete t.Last);if(t.DT&&(t.DT=new Date(+t.DT)),t.DT&&"Invalid Date"!=t.DT||(t.DT=this.convertToDataZone(new Date)),"tick"!=o.interval){var u,c,p=new i.Market({}),d={begin:s&&s.length?s[s.length-1].DT:t.DT,interval:o.interval,periodicity:1,timeUnit:o.timeUnit,inZone:l,outZone:l},f=p.newIterator(d),m=f.next();if(s){if(t.DT<m){u=0;var g=f.previous();for(c=t.DT;c<g&&u<1e3;)g=f.previous(),u++;t.DT=g,r.updating=!0}else if(t.DT>=m){for(u=0,c=t.DT;c>m&&u<1e3;)t.DT=m,m=f.next(),u++;r.appending=!0}}else t.DT=new Date(+f.previous())}t.Open=t.Close,t.High=t.Close,t.Low=t.Close}if(r.secondarySeries)i.addMemberToMasterdata(this,r.secondarySeries,t);else{if(t&&t.constructor==Object&&(t=[t]),!t||!t.length)return;if(this.runPrepend("appendMasterData",[t,e,r]))return;var v=t[0].DT;v&&"[object Date]"!=Object.prototype.toString.call(v)&&(t[0].DT=v=new Date(v)),v||(v=i.strToDateTime(t[0].Date));var y,x,C;if(s&&s.length){for(y=s.length-1;y>=0;){var S=s[y].DT;if(S||(S=i.strToDateTime(s[y].Date)),S.getTime()<=v.getTime()){var w=0;S.getTime()<v.getTime()&&(w=1,r.fillGaps&&(t.unshift(s[y]),t=this.doCleanupGaps(t,e),t.shift()));for(var D=0;D<t.length;D++){if(!w){x=t[D],C=s.length>y+D?s[y+D]:null,C&&(n?(x.Volume&&(x.Volume=parseInt(x.Volume,10)),a||(x.Volume+=C.Volume)):!x.Volume&&C.Volume&&(x.Volume=C.Volume),r.allowReplaceOHL||(isNaN(C.Open)||(x.Open=C.Open),!isNaN(C.High)&&C.High>x.High&&(x.High=C.High),!isNaN(C.Low)&&C.Low<x.Low&&(x.Low=C.Low)),isNaN(x.Close)&&!isNaN(C.Close)&&(x.Close=C.Close),isNaN(x.Bid)&&!isNaN(C.Bid)&&(x.Bid=C.Bid),isNaN(x.Ask)&&!isNaN(C.Ask)&&(x.Ask=C.Ask));for(var b in e.series){var T=e.series[b].parameters.symbolObject.symbol;void 0===x[T]&&C&&(x[T]=C[T])}}x=s[y+D+w]=t[D],x.DT&&"[object Date]"!=Object.prototype.toString.call(x.DT)&&(x.DT=new Date(x.DT)),x.DT?x.Date&&17==x.Date.length||(x.Date=i.yyyymmddhhmmssmmm(x.DT)):x.DT=i.strToDateTime(x.Date),x.Volume&&"number"!=typeof x.Volume&&(x.Volume=parseInt(x.Volume,10)),i.ChartEngine.isDailyInterval(o.interval)||this.setDisplayDate(x)}break}y--}this.maxMasterDataSize&&(s=e.masterData=this.masterData=s.slice(-this.maxMasterDataSize));for(y in this.plugins){var M=this.plugins[y];M.display&&M.appendMasterData&&M.appendMasterData(this,t,e)}}else s=i.clone(t),this.setMasterData(s,e);this.masterData&&this.masterData.length||(this.masterData=s)}if(!r.noCreateDataSet){var k=this.streamParameters;if(++k.count>k.maxTicks||r.bypassGovernor)clearTimeout(k.timeout),this.createDataSet(null,null,r),this.draw(),this.updateChartAccessories(),k.count=0,k.timeout=-1;else{var A=this;-1==k.timeout&&(k.timeout=setTimeout(function(){A.createDataSet(null,null,r),A.draw(),A.updateChartAccessories(),A.streamParameters.count=0,A.streamParameters.timeout=-1},k.maxWait))}}this.runAppend("appendMasterData",arguments)},i.ChartEngine.prototype.setMaxTicks=function(t,e){e||(e={}),(t=Math.round(t))<2&&(t=2);var i=e.padding?e.padding:0;this.layout.candleWidth=(this.chart.width-i)/t,this.layout.candleWidth||(this.layout.candleWidth=8),this.chart.maxTicks=Math.round(this.chart.width/this.layout.candleWidth-.499),(e.padding||0===e.padding)&&(this.chart.scroll=t+1)},i.ChartEngine.prototype.construct=function(){this.stackPanel("chart","chart",1),this.adjustPanelPositions(),this.chart.panel=this.panels[this.chart.name],this.cx=0,this.cy=0,this.micropixels=0,this.chart.panel.subholder.appendChild(this.controls.home),this.callbackListeners={doubleTap:[],drawing:[],layout:[],longhold:[],move:[],newChart:[],preferences:[],rightClick:[],studyOverlayEdit:[],studyPanelEdit:[],symbolChange:[],symbolImport:[],tap:[],theme:[],undoStamp:[]},this.longHoldTime=1e3},i.ChartEngine.prototype.addDomEventListener=function(t,e,i,r){t.addEventListener(e,i,r),this.eventListeners.push({element:t,event:e,function:i,options:r})},i.ChartEngine.prototype.addEventListener=function(t,e){if("*"===t)for(var i in this.callbackListeners)this.callbackListeners[i].push(e);else if(t instanceof Array)for(var r=0;r<t.length;r++)this.callbackListeners[t[r]].push(e);else{var n=this.callbackListeners[t];if(!n)throw new Error("Attempted to add an invalid listener.");n.push(e)}return{type:t,cb:e}},i.ChartEngine.prototype.removeEventListener=function(t,e){t&&"object"==typeof t||(t={type:t,cb:e});var i=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return void t.splice(i,1)},r=this.callbackListeners;if("*"!==t.type){if(!r[t.type])throw new Error("Attempted to remove an invalid listener.");i(r[t.type],t.cb)}else for(var n in r)i(r[n],t.cb)},i.ChartEngine.prototype.dispatch=function(t,e){this.callbacks[t]&&this.callbacks[t].call(this,e);var i,r=this.callbackListeners[t];if(r){for(var n=0;n<r.length;n++)i=r[n].call(this,e);if(i)return i}if(r=this.callbackListeners["*"]){for(var a=0;a<r.length;a++)i=r[a].call(this,e);if(i)return i}return!1},i.ChartEngine.prototype.deleteYAxisIfUnused=function(t,e){if(e&&e!==t.yAxis){for(var i in this.chart.seriesRenderers){var r=this.chart.seriesRenderers[i];if(r.params.yAxis===e&&0!==r.seriesParams.length)return}var n;for(n=0;n<t.yaxisLHS.length;n++)t.yaxisLHS[n]===e&&t.yaxisLHS.splice(n,1);for(n=1;n<t.yaxisRHS.length;n++)t.yaxisRHS[n]===e&&t.yaxisRHS.splice(n,1);this.resizeCanvas(),this.adjustPanelPositions()}},i.ChartEngine.prototype.addYAxis=function(t,e){if(e){t.yaxisLHS||(t.yaxisLHS=[],t.yaxisRHS=[],"left"==t.yAxis.position?t.yaxisLHS.push(t.yAxis):t.yaxisRHS.push(t.yAxis));for(var i=t.yaxisLHS.concat(t.yaxisRHS),r=0;r<i.length;r++)if(i[r]===e)return;"left"===e.position?t.yaxisLHS.unshift(e):(e.position="right",t.yaxisRHS.push(e)),this.preAdjustScroll(),this.resizeCanvas(),this.adjustPanelPositions(),this.postAdjustScroll()}},i.ChartEngine.prototype.calculateYAxisPositions=function(){var t=[];for(var e in this.charts)t.push(e);for(var i in this.panels){var r=this.panels[i];r.name!==r.chart.name&&t.push(i)}var n,a,s,o,l=0,h=0;for(a=0;a<t.length;a++)if(s=this.panels[t[a]]){if(!s.yaxisLHS){s.yaxisLHS=[],s.yaxisRHS=[];var u=s.yAxis.position;u||(u=s.chart.panel.yAxis.position),s["left"==u?"yaxisLHS":"yaxisRHS"].push(s.yAxis)}for(s.yAxis.width||0===s.yAxis.width||(s.yAxis.width=this.yaxisWidth),s.yaxisTotalWidthRight=0,s.yaxisTotalWidthLeft=0,n=0;n<s.yaxisLHS.length;n++)o=s.yaxisLHS[n],s.yaxisTotalWidthLeft+=o.width,o.justifyRight=null===o.justifyRight?s.chart.yAxis.justifyRight:o.justifyRight,null===o.justifyRight&&(o.justifyRight=!0);for(s.yaxisTotalWidthLeft>l&&(l=s.yaxisTotalWidthLeft),n=0;n<s.yaxisRHS.length;n++)o=s.yaxisRHS[n],s.yaxisTotalWidthRight+=o.width;s.yaxisTotalWidthRight>h&&(h=s.yaxisTotalWidthRight)}for(a=0;a<t.length;a++)if(s=this.panels[t[a]]){var c=s.name===s.chart.name,p=l;for(n=s.yaxisLHS.length-1;n>=0;n--)o=s.yaxisLHS[n],p-=o.width,o.left=p;for(p=this.width-h,n=0;n<s.yaxisRHS.length;n++)o=s.yaxisRHS[n],o.left=p,p+=o.width;void 0!==this.yaxisLeft&&(s.chart.yaxisPaddingRight=this.yaxisLeft),s.yaxisCalculatedPaddingRight=h,(s.chart.yaxisPaddingRight||0===s.chart.yaxisPaddingRight)&&(s.yaxisCalculatedPaddingRight=s.chart.yaxisPaddingRight),s.yaxisCalculatedPaddingLeft=l,(s.chart.yaxisPaddingLeft||0===s.chart.yaxisPaddingLeft)&&(s.yaxisCalculatedPaddingLeft=s.chart.yaxisPaddingLeft),c?(s.left=s.yaxisCalculatedPaddingLeft,s.right=this.width-s.yaxisCalculatedPaddingRight):(s.left=s.chart.panel.left,s.right=s.chart.panel.right),s.width=s.right-s.left,s.handle.style.left=s.left+"px",s.handle.style.width=s.width+"px",c&&(s.chart.left=s.left,s.chart.right=s.right,s.chart.width=Math.max(s.right-s.left,0))}},i.ChartEngine.prototype.initializeChart=function(t){if(!this.runPrepend("initializeChart",arguments)){this.chart.symbolObject.symbol||(this.chart.symbolObject.symbol=this.chart.symbol),this.locale&&this.setLocale(this.locale),!this.displayZone&&i.ChartEngine.defaultDisplayTimeZone&&this.setTimeZone(null,i.ChartEngine.defaultDisplayTimeZone),this.calculateYAxisPositions(),this.micropixels=0,t?this.chart.container=t:t=this.chart.container,t.stx=this,t.CIQRegistered||(t.CIQRegistered=!0,i.ChartEngine.registeredContainers.push(t)),i.isSurface&&(this.gesture||(this.gesture=new MSGesture,this.manageTouchAndMouse?this.gesture.target=t:this.gesture.target=document.body,this.gesturePointerId=null)),this.registerHTMLElements();var e=this.chart.canvas,r=this.chart.tempCanvas,a=this.floatCanvas;e&&document.createElement("canvas").getContext?(e.id||(t.removeChild(e),this.chart.canvas=null),r&&!r.id&&(t.removeChild(r),this.chart.tempCanvas=null),a&&!a.id&&(t.removeChild(a),this.floatCanvas=null)):(this.layout.candleWidth<this.minimumCandleWidth&&(this.layout.candleWidth=this.minimumCandleWidth),this.layout.candleWidth>200&&(this.layout.candleWidth=8)),this.chart.canvas||(e=this.chart.canvas=document.createElement("canvas")),this.chart.canvas.getContext?t.appendChild(e):(e=this.chart.canvas=t.querySelectorAll("#ie8canvas")[0],e.getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(e),e.style.display="block"),e.style.position="absolute",e.style.left="0px";(e.context=this.chart.context=e.getContext("2d")).lineWidth=1,this.chart.tempCanvas||(r=this.chart.tempCanvas=document.createElement("canvas")),this.chart.tempCanvas.getContext?t.appendChild(r):(r=this.chart.tempCanvas=t.querySelectorAll("#ie8canvasTemp")[0],r.getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(r)),r.style.position="absolute",r.style.left="0px",r.context=this.chart.tempCanvas.getContext("2d"),r.context.lineWidth=1,r.style.display="none",this.floatCanvas||(a=this.floatCanvas=document.createElement("canvas")),this.floatCanvas.getContext?t.appendChild(a):(a=this.floatCanvas=t.querySelectorAll("#ie8canvasFloat")[0],a.getContext||window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(a)),a.style.position="absolute",a.style.left="0px",a.context=a.getContext("2d"),a.context.lineWidth=1,a.style.display="none",this.resizeCanvas(),i.isAndroid&&(this.chart.tempCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()},this.floatCanvas.ontouchstart=function(t){t.preventDefault&&t.preventDefault()});var s=this.chart,o=this.panels;if(o.chart.display=s.symbol,s.symbolDisplay&&(o.chart.display=s.symbolDisplay),this.adjustPanelPositions(),this.chart.panel=o[s.name],this.calculateYAxisMargins(s.panel.yAxis),this.initialWhitespace=this.preferences.whitespace,s.dataSet&&s.dataSet.length>0){s.scroll=Math.floor(s.width/this.layout.candleWidth);var l=Math.round(this.preferences.whitespace/this.layout.candleWidth);s.scroll-=l}if(i.touchDevice){var h=n(".overlayEdit",t),u=n("#overlayTrashCan",t),c=n("#vectorTrashCan",t);h?(i.safeClickTouch(h,function(t){return function(e){t.deleteHighlighted(!0,!0)}}(this)),u&&i.safeClickTouch(u,function(t){return function(e){t.deleteHighlighted(!1)}}(this))):u&&i.safeClickTouch(u,function(t){return function(e){t.deleteHighlighted(!0)}}(this)),c&&i.safeClickTouch(c,function(t){return function(e){t.deleteHighlighted(!0)}}(this))}this.manageTouchAndMouse&&(this.registerTouchAndMouseEvents(),this.controls.chartControls&&(this.controls.chartControls.style.display="block")),t.onmouseout=function(t){return function(e){t.handleMouseOut(e)}}(this),this.abortDrawings(),this.undoStamps=[];for(var p in o){var d=o[p];d.markerHolder&&(t.removeChild(d.markerHolder),d.markerHolder=null)}for(var f in this.plugins){var m=this.plugins[f];m.display&&m.initializeChart&&m.initializeChart(this)}if(!this.resizeListenerInitialized){var g=this;this.resizeListenerInitialized=!0;var v=function(){return function(t){g.resizeChart()}};this.addDomEventListener(window,"resize",v,!0)}s.baseline.userLevel&&(s.baseline.userLevel=null),this.setResizeTimer(this.resizeDetectMS),this.runAppend("initializeChart",arguments)}},i.ChartEngine.prototype.destroy=function(){this.setResizeTimer(0),this.quoteDriver&&this.quoteDriver.die(),this.styles={};for(var t=0;t<this.eventListeners.length;t++){var e=this.eventListeners[t];e.element.removeEventListener(e.event,e.function,e.options)}this.streamParameters.timeout&&clearTimeout(this.streamParameters.timeout)},i.ChartEngine.prototype.handleMouseOut=function(t){if(t=t||window.event,!i.withinElement(this.chart.container,t.pageX,t.pageY)){if(this.runPrepend("handleMouseOut",arguments))return;if(this.undisplayCrosshairs(),this.grabbingScreen=!1,this.touches=[],this.touching=!1,this.activeDrawing&&this.userPointerDown){this.userPointerDown=!1,this.drawingLine=!1;var e=this.backOutY(t.pageY),r=this.backOutX(t.pageX);this.drawingClick(this.currentPanel,r,e)}i.ChartEngine.insideChart=!1,this.displaySticky(),this.findHighlights(!1,!0),this.runAppend("handleMouseOut",arguments)}},i.ChartEngine.prototype.registerTouchAndMouseEvents=function(){if(!this.touchAndMouseEventsRegistered){this.touchAndMouseEventsRegistered=!0;var t=n("#zoomIn",this.controls.chartControls),e=n("#zoomOut",this.controls.chartControls),r=this.chart.container,a=this,s=function(t,e){a.addDomEventListener(r,t,e)};i.touchDevice?i.isSurface?(s("mousemove",function(t){a.msMouseMoveProxy(t)}),s("mousedown",function(t){a.msMouseDownProxy(t)}),s("mouseup",function(t){a.msMouseUpProxy(t)}),window.navigator.msPointerEnabled?(s("MSPointerDown",function(t){return a.startProxy(t)}),s("MSGestureStart",function(t){a.gestureInEffect=!0}),s("MSGestureChange",function(t){return a.touchmove(t)}),s("MSGestureEnd",function(t){return a.gestureInEffect=!1,a.touchend(t)}),s("MSPointerMove",function(t){a.moveProxy(t)}),s("MSPointerUp",function(t){return a.endProxy(t)})):(s("pointerdown",function(t){return a.startProxy(t)}),s("MSGestureStart",function(t){a.gestureInEffect=!0}),s("MSGestureChange",function(t){return a.touchmove(t)}),s("MSGestureEnd",function(t){return a.gestureInEffect=!1,a.touchend(t)}),s("pointermove",function(t){a.moveProxy(t)}),s("pointerup",function(t){return a.endProxy(t)}))):(i.isAndroid||i.ipad||i.iphone||(s("mousemove",function(t){a.iosMouseMoveProxy(t)}),s("mousedown",function(t){a.iosMouseDownProxy(t)}),s("mouseup",function(t){a.iosMouseUpProxy(t)})),s("touchstart",function(t){a.touchstart(t)}),s("touchmove",function(t){a.touchmove(t)}),s("touchend",function(t){a.touchend(t)}),t&&(t.removeAttribute("onMouseOver"),t.removeAttribute("onMouseOut")),e&&(e.removeAttribute("onMouseOver"),e.removeAttribute("onMouseOut"))):(s("mousemove",function(t){a.mousemove(t)}),s("mousedown",function(t){a.mousedown(t)}),s("mouseup",function(t){a.mouseup(t)}));var o=i.wheelEvent;this.captureMouseWheelEvents&&this.addDomEventListener(r,o,function(t){a.mouseWheel(t)})}},i.ChartEngine.prototype.rightClickHighlighted=function(){this.runPrepend("rightClickHighlighted",arguments)||(this.deleteHighlighted(!0),this.runAppend("rightClickHighlighted",arguments))},i.ChartEngine.prototype.deleteHighlighted=function(t,e){if(!this.runPrepend("deleteHighlighted",arguments)){this.cancelTouchSingleClick=!0,i.clearCanvas(this.chart.tempCanvas,this);for(var r=this.drawingObjects.length-1;r>=0;r--){var n=this.drawingObjects[r];if(n.highlighted&&!n.permanent){if(!n.abort()){var a=i.shallowClone(this.drawingObjects);this.drawingObjects.splice(r,1),this.undoStamp(a,i.shallowClone(this.drawingObjects))}this.changeOccurred("vector")}}for(var s in this.overlays){var o=this.overlays[s];o.highlight&&!o.permanent&&(t||e?this.rightClickOverlay(s,e):this.removeOverlay(s))}var l=this.currentPanel.chart;for(var h in l.seriesRenderers)for(var u=l.seriesRenderers[h],c=u.seriesParams.length-1;c>=0;c--){var p=u.seriesParams[c];p.highlight&&!p.permanent&&(u.removeSeries(p.field),u.seriesParams.length<1&&this.removeSeriesRenderer(u))}this.draw(),this.clearMeasure(),this.controls.mSticky&&(this.controls.mSticky.style.display="none",this.controls.mSticky.children[0].innerHTML=""),this.runAppend("deleteHighlighted",arguments)}},i.ChartEngine.prototype.panelExists=function(t){for(var e in this.panels){if(this.panels[e].name==t)return!0}return!1},i.ChartEngine.prototype.hideCrosshairs=function(){this.displayCrosshairs=!1},i.ChartEngine.prototype.showCrosshairs=function(){this.displayCrosshairs=!0},i.ChartEngine.prototype.grabHandle=function(t){this.runPrepend("grabHandle",arguments)||t&&(i.ChartEngine.crosshairY=t.top+this.top,i.ChartEngine.resizingPanel=t,i.appendClassName(t.handle,"stx-grab"),this.runAppend("grabHandle",arguments))},i.ChartEngine.prototype.releaseHandle=function(){this.runPrepend("releaseHandle",arguments)||(i.clearCanvas(this.chart.tempCanvas,this),this.resizePanels(),i.ChartEngine.resizingPanel&&i.unappendClassName(i.ChartEngine.resizingPanel.handle,"stx-grab"),i.ChartEngine.resizingPanel=null,this.runAppend("releaseHandle",arguments))},i.ChartEngine.prototype.storePanels=function(){this.layout||(this.layout={});var t=this.layout;t.panels={};for(var e in this.panels){var i=this.panels[e];t.panels[i.name]={percent:i.percent,display:i.display}}},i.ChartEngine.prototype.savePanels=function(t){this.storePanels(),!1!==t&&this.changeOccurred("layout")},i.ChartEngine.prototype.resolveY=function(t){return this.top+t},i.ChartEngine.prototype.resolveX=function(t){return this.left+t},i.ChartEngine.prototype.backOutY=function(t){return t-this.top},i.ChartEngine.prototype.backOutX=function(t){return t-this.left},i.ChartEngine.prototype.cleanupRemovedStudy=function(t){t.study.removeFN&&t.study.removeFN(this,t),t.study.feed&&this.detachTagAlongQuoteFeed(t.study.feed);for(var e in this.plugins)e.indexOf("{"+t.id+"}")>-1&&delete this.plugins[e];this.layout.studies&&delete this.layout.studies[t.name],i.Studies.removeStudySymbols(t,this),this.quoteDriver&&this.quoteDriver.updateSubscriptions()},i.ChartEngine.prototype.privateDeletePanel=function(t){if(this.layout.studies){var e=this.layout.studies[t.name];e&&this.cleanupRemovedStudy(e)}if(delete this.panels[t.name],i.Studies)for(var r in i.Studies.studyPanelMap)i.Studies.studyPanelMap[r].panel==t.name&&delete i.Studies.studyPanelMap[r];for(var n in this.overlays)this.overlays[n].panel==t.name&&(this.cleanupRemovedStudy(this.layout.studies[n]),delete this.overlays[n]);if(t.holder&&(this.chart.container.removeChild(t.holder),this.getMarkerArray))for(var a=this.getMarkerArray("panelName",t.name),s=0;s<a.length;s++)this.removeFromHolder(a[s]);t.handle.parentNode.removeChild(t.handle),this.currentPanel=null},i.ChartEngine.prototype.panelClose=function(t){if(t&&!this.runPrepend("panelClose",arguments)){if(this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,t.soloing&&this.panelSolo(t),this.charts[t.name]){for(var e in this.panels){var r=this.panels[e];r.chart.name==t.name&&this.privateDeletePanel(r)}delete this.charts[t.name]}else this.privateDeletePanel(t);this.showCrosshairs(),this.createDataSet(),this.adjustPanelPositions(),this.draw(),this.savePanels(),this.openDialog&&(this.openDialog=""),this.runAppend("panelClose",arguments)}},i.ChartEngine.prototype.deleteAllPanels=function(){for(var t in this.panels){var e=this.panels[t];this.privateDeletePanel(e)}this.layout.panels={},this.panels={}},i.ChartEngine.prototype.panelUp=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,r={},n=0;for(e in this.panels){if(e==t.name)break;n++}if(n){var a=0;for(e in this.panels)a==n-1&&(r[t.name]=t),e!=t.name&&(r[e]=this.panels[e],a++);this.panels=r,this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.panelDown=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e,r={},n=0;for(e in this.panels){if(e==t.name)break;n++}var a=0;for(e in this.panels)a++;if(n!=a-1){var s=0;for(e in this.panels)e!=t.name?(r[e]=this.panels[e],s==n+1&&(r[t.name]=t),s++):s++;this.panels=r,this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.panelSolo=function(t){this.cancelTouchSingleClick=!0,i.ChartEngine.drawingLine=!1,this.showCrosshairs();var e=!0;t.soloing?(e=!1,t.soloing=!1,i.unappendClassName(t.solo,"stx_solo_lit"),t.percent=t.oldPercent,"chart"==t.name||this.soloPanelToFullScreen||(this.panels.chart.percent=this.panels.chart.oldPercent),this.soloPanelToFullScreen&&(this.xAxisAsFooter=this.panels.chart.oldXAxisAsFooter,this.panels.chart.subholder.appendChild(this.controls.home))):(t.soloing=!0,i.appendClassName(t.solo,"stx_solo_lit"),t.oldPercent=t.percent,"chart"!=t.name&&(this.soloPanelToFullScreen?(this.panels.chart.oldXAxisAsFooter=this.xAxisAsFooter,this.xAxisAsFooter=!0,t.subholder.appendChild(this.controls.home)):(this.panels.chart.oldPercent=this.panels.chart.percent,t.percent=1-this.panels.chart.percent)));for(var r in this.panels)this.panels[r].hidden=e;this.soloPanelToFullScreen||(this.panels.chart.hidden=!1),t.hidden=!1,this.adjustPanelPositions(),this.draw(),this.savePanels()},i.ChartEngine.prototype.calculatePanelPercent=function(t){var e=t.bottom-t.top;t.percent=e/this.chart.canvasHeight},i.ChartEngine.prototype.resizePanels=function(){if(i.ChartEngine.resizingPanel){var t,e,r,n=!0;if(i.ChartEngine.crosshairY>this.resolveY(i.ChartEngine.resizingPanel.top)&&(n=!1),n){r=null;for(t in this.panels){if(this.panels[t]==i.ChartEngine.resizingPanel)break;this.panels[t].hidden||(r=this.panels[t])}e=this.backOutY(i.ChartEngine.crosshairY),e<r.top+30&&(e=r.top+30,i.ChartEngine.crosshairY=this.resolveY(e)),r.bottom=e,i.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(r),this.calculatePanelPercent(i.ChartEngine.resizingPanel)}else{r=null;for(t in this.panels){if(this.panels[t]==i.ChartEngine.resizingPanel)break;this.panels[t].hidden||(r=this.panels[t])}e=this.backOutY(i.ChartEngine.crosshairY),e>i.ChartEngine.resizingPanel.bottom-30&&(e=i.ChartEngine.resizingPanel.bottom-30,i.ChartEngine.crosshairY=this.resolveY(e)),r.bottom=e,i.ChartEngine.resizingPanel.top=e,this.calculatePanelPercent(r),this.calculatePanelPercent(i.ChartEngine.resizingPanel)}this.adjustPanelPositions(),this.draw(),this.savePanels()}},i.ChartEngine.prototype.adjustPanelPositions=function(){if(this.chart.symbol&&!this.runPrepend("adjustPanelPositions",arguments)){var t,e,i=0,r=this.chart.canvasHeight,n=!1,a=0,s=0,o=!1;for(t in this.panels)e=this.panels[t],(isNaN(e.percent)||e.percent<=0)&&(e.percent=.05),e.hidden||(a+=e.percent,s++,e.soloing&&(o=!0));for(t in this.panels){var l=0;if(e=this.panels[t],e.hidden)e.markerHolder&&(e.markerHolder.style.display="none");else{n?this.displayIconsUpDown&&(e.up.style.display=""):(n=!0,e.up.style.display="none"),o?e.soloing?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none":1==s?e.solo.style.display="none":2!=s||this.soloPanelToFullScreen?this.displayIconsSolo&&(e.solo.style.display=""):e.solo.style.display="none",1==s?e.down.style.display="none":this.displayIconsUpDown&&(e.down.style.display=""),e.editFunction?e.edit.style.display="":e.edit.style.display="none",e.percent=e.percent/a,e.top=i,e.bottom=e.top+r*e.percent,e.height=e.bottom-e.top,e.chart.name==e.name&&(e.chart.top=e.top,e.chart.bottom=e.bottom,e.chart.height=e.height);var h=e.yAxis;h.zoom&&h.height>0&&(l=h.zoom/h.height),this.adjustYAxisHeightOffset(e,h),h.top=e.top+h.topOffset,h.bottom=e.bottom-h.bottomOffset,h.height=h.bottom-h.top,l&&(h.zoom=l*h.height,h.zoom>h.height&&(h.zoom=0,h.scroll=0)),i=e.bottom,h.high||0===h.high||(h.high=100,h.low=0,h.shadow=100),h.multiplier=h.height/h.shadow,e.holder&&(e.holder.style.right="0px",e.holder.style.top=e.top+"px",e.holder.style.left="0px",e.holder.style.height=e.height+"px",e.subholder.style.left=e.left+"px",e.subholder.style.width=e.width+"px",e.subholder.style.top="0px",h.height>=0&&(e.subholder.style.height=h.height+"px"))}}if(t&&(this.panels[t].down.style.display="none"),2!=s||o||(this.panels.chart.solo.style.display=""),this.controls.chartControls&&this.panels.chart){var u;u=o&&this.soloPanelToFullScreen?this.chart.canvasHeight-e.yAxis.bottom+12:this.chart.canvasHeight-this.panels.chart.yAxis.bottom+12,this.controls.chartControls.style.bottom=u+"px"}this.clearPixelCache(),this.adjustDrawings(),this.runAppend("adjustPanelPositions",arguments)}},i.ChartEngine.prototype.addChart=function(t,e){e.name=t,this.charts[t]=e},i.ChartEngine.prototype.createPanel=function(t,e,i,r){if(!this.runPrepend("createPanel",arguments)){r||(r="chart");var n=this.chart.canvasHeight;i||(i=.2*n);var a=i/n,s=1-a;for(var o in this.panels){this.panels[o].percent*=s}this.stackPanel(t,e,a,r),this.adjustPanelPositions(),this.savePanels(!1),this.runAppend("createPanel",arguments)}},i.ChartEngine.prototype.configurePanelControls=function(t){var e=t.name==t.chart.name;t.icons=n(".stx-panel-control",t.holder),t.close=t.icons.children[4],t.close=n(".stx-ico-close",t.icons).parentNode,i.appendClassName(t.icons,"stx-show"),t.title=n(".stx-panel-title",t.icons),t.up=n(".stx-ico-up",t.icons).parentNode,t.solo=n(".stx-ico-focus",t.icons).parentNode,t.down=n(".stx-ico-down",t.icons).parentNode,t.edit=n(".stx-ico-edit",t.icons).parentNode,this.displayIconsUpDown||(t.up.style.display="none"),this.displayIconsUpDown||(t.down.style.display="none"),this.displayIconsSolo||(t.solo.style.display="none"),this.displayIconsClose||(t.close.style.display="none"),
this.displayPanelResize||(t.handle.style.display="none"),t.title.innerHTML="",t.display&&t.title.appendChild(document.createTextNode(t.display)),e&&(i.appendClassName(t.title,"chart-title"),i.appendClassName(t.icons,"stx-chart-panel")),i.touchDevice&&!i.isSurface||this.makeModal(t.icons),i.touchDevice&&!i.isSurface||(t.handle.onmouseover=function(t){return function(){t.hideCrosshairs()}}(this)),i.touchDevice&&!i.isSurface||(t.handle.onmouseout=function(t){return function(){t.showCrosshairs()}}(this)),i.touchDevice&&(t.handle.ontouchstart=function(t,e){return function(i){t.resizingPanel||(i.preventDefault(),t.grabHandle(e))}}(this,t),t.handle.ontouchend=function(t){return function(e){e.preventDefault(),t.releaseHandle()}}(this)),t.handle.onmousedown=function(t,e){return function(i){i||(i=event),t.grabHandle(e)}}(this,t),t.handle.onmouseup=function(t){return function(e){e||(e=event),t.releaseHandle()}}(this),i.safeClickTouch(t.close,function(t,e){return function(){t.panelClose(e)}}(this,t)),i.safeClickTouch(t.up,function(t,e){return function(){t.panelUp(e)}}(this,t)),i.safeClickTouch(t.down,function(t,e){return function(){t.panelDown(e)}}(this,t)),i.safeClickTouch(t.solo,function(t,e){return function(){t.panelSolo(e)}}(this,t)),"chart"==t.name&&(t.close.style.display="none")},i.ChartEngine.prototype.stackPanel=function(t,e,r,n){if(!this.runPrepend("stackPanel",arguments)){n||(n="chart");var a=this.charts[n],s=e==n,o=null;s&&(t=a.symbol,a.symbolDisplay&&(t=a.symbolDisplay),o=a.yAxis);var l=this.panels[e]=new i.ChartEngine.Panel(e,o);!s&&a.yAxis&&(l.yAxis.width=a.yAxis.width),l.percent=r,l.chart=a,l.display=t,l.holder=i.newChild(this.container,"div","stx-holder"),l.subholder=i.newChild(l.holder,"div","stx-subholder"),l.subholder.style.zIndex=1,l.holder.setAttribute("cq-panel-name",e),l.subholder.setAttribute("cq-panel-name",e);var h=s?"stx-panel-chart":"stx-panel-study";i.appendClassName(l.holder,h),l.subholder.appendChild(this.controls.iconsTemplate.cloneNode(!0)),l.handle=this.controls.handleTemplate.cloneNode(!0),this.container.appendChild(l.handle),l.handle.id=null,l.handle.panel=l,this.configurePanelControls(l),this.resizeCanvas(),this.runAppend("stackPanel",arguments)}},i.ChartEngine.prototype.setPanelEdit=function(t,e){t.editFunction=e,i.safeClickTouch(t.edit,e),this.adjustPanelPositions()},i.ChartEngine.prototype.drawPanels=function(){if(!this.runPrepend("drawPanels",arguments)){var t=!1;for(var e in this.panels){var r=this.panels[e];r.axisDrawn=!1,r.state={};var n=this.translateIf(r.display);if(r.title.textContent!=n&&(r.title.innerHTML="",r.title.appendChild(document.createTextNode(n))),i.appendClassName(r.icons,"stx-show"),r.hidden)i.unappendClassName(r.icons,"stx-show"),r.handle.style.display="none",r.holder.style.display="none";else if(this.displayIconsUpDown||(r.up.style.display="none"),this.displayIconsUpDown||(r.down.style.display="none"),this.displayIconsSolo||(r.solo.style.display="none"),r.holder.style.display="block",t){var a=r.top;a=Math.round(a)+.5,this.plotLine(r.left,r.right,a,a,this.canvasStyle("stx_panel_border"),"segment",this.chart.context,!1,{}),this.displayPanelResize?r.handle.style.display="":r.handle.style.display="none",r.handle.style.top=a-r.handle.offsetHeight/2+"px"}else r.handle.style.display="none",t=!0}this.runAppend("drawPanels",arguments)}},i.ChartEngine.prototype.touchSingleClick=function(t,e,r){var n=this,a=arguments;return function(){(function(){if(!this.cancelTouchSingleClick){if(this.runPrepend("touchSingleClick",a))return;if(this.editingAnnotation)return;if(this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},!this.displayCrosshairs)return;if(!this.displayInitialized)return;if(""!==this.openDialog)return;if(e<this.left||e>this.right||r<this.top||r>this.bottom)return;var t=this.backOutY(i.ChartEngine.crosshairY),s=this.backOutX(i.ChartEngine.crosshairX);this.currentPanel=this.whichPanel(t);var o=this.currentVectorParameters.vectorType;if(!(i.Drawing&&o&&i.Drawing[o]&&(new i.Drawing[o]).dragToDraw)){if(!this.drawingClick(this.currentPanel,s,t)&&!this.layout.crosshair){i.ChartEngine.crosshairY=0,i.ChartEngine.crosshairX=0,this.cx=this.backOutX(i.ChartEngine.crosshairX),this.cy=this.backOutY(i.ChartEngine.crosshairY),this.findHighlights(),i.ChartEngine.crosshairY=r,i.ChartEngine.crosshairX=e;var l=this.container.getBoundingClientRect();this.top=l.top,this.left=l.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cx=this.backOutX(i.ChartEngine.crosshairX),this.cy=this.backOutY(i.ChartEngine.crosshairY),this.currentPanel&&this.currentPanel.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.cx,this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel))),this.headsUpHR(),this.findHighlights(!0)}this.currentVectorParameters.vectorType||this.dispatch("tap",{stx:this,panel:this.currentPanel,x:s,y:t})}}n.cancelTouchSingleClick=!1,this.runAppend("touchSingleClick",a)}).apply(n,a)}},i.ChartEngine.prototype.touchDoubleClick=function(t,e,r){if(!this.runPrepend("touchDoubleClick",arguments)&&!this.dispatch("doubleTap",{stx:this,finger:t,x:e,y:r})&&!(e<this.left||e>this.right||r<this.panels.chart.top||r>this.panels.chart.bottom||this.editingAnnotation)){if(i.ChartEngine.drawingLine)this.undo();else if(this.anyHighlighted)this.deleteHighlighted();else{var n=this.currentPanel.yAxis;n.scroll==(n.initialMarginTop-n.initialMarginBottom)/2&&n.zoom==n.initialMarginTop+n.initialMarginBottom?this.home():this.calculateYAxisMargins(this.currentPanel.yAxis),this.draw()}this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1},this.runAppend("touchDoubleClick",arguments)}},i.ChartEngine.prototype.startProxy=function(t){if(4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,!this.mouseMode)if(this.touches[this.touches.length]={pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY},this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||1!=this.touches.length)this.gesture.stop(),this.touchstart(t);else{if(this.gesturePointerId=t.pointerId,this.overrideGesture=!1,!this.gesture)return;this.gesture.addPointer(t.pointerId),this.touchstart(t)}},i.ChartEngine.prototype.moveProxy=function(t){4==t.pointerType||"mouse"==t.pointerType?this.mouseMode=!0:this.mouseMode=!1,this.mouseMode||this.gestureInEffect||this.touchmove(t)},i.ChartEngine.prototype.endProxy=function(t){if(!this.mouseMode){for(var e=this.touches.length,i=0;i<this.touches.length;i++)if(this.touches[i].pointerId==t.pointerId){this.touches.splice(i,1);break}if(i==e)return this.touches=[],this.grabbingScreen=!1,void(this.touching=!1);this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],this.gestureInEffect||this.touchend(t)}},i.ChartEngine.prototype.msMouseMoveProxy=function(t){!this.touches.length&&this.mouseMode&&this.mousemove(t)},i.ChartEngine.prototype.msMouseDownProxy=function(t){this.mouseMode&&this.mousedown(t)},i.ChartEngine.prototype.msMouseUpProxy=function(t){this.mouseMode&&this.mouseup(t)},i.ChartEngine.prototype.iosMouseMoveProxy=function(t){this.touching||this.mousemove(t)},i.ChartEngine.prototype.iosMouseDownProxy=function(t){if(this.touching)return void(this.mouseMode=!1);this.mouseMode=!0,this.mousedown(t)},i.ChartEngine.prototype.iosMouseUpProxy=function(t){this.touching||this.mouseup(t)},i.ChartEngine.prototype.rawWatermark=function(t,e,i,r){this.canvasFont("stx_watermark",t),t.fillStyle=this.defaultColor,t.globalAlpha=.5,this.chart.context.textBaseline="alphabetic",t.fillText(r,e,i),t.globalAlpha=1},i.ChartEngine.prototype.watermark=function(t,e){if(e&&"object"!=typeof e&&(e={h:arguments[1],v:arguments[2],text:arguments[3]}),e={h:e.h||"left",v:e.v||"bottom",text:e.text||"",hOffset:e.hOffset||10,vOffset:e.vOffset||20},this.chart.context){var i=this.panels[t];if(i&&!i.hidden){var r=i.yAxis.bottom-e.vOffset;"top"==e.v?r=i.top+e.vOffset:"middle"==e.v&&(r=(i.top+i.yAxis.bottom)/2),this.chart.context.save(),this.canvasFont("stx_watermark"),this.canvasColor("stx_watermark"),this.chart.context.textBaseline="alphabetic";var n=i.left+e.hOffset;"right"==e.h?n=i.right-e.hOffset:"center"==e.h&&(n=(i.right+i.left-this.chart.context.measureText(e.text).width)/2),this.chart.context.globalAlpha=.5,this.chart.context.fillText(e.text,n,r),this.chart.context.globalAlpha=1,this.chart.context.restore()}}},i.ChartEngine.prototype.preAdjustScroll=function(t){t||(t=this.chart),this.previousAdjust={chart:t,scroll:t.scroll,maxTicks:t.maxTicks}},i.ChartEngine.prototype.postAdjustScroll=function(){if(this.previousAdjust){var t=this.previousAdjust.chart;t.scroll=this.previousAdjust.scroll+(t.maxTicks-this.previousAdjust.maxTicks),this.displayInitialized&&this.draw()}},i.ChartEngine.prototype.adjustDrawings=function(){for(var t=0;t<this.drawingObjects.length;t++){var e=this.drawingObjects[t];this.panels[e.panelName]&&e.adjust()}},i.ChartEngine.prototype.getNextInterval=function(t,e,i){e||(e=1),!1!==i&&(i=!0);var r=this.standardMarketIterator(t,i?this.dataZone:this.displayZone);return e<1?r.previous(-1*e):r.next(e)},i.ChartEngine.prototype.standardMarketIterator=function(t,e,i){var r=e||this.dataZone,n=i||this.chart,a={begin:t,interval:"tick"==this.layout.interval?1:this.layout.interval,periodicity:"tick"==this.layout.interval?this.chart.xAxis.futureTicksInterval:this.layout.periodicity,timeUnit:this.layout.timeUnit,inZone:this.dataZone,outZone:r};return n.market.newIterator(a)},i.ChartEngine.prototype.zoomSet=function(t,e){if("volume_candle"!==this.layout.chartType){var i;i=this.preferences.zoomAtCurrentMousePosition&&this.zoomInitiatedByMouseWheel&&this.crosshairTick<e.dataSet.length?this.crosshairTick||this.tickFromPixel(this.cx,e):this.isHome()?e.dataSet.length-1:this.chart.scroll>this.chart.dataSet.length?0:this.tickFromPixel(this.chart.width/2,e),this.animations.zoom.hasCompleted&&(this.zoomInitiatedByMouseWheel=!1);var r=e.dataSet.length-1-i,n=e.scroll;e.scroll=Math.floor(this.pixelFromTick(i,e)/t)+1+r,this.micropixels+=(n-r)*this.layout.candleWidth-(e.scroll-r)*t}this.setCandleWidth(t),e.spanLock=!1,this.draw(),this.doDisplayCrosshairs(),this.updateChartAccessories()},i.ChartEngine.prototype.zoomOut=function(t,e){if(!this.runPrepend("zoomOut",arguments)){this.grabbingScreen=!1,i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"),this.preferences.zoomOutSpeed?e=this.preferences.zoomOutSpeed:e||(e=1.3),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var r=this;for(var n in this.charts){var a=this.charts[n];if(i.ipad&&a.maxTicks>i.ChartEngine.ipadMaxTicks)return;var s=Math.floor(a.maxTicks*e);!1===a.allowScrollFuture&&!1===a.allowScrollPast&&s>a.dataSet.length&&(s=a.dataSet.length);var o=this.chart.width/s;o<this.minimumCandleWidth&&(o=this.minimumCandleWidth),this.layout.setSpan=null,this.animations.zoom.run(function(t){return function(e){if(r.zoomSet(e,t),r.animations.zoom.hasCompleted){if(r.runAppend("zoomOut",arguments))return;r.changeOccurred("layout")}}}(a),this.layout.candleWidth,o)}}},i.ChartEngine.prototype.mouseWheel=function(t){if(!this.runPrepend("mouseWheel",arguments)){t||(t=event),t.preventDefault&&t.preventDefault();var e=t.deltaX,r=t.deltaY;if(Math.abs(r)>Math.abs(e)?e=0:r=0,this.lastMouseWheelEvent=Date.now(),0!==Math.abs(e)||0!==Math.abs(r)){if(this.allowSideswipe&&0!==e){this.lastMove="horizontal";var n=-1*e;return n>50&&(n=50),n<-50&&(n=-50),this.grabbingScreen=!0,this.currentPanel||(this.currentPanel=this.chart.panel),this.grabStartX=i.ChartEngine.crosshairX,this.grabStartY=i.ChartEngine.crosshairY,this.grabStartScrollX=this.chart.scroll,this.grabStartScrollY=this.currentPanel.yAxis.scroll,this.grabStartMicropixels=this.micropixels,this.grabStartPanel=this.currentPanel,this.mousemoveinner(i.ChartEngine.crosshairX-n,i.ChartEngine.crosshairY),this.updateChartAccessories(),void(this.grabbingScreen=!1)}if(this.lastMove="vertical",this.allowZoom&&this.displayInitialized){r||("onmousewheel"==i.wheelEvent?(r=-.025*t.wheelDelta,t.wheelDeltaX&&(e=-.025*t.wheelDeltaX)):r=t.detail),void 0===t.deltaMode&&(t.deltaMode="MozMousePixelScroll"==t.type?0:1);var a=r;1==t.deltaMode&&(a*=33);var s=null,o=null;if(this.mouseWheelAcceleration){var l=Math.max(Math.pow(Math.abs(a),.3),1);s=1-.1*l,o=1+.2*l}if(this.zoomInitiatedByMouseWheel=!0,a>0?this.reverseMouseWheel?this.zoomOut(null,o):this.zoomIn(null,s):a<0&&(this.reverseMouseWheel?this.zoomIn(null,s):this.zoomOut(null,o)),!this.runAppend("mouseWheel",arguments))return!1}}}},i.ChartEngine.prototype.zoomIn=function(t,e){if(!this.runPrepend("zoomIn",arguments)){this.grabbingScreen=!1,i.ChartEngine.insideChart&&i.unappendClassName(this.container,"stx-drag-chart"),this.preferences.zoomInSpeed?e=this.preferences.zoomInSpeed:e||(e=.7),t&&t.preventDefault&&t.preventDefault(),this.cancelTouchSingleClick=!0;var r=this;for(var n in this.charts){var a=this.charts[n],s=Math.floor(a.maxTicks*e);a.maxTicks-s<1&&(s=a.maxTicks-1),s<this.minimumZoomTicks&&(s=this.minimumZoomTicks);var o=this.chart.width/s;this.layout.setSpan=null,this.animations.zoom.run(function(t){return function(e){if(r.zoomSet(e,t),r.animations.zoom.hasCompleted){if(r.runAppend("zoomIn",arguments))return;r.changeOccurred("layout")}}}(a),this.layout.candleWidth,o)}}},i.ChartEngine.prototype.translateIf=function(t){return this.translationCallback?this.translationCallback(t):t},i.ChartEngine.prototype.setTimeZone=function(t,e){if(void 0===s)return void(this.timeZoneOffset=0);var r=new Date,n=r.getTimezoneOffset(),a=n,o=n;t&&(this.dataZone=t),this.dataZone&&(a=new s.Date(r,this.dataZone).getTimezoneOffset()),e&&(this.displayZone=e),this.displayZone&&(o=new s.Date(r,this.displayZone).getTimezoneOffset()),this.timeZoneOffset=a-n-(o-n);for(var l in this.charts){var h=this.charts[l];h.masterData&&!i.ChartEngine.isDailyInterval(this.layout.interval)&&this.setDisplayDates(h.masterData)}this.preferences.timeZone=e,this.changeOccurred("preferences"),this.createDataSet()},i.ChartEngine.prototype.setLocale=function(t,e){if("undefined"!=typeof Intl&&this.locale!=t){this.locale=t;var r,n=this.internationalizer={};for(n.hourMinute=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",hour12:!1}),n.hourMinuteSecond=new Intl.DateTimeFormat(this.locale,{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),n.mdhm=new Intl.DateTimeFormat(this.locale,{year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),n.monthDay=new Intl.DateTimeFormat(this.locale,{month:"numeric",day:"numeric"}),n.yearMonthDay=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric",day:"numeric"}),n.yearMonth=new Intl.DateTimeFormat(this.locale,{year:"numeric",month:"numeric"}),n.month=new Intl.DateTimeFormat(this.locale,{month:"short"}),n.numbers=new Intl.NumberFormat(this.locale),n.priceFormatters=[],e||(e=5),r=0;r<e+1;r++)n.priceFormatters.push(new Intl.NumberFormat(this.locale,{maximumFractionDigits:r,minimumFractionDigits:r}));for(r=0;r<5;r++){var a=r,s=r;r||(a="",s=2),n["percent"+a]=new Intl.NumberFormat(this.locale,{style:"percent",minimumFractionDigits:s,maximumFractionDigits:s})}i.I18N.createMonthArrays&&i.I18N.createMonthArrays(this,n.month,this.locale)}},i.ChartEngine.prototype.importLayout=function(t,e){"object"!=typeof e&&(e={managePeriodicity:arguments[1],preserveTicksAndCandleWidth:arguments[2]});var r=this.layout,n=i.shallowClone(r),a=e.managePeriodicity,s=e.cb,o=e.seriesCB,l=e.noDataLoad,h=this.minimumCandleWidth,u=e.preserveTicksAndCandleWidth;u||!1===u||(u=!0);var c=this.exportDrawings();if(this.abortDrawings(),this.currentlyImporting=!0,i.Studies)for(var p in r.studies){var d=r.studies[p];i.Studies.removeStudy(this,d)}this.overlays={};var f=i.clone(t);if(f){var m=i.shallowClone(this.panels);this.panels={};var g=i.clone(f);a||(delete g.periodicity,delete g.interval,delete g.timeUnit,delete g.setSpan),i.dataBindSafeAssignment(r,g),a||(r.periodicity=n.periodicity,r.interval=n.interval,r.timeUnit=n.timeUnit,r.setSpan=n.setSpan),u?r.candleWidth=n.candleWidth:r.candleWidth||(r.candleWidth=8),r.candleWidth<h&&(r.candleWidth=h),this.setCandleWidth(r.candleWidth),"percent"==r.chartScale&&this.setComparison(!0);var v,y,x,C=f.panels,S=[];for(y in C){if(!("top"in C[y]))break;for(x=C[y],x.name=y,v=S.length-1;v>=0&&S[v].top>x.top;--v);S.splice(v+1,0,x)}if(r.panels={},S.length>0)for(var w=0;w<S.length;++w)x=S[w],this.stackPanel(x.display,x.name,x.percent,x.chartName);else for(y in C)x=C[y],this.stackPanel(x.display,y,x.percent,x.chartName);i.isEmpty(C)&&this.stackPanel("chart","chart",1,"chart");for(var D in m){var b=m[D],T=this.panels[D];if(T){this.container.removeChild(T.holder),this.container.removeChild(b.handle);var M={holder:!0,subholder:!0,display:!0};for(var k in M)T[k]=b[k];this.configurePanelControls(T),b.chart.panel==b&&(b.chart.panel=T)}else this.privateDeletePanel(b)}if(this.adjustPanelPositions(),this.storePanels(),i.Studies){var A=i.clone(r.studies);delete r.studies;for(var P in A){var _=A[P];i.Studies.addStudy(this,_.type,_.inputs,_.outputs,_.parameters,_.panel)}}}void 0===r.chartType&&(r.chartType="line"),this.adjustPanelPositions();var F=this;if(t.symbols&&t.symbols.length){var E={};a&&(t.setSpan?E.span=t.setSpan:t.interval&&(E.periodicity={interval:t.interval,periodicity:t.periodicity,timeUnit:t.timeUnit}));var L=t.symbols[0].symbolObject||t.symbols[0].symbol;return void(l||this.newChart(L,null,this.chart,function(e){if(!e)for(var r,n=1;n<t.symbols.length;++n){r=t.symbols[n],r.parameters||(r.parameters={});var a=i.clone(r.parameters);a.action=null,F.addSeries(r.symbol,a,o)}F.importDrawings(c),F.draw(),F.currentlyImporting=!1,F.updateListeners("layout"),s&&s.apply(null,arguments)},E))}if(f&&a&&!l){if(f.setSpan&&this.chart.symbol)return void this.setSpan(f.setSpan,function(){F.importDrawings(c),F.draw(),F.currentlyImporting=!1,F.updateListeners("layout"),s&&s()});var N=f.interval,O=f.periodicity,I=f.timeUnit;if(isNaN(O)&&(O=1),N||(N="day"),N!=r.interval||O!=r.periodicity)return void this.setPeriodicity({period:O,interval:N,timeUnit:I},function(){F.importDrawings(c),F.draw(),F.currentlyImporting=!1,F.updateListeners("layout"),e.cb&&e.cb()})}this.createDataSet(),this.importDrawings(c),this.draw(),u||this.home(),this.currentlyImporting=!1,this.updateListeners("layout"),e.cb&&e.cb()},i.ChartEngine.prototype.exportLayout=function(t){var e={};for(var r in this.layout)"studies"!=r&&"panels"!=r?e[r]=i.clone(this.layout[r]):"studies"==r?e.studies={}:"panels"==r&&(e.panels={});for(var n in this.panels){var a=e.panels[n]={},s=this.panels[n];a.percent=s.percent,a.display=s.display,a.chartName=s.chart.name,a.top=s.top}for(var o in this.layout.studies){var l=e.studies[o]={},h=this.layout.studies[o];l.type=h.type,l.inputs=i.clone(h.inputs),l.outputs=i.clone(h.outputs),l.panel=h.panel,l.parameters=i.clone(h.parameters)}return t&&(e.symbols=this.getSymbols({"include-parameters":!0,"exclude-studies":!0})),e},i.ChartEngine.prototype.doCleanupDates=function(t,e){if(i.ChartEngine.isDailyInterval(e)&&t&&t.length)for(var r=0;r<t.length;r++){var n=t[r].DT;n&&("[object Date]"!=Object.prototype.toString.call(n)&&(n=new Date(n)),n&&n.setHours(0,0,0,0))}},i.ChartEngine.prototype.doCleanupGaps=function(t,e,r){function n(t,e){var r=t[f];void 0!==r&&i.ensureDefaults(e,{Close:r,Open:r,High:r,Low:r,Volume:0,Adj_Close:t.Adj_Close})}var a=this.layout.interval;r=r||{};var s=r.cleanupGaps?r.cleanupGaps:this.cleanupGaps,o="gap"==s;if(!s)return t;if("tick"==a)return t;if(!t||!t.length)return t;if(e||(e=this.chart),"month"==a||"week"==a){if(this.dontRoll)return t;a="day"}var l=function(t){return t.DT?new Date(+t.DT):i.strToDateTime(t.Date)},h=[],u=t[0];h.push(u);for(var c,p={begin:l(u),interval:a,periodicity:1,timeUnit:this.layout.timeUnit,inZone:this.dataZone,outZone:this.dataZone},d=e.market.newIterator(p),f=e.defaultPlotField,m=0;m<t.length;m++){var g=t[m];c=d.next();var v=l(g);for(function(t,e){for(;+t<+e;){var i=o?null:u[f],r=o?null:u.Adj_Close;h.push({DT:t,Open:i,High:i,Low:i,Close:i,Volume:0,Adj_Close:r}),t=d.next()}}(c,v);v<c;){if(++m==t.length)return h;o||n(u,g),h.push(g),u=g,g=t[m],v=l(g)}c<v?(m--,c=d.previous()):(o||n(u,g),h.push(g),u=g)}return h},i.Comparison=function(){},i.Comparison.priceToPercent=function(t,e,r){var n=i.Comparison.baseline||1;return Math.round((r-n)/n*100*1e4)/1e4},i.Comparison.percentToPrice=function(t,e,r){return(i.Comparison.baseline||1)*(1+r/100)},i.Comparison.createComparisonSegmentInner=function(t,e){var r,n=[];for(r in e.series){var a=e.series[r].parameters;a.isComparison&&n.push(a.symbol)}var s=["Close","Open","High","Low","iqPrevClose"];e.defaultPlotField&&!t.highLowBars[t.layout.chartType]&&s.unshift(e.defaultPlotField);var o=s[0],l=t.layout.studies;if(l)for(var h in l){var u=l[h];if(t.panels[u.panel]&&t.panels[u.panel].name==u.chart.name){for(r in u.outputMap)s.push(r);u.referenceOutput&&s.push(u.referenceOutput+" "+u.name)}}for(var c in t.plugins){var p=t.plugins[c];if(p.transformOutputs)for(r in p.transformOutputs)s.push(r)}e.dataSegment=[];var d=null,f=e.dataSet.length-e.scroll;t.micropixels+t.layout.candleWidth/2<0&&f++;for(var m=e.maxTicks+3,g=0;g<=m;g++){g==m&&(g=-1);var v=f+g;if(v<e.dataSet.length&&v>=0){var y=e.dataSet[v],x=y[o];if(!d){if(0===x||null===x){if(g<0)break;continue}d=i.clone(y)}y.transform||(y.transform={cache:{},DT:y.DT,Date:y.Date}),!i.Comparison.baseline&&x&&(d=i.clone(y)),i.Comparison.baseline=d[o];var C;for(C=0;C<s.length;C++)r=s[C],(y[r]||0===y[r])&&(y.transform[r]=e.transformFunc(t,e,y[r]));for(C=0;C<n.length;C++){r=n[C];var S=e.series[r];if(-1==g&&S&&S.parameters.isComparison)delete y.transform[r];else{var w=y[r];if(w||0===w){var D=d[r];if(D||0===D||(d[r]=D=w/(1+y.transform[o]/100)),0!==D){var b=i.Comparison.baseline||1,T=w*(b/D);y.transform[r]=e.transformFunc(t,e,T)}}}}e.dataSegment.push(y)}else v<0&&e.dataSegment.push(null);if(g<0)break}},i.Comparison.priceFormat=function(t,e,i){if(null===i||void 0===i)return"";var r=e.yAxis.priceTick,n=t.internationalizer;return i=n?r>=1?n.percent.format(i/100):r>=.1?n.percent1.format(i/100):r>=.01?n.percent2.format(i/100):r>=.001?n.percent3.format(i/100):n.percent4.format(i):r>=1?i.toFixed(0)+"%":r>=.1?i.toFixed(1)+"%":r>=.01?i.toFixed(2)+"%":r>=.001?i.toFixed(3)+"%":i.toFixed(4)+"%",0===parseFloat(i)&&"-"==i.charAt(0)&&(i=i.substring(1)),i},i.ChartEngine.prototype.setComparison=function(t,e){e||(e=this.chart),"string"==typeof e&&(e=this.charts[e]),!e.isComparison&&t?(this.setTransform(e,i.Comparison.priceToPercent,i.Comparison.percentToPrice),e.panel.yAxis.priceFormatter=i.Comparison.priceFormat,e.panel.yAxis.whichSet="dataSegment"):e.isComparison&&!t&&(this.unsetTransform(e),e.panel.yAxis.priceFormatter=null,e.panel.yAxis.whichSet="dataSet"),e.isComparison=t},i.ChartEngine.prototype.importPreferences=function(t){this.preferences=t,t.timeZone&&this.setTimeZone(this.dataZone,t.timeZone),t.language&&i.I18N&&(i.I18N.setLanguage(this,t.language),i.I18N.translateUI(t.language))},i.ChartEngine.prototype.exportPreferences=function(){return this.preferences},"undefined"!=typeof document&&document.addEventListener("contextmenu",i.ChartEngine.handleContextMenu),t},__market_=function(t){t||(t={});var e=t.CIQ,i=t.timezoneJS;e||(e=function(){},t.CIQ=e);e.Market=function(t){this.market_def=!1,this.rules=!1,this.normalHours=[],this.extraHours=[],this.class_name="Market",this.tz_lib=void 0===i?Date:i.Date,this.market_tz="",this.hour_aligned=!1,this.convertOnDaily=!1,this.enabled_by_default=!1,void 0!==t&&t&&t!={}&&(t.market_definition&&(t=t.market_definition),t.rules&&(this.rules=t.rules),t.market_tz&&(this.market_tz=t.market_tz),t.convertOnDaily&&(this.convertOnDaily=t.convertOnDaily),t.hour_aligned,this.hour_aligned=t.hour_aligned,void 0!==t.enabled_by_default&&t.enabled_by_default instanceof Array&&(this.enabled_by_default=t.enabled_by_default),this.market_def=t,void 0===this.market_def.name&&(this.market_def.name="no market name specified"),e.Market._createTimeSegments(this))},e.Market.GLOBEX={name:"GLOBEX",market_tz:"America/Chicago",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"18:00"}]},e.Market.FOREX={name:"FOREX",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"15:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:00"},{dayofweek:1,open:"17:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:00"},{dayofweek:2,open:"17:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:00"},{dayofweek:3,open:"17:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:00"},{dayofweek:4,open:"17:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:00"}]},e.Market.METALS={name:"METALS",market_tz:"America/New_York",hour_aligned:!0,rules:[{dayofweek:0,open:"18:00",close:"24:00"},{dayofweek:1,open:"00:00",close:"17:15"},{dayofweek:1,open:"18:00",close:"24:00"},{dayofweek:2,open:"00:00",close:"17:15"},{dayofweek:2,open:"18:00",close:"24:00"},{dayofweek:3,open:"00:00",close:"17:15"},{dayofweek:3,open:"18:00",close:"24:00"},{dayofweek:4,open:"00:00",close:"17:15"},{dayofweek:4,open:"18:00",close:"24:00"},{dayofweek:5,open:"00:00",close:"17:15"}]},e.Market.NYSE={name:"NYSE",market_tz:"America/New_York",hour_aligned:!1,rules:[{dayofweek:1,open:"09:30",close:"16:00"},{dayofweek:2,open:"09:30",close:"16:00"},{dayofweek:3,open:"09:30",close:"16:00"},{dayofweek:4,open:"09:30",close:"16:00"},{dayofweek:5,open:"09:30",close:"16:00"},{dayofweek:1,open:"04:00",close:"09:30",name:"pre"},{dayofweek:2,open:"04:00",close:"09:30",name:"pre"},{dayofweek:3,open:"04:00",close:"09:30",name:"pre"},{dayofweek:4,open:"04:00",close:"09:30",name:"pre"},{dayofweek:5,open:"04:00",close:"09:30",name:"pre"},{dayofweek:1,open:"16:00",close:"20:00",name:"post"},{dayofweek:2,open:"16:00",close:"20:00",name:"post"},{dayofweek:3,open:"16:00",close:"20:00",name:"post"},{dayofweek:4,open:"16:00",close:"20:00",name:"post"},{dayofweek:5,open:"16:00",close:"20:00",name:"post"},{date:"*-12-25",open:"00:00",close:"00:00"},{date:"*-07-04",open:"00:00",close:"00:00"},{date:"*-01-01",open:"00:00",close:"00:00"},{date:"2012-01-02",open:"00:00",close:"00:00"},{date:"2017-01-02"},{date:"2017-01-16"},{date:"2017-02-20"},{date:"2017-04-14"},{date:"2017-05-29"},{date:"2017-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2017-07-03",open:"9:30",close:"13:00"},{date:"2017-09-04"},{date:"2017-11-23"},{date:"2017-11-24",open:"4:00",close:"9:30",name:"pre"},{date:"2017-11-24",open:"9:30",close:"13:00"},{date:"2017-12-26"},{date:"2016-01-18"},{date:"2016-02-15"},{date:"2016-03-25"},{date:"2016-05-30"},{date:"2016-09-05"},{date:"2016-11-24"},{date:"2016-11-25",open:"4:00",close:"9:30",name:"pre"},{date:"2016-11-25",open:"9:30",close:"13:00"},{date:"2016-12-26"},{date:"2015-01-19"},{date:"2015-02-16"},{date:"2015-04-03"},{date:"2015-05-25"},{date:"2015-07-03"},{date:"2015-09-07"},{date:"2015-11-26"},{date:"2015-11-27",open:"4:00",close:"9:30",name:"pre"},{date:"2015-11-27",open:"9:30",close:"13:00"},{date:"2015-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2015-12-24",open:"9:30",close:"13:00"},{date:"2014-01-20"},{date:"2014-02-17"},{date:"2014-04-18"},{date:"2014-05-26"},{date:"2014-09-01"},{date:"2014-11-27"},{date:"2014-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2014-07-03",open:"9:30",close:"13:00"},{date:"2014-11-28",open:"4:00",close:"9:30",name:"pre"},{date:"2014-11-28",open:"9:30",close:"13:00"},{date:"2014-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2014-12-24",open:"9:30",close:"13:00"},{date:"2013-01-21"},{date:"2013-02-18"},{date:"2013-03-29"},{date:"2013-05-27"},{date:"2013-09-02"},{date:"2013-11-28"},{date:"2013-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2013-07-03",open:"9:30",close:"13:00"},{date:"2013-11-29",open:"4:00",close:"9:30",name:"pre"},{date:"2013-11-29",open:"9:30",close:"13:00"},{date:"2013-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2013-12-24",open:"9:30",close:"13:00"},{date:"2012-01-16"},{date:"2012-02-20"},{date:"2012-04-06"},{date:"2012-05-28"},{date:"2012-09-03"},{date:"2012-10-29"},{date:"2012-10-30"},{date:"2012-11-22"},{date:"2012-07-03",open:"4:00",close:"9:30",name:"pre"},{date:"2012-07-03",open:"9:30",close:"13:00"},{date:"2012-11-23",open:"4:00",close:"9:30",name:"pre"},{date:"2012-11-23",open:"9:30",close:"13:00"},{date:"2012-12-24",open:"4:00",close:"9:30",name:"pre"},{date:"2012-12-24",open:"9:30",close:"13:00"}]},e.Market.Symbology=function(){},e.Market.Symbology.isForeignSymbol=function(t){return!!t&&-1!=t.indexOf(".")},e.Market.Symbology.isFuturesSymbol=function(t){return!!t&&(0===t.indexOf("/")&&"/"!=t)},e.Market.Symbology.isForexSymbol=function(t){return!!t&&(!e.Market.Symbology.isForeignSymbol(t)&&(!e.Market.Symbology.isFuturesSymbol(t)&&(!(t.length<6||t.length>7)&&((6!=t.length||"X"!=t[5])&&!!/\^?[A-Za-z]{6}/.test(t)))))},e.Market.Symbology.isForexMetal=function(t,i){return!!t&&(!!e.Market.Symbology.isForexSymbol(t)&&("^"!=t.charAt(0)&&(t="^"+t),-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(4,3)+",")||!i&&-1!=",XAU,XPD,XPT,XAG,".indexOf(","+t.substr(1,3)+",")))},e.Market.Symbology.isForexFuturesSymbol=function(t){return!!e.Market.Symbology.isForexSymbol(t)||!!e.Market.Symbology.isFuturesSymbol(t)},e.Market.Symbology.factory=function(t){var i=t.symbol;return e.Market.Symbology.isForeignSymbol(i)?null:e.Market.Symbology.isFuturesSymbol(i)?e.Market.GLOBEX:e.Market.Symbology.isForexMetal(i)?e.Market.METALS:e.Market.Symbology.isForexSymbol(i)?e.Market.FOREX:e.Market.NYSE},e.Market.prototype._find_next_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),r=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz});if(this._wasOpenIntraDay(i)){var n=this.zseg_match.close_parts.hours,a=this.zseg_match.close_parts.minutes;i.setHours(n),i.setMinutes(a),r=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz})}return r.next()},e.Market.prototype._find_prev_segment=function(t,e){if(!this.market_def)return null;if(!this.rules)return null;var i=new Date(+t),r=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),n=this._wasOpenIntraDay(i);if(null===n?(i=new Date(i-6e4),n=this._wasOpenIntraDay(i)):(e&&i.getHours()===this.zseg_match.open_parts.hours&&i.getMinutes()===this.zseg_match.open_parts.minutes||!e&&i.getHours()===this.zseg_match.close_parts.hours&&i.getMinutes()===this.zseg_match.close_parts.minutes)&&(i=r.previous()),n){var a=this.zseg_match.open_parts.hours,s=this.zseg_match.open_parts.minutes;return i.setHours(a),i.setMinutes(s),r=this.newIterator({begin:i,interval:1,inZone:this.market_tz,outZone:this.market_tz}),i=r.previous(),this.zseg_match.close_parts.hours===a&&this.zseg_match.close_parts.minutes===s?e?r.next():i:this.zseg_match.adjacent_child?i:e?r.next():i}return r.previous()},e.Market.prototype.disableSession=function(t,e){var i=!1;if(void 0!==e&&e&&(i=!0),t){for(var r=0;r<this.normalHours.length;r++)this.normalHours[r].name===t&&(this.normalHours[r].enabled=i);for(r=0;r<this.extraHours.length;r++)this.extraHours[r].name===t&&(this.extraHours[r].enabled=i)}},e.Market.prototype.enableSession=function(t){this.disableSession(t,"enable_instead")},e.Market.prototype.getClose=function(t,e,i,r){if(!this.market_def)return null;if(!this.rules)return null;var n=t;if(t||(n=new Date,i=null),n=this._convertToMarketTZ(n,i),void 0!==e){if(this._wasOpenIntraDay(n)&&this.zseg_match.name===e)return n.setHours(this.zseg_match.close_parts.hours,this.zseg_match.close_parts.minutes,0,0),n=this._convertFromMarketTZ(n,r)}else if(this._wasOpenDaily(n)){for(var a=this.zseg_match;a.child_;)a=a.child_;for(;!a.enabled;)a=a.parent_;return n.setHours(a.close_parts.hours,a.close_parts.minutes,0,0),n=this._convertFromMarketTZ(n,r)}
return null},e.Market.prototype.getNextClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var r=t;if(t||(r=new Date,e=null),r=this._convertToMarketTZ(r,e),!this._wasOpenIntraDay(r)){r=this.newIterator({begin:r,interval:1,inZone:this.market_tz,outZone:this.market_tz}).next()}for(var n=r.getDate(),a=this.zseg_match;a.adjacent_child;)a=a.adjacent_child,n+=1;return r.setDate(n),r.setHours(a.close_parts.hours,a.close_parts.minutes,0,0),r=this._convertFromMarketTZ(r,i)},e.Market.prototype.getNextOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var r=t;return t||(r=new Date,e=null),r=this._convertToMarketTZ(r,e),r=this._find_next_segment(r),this.zseg_match.adjacent_parent?(r=this.getNextOpen(r,this.market_tz,this.market_tz),r=this._convertFromMarketTZ(r,i)):(r.setHours(this.zseg_match.open_parts.hours),r.setMinutes(this.zseg_match.open_parts.minutes),r=this._convertFromMarketTZ(r,i))},e.Market.prototype.getOpen=function(t,e,i,r){if(!this.market_def)return null;if(!this.rules)return null;var n=t;if(t||(n=new Date,i=null),n=this._convertToMarketTZ(n,i),void 0!==e){if(this._wasOpenIntraDay(n)&&this.zseg_match.name==e)return n.setHours(this.zseg_match.open_parts.hours,this.zseg_match.open_parts.minutes,0,0),n=this._convertFromMarketTZ(n,r)}else if(this._wasOpenDaily(n)){for(var a=this.zseg_match;a.parent_;)a=a.parent_;for(;!a.enabled;)a=a.child_;return n.setHours(a.open_parts.hours,a.open_parts.minutes,0,0),n=this._convertFromMarketTZ(n,r)}return null},e.Market.prototype.getPreviousClose=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var r=t;return t||(r=new Date,e=null),r=this._convertToMarketTZ(r,e),r=this._find_prev_segment(r,!1),this.zseg_match.adjacent_child?this.getPreviousClose(r,this.market_tz,this.market_tz):(r.setHours(this.zseg_match.close_parts.hours),r.setMinutes(this.zseg_match.close_parts.minutes),r=this._convertFromMarketTZ(r,i))},e.Market.prototype.getPreviousOpen=function(t,e,i){if(!this.market_def)return null;if(!this.rules)return null;var r=t;return t||(r=new Date,e=null),r=this._convertToMarketTZ(r,e),r=this._find_prev_segment(r,!0),this.zseg_match.adjacent_parent?this.getPreviousOpen(this.market_tz,this.market_tz):(r.setHours(this.zseg_match.open_parts.hours),r.setMinutes(this.zseg_match.open_parts.minutes),r=this._convertFromMarketTZ(r,i))},e.Market.prototype.getSession=function(t,e){return t=this._convertToMarketTZ(t,e),this._wasOpenIntraDay(t)&&this.zseg_match?this.zseg_match.name:null},e.Market.prototype.marketZoneNow=function(){return this._convertToMarketTZ(new Date)},e.Market.prototype.isHourAligned=function(){return this.hour_aligned},e.Market.prototype.isOpen=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenIntraDay(t)},e.Market.prototype.isMarketDay=function(){var t=new Date;return this.market_tz&&(t=new this.tz_lib(t.getTime(),this.market_tz)),this._wasOpenDaily(t)},e.Market.prototype.isMarketDate=function(t){return this._wasOpenDaily(t)},e.Market.prototype.newIterator=function(t){var i=!1;t.periodicity?i=t.periodicity:t.multiple&&(i=t.multiple);var r=t.interval;return r||(r="minute"),"hour"==r&&(r=60),i||(i=1),t.begin||(t.begin=new Date,t.inZone=null),r==parseInt(r,10)&&(r=parseInt(r,10),t.periodicity<1/60?(i=i*r*6e4,r="millisecond"):t.periodicity<1?(i=i*r*60,r="second"):(i*=r,r="minute")),t.timeUnit&&("millisecond"===t.timeUnit?r=t.timeUnit:"second"===t.timeUnit&&(r=t.timeUnit)),t.interval=r,t.multiple=i,t.market=this,new e.Market.Iterator(t)},e.Market.prototype._wasOpenDaily=function(t){return this._was_open(t,!1)},e.Market.prototype._wasOpenIntraDay=function(t){return this._was_open(t,!0)},e.Market.prototype._was_open=function(t,e){if(this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null,!this.market_def||!this.rules)return this.zclose_hour=24,!0;var i,r=!1,n=!1,a=t.getFullYear(),s=t.getMonth()+1,o=t.getDay(),l=t.getDate(),h=t.getHours(),u=t.getMinutes(),c=t.getSeconds(),p=60*h*60+60*u+c;void 0===e&&(e=!0);var d;for(d=0;d<this.normalHours.length;d++)if(i=this.normalHours[d],i.enabled&&(r=i.dayofweek===o,r&&e&&(r=p>=i.open&&p<i.close),r)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=p===i.open,this.zseg_match=i,e)break}for(d=0;d<this.extraHours.length;d++)if(i=this.extraHours[d],i.enabled&&("*"===i.year||a===i.year)&&s===i.month&&l===i.day&&(n=!e&&i.open||p>=i.open&&p<i.close,!n&&this.zseg_match&&(r=!1,this.zopen_hour=0,this.zopen_minute=0,this.zclose_hour=0,this.zclose_minute=0,this.zmatch_open=!1,this.zseg_match=null),n)){if(!e&&this.zseg_match&&(i.open_parts.hours>this.zopen_hour||i.open_parts.hours==this.zopen_hour&&i.open_parts.minutes>this.zopen_minute))continue;if(this.zopen_hour=i.open_parts.hours,this.zopen_minute=i.open_parts.minutes,this.zclose_hour=i.close_parts.hours,this.zclose_minute=i.close_parts.minutes,this.zmatch_open=p===i.open,this.zseg_match=i,e)break}return this.zseg_match},e.Market.prototype._wasClosed=function(t){return!this._was_open(t,!0)},e.Market.prototype._wasOpen=function(t){return this._was_open(t,!0)},e.Market.prototype._tzDifferenceMillis=function(t,e,i){var r=t,n=t;return 60*(r.getTimezoneOffset()-n.getTimezoneOffset())*1e3},e.Market._createTimeSegments=function(t){for(var e,i=0;i<t.rules.length;i++){var n=JSON.parse(JSON.stringify(t.rules[i]));void 0===n.open&&void 0===n.close&&(n.open="00:00",n.close="00:00"),n.hasOwnProperty("name")||(n.name="");try{var a;if(void 0!==n.dayofweek?(n.year="*",a=r._createDayOfWeekSegment(t,n),e&&(e.dayofweek===a.dayofweek?(e.child_=a,a.parent_=e):function(t,i){if(24===t.close_parts.hours&&0===i.open_parts.hours&&0===i.open_parts.minutes){if(e.dayofweek===a.dayofweek-1)return!0;if(6===e.dayofweek&&0===a.dayofweek)return!0}return!1}(e,a)&&(e.adjacent_child=a,a.adjacent_parent=e)),e=a):void 0!==n.date?(n.isDayOfWeek=!1,n.dayofweek=-1,a=r._createDateTimeSegment(t,n)):console.log("Error, unknown rule type "+n),t.enabled_by_default)for(var s=0;s<t.enabled_by_default.length;s++){var o=t.enabled_by_default[s];if(a.name===o){a.enabled=!0;break}}}catch(t){console.log("Error, creating market rules "+t)}}},e.Market._timeSegment={};var r=e.Market._timeSegment;r.re_wild_card_iso=/^(\*)-(\d\d)-(\d\d)$/,r.re_regular_iso=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,r.re_split_hours_minutes=/^(\d\d):(\d\d)$/,r.re_split_hour_minutes=/^(\d):(\d\d)$/,r._hashCode=function(t){var e,i,r,n=0;if(0===t.length)return n;for(e=0,r=t.length;e<r;e++)i=t.charCodeAt(e),n=(n<<5)-n+i,n|=0;return n},r._splitHoursMinutes=function(t){var e=r.re_split_hour_minutes.exec(t),i={hours:NaN,minutes:NaN};return null===e&&null===(e=r.re_split_hours_minutes.exec(t))?i:(i.hours=parseInt(e[1],10),i.minutes=parseInt(e[2],10),i)},r._createDayOfWeekSegment=function(t,e){var i={name:e.name,isDayOfWeek:!0,dayofweek:e.dayofweek,date_str:"*",open_parts:r._splitHoursMinutes(e.open),close_parts:r._splitHoursMinutes(e.close),open:r._secSinceMidnight(t,e.open,!0),close:r._secSinceMidnight(t,e.close,!1),child_:!1,parent_:!1,adjacent_child:!1,adjacent_parent:!1,enabled:!1};return""===i.name&&(i.enabled=!0),i.hash_code=this._hashCode((i.open+i.close).toString()),t.normalHours.push(i),i},r._createDateTimeSegment=function(t,e){var i,n=this.re_regular_iso.exec(e.date);if(null===n){if(null===(n=this.re_wild_card_iso.exec(e.date)))return void console.log("Warning: invalid date format on rule -> "+e.date);i="*"}else i=parseInt(n[1],10);var a={name:e.name,isDayOfWeek:!1,dayofweek:-1,year:i,month:parseInt(n[2],10),day:parseInt(n[3],10),date_str:e.date,open_parts:r._splitHoursMinutes(e.open),close_parts:r._splitHoursMinutes(e.close),open:r._secSinceMidnight(t,e.open,!0),close:r._secSinceMidnight(t,e.close,!1),enabled:!1};return""===a.name&&(a.enabled=!0),a.hash_key=this._hashCode(a.date_str+a.open+a.close),t.extraHours.push(a),a},r._secSinceMidnight=function(t,e,i){var r=e.split(":"),n=parseInt(r[0],10),a=parseInt(r[1],10),s=60*n*60+60*a;return i||24===n&&(s=60*n*60+1),s},e.Market.prototype._convertToMarketTZ=function(t,e){if(!this.market_tz)return t;var i;return i=e?new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e):new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),i.setTimezone&&i.setTimezone(this.market_tz),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())},e.Market.prototype._convertFromMarketTZ=function(t,e){if(!this.market_tz)return t;var i=new this.tz_lib(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),this.market_tz);return e?(i.setTimezone&&i.setTimezone(e),new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())):new Date(i.getTime())},e.Market.Iterator=function(t){this.market=t.market,this.begin=t.begin,this.interval=t.interval,this.multiple=t.multiple,this.inZone=t.inZone,this.outZone=t.outZone,this.clock=new e.Market.Iterator._Clock(t.market,t.interval,t.multiple),this.intraDay=this.clock.intra_day,this.intraDay&&(this.begin=this.market._convertToMarketTZ(this.begin,t.inZone)),this.clock._setStart(this.begin),this.clock.minutes_aligned=!1},e.Market.Iterator.prototype.date=function(){return this.clock._date()},e.Market.Iterator.prototype.futureTick=function(t){this.clock.skip=1;var e,i=0;e=this.intraDay?this.market._convertToMarketTZ(t.end,this.inZone).getTime():t.end.getTime();var r=this.clock.ctime;if(e===r)return i;var n=2,a=0;t.sample_size&&(n=t.sample_size);var s,o=(new Date).getTime();if(e>r){for(this.clock.forward=!0;this.clock.ctime<e;)if(i+=1,a+=1,this.clock._findNext(),1e3===a&&(a=0,(new Date).getTime()-o>=n)){s=(this.clock.ctime-r)/i,i=Math.floor((e-r)/s);break}}else for(this.clock.forward=!1;this.clock.ctime>e;)if(i+=1,a+=1,this.clock._findPrevious(),1e3===a&&(a=0,(new Date).getTime()-o>=n)){s=(r-this.clock.ctime)/i,i=Math.floor((r-e)/s);break}return i},e.Market.Iterator.prototype.isHourAligned=function(){return!this.intraDay||this.market.isHourAligned()},e.Market.Iterator.prototype.isOpen=function(){return this.market.isOpen()},e.Market.Iterator.prototype.next=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!0;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findNext();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator.prototype.peek=function(){return this.clock._peek()},e.Market.Iterator.prototype.previous=function(t){this.clock.skip=1,t&&(this.clock.skip=t),this.clock.forward=!1;for(var e=0;e<this.clock.skip;e++)this.begin=this.clock._findPrevious();return this.intraDay||this.market.convertOnDaily?this.market._convertFromMarketTZ(this.clock.display_date,this.outZone):this.clock.display_date},e.Market.Iterator._Clock=function(t,e,i){i%60==0&&"second"===e&&(e="minute",i/=60),this.market=t,this.interval=e,this.multiple=i,this.intra_day=!1,this.intervals=[],this.max_iters=10080;var r=864e5,n=this._dayImpl;"millisecond"===e?(n=this._millisImpl,r=1):"second"===e?(n=this._secondImpl,r=1e3):"minute"===e?(n=this._minuteImpl,r=6e4):"hour"===e?(n=this._hourImpl,r=36e5):"day"===e?(n=this._dayImpl,r=864e5):"week"===e?(n=this._weekImpl,r=6048e5):"month"===e?(n=this._monthImpl,r=2592e6):console.log('Periodicity ERROR: "'+e+'" is not a valid interval. Please see setPeriodicity() for details.'),this.tick_time=r*i,this.intra_day=this.tick_time<864e5,this._findPrevious=this._findNext=n};var n=e.Market.Iterator._Clock.prototype;return n._total_minutes=function(t,e,i,r){return 60*(i-t)-e+r},n._alignMinutes=function(){if(void 0===this.market.zopen_minute)return[];var t=this.market.zopen_minute;this.market.isHourAligned()&&this.multiple%60==0&&(t=0);for(var e=this._total_minutes(this.market.zopen_hour,t,this.market.zclose_hour,this.market.zclose_minute),i=[],r=0;r<e;)i.push(t+r),r+=this.multiple;return i},n._alignBaseZero=function(t){for(var e=0,i=[e];;){if((e+=this.multiple)>=t)break;i.push(e)}return i},n._date=function(){var t=Math.round(this.ctime),e=new Date(t);return this.intra_day?this.display_date=new Date(t+this.shift_millis):this.display_date=e,e},n._alignToBoundary=function(t,e){for(var i=0,r=0,n=e,a=0;a<t.length-1&&(i=t[a],r=t[a+1],e!==i&&e!==r);a++){if(e>i&&e<r){n=i;break}a+1===t.length-1&&(n=r)}return n},n._peek=function(){return this._date().toString()},n._seekHr=function(){this.forward?this.ctime-=36e5:this.ctime+=36e5},n._setStart=function(t){var e=this.market._tzDifferenceMillis(t),i=new Date(t.getTime()+e);this.shift_millis=e,this.ctime=i.getTime(),this.shift_millis=0,this.ctime=t.getTime()},n._tickTock=function(){this.forward?this.ctime+=this.tick_time:this.ctime-=this.tick_time},n._tockTick=function(){this.forward?this.ctime-=this.tick_time:this.ctime+=this.tick_time},n._tickTock24=function(){this.ctime+=864e5},n._tockTick24=function(){this.ctime-=864e5},n._windMaybe=function(t,e){for(var i=0,r=new Date(this.ctime),n=!1;!t.call(this.market,r);)if(e.call(this),n=!0,r=new Date(this.ctime),(i+=1)>this.max_iters){var a="Warning! max iterations ("+this.max_iters;a+=") reached with no rule match.",console.log(a);break}return n},n._millisImpl=function(){var t=!1;if(!this.mperiods_aligned){var e=this._alignBaseZero(1e3),i=new Date(this.ctime),r=i.getMilliseconds();r=this._alignToBoundary(e,r),i.setMilliseconds(0),this.ctime=i.getTime()+r,this.mperiods_aligned=!0,t=!0}var n=this._date().getMinutes();this._tickTock();var a=this._date().getMinutes();if((t||n!=a)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},n._secondImpl=function(){var t=!1;if(!this.speriod_aligned){var e=this._alignBaseZero(60),i=new Date(this.ctime),r=i.getSeconds();r=this._alignToBoundary(e,r),i.setSeconds(r),i.setMilliseconds(0),this.ctime=i.getTime(),this.speriod_aligned=!0,t=!0}var n=this._date().getMinutes();this._tickTock();var a=this._date().getMinutes();if((t||n!=a)&&!this.market._wasOpenIntraDay(this._date())){var s=this.tick_time;this.tick_time=6e4;var o=this.multiple;this.multiple=1,this._minuteImpl(),this.tick_time=s,this.multiple=o}return this._date()},n._minuteImpl=function(){var t=this._windMaybe(this.market._wasOpenIntraDay,this._tockTick),e=new Date(this.ctime),i=e.getTimezoneOffset(),r=e.getMinutes(),n=e.getHours(),a=this._alignMinutes(),s=this._total_minutes(this.market.zopen_hour,this.market.zopen_minute,n,r)+this.market.zopen_minute;s=t?this.forward?a[a.length-1]:a[0]:this._alignToBoundary(a,s),n=Math.floor(s/60)+this.market.zopen_hour,e.setHours(n,s%60,0,0);var o=e.getTimezoneOffset()-i;(this.forward&&o<0||!this.forward&&o>0)&&e.setTime(e.getTime()-6e4*o),this.ctime=e.getTime(),this._tickTock();var l=this.market.zseg_match,h=this.market.hour_aligned&&this.multiple%60==0;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!h&&l!=this.market.zseg_match){if(e=new Date(this.ctime),this.forward)e.setMinutes(this.market.zopen_minute),e.setHours(this.market.zopen_hour);else{a=this._alignMinutes();var u=a[a.length-1];e.setMinutes(u%60),e.setHours(Math.floor(u/60)+this.market.zopen_hour)}this.ctime=e.getTime()}return this._date()},n._hourImpl=function(){this._windMaybe(this.market._wasOpenIntraDay,this._tockTick);var t=new Date(this.ctime);this.market.isHourAligned()?t.setMinutes(0):t.setMinutes(this.market.zopen_minute),t.setSeconds(0),t.setMilliseconds(0),this.ctime=t.getTime(),this._tickTock();var e=this.market.zseg_match;if(this._windMaybe(this.market._wasOpenIntraDay,this._tickTock)||!this.market.hour_aligned&&e!=this.market.zseg_match){if(current_date=new Date(this.ctime),this.forward)current_date.setMinutes(this.market.zopen_minute),current_date.setHours(this.market.zopen_hour);else{periods=this._alignMinutes();var i=periods[periods.length-1];current_date.setMinutes(i%60),current_date.setHours(Math.floor(i/60)+this.market.zopen_hour)}this.ctime=current_date.getTime()}return this._date()},n._dayImpl=function(){this._windMaybe(this.market._wasOpenDaily,this._seekHr);var t=new Date(this.ctime);t.setHours(12,0,0,0),this.ctime=t.getTime();for(var e=0;e<this.multiple;)this.forward?this._tickTock24():this._tockTick24(),this.market._wasOpenDaily(this._date())&&(e+=1);return t=new Date(this.ctime),t.setHours(0),this.ctime=t.getTime(),this._date()},n._weekImpl=function(){var t=new Date(this.ctime);for(t.setHours(12),this.ctime=t.getTime(),this._tickTock(),t=new Date(this.ctime);0!==t.getDay();)this._tockTick24(),t=new Date(this.ctime);return this._windMaybe(this.market._wasOpenDaily,this._tickTock24),t=new Date(this.ctime),t.setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},n._monthImpl=function(){var t=new Date(this.ctime);return t.setDate(15),this.ctime=t.getTime(),this._tickTock(),t=new Date(this.ctime),t.setDate(1),t.setHours(12),this.ctime=t.getTime(),this._windMaybe(this.market._wasOpenDaily,this._tickTock24),t=new Date(this.ctime),t.setHours(0,0,0,0),this.ctime=t.getTime(),this._date()},n._findNext=null,n._findPrevious=null,t},__polyfills_=function(){Math.easeInOutQuad=function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)},Math.easeInOutCubic=function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)}},__timezone_=function(_exports){var CIQ=_exports.CIQ;return CIQ.timeZoneMap={"(UTC-11:00) American Samoa, Midway Island":"Pacific/Pago_Pago","(UTC-10:00) Hawaii":"Pacific/Honolulu","(UTC-09:00) Alaska":"America/Juneau","(UTC-08:00) Pacific Time (US and Canada)":"America/Los_Angeles","(UTC-08:00) Tijuana":"America/Tijuana","(UTC-07:00) Arizona":"America/Phoenix","(UTC-07:00) Chihuahua, Mazatlan":"America/Chihuahua","(UTC-07:00) Mountain Time (US and Canada)":"America/Denver","(UTC-06:00) Central America":"America/Costa_Rica","(UTC-06:00) Central Time (US and Canada)":"America/Chicago","(UTC-06:00) Guadalajara, Mexico City, Monterrey":"America/Mexico_City","(UTC-06:00) Saskatchewan":"America/Regina","(UTC-05:00) Bogota, Lima, Quito, Rio Branco":"America/Bogota","(UTC-05:00) Eastern Time (US and Canada)":"America/New_York","(UTC-05:00) Indiana (East)":"America/Indiana/Indianapolis","(UTC-04:00) Asuncion":"America/Asuncion","(UTC-04:00) Santiago":"America/Santiago","(UTC-04:00) Caracas":"America/Caracas","(UTC-04:00) Atlantic Time (Canada)":"America/Halifax","(UTC-04:00) Georgetown, La Paz, Manaus, San Juan":"America/Puerto_Rico","(UTC-03:30) Newfoundland and Labrador":"America/St_Johns","(UTC-03:00) Buenos Aires":"America/Argentina/Buenos_Aires","(UTC-03:00) Punta Arenas":"America/Punta_Arenas","(UTC-03:00) Montevideo":"America/Montevideo","(UTC-03:00) Sao Paulo":"America/Sao_Paulo","(UTC-02:00) Mid-Atlantic":"Atlantic/South_Georgia","(UTC-01:00) Azores":"Atlantic/Azores","(UTC-01:00) Cape Verde Islands":"Atlantic/Cape_Verde","(UTC) Greenwich Mean Time, Reykjavik":"UTC","(UTC) Casablanca":"Africa/Casablanca","(UTC) Dublin, Lisbon, London":"Europe/London","(UTC+01:00) Algiers, Tunis":"Africa/Tunis","(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna":"Europe/Amsterdam","(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague":"Europe/Belgrade","(UTC+01:00) Brussels, Copenhagen, Madrid, Paris":"Europe/Brussels","(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb":"Europe/Sarajevo","(UTC+02:00) Kaliningrad":"Europe/Kaliningrad","(UTC+02:00) Athens, Bucharest":"Europe/Bucharest","(UTC+02:00) Cairo":"Africa/Cairo","(UTC+02:00) Harare, Johannesburg":"Africa/Johannesburg","(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius":"Europe/Helsinki","(UTC+02:00) Cyprus":"Asia/Nicosia","(UTC+02:00) Jerusalem":"Asia/Jerusalem","(UTC+03:00) Istanbul":"Europe/Istanbul","(UTC+03:00) Baghdad, Kuwait, Qatar, Riyadh":"Asia/Riyadh","(UTC+03:00) Minsk, Moscow, Kirov, Volgograd":"Europe/Moscow","(UTC+03:00) Simferopol":"Europe/Simferopol","(UTC+03:00) Nairobi":"Africa/Nairobi","(UTC+03:30) Tehran":"Asia/Tehran","(UTC+04:00) Baku":"Asia/Baku","(UTC+04:00) Dubai, Muscat":"Asia/Dubai","(UTC+04:00) Astrakhan, Samara, Saratov, Ulyanovsk":"Europe/Samara","(UTC+04:30) Kabul":"Asia/Kabul","(UTC+05:00) Karachi, Tashkent":"Asia/Karachi","(UTC+05:00) Yekaterinburg":"Asia/Yekaterinburg","(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi":"Asia/Kolkata","(UTC+05:45) Kathmandu":"Asia/Kathmandu","(UTC+06:00) Almaty":"Asia/Almaty","(UTC+06:00) Omsk":"Asia/Omsk","(UTC+06:00) Astana, Dhaka":"Asia/Dhaka","(UTC+06:30) Yangon":"Asia/Yangon","(UTC+07:00) Bangkok, Jakarta, Vietnam":"Asia/Bangkok","(UTC+07:00) Hovd":"Asia/Hovd","(UTC+07:00) Krasnoyarsk":"Asia/Krasnoyarsk","(UTC+07:00) Novokuznetsk":"Asia/Novokuznetsk","(UTC+07:00) Barnaul, Novosibirsk, Tomsk":"Asia/Novosibirsk","(UTC+08:00) Beijing, Chongqing, Hong Kong SAR":"Asia/Hong_Kong","(UTC+08:00) Brunei, Kuala Lumpur, Singapore":"Asia/Kuala_Lumpur","(UTC+08:00) Irkutsk":"Asia/Irkutsk","(UTC+08:00) Choibalsan, Ulaanbaatar":"Asia/Ulaanbaatar","(UTC+08:00) Manila, Taipei":"Asia/Taipei","(UTC+08:00) Perth":"Australia/Perth","(UTC+08:30) Pyongyang":"Asia/Pyongyang","(UTC+08:45) Eucla":"Australia/Eucla","(UTC+09:00) Osaka, Sapporo, Tokyo":"Asia/Tokyo","(UTC+09:00) Seoul":"Asia/Seoul","(UTC+09:00) Chita, Khandyga, Yakutsk":"Asia/Yakutsk","(UTC+09:30) Adelaide":"Australia/Adelaide","(UTC+09:30) Darwin":"Australia/Darwin","(UTC+10:00) Brisbane":"Australia/Brisbane","(UTC+10:00) Canberra, Melbourne, Sydney":"Australia/Sydney","(UTC+10:00) Guam, Port Moresby":"Pacific/Guam","(UTC+10:00) Ust-Nera, Vladivostok":"Asia/Vladivostok","(UTC+11:00) Noumea, Solomon Islands":"Pacific/Noumea","(UTC+11:00) Magadan":"Asia/Magadan","(UTC+11:00) Sakhalin, Srednekolymsk":"Asia/Srednekolymsk","(UTC+12:00) Anadyr, Kamchatka":"Asia/Kamchatka","(UTC+12:00) Auckland, Wellington":"Pacific/Auckland","(UTC+12:45) Chatham":"Pacific/Chatham","(UTC+13:00) Tonga":"Pacific/Tongatapu","(UTC+13:00) Samoa":"Pacific/Apia","(UTC+14:00) Kiritimati":"Pacific/Kiritimati"},function(){"use strict";var root=this,timezoneJS={};_exports.timezoneJS=timezoneJS,timezoneJS.VERSION="0.4.11";for(var ajax_lib=root.$||root.jQuery||root.Zepto,fleegix=root.fleegix,DAYS=timezoneJS.Days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTHS=timezoneJS.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],SHORT_MONTHS={},SHORT_DAYS={},EXACT_DATE_TIME={},i=0;i<MONTHS.length;i++)SHORT_MONTHS[MONTHS[i].substr(0,3)]=i;for(i=0;i<DAYS.length;i++)SHORT_DAYS[DAYS[i].substr(0,3)]=i;var _arrIndexOf=Array.prototype.indexOf||function(t){if(null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);n<i;n++)if(n in e&&e[n]===t)return n;return-1},_fixWidth=function(t,e){if("number"!=typeof t)throw"not a number: "+t;var i=t>1e3,r=t.toString(),n=r.length;if(i&&n>e)return r.substr(n-e,n);for(r=[r];n<e;)r.unshift("0"),n++;return r.join("")},_transport=function(t){if(t){if(!t.url)throw new Error("URL must be specified");if("async"in t||(t.async=!0),!(fleegix&&void 0!==fleegix.xhr||ajax_lib&&void 0!==ajax_lib.ajax))throw new Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");return t.async?fleegix&&fleegix.xhr?fleegix.xhr.send({url:t.url,method:"get",handleSuccess:t.success,handleErr:t.error}):ajax_lib.ajax({url:t.url,dataType:"text",method:"GET",error:t.error,success:t.success}):fleegix&&fleegix.xhr?fleegix.xhr.doReq({url:t.url,async:!1}):ajax_lib.ajax({url:t.url,async:!1,dataType:"text"}).responseText}};timezoneJS.ruleCache={},timezoneJS.Date=function(){if(this===timezoneJS)throw"timezoneJS.Date object must be constructed with 'new'";var t=Array.prototype.slice.apply(arguments),e=null,i=null,r=[],n=!1;"[object Array]"===Object.prototype.toString.call(t[0])&&(t=t[0]),"string"==typeof t[t.length-1]&&(n=Date.parse(t[t.length-1].replace(/GMT[+-]\d+/,"")),(isNaN(n)||null===n)&&(i=t.pop()));var a=!1;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(t[0]),"string"==typeof t[0]&&-1==t[0].search(/[+-][0-9]{4}/)&&-1==t[0].search(/Z/)&&-1==t[0].search(/T/)&&(a=!0);break;case 2:e=new Date(t[0],t[1]),a=!0;break;default:for(var s=0;s<7;s++)r[s]=t[s]||0;e=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6]),a=!0}if(isNaN(e.getTime()))throw new Error("Invalid date");this._useCache=!1,this._tzInfo={},this._day=0,this.year=0,this.month=0,this.date=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0,this.timezone=i||null,a?this.setFromDateObjProxy(e):this.setFromTimeProxy(e.getTime(),i)},timezoneJS.Date.prototype={getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+60*this.getTimezoneOffset()*1e3},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){if(this._useCache)return this._tzInfo;var t;return t=this.timezone?"Etc/UTC"===this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:timezoneJS.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null},this._tzInfo=t,this._useCache=!0,t},getUTCDateProxy:function(){var t=new Date(this._timeProxy);return t.setUTCMinutes(t.getUTCMinutes()+this.getTimezoneOffset()),t},setDate:function(t){return this.setAttribute("date",t),this.getTime()},setFullYear:function(t,e,i){return void 0!==i&&this.setAttribute("date",1),this.setAttribute("year",t),void 0!==e&&this.setAttribute("month",e),void 0!==i&&this.setAttribute("date",i),this.getTime()},setMonth:function(t,e){return this.setAttribute("month",t),void 0!==e&&this.setAttribute("date",e),this.getTime()},setYear:function(t){return t=Number(t),0<=t&&t<=99&&(t+=1900),this.setUTCAttribute("year",t),this.getTime()},setHours:function(t,e,i,r){return this.setAttribute("hours",t),void 0!==e&&this.setAttribute("minutes",e),void 0!==i&&this.setAttribute("seconds",i),void 0!==r&&this.setAttribute("milliseconds",r),this.getTime()},setMinutes:function(t,e,i){return this.setAttribute("minutes",t),void 0!==e&&this.setAttribute("seconds",e),void 0!==i&&this.setAttribute("milliseconds",i),this.getTime()},setSeconds:function(t,e){return this.setAttribute("seconds",t),void 0!==e&&this.setAttribute("milliseconds",e),this.getTime()},setMilliseconds:function(t){return this.setAttribute("milliseconds",t),this.getTime()},setTime:function(t){if(isNaN(t))throw new Error("Units must be a number.");return this.setFromTimeProxy(t,this.timezone),this.getTime()},setUTCFullYear:function(t,e,i){return void 0!==i&&this.setUTCAttribute("date",1),this.setUTCAttribute("year",t),void 0!==e&&this.setUTCAttribute("month",e),void 0!==i&&this.setUTCAttribute("date",i),this.getTime()},setUTCMonth:function(t,e){return this.setUTCAttribute("month",t),void 0!==e&&this.setUTCAttribute("date",e),this.getTime()},setUTCDate:function(t){return this.setUTCAttribute("date",t),this.getTime()},setUTCHours:function(t,e,i,r){return this.setUTCAttribute("hours",t),void 0!==e&&this.setUTCAttribute("minutes",e),void 0!==i&&this.setUTCAttribute("seconds",i),void 0!==r&&this.setUTCAttribute("milliseconds",r),this.getTime()},setUTCMinutes:function(t,e,i){return this.setUTCAttribute("minutes",t),void 0!==e&&this.setUTCAttribute("seconds",e),void 0!==i&&this.setUTCAttribute("milliseconds",i),this.getTime()},setUTCSeconds:function(t,e){return this.setUTCAttribute("seconds",t),void 0!==e&&this.setUTCAttribute("milliseconds",e),this.getTime()},setUTCMilliseconds:function(t){return this.setUTCAttribute("milliseconds",t),this.getTime()},setFromDateObjProxy:function(t){this.year=t.getFullYear(),this.month=t.getMonth(),this.date=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds(),this.milliseconds=t.getMilliseconds(),this._day=t.getDay(),this._dateProxy=t,this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds),this._useCache=!1},setFromTimeProxy:function(t,e){var i=new Date(t),r=e?timezoneJS.timezone.getTzInfo(t,e,!0).tzOffset:i.getTimezoneOffset();i.setTime(t+6e4*(i.getTimezoneOffset()-r)),this.setFromDateObjProxy(i)},setAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i=this._dateProxy;i["set"+("year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1))](e),this.setFromDateObjProxy(i)},setUTCAttribute:function(t,e){if(isNaN(e))throw new Error("Units must be a number.");var i="year"===t?"FullYear":t.substr(0,1).toUpperCase()+t.substr(1),r=this.getUTCDateProxy();r["setUTC"+i](e),r.setUTCMinutes(r.getUTCMinutes()-this.getTimezoneOffset()),this.setFromTimeProxy(r.getTime()+6e4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(t){var e=this.getTimezoneInfo().tzOffset;this.timezone=t,this._useCache=!1,this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+e)},removeTimezone:function(){this.timezone=null,this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?new timezoneJS.Date(this.getTime(),this.timezone):new timezoneJS.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleStringIntl:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toDateString:function(){return this.toString("EEE MMM dd yyyy")},toTimeString:function(){return this.toString("H:mm k")},toString:function(t,e){t||(t="yyyy-MM-ddTHH:mm:ss.SSS");var i=t,r=e?timezoneJS.timezone.getTzInfo(this.getTime(),e):this.getTimezoneInfo(),n=this;e&&(n=this.clone(),n.setTimezone(e));var a=n.getHours();return i.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(t){return _fixWidth(n.getFullYear(),t.length)}).replace(/d+/g,function(t){return _fixWidth(n.getDate(),t.length)}).replace(/m+/g,function(t){return _fixWidth(n.getMinutes(),t.length)}).replace(/s+/g,function(t){return _fixWidth(n.getSeconds(),t.length)}).replace(/S+/g,function(t){return _fixWidth(n.getMilliseconds(),t.length)}).replace(/h+/g,function(t){return _fixWidth(a%12==0?12:a%12,t.length)}).replace(/M+/g,function(t){var e=n.getMonth(),i=t.length;return i>3?timezoneJS.Months[e]:i>2?timezoneJS.Months[e].substring(0,i):_fixWidth(e+1,i)
}).replace(/k+/g,function(){return a>=12?(a>12&&(a-=12),"PM"):"AM"}).replace(/H+/g,function(t){return _fixWidth(a,t.length)}).replace(/E+/g,function(t){return DAYS[n.getDay()].substring(0,t.length)}).replace(/Z+/gi,function(){return r.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(t,e,i){var r;e++,e>12&&(r=parseInt(e/12,10),e%=12,t+=r),e<=2&&(t-=1,e+=12),r=Math.floor(t/100);var n=2-r+Math.floor(r/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+n-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}},timezoneJS.timezone=new function(){function invalidTZError(t){throw new Error("Timezone '"+t+"' is either incorrect, or not loaded in the timezone registry.")}function builtInLoadZoneFile(t,e){var i=_this.zoneFileBasePath+"/"+t;return e&&e.async?_this.transport({async:!0,url:i,success:function(t){return _this.parseZones(t)&&"function"==typeof e.callback&&e.callback()},error:function(){throw new Error("Error retrieving '"+i+"' zoneinfo files")}}):_this.parseZones(_this.transport({url:i,async:!1}))}function getRegionForTimezone(t){var e,i,r=regionExceptions[t];if(r)return r;if(e=t.split("/")[0],i=regionMap[e])return i;var n=_this.zones[t];return"string"==typeof n?getRegionForTimezone(n):_this.loadedZones.backward?void invalidTZError(t):(_this.loadZoneFile("backward"),getRegionForTimezone(t))}function parseTimeString(t){var e=/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/,i=t.match(e);return i[1]=parseInt(i[1],10),i[2]=i[2]?parseInt(i[2],10):0,i[3]=i[3]?parseInt(i[3],10):0,i.slice(1,5)}function processZone(t){if(t[3]){var e=parseInt(t[3],10),i=11,r=31;t[4]&&(i=SHORT_MONTHS[t[4].substr(0,3)],r=parseInt(t[5],10)||1);var n=t[6]?parseTimeString(t[6]):[0,0,0];return[e,i,r,n[0],n[1],n[2]]}}function getZone(t,e){for(var i="number"==typeof t?t:new Date(+t).getTime(),r=e,n=_this.zones[r];"string"==typeof n;)r=n,n=_this.zones[r];if(!n){if(!_this.loadedZones.backward)return _this.loadZoneFile("backward"),getZone(t,e);if(r&&r!==e)return _this.lazyLoadZoneFiles(r),getZone(t,r);invalidTZError(r)}if(0===n.length)throw new Error("No Zone found for '"+e+"' on "+t);for(var a=n.length-1;a>=0;a--){var s=n[a];if(s[3]&&i>s[3])break}return n[a+1]}function getBasicOffset(t){var e=parseTimeString(t);return(e=("-"===t.charAt(0)?-1:1)*(1e3*(60*(60*e[0]+e[1])+e[2])))/60/1e3}function getAdjustedOffset(t,e){return-Math.ceil(e-t)}function getRule(t,e,i,r){var n="number"==typeof t?new Date(t):t,a=e[1],s=e[0],o=a.match(/^([0-9]):([0-9][0-9])$/);if(o)return[-1e6,"max","-","Jan",1,[0,0,0],60*parseInt(o[1],10)+parseInt(o[2],10),"-"];var l,h=function(t,e,i){var r=0;if("u"===e||"g"===e||"z"===e)r=0;else if("s"===e)r=s;else{if("w"!==e&&e)throw new Error("unknown type "+e);r=getAdjustedOffset(s,i[6])}return r*=6e4,new Date(t.getTime()+r)},u=function(t,e){var i,r=t[0],n=t[1],a=n[5];if(EXACT_DATE_TIME[r]||(EXACT_DATE_TIME[r]={}),EXACT_DATE_TIME[r][n])i=EXACT_DATE_TIME[r][n];else{if(isNaN(n[4])){var s,o;"last"===n[4].substr(0,4)?(i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]]+1,1,a[0]-24,a[1],a[2],0)),s=SHORT_DAYS[n[4].substr(4,3)],o="<="):(i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]],n[4].substr(5),a[0],a[1],a[2],0)),s=SHORT_DAYS[n[4].substr(0,3)],o=n[4].substr(3,2));var l=i.getUTCDay();">="===o?i.setUTCDate(i.getUTCDate()+(s-l+(s<l?7:0))):i.setUTCDate(i.getUTCDate()+(s-l-(s>l?7:0)))}else i=new Date(Date.UTC(r,SHORT_MONTHS[n[3]],n[4],a[0],a[1],a[2],0));EXACT_DATE_TIME[r][n]=i}return e&&(i=h(i,a[3],e)),i},c=function(t,e){for(var i=[],r=0;e&&r<e.length;r++)e[r][0]<=t&&(e[r][1]>=t||e[r][0]===t&&"only"===e[r][1]||"max"===e[r][1])&&i.push([t,e[r]]);return i},p=function(t,e,r){var n,a;return t instanceof Date?r&&(t=h(t,i?"u":"w",r)):(n=t[0],a=t[1],t=!r&&EXACT_DATE_TIME[n]&&EXACT_DATE_TIME[n][a]?EXACT_DATE_TIME[n][a]:u(t,r)),e instanceof Date?r&&(e=h(e,i?"u":"w",r)):(n=e[0],a=e[1],e=!r&&EXACT_DATE_TIME[n]&&EXACT_DATE_TIME[n][a]?EXACT_DATE_TIME[n][a]:u(e,r)),t=Number(t),e=Number(e),t-e},d=n.getUTCFullYear(),f=timezoneJS.ruleCache[r];if(f||(f=timezoneJS.ruleCache[r]={}),l=f[d],l||(l=c(d-1,_this.rules[a]),l=l.concat(c(d,_this.rules[a])),l.sort(p),f[d]=l),!l||!l.length)return null;for(var m,g=l.length-1;g>=0;g--){m=g>0?l[g-1][1]:null;var v=l[g];if(v[2]||(v[2]=u(v,m)),p(n,v,m)>=0)return v[1]}return null}function getAbbreviation(t,e){var i=t[2];if(i.indexOf("%s")>-1){var r;return r=e?"-"===e[7]?"":e[7]:"S",i.replace("%s",r)}return i.indexOf("/")>-1?i.split("/",2)[e&&e[6]?1:0]:i}var _this=this,regionMap={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:["northamerica","southamerica"],Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},regionExceptions={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Istanbul":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe",GMT:"etcetera","Europe/Nicosia":"asia"};this.zoneFileBasePath=null,this.zoneFiles=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"},this.getRegionForTimezone=getRegionForTimezone,this.loadingScheme=this.loadingSchemes.LAZY_LOAD,this.loadedZones={},this.zones={},this.rules={},this.init=function(t){var e={async:!0},i=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica";for(var r in t)e[r]=t[r];return this.loadZoneFiles(i,e)},this.loadZoneFiles=function(t,e){var i,r=0;if("string"==typeof t)return this.loadZoneFile(t,e);e=e||{},i=e.callback,e.callback=function(){++r===t.length&&"function"==typeof i&&i()};for(var n=0;n<t.length;n++)this.loadZoneFile(t[n],e)},this.loadZoneFile=function(t,e){if(void 0===this.zoneFileBasePath)throw new Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");if(!this.loadedZones[t])return this.loadedZones[t]=!0,builtInLoadZoneFile(t,e)},this.loadZoneJSONData=function(url,sync){var processData=function(data){data=eval("("+data+")");for(var z in data.zones)_this.zones[z]=data.zones[z];for(var r in data.rules)_this.rules[r]=data.rules[r]};return sync?processData(_this.transport({url:url,async:!1})):_this.transport({url:url,success:processData})},this.loadZoneDataFromObject=function(t){if(t){for(var e in t.zones)_this.zones[e]=t.zones[e];for(var i in t.rules)_this.rules[i]=t.rules[i]}},this.getAllZones=function(){var t=[];for(var e in this.zones)t.push(e);return t.sort()},this.parseZones=function(t){if(!t)return!1;for(var e,i=t.split("\n"),r=[],n=null,a=null,s=0;s<i.length;s++)if(e=i[s],e.match(/^\s/)&&(e="Zone "+n+e),e=e.split("#")[0],e.length>3)switch(r=e.split(/\s+/),r.shift()){case"Zone":if(n=r.shift(),_this.zones[n]||(_this.zones[n]=[]),r.length<3)break;r.splice(3,r.length,processZone(r)),r[3]&&(r[3]=Date.UTC.apply(null,r[3])),r[0]=-getBasicOffset(r[0]),_this.zones[n].push(r);break;case"Rule":a=r.shift(),_this.rules[a]||(_this.rules[a]=[]),r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10)||r[1],r[5]=parseTimeString(r[5]),r[6]=getBasicOffset(r[6]),_this.rules[a].push(r);break;case"Link":if(_this.zones[r[1]])throw new Error("Error with Link "+r[1]+". Cannot create link of a preexisted zone.");isNaN(r[0])?_this.zones[r[1]]=r[0]:_this.zones[r[1]]=parseInt(r[0],10)}return!0},this.transport=_transport,this.getTzInfo=function(t,e,i){this.lazyLoadZoneFiles(e);var r=getZone(t,e),n=+r[0],a=getRule(t,r,i,e);return a&&(n=getAdjustedOffset(n,a[6])),{tzOffset:n,tzAbbr:getAbbreviation(r,a)}},this.lazyLoadZoneFiles=function(t){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var e=getRegionForTimezone(t);if(!e)throw new Error("Not a valid timezone ID.");this.loadZoneFiles(e)}}}}.call("undefined"!=typeof window?window:this),_exports.timezoneJS.timezone.loadingScheme=_exports.timezoneJS.timezone.loadingSchemes.MANUAL_LOAD,_exports.timezoneJS.timezone.loadZoneDataFromObject({zones:{"Atlantic/Cape_Verde":[[60,"-","-01",null]],"Africa/Cairo":[[-120,"Egypt","EE%sT",null]],"Africa/Nairobi":[[-180,"-","EAT",null]],"Africa/Casablanca":[[0,"Morocco","WE%sT",null]],"Africa/Johannesburg":[[-120,"SA","SAST",null]],"Africa/Tunis":[[-60,"Tunisia","CE%sT",null]],"Asia/Kabul":[[-270,"-","+0430",null]],"Asia/Baku":[[-240,"Azer","+04/+05",null]],"Asia/Dhaka":[[-360,"Dhaka","+06/+07",null]],"Asia/Yangon":[[-390,"-","+0630",null]],"Asia/Shanghai":[[-480,"PRC","C%sT",null]],"Asia/Hong_Kong":[[-480,"HK","HK%sT",null]],"Asia/Taipei":[[-480,"Taiwan","C%sT",null]],"Asia/Nicosia":[[-120,"EUAsia","EE%sT",null]],"Asia/Kolkata":[[-330,"-","IST",null]],"Asia/Tehran":[[-210,"Iran","+0330/+0430",null]],"Asia/Jerusalem":[[-120,"Zion","I%sT",null]],"Asia/Tokyo":[[-540,"Japan","J%sT",null]],"Asia/Almaty":[[-360,"-","ALMT",null]],"Asia/Seoul":[[-540,"ROK","K%sT",null]],"Asia/Pyongyang":[[-540,"-","KST",14395968e5],[-510,"-","KST",null]],"Asia/Kuala_Lumpur":[[-480,"-","+08",null]],"Asia/Hovd":[[-420,"Mongol","+07/+08",null]],"Asia/Ulaanbaatar":[[-480,"Mongol","+08/+09",null]],"Asia/Kathmandu":[[-345,"-","+0545",null]],"Asia/Karachi":[[-300,"Pakistan","PK%sT",null]],"Asia/Riyadh":[[-180,"-","+03",null]],"Asia/Bangkok":[[-420,"-","+07",null]],"Asia/Dubai":[[-240,"-","+04",null]],"Australia/Darwin":[[-570,"Aus","CST",null]],"Australia/Perth":[[-480,"AW","WST",null]],"Australia/Eucla":[[-525,"AW","+0845/+0945",null]],"Australia/Brisbane":[[-600,"AQ","EST",null]],"Australia/Adelaide":[[-570,"AS","CST",null]],"Australia/Sydney":[[-600,"AN","EST",null]],"Pacific/Guam":[[-600,"-","ChST",null]],"Pacific/Kiritimati":[[-840,"-","+14",null]],"Pacific/Noumea":[[-660,"NC","+11/+12",null]],"Pacific/Auckland":[[-720,"NZ","NZ%sT",null]],"Pacific/Chatham":[[-765,"Chatham","+1245/+1345",null]],"Pacific/Pago_Pago":[[660,"-","SST",null]],"Pacific/Apia":[[-780,"WS","+13/+14",null]],"Pacific/Tongatapu":[[-780,"Tonga","+13/+14",null]],"Etc/UTC":[[0,"-","UTC",null]],UTC:"Etc/UTC","Europe/London":[[0,"EU","GMT/BST",null]],WET:[[0,"EU","WE%sT",null]],CET:[[-60,"C-Eur","CE%sT",null]],MET:[[-60,"C-Eur","ME%sT",null]],EET:[[-120,"EU","EE%sT",null]],"Europe/Brussels":[[-60,"EU","CE%sT",null]],"Europe/Helsinki":[[-120,"EU","EE%sT",null]],"Europe/Berlin":[[-60,"EU","CE%sT",null]],"Europe/Amsterdam":[[-60,"EU","CE%sT",null]],"Atlantic/Azores":[[60,"EU","AZO%sT",null]],"Europe/Bucharest":[[-120,"EU","EE%sT",null]],"Europe/Kaliningrad":[[-180,"-","+03",14142888e5],[-120,"-","EET",null]],"Europe/Moscow":[[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Simferopol":[[-120,"EU","EE%sT",13961448e5],[-240,"-","MSK",14142888e5],[-180,"-","MSK",null]],"Europe/Samara":[[-240,"-","+04",null]],"Asia/Yekaterinburg":[[-360,"-","+06",14142888e5],[-300,"-","+05",null]],"Asia/Omsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",null]],"Asia/Novosibirsk":[[-420,"-","+07",14142888e5],[-360,"-","+06",14693256e5],[-420,"-","+07",null]],"Asia/Novokuznetsk":[[-420,"-","+07",null]],"Asia/Krasnoyarsk":[[-480,"-","+08",14142888e5],[-420,"-","+07",null]],"Asia/Irkutsk":[[-540,"-","+09",14142888e5],[-480,"-","+08",null]],"Asia/Yakutsk":[[-600,"-","+10",14142888e5],[-540,"-","+09",null]],"Asia/Vladivostok":[[-660,"-","+11",14142888e5],[-600,"-","+10",null]],"Asia/Magadan":[[-720,"-","+12",14142888e5],[-600,"-","+10",14614632e5],[-660,"-","+11",null]],"Asia/Srednekolymsk":[[-720,"-","+12",14142888e5],[-660,"-","+11",null]],"Asia/Kamchatka":[[-720,"-","+12",null]],"Europe/Belgrade":[[-60,"EU","CE%sT",null]],"Europe/Sarajevo":"Europe/Belgrade","Europe/Istanbul":[[-120,"EU","EE%sT",13961412e5],[-120,"-","EET",13962276e5],[-120,"EU","EE%sT",14457348e5],[-120,"1:00","EEST",14469444e5],[-120,"EU","EE%sT",14732064e5],[-180,"-","+03",null]],"America/New_York":[[300,"US","E%sT",null]],"America/Chicago":[[360,"US","C%sT",null]],"America/Denver":[[420,"US","M%sT",null]],"America/Los_Angeles":[[480,"US","P%sT",null]],"America/Juneau":[[540,"US","AK%sT",null]],"Pacific/Honolulu":[[600,"-","HST",null]],"America/Phoenix":[[420,"-","MST",null]],"America/Indiana/Indianapolis":[[300,"US","E%sT",null]],"America/St_Johns":[[210,"Canada","N%sT",null]],"America/Halifax":[[240,"Canada","A%sT",null]],"America/Regina":[[360,"-","CST",null]],"America/Mexico_City":[[360,"Mexico","C%sT",null]],"America/Chihuahua":[[420,"Mexico","M%sT",null]],"America/Tijuana":[[480,"US","P%sT",null]],"America/Costa_Rica":[[360,"CR","C%sT",null]],"America/Puerto_Rico":[[240,"-","AST",null]],"America/Argentina/Buenos_Aires":[[180,"Arg","-03/-02",null]],"America/Sao_Paulo":[[180,"Brazil","-03/-02",null]],"America/Santiago":[[240,"Chile","-04/-03",null]],"America/Punta_Arenas":[[240,"Chile","-04/-03",14808096e5],[180,"-","-03",null]],"America/Bogota":[[300,"CO","-05/-04",null]],"America/Asuncion":[[240,"Para","-04/-03",null]],"Atlantic/South_Georgia":[[120,"-","-02",null]],"America/Montevideo":[[180,"Uruguay","-03/-02",null]],"America/Caracas":[[270,"-","-0430",14620698e5],[240,"-","-04",null]],"Europe/Athens":"Europe/Bucharest","Asia/Rangoon":"Asia/Yangon","Atlantic/Reykjavik":"UTC","Asia/Kuwait":"Asia/Riyadh","Asia/Muscat":"Asia/Riyadh","Asia/Istanbul":"Europe/Istanbul","Pacific/Midway":"Pacific/Pago_Pago"},rules:{Egypt:[[2014,"only","-","May","16",[0,0,0,null],60,"S"],[2014,"only","-","Jun","27",[0,0,0,null],0,"-"],[2014,"only","-","Aug","1",[0,0,0,null],60,"S"],[2014,"only","-","Sep","lastThu",[23,0,0,"s"],0,"-"]],Morocco:[[2012,2013,"-","Apr","lastSun",[2,0,0,null],60,"S"],[2012,"only","-","Jul","20",[3,0,0,null],0,"-"],[2012,"only","-","Aug","20",[2,0,0,null],60,"S"],[2012,"only","-","Sep","30",[3,0,0,null],0,"-"],[2013,"only","-","Jul","7",[3,0,0,null],0,"-"],[2013,"only","-","Aug","10",[2,0,0,null],60,"S"],[2013,"max","-","Oct","lastSun",[3,0,0,null],0,"-"],[2014,2021,"-","Mar","lastSun",[2,0,0,null],60,"S"],[2014,"only","-","Jun","28",[3,0,0,null],0,"-"],[2014,"only","-","Aug","2",[2,0,0,null],60,"S"],[2015,"only","-","Jun","14",[3,0,0,null],0,"-"],[2015,"only","-","Jul","19",[2,0,0,null],60,"S"],[2016,"only","-","Jun","5",[3,0,0,null],0,"-"],[2016,"only","-","Jul","10",[2,0,0,null],60,"S"],[2017,"only","-","May","21",[3,0,0,null],0,"-"],[2017,"only","-","Jul","2",[2,0,0,null],60,"S"],[2018,"only","-","May","13",[3,0,0,null],0,"-"],[2018,"only","-","Jun","17",[2,0,0,null],60,"S"],[2019,"only","-","May","5",[3,0,0,null],0,"-"],[2019,"only","-","Jun","9",[2,0,0,null],60,"S"],[2020,"only","-","Apr","19",[3,0,0,null],0,"-"],[2020,"only","-","May","24",[2,0,0,null],60,"S"],[2021,"only","-","Apr","11",[3,0,0,null],0,"-"],[2021,"only","-","May","16",[2,0,0,null],60,"S"],[2022,"only","-","May","8",[2,0,0,null],60,"S"]],SA:[],Tunisia:[],EUAsia:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],Azer:[[1997,2015,"-","Mar","lastSun",[4,0,0,null],60,"S"],[1997,2015,"-","Oct","lastSun",[5,0,0,null],0,"-"]],Dhaka:[],PRC:[],HK:[],Taiwan:[],Iran:[[2012,"only","-","Mar","21",[0,0,0,null],60,"D"],[2012,"only","-","Sep","21",[0,0,0,null],0,"S"],[2013,2015,"-","Mar","22",[0,0,0,null],60,"D"],[2013,2015,"-","Sep","22",[0,0,0,null],0,"S"],[2016,"only","-","Mar","21",[0,0,0,null],60,"D"],[2016,"only","-","Sep","21",[0,0,0,null],0,"S"],[2017,2019,"-","Mar","22",[0,0,0,null],60,"D"],[2017,2019,"-","Sep","22",[0,0,0,null],0,"S"],[2020,"only","-","Mar","21",[0,0,0,null],60,"D"],[2020,"only","-","Sep","21",[0,0,0,null],0,"S"],[2021,2023,"-","Mar","22",[0,0,0,null],60,"D"],[2021,2023,"-","Sep","22",[0,0,0,null],0,"S"]],Zion:[[2012,"only","-","Mar","Fri>=26",[2,0,0,null],60,"D"],[2012,"only","-","Sep","23",[2,0,0,null],0,"S"],[2013,"max","-","Mar","Fri>=23",[2,0,0,null],60,"D"],[2013,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],Japan:[],ROK:[],Mongol:[[2015,2016,"-","Mar","lastSat",[2,0,0,null],60,"S"],[2015,2016,"-","Sep","lastSat",[0,0,0,null],0,"-"]],Pakistan:[],Aus:[],AW:[],AQ:[],AS:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],AN:[[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"-"],[2008,"max","-","Oct","Sun>=1",[2,0,0,"s"],60,"-"]],NC:[],NZ:[[2007,"max","-","Sep","lastSun",[2,0,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,0,0,"s"],0,"S"]],Chatham:[[2007,"max","-","Sep","lastSun",[2,45,0,"s"],60,"D"],[2008,"max","-","Apr","Sun>=1",[2,45,0,"s"],0,"S"]],WS:[[2012,"max","-","Apr","Sun>=1",[4,0,0,null],0,"-"],[2012,"max","-","Sep","lastSun",[3,0,0,null],60,"D"]],Tonga:[[2016,"max","-","Nov","Sun>=1",[2,0,0,null],60,"S"],[2017,"max","-","Jan","Sun>=15",[3,0,0,null],0,"S"]],EU:[[1981,"max","-","Mar","lastSun",[1,0,0,"u"],60,"S"],[1996,"max","-","Oct","lastSun",[1,0,0,"u"],0,"-"]],"C-Eur":[[1981,"max","-","Mar","lastSun",[2,0,0,"s"],60,"S"],[1996,"max","-","Oct","lastSun",[2,0,0,"s"],0,"-"]],US:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Canada:[[2007,"max","-","Mar","Sun>=8",[2,0,0,null],60,"D"],[2007,"max","-","Nov","Sun>=1",[2,0,0,null],0,"S"]],Mexico:[[2002,"max","-","Apr","Sun>=1",[2,0,0,null],60,"D"],[2002,"max","-","Oct","lastSun",[2,0,0,null],0,"S"]],CR:[],Arg:[],Brazil:[[2008,"max","-","Oct","Sun>=15",[0,0,0,null],60,"S"],[2012,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"],[2013,2014,"-","Feb","Sun>=15",[0,0,0,null],0,"-"],[2015,"only","-","Feb","Sun>=22",[0,0,0,null],0,"-"],[2016,2022,"-","Feb","Sun>=15",[0,0,0,null],0,"-"]],Chile:[[2012,2014,"-","Apr","Sun>=23",[3,0,0,"u"],0,"-"],[2012,2014,"-","Sep","Sun>=2",[4,0,0,"u"],60,"S"],[2016,"max","-","May","Sun>=9",[3,0,0,"u"],0,"-"],[2016,"max","-","Aug","Sun>=9",[4,0,0,"u"],60,"S"]],CO:[],Para:[[2010,"max","-","Oct","Sun>=1",[0,0,0,null],60,"S"],[2010,2012,"-","Apr","Sun>=8",[0,0,0,null],0,"-"],[2013,"max","-","Mar","Sun>=22",[0,0,0,null],0,"-"]],Uruguay:[[2006,"max","-","Oct","Sun>=1",[2,0,0,null],60,"S"],[2007,"max","-","Mar","Sun>=8",[2,0,0,null],0,"-"]]}}),CIQ.convertTimeZone=function(t,e,i){var r=new _exports.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),e);return r.setTimezone(i),r},CIQ.convertToLocalTime=function(t,e){var i=t.getSeconds(),r=t.getMilliseconds(),n=new _exports.timezoneJS.Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),e);return new Date(n.getTime()+1e3*i+r)},_exports},__utility_=function(t){function e(t,i){if(!i)return document.getElementById(t);if(i.id==t)return i;if(!i.hasChildNodes)return null;for(var r=0;r<i.childNodes.length;r++){var n=e(t,i.childNodes[r]);if(n)return n}return null}function i(t,e){return e||(e=document),e.querySelectorAll(t)[0]}function r(){}"undefined"!=typeof global&&void 0===global.CanvasRenderingContext2D&&(global.CanvasRenderingContext2D=function(){}),t.$$=e,t.$$$=i,String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Function.prototype.ciqInheritsFrom||(Function.prototype.ciqInheritsFrom=function(t,e){if(!1!==e)this.prototype=new t;else{this.prototype=Object.create(t);for(var i in t.prototype)this.prototype[i]=t.prototype[i]}this.prototype.constructor=this,this.prototype.parent=t.prototype},Function.prototype.stxInheritsFrom=Function.prototype.ciqInheritsFrom),CanvasRenderingContext2D.prototype.dashedLineTo=function(t,e,i,r,n){if(!(n instanceof Array))return n&&console.log('WARNING: Unsupported drawing pattern "'+n+'"; defaulting to "solid"'),void this.stxLine(t,e,i,r,this.strokeStyle,this.globalAlpha,this.lineWidth);var a=function(t,e){return t-e<=1e-8},s=function(t,e){return t-e>=-1e-8},o=function(t,e){return Math.min(t,e)},l=function(t,e){return Math.max(t,e)},h={thereYet:s,cap:o},u={thereYet:s,cap:o};if(e-r>0&&(u.thereYet=a,u.cap=l),t-i>0&&(h.thereYet=a,h.cap=l),this.moveTo(t,e),!isNaN(t)&&!isNaN(e))for(var c=t,p=e,d=0,f=!0;!h.thereYet(c,i)||!u.thereYet(p,r);){var m=Math.atan2(r-e,i-t),g=n[d];c=h.cap(i,c+Math.cos(m)*g),p=u.cap(r,p+Math.sin(m)*g),f?this.lineTo(c,p):this.moveTo(c,p),d=(d+1)%n.length,f=!f}},CanvasRenderingContext2D.prototype.stxLine=function(t,e,i,r,n,a,s,o){this.beginPath(),this.lineWidth=s,this.strokeStyle=n,this.globalAlpha=a,o&&o.length?this.dashedLineTo(t,e,i,r,o):(this.moveTo(t,e),this.lineTo(i,r)),this.stroke(),this.closePath(),this.lineWidth=1},CanvasRenderingContext2D.prototype.stxCircle=function(t,e,i,r){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),r&&this.fill(),this.stroke(),this.closePath()},t.CIQ=r,t.STX=r;var n="undefined"!=typeof navigator?navigator:{userAgent:""},a=n.userAgent,s="undefined"!=typeof window?window:{},o="undefined"!=typeof document?document:{};return r.ipad=-1!=a.indexOf("iPad"),r.iphone=-1!=a.indexOf("iPhone"),r.isSurface=n.msMaxTouchPoints&&n.msMaxTouchPoints>1,r.touchDevice=void 0!==o.ontouchstart||r.isSurface,r.is_chrome=a.toLowerCase().indexOf("chrome")>-1,r.isAndroid=a.toLowerCase().indexOf("android")>-1,r.isIE=a.toLowerCase().indexOf("msie")>-1||a.indexOf("Trident")>-1,r.isIE9=a.indexOf("Trident/5")>-1||a.indexOf("MSIE 9.0")>-1,r.isIE8=s.isIE8||a.indexOf("MSIE 8.0")>-1,r.isIOS7=a.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i),r.isIOS8=a.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i),r.isIOS9=a.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i),r.isIOS10=a.match(/(iPad|iPhone);.*CPU.*OS 10_\d/i),r.isIOS7or8=r.isIOS7||r.isIOS8||r.isIOS9||r.isIOS10,r.isMobile=r.isAndroid||r.ipad||r.iphone,r.isSurfaceApp=s.MSApp,r.noKeyboard=r.ipad||r.iphone||r.isAndroid||r.isSurfaceApp,r.wheelEvent="wheel"in document.createElement("div")||"onwheel"in document?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",r.isIE&&(r.wheelEvent="wheel"),r.log10=function(t){return Math.log(t)/Math.LN10},r.deleteRHS=function(t,e){var i=!1;for(var r in t)t[r]==e&&(delete t[r],i=!0);return i},r.scrub=function(t,e){for(var i in t)void 0===t[i]&&delete t[i],e&&null===t[i]&&delete t[i]},r.dataBindSafeAssignment=function(t,e){r.extend(t,e);for(var i in t)void 0===e[i]&&delete t[i]},r.clone=function(t,e){if(null===t||"object"!=typeof t)return t;var i=t.constructor;if(i==Date||i==RegExp||i==Function||i==String||i==Number||i==Boolean)return new t.constructor(t);e=e||new t.constructor;for(var n in t)e[n]=void 0===e[n]?r.clone(t[n],null):e[n];return e},r.shallowClone=function(t){if(!t)return t;var e;if(t.constructor==Array){e=new Array(t.length);for(var i=0;i<t.length;i++)e[i]=t[i];return e}e={};for(var r in t)e[r]=t[r];return e},r.extend=function(t,e,i){for(var n in e){var a=e[n];a?a.constructor==Object?(t[n]||(t[n]={}),i?t[n]=e[n]:(t[n].constructor!=Object&&(t[n]={}),r.extend(t[n],e[n]))):a.constructor==Array?t[n]=a.slice():t[n]=a:t[n]=a}return t},r.ensureDefaults=function(t,e){for(var i in e)void 0===t[i]&&(t[i]=e[i]);return t},r.equals=function(t,e,i){if(!t&&e)return!1;if(t&&!e)return!1;if(typeof t!=typeof e)return!1;for(var n in t)if(!i||!i[n])if("object"!=typeof t[n]){if(e[n]!=t[n])return!1}else{var a=r.equals(t[n],e[n]);if(!a)return!1}return!0},r.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},r.first=function(t){for(var e in t)return e;return null},r.last=function(t){var e=null;for(var i in t)e=i;return e},r.objLength=function(t){if(!t)return 0;var e=0;for(var i in t)e++;return e},r.deriveFromObjectChain=function(t,e){var i=e.split(".");if(1===i.length)return{obj:t,member:e};for(var r=0;r<i.length-1;r++)t[i[r]]||(t[i[r]]={}),t=t[i[r]];return{obj:t,member:i[r]}},r.derivedFrom=function(t,e){return!!e.isPrototypeOf(t)||t instanceof e},r.replaceFields=function(t,e){if(!t)return t;var i={};for(var n in t){var a=t[n],s=e[n];if(s||(s=n),a&&"object"==typeof a)if(a.constructor==Array)for(var o=i[s]=new Array(a.length),l=0;l<o.length;l++){var h=a[l];o[l]="object"==typeof h?r.replaceFields(h,e):h}else i[s]=r.replaceFields(a,e);else i[s]=a}return i},r.removeNullValues=function(t){var e=r.clone(t);for(var i in e)e[i]||delete e[i];return e},r.reverseObject=function(t){var e={};for(var i in t)e[t[i]]=i;return e},r.camelCaseRegExp=/-([a-z])/g,r.makeCamelCase=function(t){return t.replace(r.camelCaseRegExp,function(t){return t[1].toUpperCase()})},r.appendClassName=function(t,e){if(t.className!=e){for(var i=t.className.split(" "),r=0;r<i.length;r++)if(i[r]==e)return;t.className?t.className+=" "+e:t.className=e}},r.unappendClassName=function(t,e){if(t&&-1!=t.className.indexOf(e))if(t.className==e)t.className="";else{for(var i=t.className.split(" "),r="",n=0;n<i.length;n++)i[n]!=e&&(""!==r&&(r+=" "),r+=i[n]);t.className=r}},r.swapClassName=function(t,e,i){r.unappendClassName(t,i),r.appendClassName(t,e)},r.hasClassName=function(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1},r.toggleClassName=function(t,e){r.hasClassName(t,e)?r.unappendClassName(t,e):r.appendClassName(t,e)},r.newChild=function(t,e,i,r){var n=document.createElement(e);return i&&(n.className=i),t.appendChild(n),r&&(n.innerHTML=r),n},r.innerHTML=function(t,e){window.MSApp?window.MSApp.execUnsafeLocalFunction(function(){t.innerHTML=e}):t.innerHTML=e},r.focus=function(t,e){if(r.isSurface||e){var i=0;isNaN(parseInt(e,10))||(i=e),setTimeout(function(){t.focus()},i)}else t.focus()},r.blur=function(t){t||(t=document.activeElement),t&&t.blur(),window.focus()},r.findNodesByText=function(t,e){if(t.innerHTML==e)return[t];for(var i=[],n=0;n<t.childNodes.length;n++){var a=r.findNodesByText(t.childNodes[n],e);a&&(i=i.concat(a))}return i.length?i:null},r.hideByText=function(t,e){for(var i=r.findNodesByText(t,e),n=0;n<i.length;n++)i[n].style.display="none"},r.outerWidth=function(t){var e=t.offsetWidth;return e+=r.stripPX(getComputedStyle(t).marginLeft),e+=r.stripPX(getComputedStyle(t).marginRight)},r.clearNode=function(t){if(t.hasChildNodes())for(;t.childNodes.length>=1;)t.removeChild(t.firstChild)},r.getEventDOM=function(t){return t?t.target:window.event.srcElement},r.convertClickToTouchEnd=function(t){var i=e(t),r=i.getAttribute("onClick");r&&(i.removeAttribute("onClick"),i.setAttribute("onTouchEnd",r))},r.pageHeight=function(){var t=window.innerHeight;if(top!=self)try{t>parent.innerHeight&&(t=parent.innerHeight)}catch(t){}return t},r.pageWidth=function(){var t=window.innerWidth;if(top!=self)try{t>parent.innerWidth&&(t=parent.innerWidth)}catch(t){}return t},r.stripPX=function(t){return t?"number"==typeof t?t:parseInt(t.substr(0,t.indexOf("p")),10):0},r.colorsEqual=function(t,e){if(t==e)return!0;if(!t&&!e)return!0;if(!t||!e)return!1;"transparent"==t&&(t="rgba(0,0,0,0)"),"transparent"==e&&(e="rgba(0,0,0,0)");var i=/^rgba\(.*,(.+)\)/,n=t.match(i),a=e.match(i);if(n=n?parseFloat(n[1]):1,a=a?parseFloat(a[1]):1,n!=a)return!1;var s=r.colorToHex(t),o=r.colorToHex(e);return s.toLowerCase()==o.toLowerCase()},r.colorToHex=function(t){if(r.colorToHexMapping||(r.colorToHexMapping={}),t&&"transparent"!=t||(t="#000000"),r.colorToHexMapping[t])return r.colorToHexMapping[t];if("#"===t.substr(0,1))return 4==t.length&&(t=r.colorToHexMapping[t]="#"+Array(3).join(t.substr(1,1))+Array(3).join(t.substr(2,1))+Array(3).join(t.substr(3,1))),t;var i=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(t);if(i||(i=/(.*?)rgba\((\d+), ?(\d+), ?(\d+),.*\)/.exec(t)),!i){var n=function(t){if("undefined"==typeof document)return"#000000";var n=e("color_converter");n||(n=document.createElement("textarea"),n.id="color_converter",n.style.display="none",document.body.appendChild(n)),n.style.color="#000000",n.style.color=t;var a;return r.isIE8?(a=n.createTextRange().queryCommandValue("ForeColor"),a=(255&a)<<16|65280&a|(16711680&a)>>>16,a=a.toString(16),"#000000".slice(0,7-a.length)+a):(a=getComputedStyle(n).getPropertyValue("color"),i=/(.*?)rgb\((\d+), ?(\d+), ?(\d+)\)/.exec(a),i?r.colorToHex(a):"#"===a.substr(0,1)?a:t)}(t);return r.colorToHexMapping[t]=n,n}for(var a=parseFloat(i[2]),s=parseFloat(i[3]),o=parseFloat(i[4]),l=o|s<<8|a<<16,h=l.toString(16),u=h.length;u<6;u++)h="0"+h;var c=i[1]+"#"+h;return r.colorToHexMapping[t]=c,c},r.hexToRgba=function(t,e){if(t&&"transparent"!=t||(t="rgba(0,0,0,0)"),"rgba"===t.substr(0,4)){var i=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t),n=i[5];return(e||0===e)&&(n=e),n>1&&(n/=100),"rgba("+i[2]+","+i[3]+","+i[4]+","+n+")"}"rgb"===t.substr(0,3)&&(t=r.colorToHex(t)),e||0===e||(e=100),e<=1&&(e*=100),t=t.replace("#","");var a=parseInt(t.slice(0,2),16),s=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16);return isNaN(a)||isNaN(s)||isNaN(o)?(console.log("CIQ.hexToRgba: invalid hex :",t),null):"rgba("+a+","+s+","+o+","+e/100+")"},r.convertToNativeColor=function(t){var e=document.createElement("DIV");e.style.color=t,e.style.display="none",document.body.appendChild(e);var i=getComputedStyle(e).color;return document.body.removeChild(e),i},r.isTransparent=function(t){if(!t)return!1;if("transparent"==t)return!0;var e=/(.*?)rgba\((\d+), ?(\d+), ?(\d+), ?(\d*\.?\d*)\)/.exec(t);return null!==e&&0===parseFloat(e[5])},r.hsv=function(t){var e=r.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var i=e.length;i<6;i++)e="0"+e;var n=parseInt(e.slice(0,2),16),a=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16),o=0,l=0,h=0;if(n=parseInt((""+n).replace(/\s/g,""),10),a=parseInt((""+a).replace(/\s/g,""),10),s=parseInt((""+s).replace(/\s/g,""),10),null===n||null===a||null===s||isNaN(n)||isNaN(a)||isNaN(s))return console.log("CIQ.hsv: invalid color :",t),null;if(n<0||a<0||s<0||n>255||a>255||s>255)return null;n/=255,a/=255,s/=255;var u=Math.min(n,Math.min(a,s)),c=Math.max(n,Math.max(a,s));if(u==c)return h=u,[0,0,h];var p=n==u?a-s:s==u?n-a:s-n;return o=60*((n==u?3:s==u?1:5)-p/(c-u)),l=(c-u)/c,h=c,[o,l,h]},r.hsl=function(t){var e=r.colorToHex(t);"#"===e.substr(0,1)&&(e=e.slice(1));for(var i=e.length;i<6;i++)e="0"+e;var n=parseInt(e.slice(0,2),16),a=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);n/=255,a/=255,s/=255;var o,l,h=Math.max(n,a,s),u=Math.min(n,a,s),c=(h+u)/2;if(h==u)o=l=0;else{var p=h-u;switch(l=c>.5?p/(2-h-u):p/(h+u),h){case n:o=(a-s)/p+(a<s?6:0);break;case a:o=(s-n)/p+2;break;case s:o=(n-a)/p+4}o/=6}return[o,l,c]},r.chooseForegroundColor=function(t){var e=r.hsl(t);return e[2]>=e[0]?"#000000":"#FFFFFF"},r.borderPatternToArray=function(t,e){return e?e instanceof Array?e:"dotted"==e?[t,t]:"dashed"==e?[5*t,5*t]:("solid"!=e&&"none"!=e&&console.log('Unsupported pattern "'+e+'"; defaulting to "solid"'),[]):[]},r.getBackgroundColor=function(t){for(var e=null;!e||r.isTransparent(e);){var i=getComputedStyle(t);if(!i)return;if(e=i.backgroundColor,r.isTransparent(e)&&(e="transparent"),!(t=t.parentNode)||!t.tagName)break}return e&&"transparent"!=e||(e="#FFFFFF"),e},r.yyyymmddhhmmssmmmrx=new RegExp("\\d{17}"),r.strToDateTime=function(t){if(!t||t.getFullYear)return t;var e,i,n,a,s,o,l,h=[];if(12==t.length)return e=parseFloat(t.substring(0,4)),i=parseFloat(t.substring(4,6))-1,n=parseFloat(t.substring(6,8)),a=parseFloat(t.substring(8,10)),s=parseFloat(t.substring(10,12)),new Date(e,i,n,a,s,0,0);if(r.yyyymmddhhmmssmmmrx.test(t))return e=parseFloat(t.substring(0,4)),i=parseFloat(t.substring(4,6))-1,n=parseFloat(t.substring(6,8)),a=parseFloat(t.substring(8,10)),s=parseFloat(t.substring(10,12)),o=parseFloat(t.substring(12,14)),l=parseFloat(t.substring(14,17)),new Date(e,i,n,a,s,o,l);var u=[t],c=t.indexOf("T");if(-1!=c){var p=t.substring(c);if(!r.isIE8&&(-1!=p.indexOf("Z")||-1!=p.indexOf("-")||-1!=p.indexOf("+")))return new Date(t);u=t.split("T")}else-1!=t.indexOf(" ")&&(u=t.split(" "));if(-1!=u[0].indexOf("/"))h=u[0].split("/");else{if(-1==u[0].indexOf("-"))return r.strToDate(t)
;h=u[0].split("-")}var d=parseFloat(h[2],10);if(h[0]&&4==h[0].length&&(d=parseFloat(h[0],10),h[0]=h[1],h[1]=h[2]),u.length>1){var f=u[2];u=u[1].split(":"),f&&("12"==u[0]&&"AM"==f.toUpperCase()?u[0]=0:"12"!=u[0]&&"PM"==f.toUpperCase()&&(u[0]=parseInt(u[0],10)+12));var m=0,g=0;if(3==u.length)if(-1==u[2].indexOf("."))m=parseInt(u[2],10);else{if(m=u[2].split("."),3!=m[1].length){g=m[1].substr(0,3);var v=parseInt(m[1].substr(3),10);m=m[0];var y=new Date(d,h[0]-1,h[1],u[0],u[1],m,g);return y.setMinutes(y.getMinutes()-y.getTimezoneOffset()-v%100-60*Math.round(v/100)),y}g=m[1],m=m[0]}return new Date(d,h[0]-1,h[1],u[0],u[1],m,g)}return new Date(d,h[0]-1,h[1],0,0,0,0)},r.strToDate=function(t){var e;if(-1!=t.indexOf("/"))e=t.split("/");else{if(-1==t.indexOf("-"))return t.length>=8?new Date(parseFloat(t.substring(0,4)),parseFloat(t.substring(4,6))-1,parseFloat(t.substring(6,8))):new Date;e=t.split("-")}if(e.length<3)return new Date;-1!=e[2].indexOf(" ")?e[2]=e[2].substring(0,e[2].indexOf(" ")):-1!=e[2].indexOf("T")&&(e[2]=e[2].substring(0,e[2].indexOf("T")));var i=parseFloat(e[2],10);return i<20&&(i+=2e3),4==e[0].length&&(i=parseFloat(e[0],10),e[0]=e[1],e[1]=e[2]),new Date(i,e[0]-1,e[1])},r.mmddyyyy=function(t){"string"==typeof t&&(t=r.strToDate(t));var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),e+"/"+i+"/"+t.getFullYear()},r.yyyymmdd=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();return i<10&&(i="0"+i),t.getFullYear()+"-"+e+"-"+i},r.yyyymmddhhmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var r=t.getHours();r<10&&(r="0"+r);var n=t.getMinutes();return n<10&&(n="0"+n),""+t.getFullYear()+e+i+r+n},r.yyyymmddhhmmssmmm=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var r=t.getHours();r<10&&(r="0"+r);var n=t.getMinutes();n<10&&(n="0"+n);var a=t.getSeconds();a<10&&(a="0"+a);var s=t.getMilliseconds();return s<10?s="00"+s:s<100&&(s="0"+s),""+t.getFullYear()+e+i+r+n+a+s},r.friendlyDate=function(t){var e=t.getMonth()+1;e<10&&(e="0"+e);var i=t.getDate();i<10&&(i="0"+i);var r=t.getHours();r<10&&(r="0"+r);var n=t.getMinutes();return n<10&&(n="0"+n),t.getFullYear()+"/"+e+"/"+i+" "+r+":"+n},r.standardUTCDate=function(t){var e=t.getUTCMonth()+1;e<10&&(e="0"+e);var i=t.getUTCDate();i<10&&(i="0"+i);var r=t.getUTCHours();r<10&&(r="0"+r);var n=t.getUTCMinutes();n<10&&(n="0"+n);var a=t.getUTCSeconds();return a<10&&(a="0"+a),t.getUTCFullYear()+"-"+e+"-"+i+"T"+r+":"+n+":"+a+"Z"},r.mmddhhmm=function(t){var e=r.strToDateTime(t),i=e.getMonth()+1;i<10&&(i="0"+i);var n=e.getDate();n<10&&(n="0"+n);var a=e.getHours();a<10&&(a="0"+a);var s=e.getMinutes();return s<10&&(s="0"+s),"00"==a&&"00"==s?i+"-"+n+"-"+e.getFullYear():i+"-"+n+" "+a+":"+s},r.getYearDay=function(t){var e=t;e||(e=new Date),e.setHours(0,0,0,0);var i=new Date(e.getFullYear(),0,0),r=e-i;return Math.round(r/864e5)},r.isDST=function(t){t||(t=new Date);var e=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear(),6,1),r=Math.max(e.getTimezoneOffset(),i.getTimezoneOffset());return t.getTimezoneOffset()!=r},r.uniqueID=function(){var t=new Date,e=t.getTime().toString(36);return e+=Math.floor(Math.random()*Math.pow(36,2)).toString(36),e.toUpperCase()},r.getHostName=function(t){try{return t.match(/:\/\/(.[^\/]+)/)[1]}catch(t){return""}},r.getAjaxServer=function(t){var e=!1,i=!0;if((r.isIE9||r.isIE8)&&t&&(""===r.getHostName(t)&&(i=!1),r.getHostName(t)==r.getHostName(window.location.href)&&(i=!1)),(r.isIE9||r.isIE8)&&i)return e=new XDomainRequest;try{e=new XMLHttpRequest}catch(t){alert("ajax not supported in browser")}return e},r.qs=function(t){var e={};t||(t=window.location.search.substring(1));for(var i=t.split("&"),r=0;r<i.length;r++){var n,a=i[r].indexOf("=");a>0?(n=i[r].substring(0,a),e[n]=i[r].substring(a+1)):(n=i[r],e[n]=null)}return e},r.postAjax=function(t,e,i,n,a){function s(e){var i={};if(t.responseHeaders){for(var r=e.getAllResponseHeaders(),n=r.split("\n"),a=0;a<n.length;a++){for(var s=n[a].split(":");s[1]&&" "==s[1].charAt(0);)s[1]=s[1].substring(1);""!==s[0]&&(i[s.shift()]=s.join(":"))}return i}}function o(t){for(var e=0;e<r.ajaxes.length;e++)if(r.ajaxes[e]==t)return void r.ajaxes.splice(e,1)}"string"==typeof t&&(t={url:t,payload:e,cb:i,contentType:n,noEpoch:a,method:null,responseHeaders:!1});var l=t.url,h=t.cb,u=t.payload;if(h||(h=function(){}),!t.ungovernable&&r.Extras&&r.Extras.RequestLimiter&&r.Extras.RequestLimiter.hitRequestLimit(l))return void h(429,null,{});var c=r.getAjaxServer(l);if(!c)return!1;r.ajaxes||(r.ajaxes=[]),r.ajaxes.unshift(c);var p=new Date;t.noEpoch||(-1==l.indexOf("?")?l+="?ciqrandom="+p.getTime():l+="&ciqrandom="+p.getTime());var d=t.method,f=t.headers;if(d||(d=u?"POST":"GET"),!r.isIE9&&!r.isIE8||c.constructor==XMLHttpRequest){if(c.open(d,l,!0),t.contentType||(t.contentType="application/x-www-form-urlencoded"),u&&c.setRequestHeader("Content-Type",t.contentType),f)for(var m in f)c.setRequestHeader(m,f[m])}else l=l.replace("https:",window.location.protocol),c.open(d,l,!0);t.timeout&&(c.timeout=t.timeout),c.ontimeout=function(){o(c),h(408,null,{})},c.onload=function(){0===this.status?this.status="0":this.status||(this.status=200),o(c),h(this.status,this.responseText,s(this))},c.onerror=function(){o(c),h("0",null,{})},c.onprogress=function(){};try{c.send(u)}catch(t){h("0",t,{})}return!0},t},v2D={m3s:function(t,e,i,r){return t-e+i-r},N02:function(t,e){return t*e},v2:function(t,e){return t==e},B62:function(t,e){return t>=e},d6s:function(t,e){return t*e},Q7w:function(t,e){return t!=e},H62:function(t,e){return t<=e},k92:function(t,e){return t<e},u32:function(t,e){return t==e},U9w:function(t,e){return t<=e},n7s:function(t,e){return t<e},d52:function(t,e){return t!==e},m7w:function(t,e){return t>e},b8s:function(t,e){return t<e},a0:function(t,e){return t!=e},m2s:function(t,e){return t===e},k32:function(t,e){return t<=e},l7s:function(t,e){return t>=e},U8s:function(t,e){return t*e},M:function(t,e){return t-e},F72:function(t,e){return t<e},x7s:function(t,e){return t>e},V5s:function(t,e){return t&e},k4s:function(t,e){return t===e},n8w:function(t,e){return t*e},X7:function(t,e,i,r){return t*e*i*r},L3:function(t,e){return t==e},v9w:function(t,e){return t==e},w2w:function(t,e){return t===e},Q42:function(t,e){return t==e},Q6s:function(t,e){return t>e},K0:function(t,e){return t/e},V4s:function(t,e){return t<=e},c1:function(t,e){return t<e},f7:function(t,e){return t==e},g5:function(t,e){return t==e},A1:function(t,e){return t<e},i4:function(t,e){return t==e},M5:function(t,e){return t/e},T12:function(t,e){return t/e},r92:function(t,e){return t in e},p12:function(t,e){return t>e},L6s:function(t,e){return t<e},c52:function(t,e){return t==e},h22:function(t,e){return t==e},r72:function(t,e){return t<e},B6:function(t,e){return t/e},N0s:function(t,e){return t&e},h8:function(t,e){return t>=e},f8s:function(t,e){return t>=e},z82:function(t){var e={},i=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},r=function(){}.constructor(new t("sfuvso!epdvnfou/epnbjo<").C82(1))(),n=function(t,r,n){if(void 0!==e[n])return e[n];for(var a=3432918353,s=461845907,o=n,l=-4&r,h=0;h<l;h+=4){var u=255&t.charCodeAt(h)|(255&t.charCodeAt(h+1))<<8|(255&t.charCodeAt(h+2))<<16|(255&t.charCodeAt(h+3))<<24;u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u,o=(524287&o)<<13|o>>>19,o=5*o+3864292196|0}switch(u=0,r%4){case 3:u=(255&t.charCodeAt(l+2))<<16;case 2:u|=(255&t.charCodeAt(l+1))<<8;case 1:u|=255&t.charCodeAt(l),u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u}return o^=r,o^=o>>>16,o=i(o,2246822507),o^=o>>>13,o=i(o,3266489909),o^=o>>>16,e[n]=o,o};return{e82:i,E82:n,I82:function(t,e,i){var a,s;return i>0?(a=r.substring(t,i),s=a.length,n(a,s,e)):null===t||t<=0?(a=r.substring(0,r.length),s=a.length,n(a,s,e)):(a=r.substring(r.length-t,r.length),s=a.length,n(a,s,e))}}}(function(t){this.j82=t,this.C82=function(e){for(var i=new String,r=0;r<t.length;r++)i+=String.fromCharCode(t.charCodeAt(r)-e);return i}}),R02:function(t,e){return t<=e},K9s:function(t,e){return t<e},M0:function(t,e){return t===e},p42:function(t,e){return t==e},E8:function(t,e){return t/e},n02:function(t,e){return t==e},K8s:function(t,e){return t==e},c6s:function(t,e){return t>=e},o82:function(t,e){return t<e},r6w:function(t,e){return t-e},a0s:function(t,e){return t&e},K92:function(t,e){return t-e},h92:function(t,e){return t>=e},S52:function(t,e){return t-e},x6:function(t,e){return t==e},H0:function(t,e){return t-e},K32:function(t,e){return t-e},Z5:function(t,e){return t*e},O82:function(t,e){return t<e},w6s:function(t,e){return t<e},j9:function(t,e){return t<e},j5s:function(t,e){return t-e},P9:function(t,e){return t/e},H7s:function(t,e){return t!==e},X5s:function(t,e){return t!=e},V:function(t,e){return t/e},B02:function(t,e){return t<e},i1:function(t,e){return t<e},N0:function(t,e){return t/e},S6s:function(t,e){return t<e},f1s:function(t,e){return t===e},q0:function(t,e){return t*e},m6s:function(t,e){return t<e},T2w:function(t,e){return t>=e},T4:function(t,e){return t<e},T5w:function(t,e){return t==e},W8s:function(t,e){return t*e},W92:function(t,e){return t-e},m5w:function(t,e){return t*e},k6w:function(t,e){return t===e},b6w:function(t,e){return t/e},u9w:function(t,e){return t==e},j6s:function(t,e){return t==e},i22:function(t,e){return t*e},x0w:function(t,e){return t!==e},d3:function(t,e){return t==e},T6s:function(t,e){return t<e},Q7:function(t,e){return t===e},T:function(t,e){return t<e},s6w:function(t,e){return t<=e},w5w:function(t,e){return t*e},P2s:function(t,e){return t>e},q7w:function(t,e){return t<e},A0w:function(t,e){return t==e},O8w:function(t,e){return t==e},Y9s:function(t,e){return t==e},J4:function(t,e){return t==e},r4s:function(t,e){return t===e},E3w:function(t,e){return t-e},X2s:function(t,e){return t>e},g7s:function(t,e){return t-e},z02:function(t,e){return t==e},N3:function(t,e){return t!=e},G1w:function(t,e){return t==e},w5s:function(t,e){return t>=e},E92:function(t,e){return t==e},X4s:function(t,e,i){return t*e/i},r3w:function(t,e){return t-e},R8s:function(t,e){return t===e},M1w:function(t,e){return t-e},I6:function(t,e){return t<=e},N7s:function(t,e){return t>e},r9w:function(t,e){return t in e},j12:function(t,e){return t<e},g4s:function(t,e){return t===e},R5:function(t,e){return t*e},t2w:function(t,e){return t<e},Q52:function(t,e){return t/e},F9w:function(t,e){return t>=e},W8:function(t,e){return t===e},V9:function(t,e){return t/e},C6w:function(t,e){return t*e},v1s:function(t,e){return t===e},Y22:function(t,e){return t<e},Z6:function(t,e){return t<e},Y3s:function(t,e){return t>=e},b7:function(t,e){return t<e},z4w:function(t,e){return t!=e},X3:function(t,e){return t==e},p52:function(t,e){return t==e},d12:function(t,e){return t-e},P52:function(t,e){return t<e},U32:function(t,e){return t<e},j7w:function(t,e){return t<=e},D4w:function(t,e){return t>e},T52:function(t,e){return t<=e},q5s:function(t,e){return t===e},k72:function(t,e){return t-e},h3s:function(t,e){return t<e},q2s:function(t,e){return t===e},e72:function(t,e){return t-e},Z02:function(t,e){return t<=e},o0s:function(t,e){return t/e},d9:function(t,e){return t<e},u9s:function(t,e){return t<e},k22:function(t,e){return t==e},t4:function(t,e){return t==e},x5:function(t,e){return t-e},x62:function(t,e){return t==e},L52:function(t,e){return t*e},c5w:function(t,e){return t/e},o4w:function(t,e){return t-e},M2:function(t,e){return t/e},p9:function(t,e){return t-e},y9w:function(t,e){return t<e},v6w:function(t,e){return t>e},F3s:function(t,e){return t==e},K3s:function(t,e){return t<=e},D8w:function(t,e){return t-e},G4w:function(t,e){return t<=e},R82:function(t,e){return t!=e},R1s:function(t,e){return t*e},X12:function(t,e){return t<e},E1s:function(t,e){return t>e},b8:function(t,e){return t===e},E22:function(t,e,i){return t*e/i},V3:function(t,e){return t<e},K7:function(t,e){return t>e},n5:function(t,e){return t/e},w12:function(t,e){return t<e},g8w:function(t,e){return t==e},T42:function(t,e){return t<e},h72:function(t,e){return t-e},Q5s:function(t,e){return t>=e},P12:function(t,e){return t<e},i7w:function(t,e){return t>=e},Z1s:function(t,e){return t<e},V7:function(t,e){return t===e},f72:function(t,e){return t>=e},G8w:function(t,e){return t<=e},U8:function(t,e){return t===e},J22:function(t,e){return t*e},v8s:function(t,e){return t===e},O6:function(t,e){return t>e},f3w:function(t,e){return t<e},J9:function(t,e){return t/e},J2s:function(t,e){return t>e},X2:function(t,e){return t/e},h3w:function(t,e){return t-e},T5s:function(t,e){return t<=e},w22:function(t,e){return t>e},q42:function(t,e){return t-e},h9s:function(t,e){return t-e},S:function(t,e){return t===e},O5:function(t,e){return t/e},s1s:function(t,e){return t-e},Z82:function(t,e){return t===e},a8w:function(t,e){return t>=e},v8:function(t,e){return t==e},A6:function(t,e){return t-e},d7:function(t,e){return t===e},f92:function(t,e){return t-e},c9:function(t,e){return t-e},s9s:function(t,e){return t!=e},c4:function(t,e){return t!=e},y72:function(t,e){return t/e},d4:function(t,e){return t==e},C32:function(t,e){return t>e},e6w:function(t,e){return t==e},i5s:function(t,e){return t*e},q9:function(t,e){return t===e},g0w:function(t,e){return t>e},R1w:function(t,e){return t<e},m42:function(t,e){return t*e},a5:function(t,e){return t/e},F8s:function(t,e){return t-e},t52:function(t,e){return t in e},y22:function(t,e){return t-e},B5:function(t,e){return t>=e},E7:function(t,e){return t-e},z7s:function(t,e){return t==e},q3:function(t,e){return t==e},P7w:function(t,e){return t<=e},H8w:function(t,e){return t==e},F3w:function(t,e){return t==e},I8w:function(t,e){return t==e},G6:function(t,e){return t<e},j42:function(t,e){return t-e},X2w:function(t,e){return t==e},y92:function(t,e){return t!=e},m5s:function(t,e){return t<e},V5w:function(t,e){return t==e},s8:function(t,e){return t===e},L42:function(t,e){return t-e},o5:function(t,e){return t*e},u6w:function(t,e){return t==e},Z1:function(t,e){return t==e},J12:function(t,e){return t<e},Q4:function(t,e){return t==e},e1s:function(t,e){return t<e},F32:function(t,e){return t<e},X7w:function(t,e){return t==e},A62:function(t,e){return t<=e},f32:function(t,e){return t-e},V42:function(t,e){return t==e},f3s:function(t,e){return t/e},T0:function(t,e){return t*e},n0w:function(t,e){return t!==e},i52:function(t,e){return t>e},l4s:function(t,e){return t===e},m22:function(t,e){return t>e},I5:function(t,e){return t<e},l0s:function(t,e){return t==e},Z62:function(t,e){return t-e},L7w:function(t,e){return t>=e},t9:function(t,e){return t<e},p22:function(t,e){return t<e},k9s:function(t,e){return t-e},v3w:function(t,e){return t>e},b9w:function(t,e){return t<e},g62:function(t,e){return t>=e},Y72:function(t,e){return t/e},x02:function(t,e){return t===e},C3w:function(t,e){return t>e},T1:function(t,e){return t<e},c2w:function(t,e){return t<e},Z8s:function(t,e){return t-e},z2:function(t,e){return t*e},O1w:function(t,e){return t>e},M4s:function(t,e){return t*e},B4w:function(t,e){return t===e},t5s:function(t,e){return t>e},U3s:function(t,e){return t==e},k3w:function(t,e){return t==e},N8w:function(t,e){return t>=e},V2w:function(t,e){return t-e},X9:function(t,e){return t<=e},G0s:function(t,e){return t>=e},Y0:function(t,e){return t<e},Z8w:function(t,e){return t*e},n3:function(t,e){return t*e},M62:function(t,e){return t==e},z6:function(t,e){return t<e},J7w:function(t,e){return t<=e},a6:function(t,e){return t<e},R0w:function(t,e){return t*e},A0s:function(t,e){return t&e},b92:function(t,e){return t>=e},P4:function(t,e){return t*e},q6s:function(t,e){return t>e},p5w:function(t,e){return t in e},R6:function(t,e){return t<e},l0:function(t,e){return t===e},E32:function(t,e){return t<e},c2s:function(t,e){return t>e},p2w:function(t,e){return t==e},n0s:function(t,e){return t!=e},u92:function(t,e){return t==e},T7:function(t,e){return t==e},Z7s:function(t,e){return t*e},S2s:function(t,e){return t!=e},N5:function(t,e){return t<e},W32:function(t,e){return t<e},H6:function(t,e){return t==e},v9s:function(t,e){return t<e},F22:function(t,e){return t*e},w52:function(t,e){return t>e},M02:function(t,e){return t<e},D0w:function(t,e){return t*e},c5s:function(t,e){return t-e},W9s:function(t,e){return t-e},J6s:function(t,e){return t-e},S5w:function(t,e){return t in e},t6s:function(t,e){return t>e},H0s:function(t,e){return t&e},g02:function(t,e){return t-e},R4w:function(t,e){return t!=e},m9:function(t,e){return t==e},P22:function(t,e){return t>e},M4w:function(t,e){return t<e},o0w:function(t,e){return t*e},O8s:function(t,e,i){return t-e-i},p6s:function(t,e){return t<e},G0w:function(t,e){return t==e},G4s:function(t,e){return t-e},v7:function(t,e){return t>e},Y32:function(t,e){return t-e},e9s:function(t,e){return t!=e},A5:function(t,e){return t<e},I02:function(t,e){return t<e},Y1:function(t,e){return t==e},q4:function(t,e){return t/e},e7:function(t,e){return t-e},H:function(t,e){return t-e},A4s:function(t,e){return t-e},e92:function(t,e){return t==e},V7w:function(t,e){return t!=e},u8s:function(t,e){return t!=e},j2w:function(t,e){return t-e},y9s:function(t,e){return t!=e},M7s:function(t,e){return t<e},O62:function(t,e){return t<e},s92:function(t,e){return t==e},L2w:function(t,e){return t===e},a4w:function(t,e){return t-e},v92:function(t,e){return t>e},i2s:function(t,e){return t-e},E9w:function(t,e){return t!==e},H0w:function(t,e){return t==e},Q2w:function(t,e){return t==e},d5w:function(t,e){return t!=e},W3w:function(t,e){return t<e},h9w:function(t,e){return t*e},A02:function(t,e){return t>=e},L0:function(t,e,i){return t-e+i},M0w:function(t,e){return t<e},D02:function(t,e){return t>=e},n4w:function(t,e){return t>e},L2s:function(t,e){return t==e},e3w:function(t,e){return t/e},n6:function(t,e){return t<e},i12:function(t,e){return t<e},h6w:function(t,e){return t===e},Q9:function(t,e){return t<e},z62:function(t,e){return t==e},a02:function(t,e){return t>=e},C72:function(t,e){return t<e},D82:function(t,e){return t>e},P5s:function(t,e){return t*e},Y9w:function(t,e){return t<e},r9s:function(t,e){return t<=e},D62:function(t,e){return t<=e},D7s:function(t,e){return t==e},R62:function(t,e){return t/e},p7w:function(t,e){return t===e},T7w:function(t,e){return t/e},P6s:function(t,e){return t===e},E9s:function(t,e){return t>=e},T9:function(t,e){return t/e},o7s:function(t,e){return t<e},o1w:function(t,e){return t!==e},u7:function(t,e){return t===e},g4w:function(t,e){return t>=e},k2:function(t,e){return t>=e},l6:function(t,e){return t>e},J5w:function(t,e){return t==e},j22:function(t,e){return t*e},C3s:function(t,e){return t/e},j5w:function(t,e){return t<e},i42:function(t,e){return t>e},s8s:function(t,e){return t*e},d42:function(t,e){return t!==e},o62:function(t,e){return t==e},t42:function(t,e){return t-e},B1w:function(t,e){return t/e},P:function(t,e){return t===e},U3w:function(t,e){return t===e},I62:function(t,e){return t==e},i3:function(t,e){return t==e},O7s:function(t,e){return t-e},W9w:function(t,e){return t<e},w7w:function(t,e){return t-e},e32:function(t,e){return t==e},X52:function(t,e){return t*e},T2s:function(t,e){return t<e},a4s:function(t,e){return t-e},C92:function(t,e){return t<e},a0w:function(t,e){return t<e},D6:function(t,e){return t-e},a1w:function(t,e){return t/e},O0s:function(t,e){return t==e},P2w:function(t,e){return t==e},Z0w:function(t,e){return t*e},I2:function(t,e){return t<e},A3:function(t,e){return t*e},M6:function(t,e){return t<e},N4s:function(t,e){return t<e},Y3w:function(t,e){return t-e},E6w:function(t,e){return t===e},c42:function(t,e){return t>e},o8s:function(t,e){return t*e},D5:function(t,e){return t===e},o1s:function(t,e){return t%e},C9w:function(t,e){return t<e},H02:function(t,e){return t==e},p2s:function(t,e){return t-e},u3w:function(t,e){return t===e},j4:function(t,e){return t>e},T3:function(t,e){return t==e},A7s:function(t,e){return t===e},j2s:function(t,e){return t==e},F6w:function(t,e){return t===e},g2:function(t,e){return t==e},a1:function(t,e){return t>e},Z1w:function(t,e){return t/e},Q0:function(t,e,i){return t-e+i},L1:function(t,e){return t==e},m4:function(t,e){return t==e},O4w:function(t,e){return t/e},o8w:function(t,e){return t*e},G7s:function(t,e){return t-e},K3w:function(t,e){return t<e},z0w:function(t,e){return t>e},d2w:function(t,e){return t*e},b2:function(t,e){return t==e},U9s:function(t,e){return t>e},K6w:function(t,e){return t<e},s3w:function(t,e){return t<e},q2w:function(t,e){return t==e},e8s:function(t,e){return t instanceof e},U7:function(t,e){return t*e},d0:function(t,e){return t/e},b1s:function(t,e){return t===e},w2s:function(t,e){return t<e},f6w:function(t,e){return t*e},x0s:function(t,e){return t/e},V2:function(t,e){return t==e},X5w:function(t,e){return t<e},x1w:function(t,e){return t*e},P42:function(t,e){return t*e},a7s:function(t,e){return t*e},S7w:function(t,e){return t>=e},F8:function(t,e){return t-e},u8:function(t,e){return t/e},r22:function(t,e){return t-e},J5s:function(t,e){return t*e},c22:function(t,e){return t>e},I4w:function(t,e){return t/e},L:function(t,e){return t===e},g0s:function(t,e){return t==e},h32:function(t,e){return t==e},N0w:function(t,e){return t==e},B4s:function(t,e){return t>=e},m12:function(t,e){return t===e},f9s:function(t,e){return t>e},B3:function(t,e){return t-e},l62:function(t,e){return t<e},C8s:function(t,e){return t===e},W72:function(t,e){return t-e},S5s:function(t,e){return t<e},K1s:function(t,e){return t==e},l8w:function(t,e){return t!==e},H5:function(t,e){return t===e},S1:function(t,e){return t===e},s72:function(t,e){return t/e},h2:function(t,e){return t==e},W7:function(t,e){return t/e},l4w:function(t,e){return t-e},M0s:function(t,e){return t===e},O1s:function(t,e){return t*e},s32:function(t,e){return t>e},B0:function(t,e){return t<=e},C8:function(t,e){return t==e},K9w:function(t,e){return t-e},R8w:function(t,e){return t<e},t2s:function(t,e){return t==e},N6:function(t,e){return t<e},X42:function(t,e){return t!==e},s7:function(t,e){return t*e},H4w:function(t,e){return t*e},x82:function(t,e){return t!=e},w42:function(t,e){return t-e},E72:function(t,e){return t<e},C1s:function(t,e){return t===e},z1w:function(t,e){return t==e},W6w:function(t,e){return t<e},P5w:function(t,e){return t>e},k8:function(t,e){return t<e},G02:function(t,e){return t>=e},J2w:function(t,e){return t===e},U92:function(t,e){return t==e},C9s:function(t,e){return t-e},Z0s:function(t,e){return t/e},A4w:function(t,e){return t<e},v72:function(t,e){return t-e},B7s:function(t,e){return t<e},A1w:function(t,e){return t/e},o02:function(t,e){return t<=e},z0s:function(t,e){return t===e},n62:function(t,e){return t>=e},h4s:function(t,e,i){return t*e/i},Q3:function(t,e){return t>=e},Q12:function(t,e){return t<e},L12:function(t,e){return t>e},l02:function(t,e){return t!=e},S42:function(t,e){return t/e},W3s:function(t,e,i){return t-e-i},P3:function(t,e,i){return t-e-i},y3w:function(t,e){return t==e},u72:function(t,e){return t/e},B0s:function(t,e){return t<=e},j1:function(t,e){return t==e},i2w:function(t,e){return t==e},K72:function(t,e){return t-e},o6:function(t,e){return t-e},S22:function(t,e){return t*e},N4w:function(t,e){return t<e},k3s:function(t,e){return t==e},d5s:function(t,e){return t&e},I1w:function(t,e){return t/e},e3s:function(t,e){return t==e},E8s:function(t,e){return t instanceof e},I0s:function(t,e){return t!==e},f2:function(t,e){return t==e},r3s:function(t,e){return t*e},G0:function(t,e){return t/e},t7w:function(t,e){return t>e},G5:function(t,e){return t/e},S12:function(t,e){return t/e},H1w:function(t,e){return t===e},n4s:function(t,e){return t*e},w4:function(t,e){return t>e},S4:function(t,e){return t==e},D0s:function(t,e){return t<=e},g1w:function(t,e){return t/e},V6s:function(t,e){return t<e},Z4w:function(t,e){return t/e},c3:function(t,e){return t==e},V12:function(t,e){return t<e},t5w:function(t,e){return t!==e},I7s:function(t,e){return t>e},N62:function(t,e){return t<=e},F9s:function(t,e){return t<=e},f9w:function(t,e){return t==e},l1w:function(t,e){return t/e},y3s:function(t,e){return t in e},b32:function(t,e){return t-e},L5s:function(t,e){return t===e},k9w:function(t,e){return t!==e},V4:function(t,e){return t==e},B8w:function(t,e){return t<=e},Q5w:function(t,e){return t==e},n1:function(t,e){return t/e},y8:function(t,e){return t==e},W2:function(t,e){return t==e},U72:function(t,e){return t-e},i5w:function(t,e){return t-e},J42:function(t,e){return t<e},y32:function(t,e){return t==e},W1s:function(t,e){return t/e},t22:function(t,e){return t-e},l5:function(t,e){return t>e},J52:function(t,e){return t*e},z8w:function(t,e){return t===e},Q2s:function(t,e){return t==e},i6s:function(t,e){return t==e},G1:function(t,e){return t<=e},j52:function(t,e){return t-e},e9w:function(t,e){return t===e},q12:function(t,e){return t>e},U6w:function(t,e){return t/e},r2:function(t,e){return t==e},g0:function(t,e){return t-e},I4s:function(t,e){return t<e},c12:function(t,e){return t>e},h:function(t,e){return t-e},q5w:function(t,e){return t==e},Y8:function(t,e){return t===e},H3:function(t,e){return t/e},S9:function(t,e){return t!==e},X4:function(t,e){return t==e},p5s:function(t,e){return t*e},f8:function(t,e){return t<e},L9:function(t,e){return t!=e},O0w:function(t,e){return t!==e},K8:function(t,e){return t-e},l2:function(t,e){return t==e},A2:function(t,e){return t-e},A8w:function(t,e){return t*e},Y92:function(t,e){return t==e},n1w:function(t,e){return t*e},x8w:function(t,e){return t==e},D8s:function(t,e){return t!==e},r8:function(t,e){return t/e},r32:function(t,e){return t/e},M8w:function(t,e){return t==e},a62:function(t,e){return t<=e},V52:function(t,e){return t!=e},H4s:function(t,e){return t/e},w9:function(t,e){return t*e},U1s:function(t,e){return t==e},C7:function(t,e){return t===e},p4:function(t,e){return t<=e},i9:function(t,e){return t/e},J1:function(t,e){return t>=e},b3w:function(t,e){return t>e},z5:function(t,e){return t/e},p3:function(t,e){return t==e},c7w:function(t,e){return t<=e},s9w:function(t,e){return t!=e},R0s:function(t,e){return t/e},R7s:function(t,e){return t/e},d7w:function(t,e){return t<=e},N1w:function(t,e){return t==e},b9s:function(t,e){return t>e},S2w:function(t,e){return t-e},B0w:function(t,e){return t==e},m2w:function(t,e){return t==e},z4s:function(t,e){return t-e},x1s:function(t,e,i){return t-e-i},u3s:function(t,e){return t==e},G62:function(t,e){return t>=e},t12:function(t,e){return t==e},g6:function(t,e){return t>e},V2s:function(t,e){return t!=e},I0w:function(t,e){return t<e},E3s:function(t,e){return t==e},x4w:function(t,e){return t/e},Y6w:function(t,e){return t!=e},X:function(t,e){return t/e},l0w:function(t,e){return t!==e},q1:function(t,e){return t<e},F92:function(t,e){return t==e},b72:function(t,e){return t*e},e8:function(t,e){return t/e},y6w:function(t,e){return t>e},u1s:function(t,e){return t-e},O02:function(t,e){return t/e},R1:function(t,e){return t<e},s3s:function(t,e){return t==e},C2:function(t,e){return t==e},m52:function(t,e){return t>e},X6s:function(t,e){return t>e},L4:function(t,e){return t==e},d2s:function(t,e){return t==e},q52:function(t,e){return t*e},D1w:function(t,e){return t/e},v32:function(t,e){return t<e},A:function(t,e){return t-e},s:function(t,e){return t===e},J3:function(t,e){return t==e},D1s:function(t,e){return t-e},L5w:function(t,e){return t-e}},__microkernel_=function(t){if(-117635933!==v2D.z82.I82(0,6745439)&&1439550159!==v2D.z82.I82(11,5452975)&&-1388745368!==v2D.z82.I82(0,6594231))return this.calculateWeightedClose(chart,newScrubbed),processMove(q,C),timePossibilities.splice(1,3),printProjection(this,this.activeDrawing),L5v==I5v;var e=t.CIQ,i=t.SplinePlotter;e.ChartEngine.prototype.drawXAxis=function(t,i){if(1278059492!==v2D.z82.I82(0,9721154)&&-773294636!==v2D.z82.I82(11,8333109)&&-1612656037!==v2D.z82.I82(0,1690265))return context.dashedLineTo(last[0],last[1],x,last[1],pattern),this.transformDataSetPost(this,newDataSet,min,max),context.lineTo(xstart,pxBottom),s6>p6;var r=[t,i];if(!this.runPrepend("drawXAxis",r)&&i&&!t.xAxis.noDraw){var n=this.chart.context;this.canvasFont("stx_xaxis"),n.textAlign="center",n.textBaseline="middle";for(var a,s=n.measureText("   ").width,o=0;v2D.T(o,i.length);o++){a=i[o];var l=n.measureText(a.text).width,h=Math.max(l+s,t.xAxis.minimumLabelWidth);a.hz=Math.floor(a.hz+this.micropixels)+.5,a.left=v2D.h(a.hz,h/2),a.right=a.hz+v2D.V(h,2),a.unpaddedRight=a.hz+v2D.X(l,2)}var u=new e.Plotter;u.newSeries("line","stroke",this.canvasStyle("stx_grid")),u.newSeries("boundary","stroke",this.canvasStyle("stx_grid_dark")),u.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));var c=v2D.L(this.xAxisAsFooter,!0)?this.chart.canvasHeight:t.panel.bottom,p=this.whichPanel(v2D.M(c,1));if(p){var d=p.yAxis;this.adjustYAxisHeightOffset(p,d);var f=-1,m=Math.MAX_VALUE,g=t.xAxis.displayBorder||v2D.s(t.xAxis.displayBorder,null);v2D.P(this.axisBorders,!0)&&(g=!0),v2D.S(this.axisBorders,!1)&&(g=!1);var v=g?v2D.H(d.bottom,.5):d.bottom,y=v2D.A(c,this.xaxisHeight/2);g&&(y+=3);for(var C=0;v2D.T1(C,i.length);C++)if(v2D.Z1(i[C].grid,"boundary")){m=i[C].left;break}for(var S=0;v2D.R1(S,i.length);S++){if(a=i[S],v2D.Y1(S,C)){for(C++;v2D.q1(C,i.length);C++)if(v2D.L1(i[C].grid,"boundary")){m=i[C].left;break}if(v2D.J1(C,i.length)&&(C=-1,m=Math.MAX_VALUE),f>-1&&v2D.i1(a.left,f))continue}else{if(f>-1&&v2D.c1(a.left,f))continue;if(v2D.a1(a.right,m))continue}f=a.right,v2D.G1(Math.floor(a.unpaddedRight),this.chart.right)&&(t.xAxis.displayGridLines&&(u.moveTo(a.grid,a.hz,v2D.S1(this.xAxisAsFooter,!0)?0:d.top),u.lineTo(a.grid,a.hz,v)),g&&(u.moveTo("border",a.hz,v+.5),u.lineTo("border",a.hz,v+6)),this.canvasColor(v2D.j1(a.grid,"boundary")?"stx_xaxis_dark":"stx_xaxis"),n.fillText(a.text,a.hz,y))}if(g){var w=Math.round(d.bottom)+.5,D=Math.round(t.right)+.5;u.moveTo("border",t.left,w),u.lineTo("border",D,w)}u.draw(n),n.textAlign="left",this.runAppend("drawXAxis",r)}}},e.ChartEngine.prototype.createTickXAxisWithDates=function(t){if(1977032815!==v2D.z82.I82(0,3963692)&&-881992118!==v2D.z82.I82(11,1267489)&&1752939245!==v2D.z82.I82(0,3184865))return processMove(q,H),this.runAppend("touchend",arguments),A1k>D7k;t||(t=this.chart),t.xaxis=[];var i,r=[e.MILLISECOND,e.SECOND,e.MINUTE,e.HOUR,e.DAY,e.MONTH,e.YEAR];e.ChartEngine.isDailyInterval(this.layout.interval)&&r.splice(1,3),this.timeIntervalMap||(i={},i[e.MILLISECOND]={arr:[1,2,5,10,20,50,100,250,500],minTimeUnit:0,maxTimeUnit:1e3},i[e.SECOND]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60},i[e.MINUTE]={arr:[1,2,3,4,5,6,10,12,15,20,30],minTimeUnit:0,maxTimeUnit:60},i[e.HOUR]={arr:[1,2,3,4,6,12],minTimeUnit:0,maxTimeUnit:24},i[e.DAY]={arr:[1,2,7,14],minTimeUnit:1,maxTimeUnit:32},i[e.MONTH]={arr:[1,2,3,6],minTimeUnit:1,maxTimeUnit:13},i[e.YEAR]={arr:[1,2,3,5],minTimeUnit:1,maxTimeUnit:2e7},i[e.DECADE]={arr:[10],minTimeUnit:0,maxTimeUnit:2e6},this.timeIntervalMap=i),i=this.timeIntervalMap;for(var n=[31,28,31,30,31,30,31,31,30,31,30,31],a=this.layout.periodicity,s=this.layout.interval,o=t.maxTicks,l=t.dataSegment,h=t.xAxis,u=l.length,c=h.idealTickSizePixels||h.autoComputedTickSizePixels,p=v2D.n1(this.chart.width,c),d=0;v2D.A1(d,u)&&!l[d];d++);if(v2D.T7(d,u))return[];var f=0,m=this.layout.timeUnit||"minute";isNaN(s)&&(m=s,s=1);var g=v2D.d7(m,"millisecond")?1:v2D.Q7(m,"second")?1e3:v2D.V7(m,"minute")?6e4:0;f=g?v2D.X7(s,a,g,u):v2D.E7(l[u-1].DT.getTime(),l[d].DT.getTime());var v=this;f=v2D.u7(f,0)?v2D.U7(function(){if(1022781690!==v2D.z82.I82(0,5321533)&&-1372590514!==v2D.z82.I82(11,9829260)&&193248419!==v2D.z82.I82(0,7629487))createBar(P0r1k.y5k(highTarget,range),highTarget),chart.scroll++;else{var e={begin:new Date,interval:"day",periodicity:1,inZone:this.dataZone,outZone:this.dataZone},i=t.market.newIterator(e);i.next();var r=i.previous()}i=v.standardMarketIterator(r,null,t);var n=i.next();return v2D.e7(n.getTime(),r.getTime())}(),o):v2D.s7(f/u,o);var y,x=v2D.W7(f,p);for(y=0;v2D.b7(y,r.length)&&!v2D.v7(r[y],x+.001);y++);if(v2D.C7(y,0)&&console.log("createTickXAxisWithDates: Assertion error. msPerGridLine < 1"),v2D.f7(y,r.length))y--;else if(v2D.K7(y,0)){var C=r[v2D.D6(y,1)],S=i[C].arr,w=S[v2D.o6(S.length,1)]
;v2D.Z6(x-C*w,r[y]-x)&&y--}var D=h.timeUnit||r[y];h.activeTimeUnit=D;var b=e.clone(i[D]),T=b.arr;for(y=0;v2D.R6(y,T.length)&&!v2D.O6(T[y]*D,x);y++);v2D.x6(y,T.length)?y--:v2D.z6(x-T[y-1]*D,T[y]*D-x)&&y--;var M=h.timeUnitMultiplier||T[y],k=[],A=this.layout.candleWidth;for(y=0;v2D.I6(y,o)&&!l[y];y++);if(v2D.l6(y,0)&&v2D.M6(y,o))for(var P=this.standardMarketIterator(l[y].DT,h.adjustTimeZone?this.displayZone:this.dataZone),_=y;v2D.g6(_,0)&&(!t.lineApproximation||!v2D.a6(A,1));_--){var F=P.previous();t.xaxis.unshift({DT:F})}var E=0,L=b.minTimeUnit,N=-1,O=!0,I=null;for(y;v2D.G6(y,o);y++){if(v2D.N6(y,u)){var z=l[y];if(E=z.displayDate&&h.adjustTimeZone?z.displayDate:z.DT,y&&t.segmentImage){var R=t.segmentImage[y];A=v2D.B6(R.leftOffset-R.candleWidth/2,y)}}else{if(v2D.H6(this.layout.interval,"tick")&&!h.futureTicksInterval)break;if(t.lineApproximation&&v2D.n6(A,1))break;if(!h.futureTicks)break;I||(I=this.standardMarketIterator(l[v2D.A6(u,1)].DT,t.adjustTimeZone?this.displayZone:this.dataZone)),E=I.next()}var V={DT:E};v2D.T4(y,u)?V.data=l[y]:V.data=null,t.xaxis.push(V);var B,W;v2D.d4(D,e.MILLISECOND)?(B=E.getMilliseconds(),W=E.getSeconds()):v2D.Q4(D,e.SECOND)?(B=E.getSeconds(),W=E.getMinutes()):v2D.V4(D,e.MINUTE)?(B=E.getMinutes(),W=E.getHours()):v2D.X4(D,e.HOUR)?(B=E.getHours()+v2D.q4(E.getMinutes(),60),W=E.getDate()):v2D.L4(D,e.DAY)?(B=E.getDate(),W=E.getMonth()+1):v2D.J4(D,e.MONTH)?(B=E.getMonth()+1,W=E.getFullYear()):v2D.i4(D,e.YEAR)?(B=E.getFullYear(),W=E.getFullYear()+1e3):(B=E.getFullYear(),W=0);var U,j=null;if(v2D.c4(N,W)&&(v2D.p4(B,L)&&(L=b.minTimeUnit),U=t.left+v2D.P4(y,A)-1,j=null,v2D.m4(D,e.HOUR)||v2D.S4(D,e.MINUTE)&&v2D.j4(N,W)?j=h.formatter?h.formatter(E,"boundary",e.DAY,1):this.internationalizer?this.internationalizer.monthDay.format(E):E.getMonth()+1+"/"+E.getDate():v2D.t4(D,e.DAY)?j=v2D.w4(N,W)?h.formatter?h.formatter(E,"boundary",e.YEAR,1):E.getFullYear():h.formatter?h.formatter(E,"boundary",e.MONTH,1):e.monthAsDisplay(E.getMonth(),!1,this):v2D.r2(D,e.MONTH)&&(j=h.formatter?h.formatter(E,"boundary",e.YEAR,1):E.getFullYear()),j&&-1!=N&&k.push(new e.ChartEngine.XAxisLabel(U,"boundary",j))),v2D.k2(B,L)){if(v2D.h2(L,b.minTimeUnit)&&v2D.V2(W,N))continue;var Y=new Date(+E);U=t.left+v2D.X2((2*y+1)*A,2)-1;var X=v2D.z2(Math.floor(B/M),M);if(v2D.I2(X,B)&&(v2D.l2(this.layout.interval,"week")?X=B:U-=v2D.M2(A,2)),v2D.g2(D,e.MILLISECOND)?Y.setMilliseconds(X):v2D.W2(D,e.SECOND)?(Y.setMilliseconds(0),Y.setSeconds(X)):v2D.b2(D,e.MINUTE)?(Y.setMilliseconds(0),Y.setSeconds(0),Y.setMinutes(X)):v2D.v2(D,e.HOUR)?(Y.setMilliseconds(0),Y.setSeconds(0),Y.setMinutes(0),Y.setHours(X)):v2D.C2(D,e.DAY)?Y.setDate(Math.max(1,X)):v2D.f2(D,e.MONTH)?(Y.setDate(1),Y.setMonth(v2D.A2(X,1))):(v2D.T3(D,e.YEAR),Y.setDate(1),Y.setMonth(0)),L=X+M,v2D.d3(D,e.DAY)&&(b.maxTimeUnit=n[Y.getMonth()]+1),v2D.Q3(L,b.maxTimeUnit)&&(L=b.minTimeUnit),N=W,O&&v2D.V3(X,B)){O=!1;continue}j=h.formatter?h.formatter(Y,"line",D,M):v2D.X3(D,e.DAY)?Y.getDate():v2D.q3(D,e.MONTH)?e.monthAsDisplay(E.getMonth(),!1,this):v2D.L3(D,e.YEAR)||v2D.J3(D,e.DECADE)?Y.getFullYear():e.timeAsDisplay(Y,this,D),k.push(new e.ChartEngine.XAxisLabel(U,"line",j))}}return k},e.ChartEngine.prototype.createYAxis=function(t,i){if(!this.runPrepend("createYAxis",arguments)){var r=t.chart,n=v2D.i3(t.name,r.name);i||(i={}),i.noChange=!1;var a=i.yAxis?i.yAxis:t.yAxis;if(e.ChartEngine.enableCaching&&v2D.c3(a.high,t.cacheHigh)&&v2D.p3(a.low,t.cacheLow)){var s=v2D.P3(r.dataSet.length,r.scroll,1),o=s+r.maxTicks+1;t.cacheLeft=s,t.cacheRight=o,i.noChange=!0}else t.cacheLeft=1e6,t.cacheRight=-1,t.cacheHigh=a.high,t.cacheLow=a.low;var l=r.xAxis.idealTickSizePixels?r.xAxis.idealTickSizePixels:r.xAxis.autoComputedTickSizePixels;if(a.goldenRatioYAxis&&v2D.N3(a.idealTickSizePixels,l/1.618)&&(i.noChange=!1),!i.noChange){this.adjustYAxisHeightOffset(t,a);var h=a.height=v2D.B3(a.bottom,a.top),u=v2D.H3(a.high-a.low,h-a.zoom);if(i.ground&&!a.semiLog)a.high=a.high+v2D.n3(a.zoom,u);else{a.high=a.high+v2D.A3(a.zoom/2,u)+v2D.T0(a.scroll,u);var c=a.low;if(a.semiLog){var p=v2D.d0(a.zoom/2*u,a.high/a.low);a.low=v2D.Q0(a.low,p,a.scroll*u),v2D.Y0(a.low,.1*c)&&(a.low=v2D.q0(c,.1))}else a.low=v2D.L0(a.low,a.zoom/2*u,a.scroll*u)}if((a.min||v2D.l0(a.min,0))&&(a.low=a.min),(a.max||v2D.M0(a.max,0))&&(a.high=a.max),a.shadow=v2D.g0(a.high,a.low),a.semiLog&&(!this.activeDrawing||v2D.a0(this.activeDrawing.name,"projection"))){a.logHigh=v2D.G0(Math.log(a.high),Math.LN10);var d=Math.max(a.low,1e-9);a.logLow=v2D.N0(Math.log(d),Math.LN10),v2D.B0(a.low,0)&&(a.logLow=0),a.logShadow=v2D.H0(a.logHigh,a.logLow)}var f;a.goldenRatioYAxis&&n?(a.idealTickSizePixels=v2D.K0(l,1.618),v2D.D5(a.idealTickSizePixels,0)&&(f=this.getCanvasFontSize("stx_yaxis"),a.idealTickSizePixels=v2D.o5(f,5))):a.idealTickSizePixels||(f=this.getCanvasFontSize("stx_yaxis"),a.idealTickSizePixels=n?v2D.Z5(f,5):v2D.R5(f,2));var m=Math.round(v2D.O5(h,a.idealTickSizePixels)),g=i.range?v2D.x5(i.range[1],i.range[0]):a.shadow;a.priceTick=Math.floor(v2D.z5(g,m));for(var v=1,y=0;v2D.I5(y,10)&&!v2D.l5(a.priceTick,0);y++)v*=10,a.priceTick=v2D.M5(Math.floor(g/m*v),v);v2D.g5(y,10)&&(a.priceTick=1e-8),a.priceTick=v2D.a5(Math.round(g/m*v),v);var x=Math.round(v2D.G5(g,a.priceTick));if(i.range&&v2D.N5(x,g)&&!a.noEvenDivisorTicks){for(;v2D.B5(x,1)&&!v2D.H5(g%x,0);)x--;a.priceTick=v2D.n5(g,x)}if(a.minimumPriceTick){var C=a.minimumPriceTick;f=this.getCanvasFontSize("stx_yaxis");for(var S=0;v2D.A5(S,100);S++){var w=v2D.T9(g,C);if(!v2D.d9(h/w,2*f))break;C+=a.minimumPriceTick}v2D.Q9(S,100)&&(a.priceTick=C)}a.multiplier=v2D.V9(a.height,a.shadow)}if((v2D.X9(a.priceTick,0)||v2D.q9(a.priceTick,1/0))&&(a.priceTick=1),!this.activeDrawing||v2D.L9(this.activeDrawing.name,"projection")){if(a.high=this.transformedPriceFromPixel(t.top,t,a),a.semiLog){a.logHigh=v2D.J9(Math.log(a.high),Math.LN10);var D=Math.max(a.low,1e-11);a.logLow=v2D.i9(Math.log(D),Math.LN10),a.logShadow=v2D.c9(a.logHigh,a.logLow)}a.shadow=v2D.p9(a.high,a.low)}if(a.multiplier=v2D.P9(a.height,a.shadow),v2D.m9(a.multiplier,1/0)&&(a.multiplier=0),!a.decimalPlaces&&v2D.S9(a.decimalPlaces,0))if(n){for(var b=0,T=0;v2D.j9(T,t.yAxis.shadowBreaks.length);T++){var M=t.yAxis.shadowBreaks[T];v2D.t9(t.yAxis.shadow,M[0])&&(b=M[1])}a.printDecimalPlaces=b}else a.printDecimalPlaces=null;else a.printDecimalPlaces=a.decimalPlaces;this.runAppend("createYAxis",arguments)}},e.ChartEngine.prototype.drawYAxis=function(t,i){if(!t.hidden){i||(i={});var r=i.yAxis?i.yAxis:t.yAxis;if(r.fractional?(r.originalPriceFormatter||(r.originalPriceFormatter={func:r.priceFormatter}),r.fractional.resolution||(r.fractional.resolution=r.minimumPrice),r.fractional.formatter||(r.fractional.formatter="'"),r.priceFormatter||(r.priceFormatter=function(t,e,i){var n=Math.floor(v2D.w9(Math.round(i/r.fractional.resolution),r.fractional.resolution)),a=Math.round(v2D.r8(i-n,r.fractional.resolution)),s=Math.floor(a);return n+r.fractional.formatter+(v2D.k8(s,10)?"0":"")+s+(v2D.h8(a-s,.5)?"+":"")})):r.originalPriceFormatter&&(r.priceFormatter=r.originalPriceFormatter.func,r.originalPriceFormatter=null),r.pretty)return this.drawYAxisPretty(t,i);if(!this.runPrepend("drawYAxis",arguments)){if(!i.noDraw&&!r.noDraw){var n=r.yAxisPlotter;if(!n||!i.noChange){n=r.yAxisPlotter=new e.Plotter;var a=t.chart,s=v2D.y8(t.name,a.name)&&v2D.Y8(r,t.yAxis);if(!r.priceTick)return;var o=r.shadow,l=i.range;l&&(o=v2D.F8(l[1],l[0]));var h=v2D.E8(o,r.priceTick);h=Math.round(h);var u,c;r.semiLog&&(u=v2D.e8(Math.log(this.valueFromPixel(r.bottom,t)),Math.LN10),c=v2D.u8(r.logHigh-r.logLow,h));var p=r.textStyle?r.textStyle:"stx_yaxis";n.newSeries("grid","stroke",this.canvasStyle("stx_grid")),n.newSeries("text","fill",this.colorOrStyle(p)),n.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));var d=0,f=l?l[1]:r.high,m=l?l[0]:r.low,g=v2D.U8(r.displayBorder,null)?a.panel.yAxis.displayBorder:r.displayBorder;v2D.s8(this.axisBorders,!1)&&(g=!1),v2D.W8(this.axisBorders,!0)&&(g=!0);var v,y=v2D.b8(r.position,null)?a.panel.yAxis.position:r.position;v=v2D.v8(y,"left")?r.left+r.width:r.left;var x=Math.round(v)+.5,C=g?3:0;v2D.C8(y,"left")&&(C=g?-3:0),d=s?v2D.f8(r.shadow,1)?v2D.K8((parseInt(m/r.priceTick,10)+1)*r.priceTick,m):v2D.D1s(r.priceTick,Math.round(m%r.priceTick*t.chart.roundit)/t.chart.roundit):v2D.o1s(f,r.priceTick);for(var S=this.getCanvasFontSize("stx_yaxis"),w=0;v2D.Z1s(w,h);w++){var D;if(r.semiLog){var b=u+v2D.R1s(w,c);D=Math.pow(10,b)}else D=s?m+v2D.O1s(w,r.priceTick)+d:v2D.x1s(f,w*r.priceTick,d);var T=this.pixelFromTransformedValue(D,t,r),M=Math.round(T)+.5;if(!v2D.E1s(M+S/2,t.bottom)&&!v2D.e1s(M-S/2,t.top)){r.displayGridLines&&(n.moveTo("grid",t.left,M),n.lineTo("grid",t.right,M)),g&&(n.moveTo("border",v2D.u1s(x,.5),M),n.lineTo("border",x+C,M)),D=r.priceFormatter?r.priceFormatter(this,t,D):this.formatYAxisPrice(D,t,null,r);var k=r.textBackground?this.containerColor:null,A=v+C+3;v2D.U1s(y,"left")?(A=r.left+3,r.justifyRight&&(A=r.left+r.width+C-3)):r.justifyRight&&(A=v+r.width),n.addText("text",D,A,M,k,null,S)}}if(g){var P=Math.round(r.bottom)+.5;n.moveTo("border",x,r.top),n.lineTo("border",x,P),n.draw(this.chart.context,"border")}}this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}}},e.ChartEngine.prototype.drawYAxisPretty=function(t,i){if(!this.runPrepend("drawYAxis",arguments)){i||(i={});var r=i.yAxis?i.yAxis:t.yAxis;if(!i.noDraw&&!r.noDraw){var n=r.yAxisPlotter;if(!n||!i.noChange){n=r.yAxisPlotter=new e.Plotter;var a=t.chart;if(!r.priceTick)return;if(isNaN(r.high)||isNaN(r.low))return;var s=r.shadow;i.range&&(s=v2D.s1s(i.range[1],i.range[0]));var o=v2D.W1s(r.height,r.idealTickSizePixels);o=Math.round(o);var l=r.textStyle?r.textStyle:"stx_yaxis";n.newSeries("grid","stroke",this.canvasStyle("stx_grid")),n.newSeries("text","fill",this.colorOrStyle(l)),n.newSeries("border","stroke",this.canvasStyle("stx_grid_border"));var h=i.range,u=h?h[1]:r.high,c=h?h[0]:r.low,p=v2D.b1s(r.displayBorder,null)?a.panel.yAxis.displayBorder:r.displayBorder;v2D.v1s(this.axisBorders,!1)&&(p=!1),v2D.C1s(this.axisBorders,!0)&&(p=!0);var d,f=v2D.f1s(r.position,null)?a.panel.yAxis.position:r.position;d=v2D.K1s(f,"left")?r.left+r.width:r.left;var m=Math.round(d)+.5,g=p?3:0;v2D.D7s(f,"left")&&(g=p?-3:0);for(var v=this.getCanvasFontSize("stx_yaxis"),y=r.increments,x=y.length,C=0,S=1,w=0,D=0,b=0,T=Number.MAX_VALUE,M=0;v2D.o7s(M,100);M++){w=v2D.Z7s(y[C],Math.pow(10,b)),S=Math.floor(v2D.R7s(s,w));var k=Math.abs(v2D.O7s(o,S));if(v2D.x7s(k,T))break;if(T=k,v2D.z7s(S,o)){D=w;break}v2D.I7s(S,o)?(C++,v2D.l7s(C,x)&&(C=0,b++)):(C--,v2D.M7s(C,0)&&(C=v2D.g7s(x,1),b--)),D=w}var A=v2D.a7s(Math.ceil(c/D),D),P=v2D.G7s(r.bottom,this.pixelFromTransformedValue(A,t,r)),_=0;if(v2D.N7s(P,r.idealTickSizePixels)&&r.semiLog&&r.prettySemiLog){var F;for(F=Math.ceil(c);v2D.B7s(F,A)&&v2D.H7s(A%F,0);++F);v2D.n7s(F,A)&&(v2D.A7s(A,D)&&(D=F,_=F),A=F)}for(var E=0,L=Number.MAX_VALUE,N=0;v2D.T6s(N,100);N++){var O=A+v2D.d6s(E,D);if(v2D.Q6s(O,u))break;D+=_,E++;var I=this.pixelFromTransformedValue(O,t,r);if(v2D.V6s(L-I,v+1)&&v2D.X6s(_,0))N=E=0,L=Number.MAX_VALUE,D=_,_*=2,n.reset();else{L=I;var H=Math.round(I)+.5;if(!v2D.q6s(H+v/2,t.bottom)&&!v2D.L6s(H-v/2,t.top)){r.displayGridLines&&(n.moveTo("grid",t.left,H),n.lineTo("grid",t.right,H)),p&&(n.moveTo("border",v2D.J6s(m,.5),H),n.lineTo("border",m+g,H)),O=r.priceFormatter?r.priceFormatter(this,t,O):this.formatYAxisPrice(O,t,null,r);var z=r.textBackground?this.containerColor:null,R=d+g+3;v2D.i6s(f,"left")?(R=r.left+3,r.justifyRight&&(R=r.left+r.width+g-3)):r.justifyRight&&(R=d+r.width),n.addText("text",O,R,H,z,null,v)}}}if(v2D.c6s(N,100)&&console.log("drawYAxisPretty: assertion error. zz reached 100"),p){var V=Math.round(r.bottom)+.5;n.moveTo("border",m,r.top),n.lineTo("border",m,V),n.draw(this.chart.context,"border")}}this.plotYAxisGrid(t)}this.runAppend("drawYAxis",arguments)}},e.ChartEngine.prototype.drawHistogram=function(t,i){function r(t,i,r,n,s,h,u,p){r||(r=1),C.globalAlpha=e.isIE8?.5:r,C.beginPath();for(var f=v+.5,m=Math.floor(v2D.z4s(b.pixelFromBar(0,a.chart),b.layout.candleWidth/2)),g=m,y=0;v2D.I4s(y,l.length);y++){var T=D[y]||v;v2D.l4s(y,0)&&(f=T);var M=l[y];if(M&&M[t]){var k=v2D.M4s(M[t]-d,c);if(!isNaN(k)){var A=b.layout.candleWidth;M.candleWidth&&(A=M.candleWidth,v2D.g4s(y,0)&&(m=g=Math.floor(v2D.a4s(b.pixelFromBar(0,a.chart),M.candleWidth/2))));var P=Math.min(Math.floor(v2D.G4s(T,k))+.5,T);if(p&&-1==p.indexOf(y)||!p&&(s&&v2D.N4s(M.Close,M.iqPrevClose)||!s&&v2D.B4s(M.Close,M.iqPrevClose)))f=P,g+=A;else{var _=v2D.H4s(A,b.layout.candleWidth),F=g+v2D.n4s(S+h*u,_),E=Math.round(F)+(n?0:x),L=v2D.A4s(Math.round(F+u*_),n?0:x);v2D.T2s(L-E,2)&&(L=E+1);var N=n?0:.5;v2D.d2s(E%1,N)&&(E+=.5),v2D.Q2s(L%1,N)&&(L+=.5),C.moveTo(L,T),v2D.V2s(v,T)&&n&&!S&&D[y+1]&&C.moveTo(L,Math.max(P,Math.min(T,D[y+1]))),C.lineTo(L,P),C.lineTo(E,P),n&&h?(v2D.X2s(w[y],P)||v2D.q2s(y,0))&&C.lineTo(E,Math.min(T,w[y])):n&&!S&&v2D.L2s(o,"clustered")?v2D.J2s(y,0)&&w[v2D.i2s(y,1)]&&v2D.c2s(w[y-1],P)&&C.lineTo(E,Math.min(T,w[v2D.p2s(y,1)])):n&&!S?(v2D.P2s(f,P)||v2D.m2s(y,0))&&C.lineTo(E,Math.min(T,f)):C.lineTo(E,T),f=P,g+=A,(v2D.S2s(o,"clustered")||n)&&(w[y]=P)}}}else f=T,g+=b.layout.candleWidth}n?(C.strokeStyle=!i||v2D.j2s(i,"auto")?b.defaultColor:i,C.stroke()):(C.fillStyle=!i||v2D.t2s(i,"auto")?b.defaultColor:i,C.fill()),C.closePath()}if(i&&i.length){var n=t.panel;n||(n="chart");var a=this.panels[n];if(a){var s=t.yAxis?t.yAxis:a.yAxis,o=t.subtype,l=this.chart.dataSegment,h=!1;this.getDefaultColor();var u;for(u=0;v2D.p6s(u,i.length);u++)h|=i[u].border_color_up&&!e.isTransparent(i[u].border_color_up),h|=i[u].border_color_down&&!e.isTransparent(i[u].border_color_down);v2D.P6s(t.borders,!1)&&(h=!1),t.name||(t.name="Data");var c=s.multiplier;t.heightPercentage||(t.heightPercentage=.7),t.widthFactor||(t.widthFactor=.8);for(var p=0,d=0,f=0;v2D.m6s(f,this.chart.maxTicks);f++){var m=l[f];if(m){var g=0;for(u=0;v2D.S6s(u,i.length);u++)m[i[u].field]&&(v2D.j6s(o,"stacked")?g+=m[i[u].field]:g=m[i[u].field],v2D.t6s(g,p)&&(p=g),v2D.w6s(g,d)&&(d=g))}}if(v2D.r4s(p,0)&&v2D.k4s(d,0))return void this.watermark(n,"center","bottom",this.translateIf(t.name+" Not Available"));var v,y=Math.floor(s.top)+.5;t.bindToYAxis?v=Math.floor(this.pixelFromPrice(d,a,s))+.5:(v=Math.floor(s.bottom)+.5,c=v2D.h4s(v-y,t.heightPercentage,p-d)),this.startClip(n);var x=v2D.V4s(this.layout.candleWidth,1)||!h?0:.5,C=this.chart.context,S=Math.max(0,v2D.X4s(1-t.widthFactor,this.layout.candleWidth,2)),w=new Array(l.length),D=[],b=this,T=1;for(u=0;v2D.w2s(u,i.length);u++){var M=i[u];T=v2D.r3s(this.layout.candleWidth,t.widthFactor);var k=0;if(v2D.k3s(o,"clustered")&&(k=u,T/=i.length),"function"==typeof M.color_function){for(var A,P,_={},F=0;v2D.h3s(F,l.length);F++)l[F]&&(A=M.color_function(l[F]),"string"==typeof A&&(A={fill_color:A,border_color:A}),P=A.fill_color+","+A.border_color,v2D.y3s(P,_)?_[P].positions.push(F):(A.positions=[F],_[P]=A));for(P in _)A=_[P],r(M.field,A.fill_color,A.opacity,null,null,k,T,A.positions),r(M.field,A.border_color,A.opacity,!0,null,k,T,A.positions)}else r(M.field,M.fill_color_up,M.opacity_up,null,!0,k,T),r(M.field,M.fill_color_down,M.opacity_down,null,null,k,T),v2D.Y3s(this.layout.candleWidth,2)&&h&&(r(M.field,M.border_color_up,M.opacity_up,!0,!0,k,T),r(M.field,M.border_color_down,M.opacity_down,!0,null,k,T));v2D.F3s(o,"stacked")&&(D=e.shallowClone(w))}C.globalAlpha=1,this.endClip()}}},e.ChartEngine.prototype.drawCandlesHighPerformance=function(t,e,i,r,n){var a=n?"histogram":"candle";this.drawBarTypeChartInner({panel:t,fillColor:e,borderColor:i,condition:r,type:a})},e.ChartEngine.prototype.drawShadowsHighPerformance=function(t,e,i){this.drawBarTypeChartInner({panel:t,style:e,condition:i,type:"shadow"})},e.ChartEngine.prototype.drawBarChartHighPerformance=function(t,e,i){this.drawBarTypeChartInner({panel:t,style:e,condition:i,type:"bar"})},e.ChartEngine.prototype.drawHLCChart=function(t,e,i){this.drawBarTypeChartInner({panel:t,style:e,condition:i,type:"hlc"})},e.ChartEngine.prototype.drawBarTypeChartInner=function(t){var i=t.type,r=t.panel,n=t.fillColor,a=t.borderColor,s=t.condition,o=t.style,l=v2D.E3s(i,"histogram"),h=l||v2D.e3s(i,"candle"),u=v2D.u3s(i,"shadow"),c=v2D.U3s(i,"hlc"),p=v2D.s3s(i,"bar")||c,d=r.chart,f=d.dataSegment,m=this.chart.context,g=r.yAxis.top,v=r.yAxis.bottom,y=0;a&&!e.isTransparent(a)&&(y=.5);v2D.W3s(d.dataSet.length,d.scroll,1);m.beginPath();var x=r.yAxis,C=this.layout.candleWidth,S=v2D.m3s(r.left,.5*C,this.micropixels,1),w=v2D.C3s(d.tmpWidth,2),D=v2D.f3s(m.lineWidth,2);if(h&&(e.isTransparent(n)&&(n=this.containerColor),m.fillStyle=n),u&&(m.lineWidth=1),p){var b=this.canvasStyle(o);b.width&&v2D.K3s(parseInt(b.width,10),25)?m.lineWidth=Math.max(1,e.stripPX(b.width)):m.lineWidth=1}for(var T=0;v2D.D0s(T,f.length);T++){S+=v2D.o0s(C,2),C=this.layout.candleWidth,S+=v2D.Z0s(C,2);var M=f[T];if(M&&!M.projection){M.candleWidth&&(S+=v2D.R0s(M.candleWidth-C,2),C=M.candleWidth,v2D.O0s(this.layout.chartType,"volume_candle")&&(w=v2D.x0s(C,2))),d.transformFunc&&M.transform&&(M=M.transform);var k=M.Close,A=v2D.z0s(M.Open,void 0)?k:M.Open;if(l&&d.defaultPlotField&&(k=M[d.defaultPlotField]),(k||!v2D.I0s(k,0))&&(!h||l||!v2D.l0s(A,k)&&!v2D.M0s(A,null))){if(s){if(d.state.chartType.pass.even|=v2D.g0s(k,M.iqPrevClose),v2D.a0s(s,e.ChartEngine.CANDLEUP)&&v2D.G0s(A,k))continue;if(v2D.N0s(s,e.ChartEngine.CANDLEDOWN)&&v2D.B0s(A,k))continue;if(v2D.H0s(s,e.ChartEngine.CANDLEEVEN)&&v2D.n0s(A,k))continue;if(v2D.A0s(s,e.ChartEngine.CLOSEUP)&&v2D.T5s(k,M.iqPrevClose))continue;if(v2D.d5s(s,e.ChartEngine.CLOSEDOWN)&&v2D.Q5s(k,M.iqPrevClose))continue;if(v2D.V5s(s,e.ChartEngine.CLOSEEVEN)&&v2D.X5s(k,M.iqPrevClose))continue}var P=A,_=k;(u||p)&&(P=v2D.q5s(M.High,void 0)?Math.max(k,A):M.High,_=v2D.L5s(M.Low,void 0)?Math.min(k,A):M.Low);var F,E,L=x.semiLog?this.pixelFromTransformedValue(P,r):v2D.J5s(x.high-P,x.multiplier)+x.top,N=x.semiLog?this.pixelFromTransformedValue(_,r):v2D.i5s(x.high-_,x.multiplier)+x.top,O=Math.floor(l?N:Math.min(L,N))+y,I=l?x.bottom:Math.max(L,N),H=Math.floor(v2D.c5s(I,O));if((p||u)&&(F=x.semiLog?this.pixelFromTransformedValue(A,r):v2D.p5s(x.high-A,x.multiplier)+x.top,E=x.semiLog?this.pixelFromTransformedValue(k,r):v2D.P5s(x.high-k,x.multiplier)+x.top),v2D.m5s(O,g)){if(v2D.S5s(O+H,g))continue;H-=v2D.j5s(g,O),O=g}if(v2D.t5s(O+H,v)&&(H-=O+H-v),H=Math.max(H,2),I=O+H,!v2D.w5s(O,v)&&!v2D.r9s(I,g)){var z=Math.floor(S)+.5,R=Math.floor(v2D.k9s(z,w))+y,V=v2D.h9s(Math.round(z+w),y);if(h)v2D.y9s(O,I)&&(m.moveTo(R,O),m.lineTo(V,O),m.lineTo(V,I),m.lineTo(R,I),m.lineTo(R,O));else if(u){if(v2D.Y9s(k,A)&&v2D.F9s(E,v)&&v2D.E9s(E,g)){var B=Math.floor(E)+.5;m.moveTo(R,B),m.lineTo(V,B)}v2D.e9s(P,_)&&(m.moveTo(z,O),m.lineTo(z,I))}else if(p){if(v2D.u9s(O,v)&&v2D.U9s(I,g)&&v2D.s9s(M.High,M.Low)&&(m.moveTo(z,v2D.W9s(O,D)),m.lineTo(z,I+D)),v2D.b9s(F,g)&&v2D.v9s(F,v)&&!c){var W=Math.floor(F)+.5;m.moveTo(z,W),m.lineTo(v2D.C9s(z,w),W)}if(v2D.f9s(E,g)&&v2D.K9s(E,v)){var U=Math.floor(E)+.5;m.moveTo(z,U),m.lineTo(z+w,U)}}}}}}h?(m.fill(),y&&(m.lineWidth=1,m.strokeStyle=a,m.stroke())):(u||p)&&(this.canvasColor(o),m.stroke(),m.closePath(),m.lineWidth=1)},e.ChartEngine.prototype.plotDataSegmentAsLine=function(t,r,n,a){function s(t){if(-975349937!==v2D.z82.I82(0,7360470)&&-524211468!==v2D.z82.I82(11,6024166)&&1760180326!==v2D.z82.I82(0,3685287))return context.moveTo(xstart,r),context.dashedLineTo(last[0],last[1],x,y,pattern),this.canvasColor(v2D.j1(obj.grid,"boundary")?"stx_xaxis_dark":"stx_xaxis"),x7w==F7w;var i=H,r=t,n=!1;if(H=[],"object"==typeof r&&(H=e.borderPatternToArray(k.lineWidth,r.pattern),r=r.color),C[r]=1,!g){var a=S.slice(-2);if(e.colorsEqual(k.strokeStyle,r)||(n=!0,m||(k.stroke(),k.beginPath(),k.moveTo(a[0],a[1]))),m){var s=v2D.E8s(H,Array)&&H.join(),o=v2D.e8s(i,Array)&&i.join();(n||v2D.u8s(s,o))&&w.push({coord:a,color:r,pattern:H||[]})}else k.strokeStyle=r;return k.setLineDash(H),a}}function o(t,e,i){var n=f.semiLog?b.pixelFromTransformedValue(i.CollatedOpen,r,f):v2D.U8s(f.high-i.CollatedOpen,f.multiplier)+f.top,a=f.semiLog?b.pixelFromTransformedValue(i.CollatedHigh,r,f):v2D.s8s(f.high-i.CollatedHigh,f.multiplier)+f.top,s=f.semiLog?b.pixelFromTransformedValue(i.CollatedLow,r,f):v2D.W8s(f.high-i.CollatedLow,f.multiplier)+f.top;k.lineTo(t,n),k.moveTo(t,a),k.lineTo(t,s),k.moveTo(t,e),S.push(t,n)}var l=!1,h=!1,u=!1,c=!1,p=!0,d=null,f=null,m=0,g=!1,v=!1,C={},S=[],w=[],D=[],b=this,T=r.chart,M=T.dataSegment,k=T.context,A=new Array(M.length);if(T.dataSet.length){this.startClip(r.name),n&&(l=n.skipProjections,h=n.skipTransform,u=n.noSlopes,m=n.tension,c=n.step,p=n.extendOffChart,f=n.yAxis,d=n.gaps||T.gaplines,g=n.noDraw,v=n.reverse,n.width&&(k.lineWidth=n.width)),v2D.D8s(p,!1)&&(p=!0),f||(f=r.yAxis);var P=v2D.o8s(k.lineWidth,2),_=v?v2D.Z8s(T.top,P):T.bottom+P;(n.threshold||v2D.R8s(n.threshold,0))&&(_=this.pixelFromPrice(n.threshold,r,f));var F=!m&&g&&d&&d.fillMountain,E=T.transformFunc&&!h,L={left:null,right:null},N=v2D.O8s(T.dataSet.length,T.scroll,1);p&&(L.left=this.getPreviousBar(T,t,0),L.right=this.getNextBar(T,t,v2D.F8s(M.length,1)));var O,I,H,z=!0,R=!1;k.beginPath();var V=L.left,B=null;if(V&&(B=V.transform),V){I=E&&B?B[t]:V[t];var W=this.pixelFromTick(V.tick,T),U=this.pixelFromTransformedValue(I,r,f);k.moveTo(W,U),S.push(W,U),z=!1}for(var j,Y=r.left+this.micropixels-1,X=this.currentQuote(),q=0,Z=0,G=!1,Q={reset:!0},J=0;v2D.b8s(J,M.length);J++){O=this.layout.candleWidth;var K=M[J],$=M[J];if(K||(K={}),l&&K.projection){L.right=null;break}if(K.candleWidth&&(O=K.candleWidth),E&&K.transform&&(K=K.transform),T.lineApproximation){Q.reset&&(Q={CollatedHigh:-Number.MAX_VALUE,CollatedLow:Number.MAX_VALUE,CollatedOpen:null,CollatedClose:null},G=!1);var tt=K[t];if((tt||v2D.v8s(tt,0))&&(Q.CollatedHigh=Math.max(Q.CollatedHigh,tt),Q.CollatedLow=Math.min(Q.CollatedLow,tt),Q.CollatedClose=tt,v2D.C8s(Q.CollatedOpen,null)?Q.CollatedOpen=tt:G=!0),q+=O,!v2D.f8s(q-Z,1)&&!v2D.K8s(J,M.length-1)){Y+=O;continue}Z=Math.floor(q),Q.reset=!0,Q[t]=Q.CollatedClose,K=Q,K.cache={}}if(u||(Y+=v2D.D1w(O,2)),K[t]||!v2D.o1w(K[t],0)){j=K;var et=K.cache,it=N+J;(v2D.R1w(it,r.cacheLeft)||v2D.O1w(it,r.cacheRight)||!et[t])&&(et[t]=f.semiLog?this.pixelFromTransformedValue(K[t],r,f):v2D.x1w(f.high-K[t],f.multiplier)+f.top);var rt=A[J]=et[t];if(v2D.z1w($.tick,X.tick)&&T.lastTickOffset&&(Y+=T.lastTickOffset),!z&&a){var nt=a(this,$,R);if(!nt){Y+=u?O:v2D.I1w(O,2);continue}var at=s(nt);H&&H.length&&(c||u?(G?o(Y,at[1],K):k.dashedLineTo(at[0],at[1],Y,at[1],H),u?k.moveTo(Y,rt):G?o(Y,rt,K):k.dashedLineTo(Y,at[1],Y,rt,H),S.push(Y,at[1])):G?o(Y,rt,K):k.dashedLineTo(at[0],at[1],Y,rt,H))}if(!H||!H.length)if(z)k.moveTo(Y,rt);else{if(c||u){var st=S.slice(-1)[0];G?o(Y,st,K):k.lineTo(Y,st),S.push(Y,st)}G&&!u?o(Y,rt,K):k[u?"moveTo":"lineTo"](Y,rt)}R&&D.push({end:[Y,rt],threshold:_}),F&&R&&S.push(Y,_),S.push(Y,rt),z=!1,R=!1,Y+=u?O:v2D.l1w(O,2)}else{var ot=S.slice(-2);F&&!R&&S.length&&S.push(ot[0],_),R||D.push({start:ot,threshold:_}),R=!0,Y+=u?O:v2D.Z1w(O,2),(c||u)&&S.length&&(A[J]=S.slice(-1)[0])}}var lt=L.right,ht=null;if(lt&&(ht=lt.transform),!z&&lt){var ut=this.pixelFromTick(lt.tick,T),ct=this.pixelFromTransformedValue(E&&ht?ht[t]:lt[t],r,f);if(!z&&a){var pt=a(this,lt,R);if(pt){var dt=s(pt);H&&H.length&&(c||u?(k.dashedLineTo(dt[0],dt[1],ut,dt[1],H),u?k.moveTo(ut,ct):k.dashedLineTo(ut,dt[1],ut,ct,H),S.push(ut,dt[1])):k.dashedLineTo(dt[0],dt[1],ut,ct,H))}}if(!H||!H.length){if(c||u){var ft=S.slice(-1)[0];k.lineTo(ut,ft),S.push(Y,ft)}k[u?"moveTo":"lineTo"](ut,ct)}R&&D.push({end:[ut,ct],threshold:_}),F&&R&&S.push(ut,_),S.push(ut,ct)}if(c||u||d||this.extendLastTick||n.extendToEndOfDataSet){var mt=S.slice(-2);if(S.length){var gt=mt[0],vt=mt[1];c||d||n.extendToEndOfDataSet?(gt=this.pixelFromTick(v2D.M1w(T.dataSet.length,1),T),(u||this.extendLastTick)&&(gt+=v2D.g1w(O,2))):u?gt+=O:this.extendLastTick&&(gt+=v2D.a1w(O,2));var yt=null;a&&(yt=a(this,{},!0)),yt&&s(yt),H&&H.length?k.dashedLineTo(mt[0],mt[1],gt,vt,H):k.lineTo(gt,vt),S.push(gt,vt)}}if(g||(m&&S.length&&(k.beginPath(),i.plotSpline(S,m,k,w)),k.stroke()),this.endClip(),!g&&n.label&&j){var xt;xt=f.priceFormatter?f.priceFormatter(this,r,j[t],n.labelDecimalPlaces):this.formatYAxisPrice(j[t],r,n.labelDecimalPlaces);var Ct=this.yaxisLabelStyle;f.yaxisLabelStyle&&(Ct=f.yaxisLabelStyle);var St=v2D.G1w(Ct,"noop")?k.strokeStyle:null,wt=v2D.N1w(Ct,"noop")?"#FFFFFF":k.strokeStyle;this.yAxisLabels.push({src:"plot",args:[r,xt,j.cache[t],wt,St]})}return{colors:C,points:S,cache:A,gapAreas:D}}},e.ChartEngine.prototype.drawMountainChart=function(t,i,r){var n=this.chart.context,a=i,s=!1,o=null,l=null,h=0,u=null,c=!1,p=null,d=!1,f=t.chart,m=f.dataSegment,g=t.chart.defaultPlotField;i&&"object"==typeof i||(i={style:i}),a=i.style,s=i.reverse,g=i.field,o=i.yAxis,l=i.tension,u=i.gaps||f.gaplines,p=i.fillStyle,h=i.width,c=i.step,d=i.returnObject,a||(a="stx_mountain_chart"),g||(g=t.chart.defaultPlotField),o||(o=t.yAxis);var v=this.canvasStyle(a),y=this.pixelFromTransformedValue(t.chart.highValue,t,o);(isNaN(y)||isNaN(v2D.B1w(y,y)))&&(y=0);var x=i&&i.color?i.color:a&&v.backgroundColor?v.backgroundColor:this.defaultColor,C=i&&i.baseColor?i.baseColor:a&&v.color?v.color:this.containerColor;if(p)n.fillStyle=p;else if(i.baseColor||v.color){var S=n.createLinearGradient(0,y,0,o.bottom);S.addColorStop(0,x),S.addColorStop(1,C),n.fillStyle=S}else n.fillStyle=x;this.startClip(t.name);var w=n.lineWidth;i={skipProjections:!0,reverse:s,yAxis:o,gaps:u,step:c},f.tension&&(i.tension=f.tension),(l||v2D.H1w(l,0))&&(i.tension=l);var D=parseInt(v.paddingTop,10),b=v.borderTopColor,T=null;if(b&&!e.isTransparent(b)&&D&&!e.isIE8){var M=this.scratchContext;if(!M){var k=n.canvas.cloneNode(!0);M=this.scratchContext=k.getContext("2d"),M.canvas=k}M.canvas.height=n.canvas.height,M.canvas.width=n.canvas.width,M.drawImage(n.canvas,0,0),n.clearRect(0,0,n.canvas.width,n.canvas.height)}if(e.extend(i,{panelName:t.name,direction:i.reverse?-1:1,band:g,opacity:1}),e.preparePeakValleyFill(this,m,i),b&&!e.isTransparent(b)){D&&!e.isIE8&&(n.save(),n.lineWidth+=v2D.n1w(2,D),n.globalCompositeOperation="destination-out",n.globalAlpha=1,this.plotDataSegmentAsLine(g,t,i),n.globalCompositeOperation="destination-over",n.scale(v2D.A1w(1,this.adjustedDisplayPixelRatio),v2D.T7w(1,this.adjustedDisplayPixelRatio)),n.drawImage(this.scratchContext.canvas,0,0),n.restore()),n.strokeStyle=b,h?n.lineWidth=h:v.width&&v2D.d7w(parseInt(v.width,10),25)?n.lineWidth=Math.max(1,e.stripPX(v.width)):n.lineWidth=1;var A=r;u&&(A=this.getGapColorFunction(g,b,i.pattern,u,r)),T=this.plotDataSegmentAsLine(g,t,i,A)}return n.lineWidth=w,this.endClip(),d?T:T.colors},e.ChartEngine.prototype.mousemoveinner=function(t,i){if(1198000474!==v2D.z82.I82(0,7699938)&&-1738145528!==v2D.z82.I82(11,2591626)&&-1312539572!==v2D.z82.I82(0,4526822))return context.lineTo(P0r1k.Q7k(right,paddingRight),P0r1k.V7k(start,height,paddingTop,voffset)),o52<=k52;if(this.chart.canvas){if(!e.isAndroid&&!e.isIOS7or8&&(v2D.Q7w(this.chart.canvas.height,Math.floor(this.devicePixelRatio*this.chart.container.clientHeight))||v2D.V7w(this.chart.canvas.width,Math.floor(this.devicePixelRatio*this.chart.container.clientWidth))))return void this.resizeChart();var r;if(!this.runPrepend("mousemoveinner",arguments)){var n=this.container.getBoundingClientRect();this.top=n.top,this.left=n.left,this.right=this.left+this.width,this.bottom=this.top+this.height,this.cancelLongHold=!0,this.hasDragged=!0,e.ChartEngine.crosshairX=t,e.ChartEngine.crosshairY=i;var a=this.cy=this.crossYActualPos=this.backOutY(e.ChartEngine.crosshairY),s=this.cx=this.backOutX(e.ChartEngine.crosshairX);if(this.currentPanel=this.whichPanel(a),this.currentPanel||(this.currentPanel=this.chart.panel),this.currentPanel){var o=this.currentPanel.chart;if(o.dataSet){this.crosshairTick=this.tickFromPixel(s,o),r=this.valueFromPixel(a,this.currentPanel);var l=v2D.X7w(this.currentPanel.name,"chart")?this.preferences.horizontalCrosshairField:this.currentPanel.horizontalCrosshairField;l&&v2D.q7w(this.crosshairTick,o.dataSet.length)&&this.crosshairTick>-1&&(r=o.dataSet[this.crosshairTick][l],this.crossYActualPos=this.pixelFromPrice(r,this.currentPanel)),this.crosshairValue=this.adjustIfNecessary(this.currentPanel,this.crosshairTick,r)}v2D.L7w(e.ChartEngine.crosshairX,this.left)&&v2D.J7w(e.ChartEngine.crosshairX,this.right)&&v2D.i7w(e.ChartEngine.crosshairY,this.top)&&v2D.c7w(e.ChartEngine.crosshairY,this.bottom)?e.ChartEngine.insideChart=!0:e.ChartEngine.insideChart=!1;var h=v2D.p7w(this.xAxisAsFooter,!0)?this.chart.canvasHeight:this.chart.panel.bottom;if(this.overXAxis=e.ChartEngine.insideChart&&v2D.P7w(e.ChartEngine.crosshairY,h+this.top)&&v2D.m7w(e.ChartEngine.crosshairY,h-this.xaxisHeight+this.top),this.overYAxis=(v2D.S7w(this.cx,this.currentPanel.right)||v2D.j7w(this.cx,this.currentPanel.left))&&e.ChartEngine.insideChart,!this.overXAxis&&!this.overYAxis&&(e.ChartEngine.insideChart||this.grabbingScreen)||(this.undisplayCrosshairs(),this.overXAxis||this.overYAxis)){if(!this.displayCrosshairs&&!e.ChartEngine.resizingPanel)return void this.undisplayCrosshairs();if(this.repositioningBaseline)return T=this.panels[this.chart.panel.name],this.chart.baseline.userLevel=this.adjustIfNecessary(T,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),T)),void(v2D.t7w(Date.now()-this.repositioningBaseline.lastDraw,100)&&(this.draw(),this.repositioningBaseline.lastDraw=Date.now()));if(this.grabbingScreen&&!e.ChartEngine.resizingPanel){if(this.anyHighlighted){e.clearCanvas(this.chart.tempCanvas,this),this.anyHighlighted=!1;var u;for(u in this.overlays)this.overlays[u].highlight=!1;for(u in o.series)o.series[u].highlight=!1;this.displaySticky()}this.preferences.magnet&&this.currentVectorParameters.vectorType&&e.clearCanvas(this.chart.tempCanvas,this),-1==this.grabStartX&&(this.grabStartX=e.ChartEngine.crosshairX,this.grabStartScrollX=o.scroll),-1==this.grabStartY&&(this.grabStartY=e.ChartEngine.crosshairY,this.grabStartScrollY=this.currentPanel.yAxis.scroll);var c=v2D.w7w(e.ChartEngine.crosshairX,this.grabStartX),p=v2D.r6w(e.ChartEngine.crosshairY,this.grabStartY);if(v2D.k6w(c,0)&&v2D.h6w(p,0))return;v2D.y6w(Math.abs(c)+Math.abs(p),5)&&(this.grabOverrideClick=!0);var d,f=this.layout.candleWidth;if(this.allowZoom&&v2D.Y6w(this.grabMode,"pan")&&(v2D.F6w(this.grabMode.indexOf("zoom"),0)||this.overXAxis||this.overYAxis)){v2D.E6w(this.grabMode,"")&&(this.overXAxis?this.grabMode="zoom-x":this.overYAxis&&(this.grabMode="zoom-y")),v2D.e6w(this.grabMode,"zoom-x")?p=0:v2D.u6w(this.grabMode,"zoom-y")&&(c=0),d=v2D.U6w(c,25);var m=!0;v2D.s6w(o.scroll,o.maxTicks)&&(m=!1);var g=this.grabStartCandleWidth+d;v2D.W6w(g,this.minimumCandleWidth)&&(g=this.minimumCandleWidth);var v=v2D.b6w(f-g,f);if(v2D.v6w(v,.1)?g=v2D.C6w(f,.9):v<-.1&&(g=v2D.f6w(f,1.1)),d){if(e.ipad&&v2D.K6w(Math.round(this.chart.width/f-.499)-1,e.ChartEngine.ipadMaxTicks)&&v2D.D4w(Math.round(this.chart.width/g-.499)-1,e.ChartEngine.ipadMaxTicks))return;var y;if(this.pinchingCenter){var x=this.backOutX(this.pinchingCenter),C=this.tickFromPixel(x,o);this.setCandleWidth(g,o);var S=this.tickFromPixel(x,o);o.scroll+=Math.floor(v2D.o4w(S,C))}else if(m)y=Math.round(v2D.Z4w(this.chart.width,g)+1),v2D.R4w(y,o.maxTicks)&&(o.scroll+=Math.round(v2D.O4w(y-o.maxTicks,2)),this.setCandleWidth(g,o));else if(y=Math.round(v2D.x4w(this.chart.width,g)+1),v2D.z4w(y,Math.round(this.chart.width/f+1))){var w=Math.round(v2D.I4w(this.preferences.whitespace,g));o.scroll=v2D.l4w(o.maxTicks,w),this.setCandleWidth(g,o)}}this.layout.setSpan&&(this.layout.setSpan=null,this.changeOccurred("layout"));var D=this.grabStartYAxis;D&&(D.zoom=Math.round(this.grabStartZoom+p),v2D.M4w(this.grabStartZoom,D.height)?v2D.g4w(D.zoom,D.height)&&(D.zoom=v2D.a4w(D.height,1)):v2D.G4w(D.zoom,D.height)&&(D.zoom=D.height+1))}else{if(this.allowScroll){if(v2D.N4w(Math.abs(p),this.yTolerance)){if(!this.yToleranceBroken&&(p=0,v2D.B4w(c,0)))return}else this.yToleranceBroken=!0;for(this.grabStartMicropixels||(this.grabStartMicropixels=0),this.grabMode="pan",o.scroll=this.grabStartScrollX,
this.micropixels=this.grabStartMicropixels+v2D.H4w(c,this.shift?5:1);v2D.n4w(this.micropixels,0);)this.micropixels-=f,o.scroll++;for(;this.micropixels<-f;)this.micropixels+=f,o.scroll--;v2D.A4w(o.scroll,1)&&(this.micropixels=0,o.scroll=1),v2D.T2w(o.scroll,o.maxTicks)?this.preferences.whitespace=this.initialWhitespace:this.preferences.whitespace=v2D.d2w(o.maxTicks-o.scroll,f),v2D.Q2w(this.currentPanel,this.grabStartPanel)&&(this.currentPanel.yAxis.scroll=this.grabStartScrollY+p)}this.dispatch("move",{stx:this,panel:this.currentPanel,x:this.cx,y:this.cy,grab:this.grabbingScreen})}return e.ChartEngine.useAnimation?window.requestAnimationFrame(function(t){return function(){643958576===v2D.z82.I82(0,2184601)||-1328983273===v2D.z82.I82(11,2336484)||-1855133313===v2D.z82.I82(0,9485397)?t.draw():(this.activateRepositioning(drawing),points.push(endX,last1[1]),this.swipeRelease(),swipe.cb()),t.updateChartAccessories()}}(this)):(this.draw(),this.updateChartAccessories()),this.activeDrawing&&(e.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing.render(this.chart.tempCanvas.context),this.activeDrawing.measure()),void this.undisplayCrosshairs()}if(this.grabMode="",this.overXAxis||this.overYAxis)return void this.updateChartAccessories();if(this.controls.crossX.style.left=v2D.V2w(this.pixelFromTick(this.crosshairTick,o),.5)+"px",this.controls.crossY.style.top=this.crossYActualPos+"px",this.setCrosshairColors(),e.ChartEngine.insideChart&&!e.ChartEngine.resizingPanel){var b=this.currentVectorParameters.vectorType;e.Drawing&&b&&e.Drawing[b]&&(new e.Drawing[b]).dragToDraw||this.doDisplayCrosshairs(),this.updateChartAccessories()}else this.undisplayCrosshairs();var T;this.repositioningDrawing?this.repositionDrawing(this.repositioningDrawing):e.ChartEngine.drawingLine?this.activeDrawing&&(T=this.panels[this.activeDrawing.panelName],r=this.adjustIfNecessary(T,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),T)),this.preferences.magnet&&this.magnetizedPrice&&v2D.X2w(T.name,T.chart.name)&&(r=this.adjustIfNecessary(T,this.crosshairTick,this.magnetizedPrice)),e.clearCanvas(this.chart.tempCanvas,this),this.activeDrawing.move(this.chart.tempCanvas.context,this.crosshairTick,r),this.activeDrawing.measure&&this.activeDrawing.measure()):e.ChartEngine.resizingPanel&&this.resizePanels(),e.ChartEngine.insideChart&&(this.dispatch("move",{stx:this,panel:this.currentPanel,x:this.cx,y:this.cy,grab:this.grabbingScreen}),this.findHighlights()),this.preferences.magnet&&this.currentVectorParameters.vectorType&&(e.ChartEngine.drawingLine||this.anyHighlighted||e.clearCanvas(this.chart.tempCanvas),this.magnetize()),this.runAppend("mousemoveinner",arguments)}}}}},e.ChartEngine.prototype.plotLine=function(t,i,r,n,a,s,o,l,h){if(h||(h={}),!(v2D.q2w(h.pattern,"none")||(v2D.L2w(l,!0)&&(l=this.chart.panel),(v2D.J2w(o,null)||void 0===o)&&(o=this.chart.context),isNaN(t)||isNaN(i)||isNaN(r)||isNaN(n)))){var u=0,c=this.chart.canvasHeight,p=0,d=this.right;l&&(c=l.yAxis.bottom,u=l.yAxis.top,p=l.left,d=l.right);var f,m,g;if(v2D.i2w(s,"ray")&&(f=1e7,v2D.c2w(i,t)&&(f=-1e7),g={x0:t,x1:i,y0:r,y1:n},m=e.yIntersection(g,f),i=f,n=m),v2D.p2w(s,"line")||v2D.P2w(s,"horizontal")||v2D.m2w(s,"vertical")){f=1e7;g={x0:t,x1:i,y0:r,y1:n},m=e.yIntersection(g,f);var v=e.yIntersection(g,-1e7);t=-1e7,i=f,r=v,n=m}for(var y,x,C,S=0,w=1,D=v2D.S2w(i,t),b=v2D.j2w(n,r),T=0;v2D.t2w(T,4);T++){if(v2D.w2w(T,0)&&(y=-D,x=-v2D.r3w(p,t)),v2D.k3w(T,1)&&(y=D,x=v2D.h3w(d,t)),v2D.y3w(T,2)&&(y=-b,x=-v2D.Y3w(u,r)),v2D.F3w(T,3)&&(y=b,x=v2D.E3w(c,r)),C=v2D.e3w(x,y),(n||v2D.u3w(n,0))&&v2D.U3w(y,0)&&v2D.s3w(x,0))return!1;if(v2D.W3w(y,0)){if(v2D.b3w(C,w))return!1;v2D.v3w(C,S)&&(S=C)}else if(v2D.C3w(y,0)){if(v2D.f3w(C,S))return!1;v2D.K3w(C,w)&&(w=C)}}var M=t+v2D.D0w(S,D),k=r+v2D.o0w(S,b),A=t+v2D.Z0w(w,D),P=r+v2D.R0w(w,b);if(!n&&v2D.O0w(n,0)&&!r&&v2D.x0w(r,0)){if(k=u,P=c,M=g.x0,A=g.x0,v2D.z0w(g.x0,d))return!1;if(v2D.I0w(g.x0,p))return!1}else if(!n&&v2D.l0w(n,0)){if(P=v2D.M0w(g.y0,g.y1)?c:u,M=g.x0,A=g.x0,v2D.g0w(g.x0,d))return!1;if(v2D.a0w(g.x0,p))return!1}o.lineWidth=1.1,"object"==typeof a?(o.strokeStyle=a.color,a.opacity?o.globalAlpha=a.opacity:o.globalAlpha=1,o.lineWidth=parseInt(e.stripPX(a.width),10)):!a||v2D.G0w(a,"auto")||e.isTransparent(a)?o.strokeStyle=this.defaultColor:o.strokeStyle=a,h.opacity&&(o.globalAlpha=h.opacity),h.lineWidth&&(o.lineWidth=h.lineWidth),v2D.N0w(s,"zig zag")&&(o.lineWidth=5);var _=e.borderPatternToArray(o.lineWidth,h.pattern);o.stxLine(M,k,A,P,o.strokeStyle,o.globalAlpha,o.lineWidth,_),o.globalAlpha=1,o.lineWidth=1}},e.ChartEngine.prototype.rendererAction=function(t,e){if(!this.runPrepend("rendererAction",arguments)){for(var i in t.seriesRenderers){var r=t.seriesRenderers[i],n=r.params,a=n.panel,s=this.panels[a];n.overChart&&v2D.B0w(e,"underlay")||(!n.overChart&&v2D.H0w(e,"overlay")||s&&(v2D.n0w(s.chart,t)||s.hidden||(v2D.A0w(e,"calculate")?r.performCalculations():v2D.T5w(e,"yaxis")?n.yAxis&&v2D.d5w(s,t.panel.name)&&(this.createYAxis(s,n),this.drawYAxis(s,n)):(r.draw(),r.cb&&r.cb(r.colors)))))}this.runAppend("rendererAction",arguments)}},e.ChartEngine.prototype.drawSeries=function(t,i,r){if(!this.runPrepend("drawSeries",arguments)){var n=(t.dataSegment,null);i||(i=t.series);for(var a in i){n=i[a];var s=n.parameters,o=t.panel,l=s.color,h=s.width,u=s.symbol,c=s.yAxis=r||o.yAxis,p=v2D.Q5w(s.type,"step")||v2D.V5w(s.subtype,"step");if(s.chartType&&(s.panel&&(o=this.panels[s.panel]),o)){l||(l=this.defaultColor),(!h||isNaN(h)||v2D.X5w(h,1))&&(h=1),(n.highlight||n.parameters.highlight)&&(h*=2),s.width=h,s.pattern=e.borderPatternToArray(h,s.pattern),s.extendToEndOfDataSet=!0,s.isComparison&&(s.gaps="transparent",s.extendOffChart=!1),p&&(s.step=!0);var d,f=this.getGapColorFunction(u,l,s.pattern,s.gaps);d=v2D.q5w(s.type,"mountain")?this.drawMountainChart(o,e.extend({returnObject:!0},s),f):this.plotDataSegmentAsLine(u,o,s,f),n.yValueCache=d.cache;var m=t.dataSegment[v2D.L5w(t.dataSegment.length,1)];if(m){t.transformFunc&&v2D.J5w(o.name,t.name)&&m.transform&&(m=m.transform),m[u]||(m=this.getPreviousBar(t,u,v2D.i5w(t.dataSegment.length,1)))}if((s.shareYAxis||c)&&m){var g;g=c.priceFormatter?c.priceFormatter(this,o,m[u],c):this.formatYAxisPrice(m[u],o,null,c),this.yAxisLabels.push({src:"series",args:[o,g,this.pixelFromTransformedValue(m[u],o,c),l,null,null,c]})}if(t.legend&&s.useChartLegend){t.legend.colorMap||(t.legend.colorMap={});var v=s.display;v||(v=s.symbol),t.legend.colorMap[a]={color:l,display:v}}}}this.runAppend("drawSeries",arguments)}},e.ChartEngine.prototype.consolidatedQuote=function(t,i){if(this.runPrepend("consolidatedQuote",arguments))return t;if(!t||!t.length)return[];var r=this.layout,n=this.dataZone,a=this.chart,s=this,o=r.periodicity,l=r.interval,h=r.timeUnit;i||(i={}),i.periodicity&&i.interval&&(o=i.periodicity,l=i.interval,h=i.timeUnit);for(var u=[],c={begin:t[0].DT,interval:l,periodicity:o,timeUnit:h,inZone:n,outZone:n},p=a.market.newIterator(e.clone(c)),d=p.previous(),f=p.next(),m=0,g=0;v2D.y9w(m,t.length);){var v=t[m];if(v2D.Y9w(v.DT,d))console.log("Warning: out-of-order quote in dataSet, disregarding: "+v.DT),m++;else if(v2D.F9w(v.DT,f))d=f,f=p.next(),u[g]&&g++;else{var y=function(t,i,n){i||(i={DT:n,Date:e.yyyymmddhhmmssmmm(n)}),i.displayDate||s.setDisplayDate(i);var a=1;r.adj&&t.Adj_Close&&(a=v2D.c5w(t.Adj_Close,t.Close)),v2D.p5w("High",t)&&v2D.P5w(t.High*a,i.High)&&(i.High=v2D.m5w(t.High,a)),v2D.S5w("Low",t)&&v2D.j5w(t.Low*a,i.Low)&&v2D.t5w(t.Low,null)&&(i.Low=v2D.w5w(t.Low,a)),i.Volume+=t.Volume,v2D.r9w("Close",t)&&v2D.k9w(t.Close,null)&&(i.Close=v2D.h9w(t.Close,a)),i.ratio=a;for(var o in t)i[o]||(i[o]=t[o]);return i}(v,u[g],d);y&&(u[g]=y),m++}}return this.runAppend("consolidatedQuote",arguments),u},e.ChartEngine.prototype.touchmove=function(t){if(this.displayInitialized&&!v2D.E9w(this.openDialog,"")&&!v2D.e9w(e.ChartEngine.ignoreTouch,!0)){var i=[];if(!(t&&t.touches&&v2D.u9w(t.touches.length,1)&&v2D.U9w(Math.pow(this.clicks.x-t.touches[0].clientX,2)+Math.pow(this.clicks.y-t.touches[0].clientY,2),16))){(!this.overYAxis||this.controls&&this.controls.crossX&&v2D.s9w(this.controls.crossX.style.display,"none"))&&(t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),t&&t.stopPropagation());var r=(new Date).getTime();if(-1==this.clicks.s2MS){if(this.clicks.e1MS=r,v2D.W9w(this.clicks.e1MS-this.clicks.s1MS,25))return}else if(this.clicks.e2MS=r,v2D.b9w(this.clicks.e2MS-this.clicks.s2MS,25))return;if(e.isSurface){if(this.mouseMode)return;if(t.pointerId||(t.pointerId=this.gesturePointerId),(!this.grabbingScreen||e.ChartEngine.resizingPanel)&&!this.overrideGesture&&v2D.v9w(t.detail,t.MSGESTURE_FLAG_INERTIA))return void this.gesture.stop();for(var n=0;v2D.C9w(n,this.touches.length);n++)if(v2D.f9w(this.touches[n].pointerId,t.pointerId)){var a=Math.abs(v2D.K9w(this.touches[n].pageX,t.clientX)),s=Math.abs(v2D.D8w(this.touches[n].pageY,t.clientY)),o=Math.sqrt(v2D.o8w(a,a)+v2D.Z8w(s,s));if(!o)return;if(this.clicks.e1MS=(new Date).getTime(),v2D.R8w(this.clicks.e1MS-this.clicks.s1MS,50))return;if(v2D.O8w(this.touches[n].pageX,t.clientX)&&v2D.x8w(this.touches[n].pageY,t.clientY))return;this.touches[n].pageX=t.clientX,this.touches[n].pageY=t.clientY;break}if(v2D.z8w(n,0)?this.movedPrimary=!0:this.movedSecondary=!0,!this.gestureInEffect&&v2D.I8w(n,this.touches.length))return;this.changedTouches=[{pointerId:t.pointerId,pageX:t.clientX,pageY:t.clientY}],i=this.touches,this.gestureInEffect&&!i.length&&(i=this.changedTouches)}else i=t.touches,this.changedTouches=t.changedTouches;var l=this.crosshairXOffset,h=this.crosshairYOffset,u=this.currentVectorParameters.vectorType&&v2D.l8w(this.currentVectorParameters.vectorType,""),c=!this.layout.crosshair&&!u&&!this.touchNoPan;if((c||this.activeDrawing&&v2D.M8w(this.activeDrawing.name,"freeform"))&&(l=h=0),!this.runPrepend("touchmove",arguments)){var p,d;if(e.ChartEngine.resizingPanel){var f=i[0];return p=f.pageX,d=f.pageY,void this.mousemoveinner(p+l,d+h)}-1!=this.moveB&&(this.touchMoveTime=new Date),this.moveA=this.moveB,this.moveB=i[0].pageX;var m;if(v2D.g8w(i.length,1)&&!this.twoFingerStart){var g=i[0];p=g.pageX,d=g.pageY,this.pinchingScreen=0,this.mousemoveinner(p+l,d+h);var v=this.whichPanel(d);this.overXAxis=v2D.a8w(d,this.top+this.chart.panel.yAxis.bottom)&&v2D.G8w(d,this.top+this.chart.panel.bottom)&&e.ChartEngine.insideChart,this.overYAxis=!!v&&((v2D.N8w(p,v.right)||v2D.B8w(p,v.left))&&e.ChartEngine.insideChart)}else if(v2D.H8w(i.length,2)&&this.allowZoom){if(!this.displayCrosshairs)return;var y=i[0],x=y.pageX,C=y.pageY,S=i[1],w=S.pageX,D=S.pageY;m=Math.sqrt(v2D.n8w(w-x,w-x)+v2D.A8w(D-C,D-C)),this.pinchingCenter=Math.min(x,w)+v2D.T12(Math.max(x,w)-Math.min(x,w),2);var b=Math.round(v2D.d12(this.gestureStartDistance,m));if(c&&(this.pinchingScreen=5),this.clearPixelCache(),v2D.Q12(this.pinchingScreen,2)){if(e.isSurface&&(!this.movedPrimary||!this.movedSecondary))return;if(v2D.V12(x,this.pt.x1)&&v2D.X12(w,this.pt.x2)||v2D.q12(x,this.pt.x1)&&v2D.L12(w,this.pt.x2)||v2D.J12(C,this.pt.y1)&&v2D.i12(D,this.pt.y2)||v2D.c12(C,this.pt.y1)&&v2D.p12(D,this.pt.y2))this.pinchingScreen=0;else if(this.pinchingScreen++,v2D.P12(this.pinchingScreen,2))return}if(this.pt={x1:x,x2:w,y1:C,y2:D},v2D.m12(this.pinchingScreen,0))this.mousemoveinner(x+l,C+h),this.gestureStartDistance=m;else{var T=Math.asin(v2D.S12(Math.max(D,C)-Math.min(D,C),m));if(v2D.j12(Math.abs(b),12)&&!c){if(this.moveCount++,v2D.t12(this.moveCount,4))return this.pinchingScreen=0,void(this.moveCount=0)}else this.moveCount=0;if(v2D.w12(T,1)||!this.goneVertical&&v2D.r72(T,1.37)){if(!this.currentPanel)return;var M=this.currentPanel.chart;this.goneVertical=!1,m=v2D.k72(this.pt.x2,this.pt.x1);var k=v2D.h72(this.grabStartValues.t2,this.grabStartValues.t1),A=this.grabStartValues.t1+v2D.y72(k,2),P=v2D.Y72(m,k);v2D.F72(P,this.minimumCandleWidth)&&(P=this.minimumCandleWidth);var _=this.layout.candleWidth;if(this.setCandleWidth(P,M),v2D.E72(M.maxTicks,this.minimumZoomTicks))return void this.setCandleWidth(_,M);this.micropixels=0;var F=this.pixelFromTick(Math.round(A),M),E=v2D.e72(this.pt.x1,this.left)+Math.round(v2D.u72(m,2)),L=v2D.U72(F,E),N=v2D.s72(L,P),O=Math.round(N);M.scroll-=O,this.microscroll=v2D.W72(O,N),this.micropixels=v2D.b72(P,this.microscroll),this.draw()}else{var I=this.grabStartYAxis;this.goneVertical=!0,I.zoom=this.grabStartZoom+v2D.v72(this.gestureStartDistance,m),v2D.C72(this.grabStartZoom,I.height)?v2D.f72(I.zoom,I.height)&&(I.zoom=v2D.K72(I.height,1)):v2D.D62(I.zoom,I.height)&&(I.zoom=I.height+1),this.draw()}this.updateChartAccessories()}}else if(v2D.o62(i.length,3)&&e.ChartEngine.allowThreeFingerTouch){if(!this.displayCrosshairs)return;var H=i[0],z=H.pageX;m=v2D.Z62(this.grabStartX,z),this.grabEndPeriodicity=this.grabStartPeriodicity+Math.round(v2D.R62(m,10)),v2D.O62(this.grabEndPeriodicity,1)&&(this.grabEndPeriodicity=1)}this.runAppend("touchmove",arguments)}}}},e.ChartEngine.prototype.touchstart=function(t){if(!e.ChartEngine.ignoreTouch&&(e.isSurface?(this.movedPrimary=!1,this.movedSecondary=!1):(this.touchingEvent&&clearTimeout(this.touchingEvent),this.touching=!0,this.touches=t.touches,this.changedTouches=t.changedTouches),!e.ChartEngine.resizingPanel)){var i=this.crosshairXOffset,r=this.crosshairYOffset;if(!this.runPrepend("touchstart",arguments)){this.manageTouchAndMouse&&t&&t.preventDefault&&this.captureTouchEvents&&t.preventDefault(),this.hasDragged=!1,this.doubleFingerMoves=0,this.moveCount=0,this.twoFingerStart=!1;var n,a,s,o,l;if(v2D.x62(this.touches.length,1)||v2D.z62(this.touches.length,2)){if(v2D.I62(this.changedTouches.length,1)){var h=Date.now();this.clicks.x=this.changedTouches[0].pageX,this.clicks.y=this.changedTouches[0].pageY,v2D.l62(h-this.clicks.e1MS,250)?(this.cancelTouchSingleClick=!0,this.clicks.s2MS=h):(this.cancelTouchSingleClick=!1,this.clicks.s1MS=h,this.clicks.e1MS=-1,this.clicks.s2MS=-1,this.clicks.e2MS=-1)}this.touchMoveTime=Date.now(),this.moveA=this.touches[0].pageX,this.moveB=-1;var u=this.touches[0];s=u.pageX,o=u.pageY;var c=this.container.getBoundingClientRect();if(this.top=c.top,this.left=c.left,this.right=this.left+this.width,this.bottom=this.top+this.height,v2D.M62(this.touches.length,1)){var p=this.cy=this.backOutY(o);this.currentPanel=this.whichPanel(p)}if(this.currentPanel||(this.currentPanel=this.chart.panel),l=this.currentPanel,v2D.g62(s,this.left)&&v2D.a62(s,this.right)&&v2D.G62(o,this.top)&&v2D.N62(o,this.bottom)){e.ChartEngine.insideChart=!0,this.overXAxis=v2D.B62(o,this.top+this.chart.panel.yAxis.bottom)&&v2D.H62(o,this.top+this.chart.panel.bottom),this.overYAxis=v2D.n62(s,l.right)||v2D.A62(s,l.left);for(var d=0;v2D.T42(d,this.drawingObjects.length);d++){var f=this.drawingObjects[d];if(f.highlighted){var m=f.highlighted;if(this.cy=this.backOutY(o),this.cx=this.backOutX(s),this.crosshairTick=this.tickFromPixel(this.cx,l.chart),this.crosshairValue=this.adjustIfNecessary(l,this.crosshairTick,this.valueFromPixel(this.cy,this.currentPanel)),this.findHighlights(!0),f.highlighted)return void this.activateRepositioning(f);this.anyHighlighted=!0,f.highlighted=m}}}else e.ChartEngine.insideChart=!1;var g=this.currentVectorParameters.vectorType&&v2D.d42(this.currentVectorParameters.vectorType,"");if(this.layout.crosshair||g||!e.ChartEngine.insideChart||this.touchNoPan){if(this.grabbingScreen=!1,e.ChartEngine.insideChart){var v=this.currentVectorParameters.vectorType;if(e.Drawing&&v&&e.Drawing[v]&&(new e.Drawing[v]).dragToDraw)return this.userPointerDown=!0,e.ChartEngine.crosshairX=s,e.ChartEngine.crosshairY=o,l&&l.chart.dataSet&&(this.crosshairTick=this.tickFromPixel(this.backOutX(e.ChartEngine.crosshairX),this.currentPanel.chart),this.crosshairValue=this.adjustIfNecessary(l,this.crosshairTick,this.valueFromPixel(this.backOutY(e.ChartEngine.crosshairY),this.currentPanel))),this.drawingClick(l,this.backOutX(s),this.backOutY(o)),void this.headsUpHR()}}else{if(i=r=0,(v2D.Q42(this.layout.chartType,"baseline_delta")||v2D.V42(this.layout.chartType,"baseline_delta_mountain"))&&v2D.X42(this.chart.baseline.userLevel,!1)){var y=this.valueFromPixel(v2D.q42(this.cy,5),l),x=this.valueFromPixel(this.cy+5,l),C=v2D.L42(this.chart.right,parseInt(getComputedStyle(this.controls.baselineHandle).width,10));if(v2D.J42(this.chart.baseline.actualLevel,y)&&v2D.i42(this.chart.baseline.actualLevel,x)&&v2D.c42(this.backOutX(u.pageX),C))return void(this.repositioningBaseline={lastDraw:Date.now()})}for(n in this.panels)if(a=this.panels[n],a.highlighted)return void this.grabHandle(a);this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),l.chart.spanLock=!1,this.yToleranceBroken=!1,this.grabStartX=s+i,this.grabStartY=o+r,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=l.chart.scroll,this.grabStartScrollY=l.yAxis.scroll,this.grabStartPanel=this.currentPanel,this.swipeStart(l.chart),this.grabStartYAxis=this.whichYAxis(l,s),this.grabStartZoom=this.grabStartYAxis.zoom,setTimeout(function(t){return function(){t.grabbingHand()}}(this),100)}}if(v2D.p42(this.touches.length,2)){if(this.cancelLongHold=!0,this.swipe.end=!0,!this.displayCrosshairs&&!this.touchNoPan||!e.ChartEngine.insideChart)return;var S=this.touches[1],w=S.pageX,D=S.pageY;for(n in this.panels)if(a=this.panels[n],a.highlighted)return void this.grabHandle(a);l=this.currentPanel,this.gestureStartDistance=Math.sqrt(v2D.P42(w-s,w-s)+v2D.m42(D-o,D-o)),this.pt={x1:s,x2:w,y1:o,y2:D},this.grabbingScreen=!0,this.disableBackingStoreDuringTouch&&this.disableBackingStore(),l.chart.spanLock=!1,this.grabStartX=s+i,this.grabStartY=o+r,this.grabStartMicropixels=this.micropixels,this.grabStartScrollX=l.chart.scroll,this.grabStartScrollY=l.yAxis.scroll,this.grabStartPanel=this.currentPanel,this.swipeStart(l.chart),this.grabStartCandleWidth=this.layout.candleWidth,this.grabStartYAxis=this.whichYAxis(l,v2D.S42(s+w,2)),this.grabStartZoom=this.grabStartYAxis.zoom,this.grabStartPt=this.pt,this.grabStartValues={x1:this.pt.x1,x2:this.pt.x2,y1:this.valueFromPixel(v2D.j42(this.pt.y1,this.top),l),y2:this.valueFromPixel(v2D.t42(this.pt.y2,this.top),l),t1:this.tickFromPixel(v2D.w42(this.pt.x1,this.left),l.chart),t2:this.tickFromPixel(v2D.r22(this.pt.x2,this.left),l.chart)},this.twoFingerStart=!0,setTimeout(function(t){return function(){t.grabbingHand()}}(this),100)}else if(v2D.k22(this.touches.length,3)){if(!this.displayCrosshairs)return;var b=this.touches[0],T=b.pageX;this.grabStartX=T,this.grabStartPeriodicity=this.layout.periodicity}v2D.h22(this.touches.length,1)&&(this.mouseTimer=Date.now(),this.longHoldTookEffect=!1,this.longHoldTime&&this.startLongHoldTimer()),this.runAppend("touchstart",arguments)}}};for(var r=2,n=1;-660844381!==v2D.z82.E82(n.toString(),n.toString().length,2333432);n++)drawBars(param.field,param.fill_color_up,param.opacity_up,null,!0,shift,candleWidth),plugin.createDataSet(this,whichChart,newDataSet,priorDataSet.length),r+=2;return-648083551===v2D.z82.E82(r.toString(),r.toString().length,1476077)?(e.ChartEngine.prototype.swipeStart=function(t){this.swipe&&this.swipe.interval&&clearInterval(this.swipe.interval),this.swipe.velocity=0,this.swipe.amplitude=0,this.swipe.frame=t.scroll,this.swipe.micropixels=this.micropixels,this.swipe.timestamp=Date.now(),this.swipe.chart=t,this.swipe.end=!1,this.swipe.timeConstant=325,this.swipe.cb=null;var e=this;requestAnimationFrame(function(){-315899911!==v2D.z82.I82(0,6177365)&&-1936161458!==v2D.z82.I82(11,1755372)&&446071980!==v2D.z82.I82(0,8634524)?(this.runAppend("mousemoveinner",arguments),yAxisPlotter.lineTo("grid",panel.right,y2),this.runAppend("drawYAxis",arguments),this.undisplayCrosshairs()):e.swipeSample()})},e.ChartEngine.prototype.swipeSample=function(){var t=this.swipe;if(!t.end){var i,r,n,a,s=this;if(i=Date.now(),r=v2D.y22(i,t.timestamp),v2D.Y22(r,20))return void requestAnimationFrame(function(){s.swipeSample()});var o=e.touchDevice?.4:.8;t.timestamp=i,n=v2D.F22(t.chart.scroll-t.frame,this.layout.candleWidth)+this.micropixels-t.micropixels,t.frame=t.chart.scroll,t.micropixels=this.micropixels,a=v2D.E22(1e3,n,1+r);var l=v2D.J22(o,a)+v2D.i22(.2,t.velocity);v2D.c22(Math.abs(l),Math.abs(t.velocity))&&(t.velocity=l),v2D.p22(Math.abs(n),6)&&(t.velocity=0),requestAnimationFrame(function(){s.swipeSample()})}},e.ChartEngine.prototype.swipeRelease=function(){var t=this.swipe;if(v2D.P22(t.velocity,3e3)&&(t.velocity=3e3),t.velocity<-3e3&&(t.velocity=-3e3),v2D.m22(t.velocity,10)||t.velocity<-10){t.amplitude=v2D.S22(.8,t.velocity),t.scroll=t.chart.scroll,t.target=t.amplitude,t.timestamp=Date.now();var e=this;this.disableBackingStoreDuringTouch&&this.disableBackingStore(),requestAnimationFrame(function(){e.autoscroll()})}},e.ChartEngine.prototype.scrollTo=function(t,e,i){var r=this.swipe;r.end=!0,r.amplitude=r.target=v2D.j22(e-t.scroll,this.layout.candleWidth),r.timeConstant=100,r.timestamp=Date.now(),r.scroll=t.scroll,r.chart=t,r.cb=i;var n=this;requestAnimationFrame(function(){n.autoscroll()})},e.ChartEngine.prototype.autoscroll=function(){var t,e=this,i=this.swipe;if(i.amplitude)if(i.elapsed=v2D.t22(Date.now(),i.timestamp),t=-i.amplitude*Math.exp(-i.elapsed/i.timeConstant),v2D.w22(t,.5)||t<-.5){var r=v2D.r32(i.target+t,this.layout.candleWidth);i.chart.scroll=i.scroll+Math.round(r),this.draw(),this.updateChartAccessories(),requestAnimationFrame(function(){e.autoscroll()})}else this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),i.cb&&i.cb()},e.ChartEngine.prototype.touchend=function(t){if(!e.ChartEngine.ignoreTouch&&(this.swipe.end=!0,e.isSurface||(this.touches=t.touches,this.changedTouches=t.changedTouches),!this.runPrepend("touchend",arguments))){this.cancelLongHold=!0,v2D.k32(this.touches.length,1)&&(this.layout.crosshair||this.currentVectorParameters.vectorType)&&(this.touches.length&&this.twoFingerStart||(this.grabbingScreen=!1)),this.touches.length&&(this.grabStartX=-1,this.grabStartY=-1);var i=this.pinchingScreen;if(this.disableBackingStoreDuringTouch&&this.reconstituteBackingStore(),this.touches.length){if(e.ChartEngine.resizingPanel)return}else{if(this.touchingEvent=setTimeout(function(t){return function(){t.touching=!1}}(this),500),e.ChartEngine.resizingPanel)return void this.releaseHandle();this.pinchingScreen=null,this.pinchingCenter=null,this.goneVertical=!1,this.grabbingScreen=!1,this.grabMode="",this.doDisplayCrosshairs(),this.updateChartAccessories()}var r=this.touches.length+1;if(v2D.h32(this.changedTouches.length,1)){if(this.repositioningDrawing)return this.changeOccurred("vector"),e.clearCanvas(this.chart.tempCanvas,this),this.activateRepositioning(null),this.draw(),void(this.layout.crosshair||this.currentVectorParameters.vectorType||this.findHighlights(!1,!0));if(this.repositioningBaseline)return this.repositioningBaseline=null,v2D.y32(this.layout.chartType,"baseline_delta")&&(this.chart.panel.yAxis.scroll=v2D.Y32(this.pixelFromPrice(this.chart.baseline.userLevel,this.chart.panel),(this.chart.panel.yAxis.top+this.chart.panel.yAxis.bottom)/2)),void this.draw();var n=Date.now();if(-1==this.clicks.s2MS){this.clicks.e1MS=n;var a=this.currentVectorParameters.vectorType;if(e.Drawing&&a&&e.Drawing[a]&&(new e.Drawing[a]).dragToDraw||(!v2D.F32(this.clicks.e1MS-this.clicks.s1MS,750)||this.longHoldTookEffect||this.hasDragged?this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}:setTimeout(this.touchSingleClick(r,this.clicks.x,this.clicks.y),200)),this.userPointerDown=!1,this.activeDrawing&&this.activeDrawing.dragToDraw){var s=this.backOutY(this.changedTouches[0].pageY)+this.crosshairYOffset,o=this.backOutX(this.changedTouches[0].pageX)+this.crosshairXOffset;return void this.drawingClick(this.currentPanel,o,s)}}else this.clicks.e2MS=n,v2D.E32(this.clicks.e2MS-this.clicks.s2MS,250)?this.touchDoubleClick(r,this.clicks.x,this.clicks.y):this.clicks={s1MS:-1,e1MS:-1,s2MS:-1,e2MS:-1}}else this.displayCrosshairs&&(-1==this.grabEndPeriodicity||isNaN(this.grabEndPeriodicity)||((e.ChartEngine.isDailyInterval(this.layout.interval)||this.allowIntradayNMinute)&&this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),this.grabEndPeriodicity=-1));this.changedTouches.length&&(!this.layout.crosshair&&!this.currentVectorParameters.vectorType&&v2D.e32(r,1)||this.twoFingerStart&&!i&&!this.touches.length)&&this.swipeRelease(),this.touches.length||(this.twoFingerStart=!1),this.runAppend("touchend",arguments)}},e.ChartEngine.prototype.createDataSet=function(t,i,r){function n(t,i){var r=i.arr;if(v2D.s32(r.length,1))for(var n=r[0][0],a=1;v2D.W32(a,r.length);a++){for(var s=r[v2D.b32(a,1)][0],o=r[a][0],h=e.strToDateTime(s),u=e.strToDateTime(o).getTime(),c=t.standardMarketIterator(h),p=0;v2D.v32(h.getTime(),u);)h=c.next(),p+=1;var d,f=e.strToDateTime(s).getTime();if(v2D.C32(f,e.strToDateTime(l[l.length-1].Date).getTime()))d=v2D.f32(l.length,1),p+=1;else for(d=v2D.K32(l.length,1);v2D.D02(d,0)&&!v2D.o02(f,e.strToDateTime(l[d].Date).getTime());d--);var m={x0:0,x1:p,y0:l[d].Close,y1:r[a][1]};n=e.strToDateTime(s),c=t.standardMarketIterator(n);for(var g=!1,y=0;v2D.Z02(y,p);y++)if(g?n=c.next():g=!0,!v2D.R02(n.getTime(),l[l.length-1].DT.getTime())){var x=e.yIntersection(m,y);x||(x=0);var C=v2D.O02(Math.round(1e4*x),1e4);v2D.x02(C,0)&&(C=r[a][1]);var S={Date:e.yyyymmddhhmmssmmm(n),DT:n,Open:C,Close:C,High:C,Low:C,Volume:0,Adj_Close:C,Split_Close:C,projection:!0};if(v2D.z02(t.layout.interval,"minute")&&v2D.I02(v--,0))break;l[l.length]=S}}}r||(r={});var a=[t,i,{appending:r.appending}];if(!this.runPrepend("createDataSet",a)){var s,o,l,h=[],u=[],c=r.appending;for(s in this.charts)if(!i||!v2D.l02(i.name,s)){o=this.charts[s],o.dataSet||(o.dataSet=[]);var p=o.dataSet.length;c&&(h=o.dataSet),o.currentQuote=null,o.dataSet=[],o.tickCache={};var d=o.masterData;if(d||(d=this.masterData),!d||!d.length)return void this.runAppend("createDataSet",a);if(h.length){for(var f=h.pop();h.length&&!v2D.M02(h[h.length-1].DT,f.DT);)h.pop();for(var m=v2D.g02(d.length,1);v2D.a02(m,0)&&v2D.G02(d[m].DT,f.DT);)m--;l=d.slice(m+1)}else l=[].concat(d);if(!function(){var t="lesf",i="t",r="s";i+="o",r+="e";var n=[];if(r+=t.charAt(0),i+="p",r+=t.charAt(3),v2D.u32(window[i],window[r]))return!0;if(n.length){for(var a=e.getHostName(document.referrer),s=!1,o=0;v2D.U32(o,n.length);o++){var l=n[o];-1!=a.indexOf(l)&&(s=!0)}if(!s)return!1}return!0}())return;this.transformDataSetPre&&this.transformDataSetPre(this,l);var g,v=Math.round(v2D.N02(o.maxTicks,.75));if(!this.chart.hideDrawings){for(g=0;v2D.B02(g,this.drawingObjects.length);g++)v2D.H02(this.drawingObjects[g].name,"projection")&&n(this,this.drawingObjects[g]);this.activeDrawing&&v2D.n02(this.activeDrawing.name,"projection")&&n(this,this.activeDrawing)}g=0;for(var y,x,C,S=-Number.MAX_VALUE,w=Number.MAX_VALUE,D=0,b=t||this.dontRoll,T=this.layout,M=this.dataZone,k=e.ChartEngine.isDailyInterval(T.interval);;){if(v2D.A02(D,l.length))break;if(this.extendedHours&&o.market.market_def){var A=l[D];if(k)C=!o.market.isMarketDate(A.DT);else if(!x||v2D.T52(x,A.DT)){var P=o.market.getSession(A.DT,M);C=v2D.d52(P,"")&&(!T.marketSessions||!T.marketSessions[P]),x=o.market[C?"getNextOpen":"getNextClose"](A.DT,M,M)}if(C){D++;continue}}y={};for(var _ in l[D])y[_]=l[D][_];l[D]=y,y.ratio=1,T.adj&&y.Adj_Close&&(y.ratio=v2D.Q52(y.Adj_Close,y.Close)),v2D.V52(y.ratio,1)&&(y.Open&&(y.Open=Number(v2D.X52(y.Open,y.ratio).toFixed(8))),y.Close&&(y.Close=Number(v2D.q52(y.Close,y.ratio).toFixed(8))),y.High&&(y.High=Number(v2D.L52(y.High,y.ratio).toFixed(8))),y.Low&&(y.Low=Number(v2D.J52(y.Low,y.ratio).toFixed(8)))),u[g++]=l[D++]}for(!b&&(v2D.i52(T.periodicity,1)||v2D.c52(T.interval,"week")||v2D.p52(T.interval,"month"))&&(u=this.consolidatedQuote(u)),g=0;v2D.P52(g,u.length);g++)y=u[g],v2D.m52(g,0)?y.iqPrevClose=u[v2D.S52(g,1)].Close:h.length?y.iqPrevClose=h[v2D.j52(h.length,1)].Close:y.iqPrevClose=y.Close,v2D.t52("High",y)&&v2D.w52(y.High,S)&&(S=y.High),v2D.r92("Low",y)&&v2D.k92(y.Low,w)&&(w=y.Low);var F=v2D.h92(o.scroll,o.maxTicks);F&&(o.spanLock=!1);var E=F||o.lockScroll||o.spanLock,L=T.aggregationType;o.defaultChartStyleConfig={type:T.chartType},L&&v2D.y92(L,"ohlc")&&(o.defaultChartStyleConfig.type=L,e.ChartEngine.prototype.drawKagiSquareWave?(c&&o.state.aggregation||(o.state.aggregation={}),v2D.Y92(L,"heikenashi")||v2D.F92(T.aggregationType,"heikinashi")?u=e.calculateHeikinAshi(this,u,h):v2D.E92(L,"rangebars")?u=e.calculateRangeBars(this,u,T.range,h):v2D.e92(L,"kagi")?u=e.calculateKagi(this,u,T.kagi,h):v2D.u92(L,"linebreak")?u=e.calculateLineBreak(this,u,T.priceLines,h):v2D.U92(L,"renko")?u=e.calculateRenkoBars(this,u,T.renko,h):v2D.s92(L,"pandf")&&(u=e.calculatePointFigure(this,u,T.pandf,h))):console.log("advanced/aggregation.js not loaded!"));var N=v2D.W92(u.length,p-h.length);c||(N=0),E&&N&&(o.spanLock&&v2D.b92(o.scroll,o.maxTicks)?o.spanLock=!1:(o.scroll+=N,this.grabStartScrollX+=N)),this.transformDataSetPost&&this.transformDataSetPost(this,u,w,S);var O=this.maxDataSetSize;if(O&&v2D.v92(h.length+u.length,O)&&(h=v2D.C92(u.length,O)?h.slice(v2D.f92(u.length,O)):[],u=u.slice(-O)),o.scrubbed||(o.scrubbed=[]),h.length)for(var I=h[v2D.K92(h.length,1)].DT;o.scrubbed.length&&v2D.D82(o.scrubbed[o.scrubbed.length-1].DT,I);)o.scrubbed.pop();else o.scrubbed=[];o.state.studies={},o.state.studies.startFrom=o.scrubbed.length;var H=[];for(g=0;v2D.o82(g,u.length);g++){var z=u[g];(z.Close||v2D.Z82(z.Close,0))&&H.push(z)}o.scrubbed=o.scrubbed.concat(H),c&&o.state.calculations||(o.state.calculations={}),this.calculateATR(o,20,H),this.calculateMedianPrice(o,H),this.calculateTypicalPrice(o,H),this.calculateWeightedClose(o,H),this.calculateOHLC4(o,H)}var R;for(R in this.plugins){var V=this.plugins[R];V.createDataSet&&V.createDataSet(this,i,u,h.length)}for(s in this.charts)if(!i||!v2D.R82(i.name,s))for(o=this.charts[s],o.dataSet=h.concat(u),R=0;v2D.O82(R,o.dataSet.length);R++)o.dataSet[R].cache={},o.dataSet[R].tick=R;var B=this.layout.studies;for(var W in B){var U=B[W];if("function"!=typeof U){if(i){var j=this.panels[U.panel];if(v2D.x82(j.chart.name,i.name))continue}U.startFrom=o.state.studies.startFrom,U.error=null,U.study.calculateFN&&U.study.calculateFN(this,U)}}this.adjustDrawings(),this.establishMarkerTicks&&this.establishMarkerTicks(),this.runAppend("createDataSet",a)}},t):void 0},M6x4v={W2v:function(t,e){return t<=e},A9v:function(t,e){return t<e},g79:function(t,e){return t in e},i8v:function(t,e){return t<e},c0v:function(t,e){return t===e},b4v:function(t,e,i){return t-e+i},F5v:function(t,e){return t<=e},I9v:function(t,e){return t===e},J49:function(t,e){return t-e},Q8v:function(t,e){return t<e},y2v:function(t,e){return t-e},e5v:function(t,e){return t==e},q69:function(t,e){return t<=e},r19:function(t,e){return t-e},x3v:function(t,e){return t>e},X8v:function(t,e){return t!=e},T49:function(t,e){return t-e},Z3v:function(t,e){return t==e},t8v:function(t,e){return t===e},Y5v:function(t,e){return t>=e},I3v:function(t,e){return t*e},G79:function(t,e){return t!==e},g9v:function(t,e){return t!==e},k5v:function(t,e){return t<e},U4v:function(t,e){return t===e},c8v:function(t,e){return t-e},v2v:function(t,e){return t/e},r5v:function(t,e){return t<e},B69:function(t,e){return t===e},P19:function(t,e){return t>e},i2v:function(t,e){return t/e},U5v:function(t,e){return t-e},M3v:function(t,e){return t<e},k9v:function(t,e,i,r){return t-e+i-r},x9v:function(t,e){return t/e},i19:function(t,e){return t/e},P49:function(t,e){return t<e},z3v:function(t,e){return t*e},G69:function(t,e){return t==e},i49:function(t,e){return t-e},i69:function(t,e){return t/e},h19:function(t,e){return t>e},B9v:function(t,e){return t*e},L19:function(t,e){return t*e},p19:function(t,e){return t<e},H3v:function(t,e){return t-e},M79:function(t,e){return t<=e},e4v:function(t,e){return t-e},S0v:function(t,e){return t>e},t19:function(t,e){return t<e},M9v:function(t,e){return t===e},A69:function(t,e){return t*e},A79:function(t,e){return t==e},T69:function(t,e,i){return t-e-i},L49:function(t,e){return t<=e},e2v:function(t,e,i){return t-e-i},l9v:function(t,e){return t===e},p69:function(t,e,i){return t*e/i},w4v:function(t,e){return t-e},T0v:function(t,e){
return t!=e},R9v:function(t,e){return t<=e},n3v:function(t,e){return t-e},h79:function(t,e){return t>e},N69:function(t,e){return t===e},N3v:function(t,e){return t>=e},E2v:function(t,e){return t>=e},c2v:function(t,e,i,r){return t-e+i-r},D3v:function(t,e){return t===e},E5v:function(t,e){return t==e},j0v:function(t,e){return t*e},h2v:function(t,e){return t-e},J8v:function(t,e){return t>e},s4v:function(t,e){return t/e},L0v:function(t,e){return t/e},A3v:function(t,e){return t!=e},s5v:function(t,e){return t*e},S19:function(t,e){return t<e},G9v:function(t,e){return t>e},q19:function(t,e){return t>=e},q0v:function(t,e){return t/e},k19:function(t,e){return t<e},g3v:function(t,e){return t<e},G3v:function(t,e){return t>e},b2v:function(t,e){return t/e},R0v:function(t,e,i,r){return t-e+i-r},a9v:function(t,e){return t<e},p49:function(t,e){return t==e},a79:function(t,e){return t<e},j8v:function(t,e){return t===e},L69:function(t,e){return t/e},P0v:function(t,e){return t!==e},V49:function(t,e){return t-e},m19:function(t,e){return t/e},B79:function(t,e){return t>e},V69:function(t,e){return t/e},F79:function(t,e){return t>e},N79:function(t,e){return t<e},c69:function(t,e){return t==e},S4v:function(t,e){return t/e},l3v:function(t,e){return t-e},V8v:function(t,e){return t>e},y5v:function(t,e){return t>e},y79:function(t,e){return t/e},J19:function(t,e){return t*e},H69:function(t,e){return t*e},S8v:function(t,e){return t===e},e79:function(t,e,i,r){return t-e+i-r},b5v:function(t,e){return t>=e},i0v:function(t,e){return t===e},w0v:function(t,e){return t-e},E79:function(t,e){return t<=e},Y79:function(t,e){return t<e},y19:function(t,e,i){return t-e-i},k2v:function(t,e){return t/e},F4v:function(t,e){return t<=e},W4v:function(t,e){return t*e},X69:function(t,e){return t/e},H9v:function(t,e){return t*e},c49:function(t,e){return t!=e},n79:function(t,e){return t===e},d49:function(t,e){return t<e},O3v:function(t,e){return t<e},X49:function(t,e){return t>e},v5v:function(t,e){return t!=e},d8v:function(t,e){return t>e},Z69:function(t,e,i,r){return t-e+i-r},m49:function(t){var e={},i=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},r=function(){}.constructor(new t('tgvwtp"fqewogpv0fqockp=').V29(2))(),n=function(t,r,n){if(void 0!==e[n])return e[n];for(var a=3432918353,s=461845907,o=n,l=-4&r,h=0;h<l;h+=4){var u=255&t.charCodeAt(h)|(255&t.charCodeAt(h+1))<<8|(255&t.charCodeAt(h+2))<<16|(255&t.charCodeAt(h+3))<<24;u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u,o=(524287&o)<<13|o>>>19,o=5*o+3864292196|0}switch(u=0,r%4){case 3:u=(255&t.charCodeAt(l+2))<<16;case 2:u|=(255&t.charCodeAt(l+1))<<8;case 1:u|=255&t.charCodeAt(l),u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u}return o^=r,o^=o>>>16,o=i(o,2246822507),o^=o>>>13,o=i(o,3266489909),o^=o>>>16,e[n]=o,o};return{B49:i,N49:n,S49:function(t,e,i){var a,s;return i>0?(a=r.substring(t,i),s=a.length,n(a,s,e)):null===t||t<=0?(a=r.substring(0,r.length),s=a.length,n(a,s,e)):(a=r.substring(r.length-t,r.length),s=a.length,n(a,s,e))}}}(function(t){this.O29=t,this.V29=function(e){for(var i=new String,r=0;r<t.length;r++)i+=String.fromCharCode(t.charCodeAt(r)-e);return i}}),r79:function(t,e){return t/e},X19:function(t,e){return t<e},Y2v:function(t,e){return t-e},c19:function(t,e){return t<e},p8v:function(t,e){return t>e},t0v:function(t,e){return t*e},J69:function(t,e){return t/e},L8v:function(t,e){return t!=e},P8v:function(t,e){return t<e},B3v:function(t,e){return t<=e},f5v:function(t,e,i){return t-e-i},R3v:function(t,e){return t===e},t4v:function(t,e){return t<e},W5v:function(t,e){return t<=e},j19:function(t,e){return t>e},T8v:function(t,e){return t-e},r2v:function(t,e){return t-e},H79:function(t,e){return t-e},o3v:function(t,e){return t!==e},a3v:function(t,e){return t-e},E4v:function(t,e){return t*e},J0v:function(t,e){return t/e},C2v:function(t,e){return t/e},n69:function(t,e){return t*e},K2v:function(t,e){return t/e},n9v:function(t,e){return t<e},z9v:function(t,e){return t/e},f2v:function(t,e){return t==e},m0v:function(t,e){return t<e},F2v:function(t,e){return t<e},h5v:function(t,e){return t-e},u5v:function(t,e){return t/e},k79:function(t,e){return t<e},d0v:function(t,e,i){return t-e-i},N9v:function(t,e){return t-e},p0v:function(t,e){return t===e},q8v:function(t,e){return t-e},u4v:function(t,e){return t<e},w8v:function(t,e){return t!==e},m8v:function(t,e){return t<=e},j4v:function(t,e){return t<e},r9v:function(t,e){return t/e},w19:function(t,e){return t>e},Q49:function(t,e){return t<e},w5v:function(t,e){return t/e},O9v:function(t,e){return t/e},X0v:function(t,e){return t<=e},q49:function(t,e){return t>=e},C5v:function(t,e){return t<=e}},__customCharts_=function(t){if(1177928598!==M6x4v.m49.S49(0,9586217)&&872223271!==M6x4v.m49.S49(11,9941531)&&-770823605!==M6x4v.m49.S49(0,1536852))return context.moveTo(startX,startY),this.canvasColor("stx_line_chart"),this.activeDrawing.render(this.chart.tempCanvas.context),g5s-s5s;var e=t.CIQ;e.ChartEngine.prototype.drawHeatmap=function(t,e){function i(e,i,r,o,d){if(388178521!==M6x4v.m49.S49(0,6380171)&&-1770609222!==M6x4v.m49.S49(11,9180103)&&205471860!==M6x4v.m49.S49(0,7085020))context.dashedLineTo(last[0],last[1],x,y,pattern),chart.scroll++,context.lineTo(v2D.C9s(flr_xbase,whitespace),o1),stx.draw();else{p.beginPath(),p.fillStyle=i,p.strokeStyle=i;for(var f,m,g=M6x4v.E4v(u.layout.candleWidth,o),v=Math.floor(M6x4v.e4v(u.pixelFromBar(0,n.chart),u.layout.candleWidth)),C=0;M6x4v.u4v(C,s.length);C++){var S=s[C];if(S){S.candleWidth?(M6x4v.U4v(C,0)?v+=u.layout.candleWidth:v+=M6x4v.s4v(S.candleWidth+g/o,2),g=M6x4v.W4v(S.candleWidth,o)):v+=u.layout.candleWidth,f=M6x4v.b4v(v,g/2,d),m=v+M6x4v.S4v(g,2)-d,M6x4v.j4v(m-f,2)&&(m=f+1),u.chart.transformFunc&&S.transform&&(S=S.transform);var w=S[e];if(w){"number"==typeof w&&(w=[w]);for(var D=0;M6x4v.t4v(D,w.length);D++){var b=u.pixelFromTransformedValue(w[D],n,a);if(!c){var T=u.pixelFromTransformedValue(M6x4v.w4v(w[D],t.height),n,a);p.lineWidth=1,l=M6x4v.r2v(T,b),h=M6x4v.k2v(l,2),c=p.lineWidth}if(r){var M=b+h,k=M6x4v.h2v(b,h);p.moveTo(f,M),p.lineTo(f,k),p.lineTo(m,k),p.lineTo(m,M),p.lineTo(f,M)}else p.fillRect(f,M6x4v.y2v(b,h),M6x4v.Y2v(m,f),l)}}}}}r&&p.stroke(),p.closePath()}if(-2058641079===M6x4v.m49.S49(0,2363104)||-1882638493===M6x4v.m49.S49(11,5600130)||442192855===M6x4v.m49.S49(0,9237651)){if(!e||!e.length)return;var r=t.panel;r||(r="chart")}else context.drawImage(this.scratchContext.canvas,0,0),context.lineTo(xend,pxBottom),context.moveTo(flr_xbase,o1),gapAreas.push({start:gapStart,threshold:threshold});var n=this.panels[r];if(n){var a=t.yAxis?t.yAxis:n.yAxis,s=this.chart.dataSegment;this.getDefaultColor(),t.name||(t.name="Data"),t.widthFactor||(t.widthFactor=1);var o=.5;M6x4v.F4v(n.chart.tmpWidth,1)&&(o=0);var l=null,h=null,u=this,c=null;this.startClip(r);var p=this.chart.context;p.globalAlpha=t.opacity;for(var d=0;M6x4v.F2v(d,e.length);d++){var f=e[d];i(f.field,f.color,null,t.widthFactor,f.border_color?o:-o/4),f.border_color&&M6x4v.E2v(this.layout.candleWidth,2)&&i(f.field,f.border_color,!0,t.widthFactor,o)}p.lineWidth=1,p.globalAlpha=1,this.endClip()}},e.ChartEngine.prototype.drawCandles=function(t,i,r,n){if(1972619225===M6x4v.m49.S49(0,4984997)||1357626321===M6x4v.m49.S49(11,9780254)||1592855646===M6x4v.m49.S49(0,7394426)){var a=t.chart;a||(a=t,t=t.chart);for(var s,o,l,h=a.dataSegment,u=this.chart.context,c=t.yAxis.top,p=t.yAxis.bottom,d="transparent",f="transparent",m=0,g=M6x4v.e2v(a.dataSet.length,a.scroll,1),v=t.yAxis,y=M6x4v.i2v(a.tmpWidth,2),x=this.layout.candleWidth,C=M6x4v.c2v(t.left,.5*x,this.micropixels,1),S=0;M6x4v.W2v(S,h.length);S++){C+=M6x4v.b2v(x,2),x=this.layout.candleWidth,C+=M6x4v.v2v(x,2);var w=h[S];if(w&&!w.projection){w.candleWidth&&(C+=M6x4v.C2v(w.candleWidth-x,2),x=w.candleWidth,M6x4v.f2v(this.layout.chartType,"volume_candle")&&(y=M6x4v.K2v(x,2))),a.transformFunc&&w.transform&&(w=w.transform);var D=w.Close,b=M6x4v.D3v(w.Open,void 0)?D:w.Open;if(n&&a.defaultPlotField&&(D=w[a.defaultPlotField]),(D||!M6x4v.o3v(D,0))&&(n||!M6x4v.Z3v(b,D)&&!M6x4v.R3v(b,null))){var T=i(this,w,r?"outline":"solid");if(T){r?d=T:f=T,e.isTransparent(d)||(m=.5),u.beginPath(),u.fillStyle=f;var M=w.cache,k=g+S;if(M6x4v.O3v(k,t.cacheLeft)||M6x4v.x3v(k,t.cacheRight)||!M.open){var A=v.semiLog?this.pixelFromTransformedValue(b,t):M6x4v.z3v(v.high-b,v.multiplier)+v.top,P=v.semiLog?this.pixelFromTransformedValue(D,t):M6x4v.I3v(v.high-D,v.multiplier)+v.top;if(s=Math.floor(n?P:Math.min(A,P))+m,o=n?v.bottom:Math.max(A,P),l=Math.floor(M6x4v.l3v(o,s)),M6x4v.M3v(s,c)){if(M6x4v.g3v(s+l,c)){M.open=s,M.close=s;continue}l-=M6x4v.a3v(c,s),s=c}M6x4v.G3v(s+l,p)&&(l-=s+l-p),l=Math.max(l,2),M.open=s,M.close=M.open+l}if(!M6x4v.N3v(M.open,p)&&!M6x4v.B3v(M.close,c)){var _=Math.floor(C)+.5,F=Math.floor(M6x4v.H3v(_,y))+m,E=M6x4v.n3v(Math.round(_+y),m);M6x4v.A3v(M.open,M.close)&&(u.moveTo(F,M.open),u.lineTo(E,M.open),u.lineTo(E,M.close),u.lineTo(F,M.close),u.lineTo(F,M.open)),M6x4v.T0v(f,"transparent")&&u.fill(),m&&(u.lineWidth=1,u.strokeStyle=d,u.stroke())}}}}}}};for(var i=2,r=1;-255089966!==M6x4v.m49.N49(r.toString(),r.toString().length,6458466);r++)this.runAppend("touchstart",arguments),this.setCrosshairColors(),aggregatedData.push(newLine),i+=2;return 757378231!==M6x4v.m49.N49(i.toString(),i.toString().length,8870577)?(context.lineTo(xend,cache.open),context.stroke(),createBar(C),X72/x72):(e.ChartEngine.prototype.drawShadows=function(t,e){var i=t.chart;i||(i=t,t=t.chart);var r=i.dataSegment,n=this.chart.context;n.lineWidth=1;for(var a,s,o=t.yAxis.top,l=t.yAxis.bottom,h=M6x4v.d0v(i.dataSet.length,i.scroll,1),u=t.yAxis,c=this.layout.candleWidth,p=M6x4v.R0v(t.left,.5*c,this.micropixels,1),d=0;M6x4v.X0v(d,r.length);d++){p+=M6x4v.q0v(c,2),c=this.layout.candleWidth,p+=M6x4v.L0v(c,2);var f=r[d];if(f&&!f.projection){f.candleWidth&&(p+=M6x4v.J0v(f.candleWidth-c,2),c=f.candleWidth);var m=e(this,f,"shadow");if(m){i.transformFunc&&f.transform&&(f=f.transform);var g=f.Close,v=M6x4v.i0v(f.Open,void 0)?g:f.Open,y=M6x4v.c0v(f.High,void 0)?Math.max(g,v):f.High,x=M6x4v.p0v(f.Low,void 0)?Math.min(g,v):f.Low;if(g||!M6x4v.P0v(g,0)){var C=f.cache,S=h+d;if(M6x4v.m0v(S,t.cacheLeft)||M6x4v.S0v(S,t.cacheRight)||!C.top){a=u.semiLog?this.pixelFromTransformedValue(y,t):M6x4v.j0v(u.high-y,u.multiplier)+u.top,s=u.semiLog?this.pixelFromTransformedValue(x,t):M6x4v.t0v(u.high-x,u.multiplier)+u.top;var w=M6x4v.w0v(s,a);if(M6x4v.r5v(a,o)){if(M6x4v.k5v(a+w,o)){C.top=a,C.bottom=a;continue}w-=M6x4v.h5v(o,a),a=o}M6x4v.y5v(a+w,l)&&(w-=a+w-l),C.top=a,C.bottom=C.top+w}if(!M6x4v.Y5v(C.top,l)&&!M6x4v.F5v(C.bottom,o)){var D=Math.floor(p)+.5;if(n.beginPath(),M6x4v.E5v(g,v)){var b=this.offset;M6x4v.e5v(this.layout.chartType,"volume_candle")&&(b=M6x4v.u5v(c,2));var T=M6x4v.U5v(D,b),M=D+b,k=Math.floor(u.semiLog?this.pixelFromTransformedValue(g,t):M6x4v.s5v(u.high-g,u.multiplier)+u.top)+.5;M6x4v.W5v(k,l)&&M6x4v.b5v(k,o)&&(n.moveTo(T,k),n.lineTo(M,k))}M6x4v.v5v(y,x)&&(n.moveTo(D,C.top),n.lineTo(D,C.bottom)),n.strokeStyle=m,n.stroke()}}}}}},e.ChartEngine.prototype.drawBarChart=function(t,i,r,n){if(1159156478===M6x4v.m49.S49(0,9160597)||1712999768===M6x4v.m49.S49(11,8222122)||-262194134===M6x4v.m49.S49(0,7615104)){var a=t.chart;a||(a=t,t=t.chart);var s=a.dataSegment,o=a.context,l=this.canvasStyle(i);l.width&&M6x4v.C5v(parseInt(l.width,10),25)?o.lineWidth=Math.max(1,e.stripPX(l.width)):o.lineWidth=1;for(var h,u,c,p=t.yAxis.top,d=t.yAxis.bottom,f=M6x4v.f5v(a.dataSet.length,a.scroll,1),m=t.yAxis,g={},v=M6x4v.w5v(a.tmpWidth,2),y=M6x4v.r9v(o.lineWidth,2),x=this.layout.candleWidth,C=M6x4v.k9v(t.left,.5*x,this.micropixels,1),S=0;M6x4v.R9v(S,s.length);S++){C+=M6x4v.O9v(x,2),x=this.layout.candleWidth,C+=M6x4v.x9v(x,2);var w=s[S];if(w){if(w.projection)break;w.candleWidth&&(C+=M6x4v.z9v(w.candleWidth-x,2),x=w.candleWidth);var D=r(this,w);if(D){g[D]=1,o.strokeStyle=D,o.beginPath(),a.transformFunc&&w.transform&&(w=w.transform);var b=w.Close,T=M6x4v.I9v(w.Open,void 0)?b:w.Open,M=M6x4v.l9v(w.High,void 0)?Math.max(b,T):w.High,k=M6x4v.M9v(w.Low,void 0)?Math.min(b,T):w.Low;if(b||!M6x4v.g9v(b,0)){var A=w.cache,P=f+S;if(M6x4v.a9v(P,t.cacheLeft)||M6x4v.G9v(P,t.cacheRight)||!A.top){if(h=this.pixelFromTransformedValue(M,t),u=this.pixelFromTransformedValue(k,t),c=M6x4v.N9v(u,h),A.open=m.semiLog?this.pixelFromTransformedValue(T,t):M6x4v.B9v(m.high-T,m.multiplier)+m.top,A.close=m.semiLog?this.pixelFromTransformedValue(b,t):M6x4v.H9v(m.high-b,m.multiplier)+m.top,M6x4v.n9v(h,p)){if(M6x4v.A9v(h+c,p)){A.top=h,A.bottom=h;continue}c-=M6x4v.T8v(p,h),h=p}M6x4v.d8v(h+c,d)&&(c-=h+c-d),A.top=h,A.bottom=h+c}var _=Math.floor(C)+.5;M6x4v.Q8v(A.top,d)&&M6x4v.V8v(A.bottom,p)&&M6x4v.X8v(w.High,w.Low)&&(o.moveTo(_,M6x4v.q8v(A.top,y)),o.lineTo(_,A.bottom+y)),M6x4v.L8v(n.type,"hlc")&&M6x4v.J8v(A.open,p)&&M6x4v.i8v(A.open,d)&&(o.moveTo(_,A.open),o.lineTo(M6x4v.c8v(_,v),A.open)),M6x4v.p8v(A.close,p)&&M6x4v.P8v(A.close,d)&&(o.moveTo(_,A.close),o.lineTo(_+v,A.close)),o.stroke()}}}}return o.lineWidth=1,g}},e.ChartEngine.prototype.drawWaveChart=function(t){var i=t.chart,r=i.dataSegment,n=this.chart.context;this.startClip(t.name),n.beginPath();for(var a=!1,s=!1,o=t.yAxis.top,l=t.yAxis.bottom,h=t.left+Math.floor(-.5*this.layout.candleWidth+this.micropixels),u=0;M6x4v.m8v(u,r.length);u++){h+=this.layout.candleWidth;var c=r[u];if(c){if(c.projection)break;i.transformFunc&&c.transform&&(c=c.transform);var p=c.Close,d=M6x4v.S8v(c.Open,void 0)?p:c.Open,f=M6x4v.j8v(c.High,void 0)?Math.max(p,d):c.High,m=M6x4v.t8v(c.Low,void 0)?Math.min(p,d):c.Low;if(p||!M6x4v.w8v(p,0)){var g=M6x4v.r19(h,3*this.layout.candleWidth/8),v=this.pixelFromTransformedValue(d,t);if(M6x4v.k19(v,o)){if(v=o,s){n.moveTo(g,v);continue}s=!0}else if(M6x4v.h19(v,l)){if(v=l,s){n.moveTo(g,v);continue}s=!0}else s=!1;if(a)n.lineTo(g,v);else{a=!0;var y=M6x4v.y19(i.dataSet.length,i.scroll,1);if(M6x4v.X19(y,0))n.moveTo(g,v);else if(M6x4v.q19(y,0)){var x=i.dataSet[y];x.transform&&(x=x.transform);var C=x.Close;C=t.yAxis.semiLog?this.pixelFromTransformedValue(C,t):M6x4v.L19(t.yAxis.high-C,t.yAxis.multiplier)+o,C=Math.min(Math.max(C,o),l),n.moveTo(t.left+M6x4v.J19(u-1,this.layout.candleWidth)+this.micropixels,C),n.lineTo(g,v)}n.moveTo(g,v)}g+=M6x4v.i19(this.layout.candleWidth,4),M6x4v.c19(d,p)?(v=this.pixelFromTransformedValue(m,t),M6x4v.p19(v,o)&&(v=o),M6x4v.P19(v,l)&&(v=l),n.lineTo(g,v),g+=M6x4v.m19(this.layout.candleWidth,4),v=this.pixelFromTransformedValue(f,t),M6x4v.S19(v,o)&&(v=o),M6x4v.j19(v,l)&&(v=l),n.lineTo(g,v)):(v=this.pixelFromTransformedValue(f,t),M6x4v.t19(v,o)&&(v=o),M6x4v.w19(v,l)&&(v=l),n.lineTo(g,v),g+=M6x4v.r79(this.layout.candleWidth,4),v=this.pixelFromTransformedValue(m,t),M6x4v.k79(v,o)&&(v=o),M6x4v.h79(v,l)&&(v=l),n.lineTo(g,v)),g+=M6x4v.y79(this.layout.candleWidth,4),v=this.pixelFromTransformedValue(p,t),M6x4v.Y79(v,o)&&(v=o),M6x4v.F79(v,l)&&(v=l),n.lineTo(g,v)}}}var S=this.canvasStyle("stx_line_chart");S.width&&M6x4v.E79(parseInt(S.width,10),25)?n.lineWidth=Math.max(1,e.stripPX(S.width)):n.lineWidth=1,this.canvasColor("stx_line_chart"),n.stroke(),n.closePath(),this.endClip(),n.lineWidth=1},e.ChartEngine.prototype.scatter=function(t){if(-149518060!==M6x4v.m49.S49(0,6617577)&&1195530060!==M6x4v.m49.S49(11,9836372)&&222439376!==M6x4v.m49.S49(0,4306645))return context.moveTo(flr_xbase,v2D.W9s(pxTop,voffset)),context.fill(),context.moveTo(xx,M6x4v.q8v(cache.top,voffset)),a19<W19;var e=t.chart,i=e.dataSegment,r=this.chart.context;r.beginPath(),r.lineWidth=4;for(var n=t.yAxis.top,a=t.yAxis.bottom,s=M6x4v.e79(t.left,.5*this.layout.candleWidth,this.micropixels,1),o=0;M6x4v.M79(o,i.length);o++){s+=this.layout.candleWidth;var l=i[o];if(l&&!l.projection){e.transformFunc&&l.transform&&(l=l.transform);var h=[l[e.defaultPlotField]];M6x4v.g79("Scatter",l)&&(h=l.Scatter);for(var u=0;M6x4v.a79(u,h.length);u++)if(h[u]||!M6x4v.G79(h[u],0)){var c=this.pixelFromTransformedValue(h[u],t);M6x4v.N79(c,n)||M6x4v.B79(c,a)||(r.moveTo(M6x4v.H79(s,2),c),r.lineTo(s+2,c))}}}this.canvasColor("stx_scatter_chart"),r.stroke(),r.closePath(),r.lineWidth=1},e.ChartEngine.prototype.drawHLCBox=function(t){var i=t.shaded,r=t.panel,n=t.fillColor,a=t.borderColor,s=t.shadeColor,o=t.widthFactor;"string"==typeof r&&(r=this.panels[r]);var l=r.chart,h=l.dataSegment,u=l.context,c=r.yAxis.top,p=r.yAxis.bottom,d=!0,f=t.close,m=t.high,g=t.low;f||(f="Close"),m||(m="High"),g||(g="Low"),M6x4v.n79(t.clip,!1)&&(d=!1),d&&this.startClip(r.name);var v=0;(e.isTransparent(n)||M6x4v.A79(n,"auto"))&&(a||(a=this.defaultColor),n=this.containerColor),a&&!e.isTransparent(a)&&(v=.5),u.fillStyle=n;var y=[];M6x4v.T69(l.dataSet.length,l.scroll,1);u.beginPath();for(var x=r.yAxis,C=this.layout.candleWidth,S=M6x4v.Z69(r.left,.5*C,this.micropixels,1),w=M6x4v.V69(o?C*o:l.tmpWidth,2),D=(M6x4v.X69(u.lineWidth,2),0);M6x4v.q69(D,h.length);D++){S+=M6x4v.L69(C,2),C=this.layout.candleWidth,S+=M6x4v.J69(C,2);var b=h[D];if(b&&!b.projection){b.candleWidth&&(S+=M6x4v.i69(b.candleWidth-C,2),C=b.candleWidth,M6x4v.c69(this.layout.chartType,"volume_candle")&&(w=M6x4v.p69(C,o||1,2))),M6x4v.G69(r,l.panel)&&l.transformFunc&&b.transform&&(b=b.transform);var T=b[f],M=M6x4v.N69(b[m],void 0)?T:b[m],k=M6x4v.B69(b[g],void 0)?T:b[g],A=x.semiLog?this.pixelFromTransformedValue(M,r):M6x4v.H69(x.high-M,x.multiplier)+x.top,P=x.semiLog?this.pixelFromTransformedValue(k,r):M6x4v.n69(x.high-k,x.multiplier)+x.top,_=x.semiLog?this.pixelFromTransformedValue(T,r):M6x4v.A69(x.high-T,x.multiplier)+x.top,F=Math.floor(A)+v,E=P,L=_,N=Math.floor(M6x4v.T49(E,F));if(M6x4v.d49(F,c)){if(M6x4v.Q49(F+N,c))continue;N-=M6x4v.V49(c,F),F=c}if(M6x4v.X49(F+N,p)&&(N-=F+N-p),N=Math.max(N,2),E=F+N,!M6x4v.q49(F,p)&&!M6x4v.L49(E,c)){var O=Math.floor(S)+.5,I=Math.floor(M6x4v.J49(O,w))+v,H=M6x4v.i49(Math.round(O+w),v);M6x4v.c49(F,E)&&(u.moveTo(I,F),u.lineTo(H,F),u.lineTo(H,E),u.lineTo(I,E),u.lineTo(I,F),y.push({left:I,right:H,top:L,bottom:E}))}}}if(u.fill(),v&&(u.lineWidth=1,u.strokeStyle=a,u.stroke()),s&&!e.isTransparent(s)){u.beginPath(),M6x4v.p49(s,"auto")&&(s=this.defaultColor),u.fillStyle=u.strokeStyle=s;for(var z=0;M6x4v.P49(z,y.length);z++){var R=y[z];u.moveTo(R.left,R.top),u.lineTo(R.right,R.top),i&&(u.lineTo(R.right,R.bottom),u.lineTo(R.left,R.bottom),u.lineTo(R.left,R.top))}u[i?"fill":"stroke"]()}d&&this.endClip()},t)},P0r1k={t1k:function(t,e){return t>e},P0k:function(t,e){return t!=e},o9k:function(t,e){return t/e},Z3k:function(t,e){return t===e},G7v:function(t,e){return t>=e},y5k:function(t,e){return t-e},L0k:function(t,e){return t!==e},i4k:function(t,e){return t!==e},A6k:function(t,e){return t<e},X0k:function(t,e){return t===e},w4k:function(t,e){return t>e},N3k:function(t,e){return t<e},a3k:function(t,e){return t-e},W2k:function(t,e){return t<e},A3k:function(t,e){return t<e},l3k:function(t,e){return t<e},p0k:function(t,e){return t-e},R7v:function(t,e){return t==e},p1k:function(t,e){return t*e},a9k:function(t,e){return t-e},z9k:function(t,e){return t<e},c0k:function(t,e){return t-e},K2k:function(t,e){return t>e},j8k:function(t,e){return t<e},s2k:function(t,e){return t>e},d6v:function(t,e){return t==e},D7v:function(t,e){return t==e},I7v:function(t,e){return t>=e},D9k:function(t,e){return t!==e},p8k:function(t,e){return t<e},j1k:function(t,e){return t!=e},r1v:function(t,e){return t<e},B7v:function(t,e){return t==e},j4k:function(t,e){return t===e},T1k:function(t,e){return t<=e},T8k:function(t,e){return t!==e},P4k:function(t,e){return t-e},x3k:function(t,e){return t>e},T4k:function(t,e){return t-e},h1v:function(t,e){return t<e},a7v:function(t,e){return t==e},U1v:function(t,e){return t<=e},H7v:function(t,e){return t==e},g3k:function(t,e){return t<=e},q6v:function(t,e){return t==e},l6k:function(t,e){return t/e},n9k:function(t,e){return t===e},c1k:function(t,e){return t*e},z7v:function(t,e){return t==e},v2k:function(t,e){return t<e},V7k:function(t,e,i,r){return t-e+i+r},E5k:function(t,e){return t>e},H6k:function(t,e){return t==e},U5k:function(t,e){return t<e},n3k:function(t,e){return t>=e},r2k:function(t,e){return t>e},P1k:function(t,e){return t>=e},C1v:function(t,e){return t===e},J0k:function(t,e){return t/e},Q4k:function(t,e){return t===e},e1v:function(t,e){return t>e},k1v:function(t,e){return t<e},C2k:function(t,e){return t<=e},z3k:function(t,e){return t>e},O3k:function(t,e){return t===e},C7k:function(t,e){return t<=e},n7v:function(t,e){return t<=e},B6k:function(t,e){return t>=e},N6k:function(t,e){return t==e},P8k:function(t,e){return t<e},f5k:function(t,e){return t===e},f1v:function(t,e){return t*e},G3k:function(t,e){return t<=e},u5k:function(t,e){return t>e},c4k:function(t,e){return t<=e},h5k:function(t,e){return t>=e},s5k:function(t,e){return t-e},L6v:function(t){var e={},i=function(t,e){var i=65535&e;return((e-i)*t|0)+(i*t|0)|0},r=function(){}.constructor(new t('tgvwtp"fqewogpv0fqockp=').H6v(2))(),n=function(t,r,n){if(void 0!==e[n])return e[n];for(var a=3432918353,s=461845907,o=n,l=-4&r,h=0;h<l;h+=4){var u=255&t.charCodeAt(h)|(255&t.charCodeAt(h+1))<<8|(255&t.charCodeAt(h+2))<<16|(255&t.charCodeAt(h+3))<<24;u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u,o=(524287&o)<<13|o>>>19,o=5*o+3864292196|0}switch(u=0,r%4){case 3:u=(255&t.charCodeAt(l+2))<<16;case 2:u|=(255&t.charCodeAt(l+1))<<8;case 1:u|=255&t.charCodeAt(l),u=i(u,a),u=(131071&u)<<15|u>>>17,u=i(u,s),o^=u}return o^=r,o^=o>>>16,o=i(o,2246822507),o^=o>>>13,o=i(o,3266489909),o^=o>>>16,e[n]=o,o};return{l6v:i,I6v:n,J6v:function(t,e,i){var a,s;return i>0?(a=r.substring(t,i),s=a.length,n(a,s,e)):null===t||t<=0?(a=r.substring(0,r.length),s=a.length,n(a,s,e)):(a=r.substring(r.length-t,r.length),s=a.length,n(a,s,e))}}}(function(t){this.f6v=t,this.H6v=function(e){for(var i=new String,r=0;r<t.length;r++)i+=String.fromCharCode(t.charCodeAt(r)-e);return i}}),Z7v:function(t,e){return t-e},Q6v:function(t,e){return t==e},I7k:function(t,e){return t-e},z6k:function(t,e){return t*e},J4k:function(t,e){return t/e},o7v:function(t,e){return t-e},i1k:function(t,e){return t*e},b2k:function(t,e){return t<e},V4k:function(t,e){return t===e},x9k:function(t,e){return t-e},m8k:function(t,e){return t<e},d8k:function(t,e){return t*e},w1k:function(t,e){return t>e},F7k:function(t,e,i,r){return t-e+i+r},O1k:function(t,e,i,r){return t-e+i-r},u1v:function(t,e){return t>e},l7k:function(t,e,i){return t-e+i},s1v:function(t,e){return t!==e},D3k:function(t,e){return t<e},l7v:function(t,e){return t*e},I9k:function(t,e){return t>=e},v7k:function(t,e){return t/e},S8k:function(t,e){return t<e},M3k:function(t,e){return t>e},y2k:function(t,e){return t<e},A9k:function(t,e){return t===e},U7k:function(t,e){return t/e},T6v:function(t,e){return t*e},f7k:function(t,e,i){return t-e-i},y1v:function(t,e){return t<e},k7k:function(t,e,i){return t-e+i},Q0k:function(t,e){return t-e},O9k:function(t,e){return t<e},Y2k:function(t,e){return t<e},f2k:function(t,e){return t!==e},B9k:function(t,e){return t!==e},X8k:function(t,e){return t!=e},g6k:function(t,e){return t==e},k6k:function(t,e,i,r){return t-e+i-r},j0k:function(t,e){return t===e},K5k:function(t,e){return t<e},L8k:function(t,e){return t!==e},J8k:function(t,e){return t!==e},X4k:function(t,e){return t===e},x7v:function(t,e){return t*e},v1v:function(t,e){return t===e},r6k:function(t,e){return t/e},d4k:function(t,e){return t-e},N9k:function(t,e){return t===e},q4k:function(t,e){return t===e},e5k:function(t,e){return t-e},q1k:function(t,e){return t<=e},U2k:function(t,e){return t>e},c8k:function(t,e){return t<e},m1k:function(t,e){return t<e},E1v:function(t,e){return t!==e},N7v:function(t,e){return t*e},g9k:function(t,e){return t<e},H9k:function(t,e){return t===e},K1v:function(t,e){return t*e},J1k:function(t,e){return t>e},S1k:function(t,e){return t<e},R3k:function(t,e){return t===e},d1k:function(t,e){return t<=e},M7v:function(t,e){return t==e},l9k:function(t,e){return t>e},x6k:function(t,e){return t>e},Q1k:function(t,e,i){return t-e-i},T0k:function(t,e){return t!==e},w0k:function(t,e){return t-e},G9k:function(t,e){return t-e},d0k:function(t,e){return t-e},G6k:function(t,e){return t==e},R6k:function(t,e){return t<e},t8k:function(t,e){return t<e},L4k:function(t,e){return t/e},W5k:function(t,e){return t-e},b7k:function(t,e){return t-e},A7v:function(t,e){return t-e},m0k:function(t,e){return t!==e},q0k:function(t,e){return t<=e},F1v:function(t,e){return t<=e},O7v:function(t,e){return t<=e},F5k:function(t,e){return t<e},h2k:function(t,e){return t<e},Q7k:function(t,e){return t-e},M9k:function(t,e){return t-e},C5k:function(t,e){return t/e},a6k:function(t,e){return t-e},O6k:function(t,e){return t<e},u2k:function(t,e){return t-e},r7k:function(t,e){return t<e},k5k:function(t,e){return t*e},b5k:function(t,e){return t-e},M6k:function(t,e){return t==e},p4k:function(t,e){return t!==e},R9k:function(t,e){return t!==e},Z9k:function(t,e){return t!==e},e2k:function(t,e){return t!==e},r5k:function(t,e){return t<=e},V6v:function(t,e){return t==e},S0k:function(t,e){return t<e},F2k:function(t,e){return t<e},W1v:function(t,e){return t<e},w7k:function(t,e){return t*e},b1v:function(t,e){return t===e},t4k:function(t,e){return t>e},g7v:function(t,e){return t==e},n6k:function(t,e){return t==e},V8k:function(t,e){return t==e},q8k:function(t,e){return t-e},B3k:function(t,e){return t<=e},s7k:function(t,e){return t/e},E2k:function(t,e){return t<e},w8k:function(t,e){return t<e},Y5k:function(t,e){return t-e},L1k:function(t,e){return t<e},Y1v:function(t,e){return t<e},W7k:function(t,e){return t-e},V0k:function(t,e){return t/e},I3k:function(t,e){return t<e},m4k:function(t,e){return t<e},Q8k:function(t,e){return t<e},t0k:function(t,e){return t*e},v5k:function(t,e){return t-e},X6v:function(t,e){return t!=e},H3k:function(t,e){return t-e},S4k:function(t,e){return t-e},I6k:function(t,e){return t*e},i0k:function(t,e){return t!==e},o3k:function(t,e){return t-e},i8k:function(t,e){return t-e},k2k:function(t,e){return t<e}},__aggregations_=function(t){if(-2124392348===P0r1k.L6v.J6v(0,6092192)||-269647862===P0r1k.L6v.J6v(11,3905791)||-1634039953===P0r1k.L6v.J6v(0,2820996)){var e=t.CIQ;return e.ChartEngine.prototype.drawKagiSquareWave=function(t,i,r){if(1448679905!==P0r1k.L6v.J6v(0,6074010)&&897128724!==P0r1k.L6v.J6v(11,9541219)&&-2047057587!==P0r1k.L6v.J6v(0,3437824))return context.lineTo(extendX,extendY),context.lineTo(point.right,point.top),context.moveTo(last[0],last[1]),v9v-S9v;var n=t.chart;this.startClip(t.name);var a=n.dataSegment,s=n.context,o=this.canvasStyle(i),l=this.canvasStyle(r);this.canvasColor(i);var h=s.strokeStyle;this.canvasColor(r);var u=s.strokeStyle,c=1;o.width&&P0r1k.T1k(parseInt(o.width,10),25)&&(c=Math.max(1,e.stripPX(o.width)));var p=1;l.width&&P0r1k.d1k(parseInt(l.width,10),25)&&(p=Math.max(1,e.stripPX(l.width))),s.beginPath();for(var d=P0r1k.Q1k(n.dataSet.length,n.scroll,1),f=t.yAxis,m=!0,g=null,v=null,y=P0r1k.O1k(t.left,.5*this.layout.candleWidth,this.micropixels,1),x=0;P0r1k.q1k(x,a.length);x++){y+=this.layout.candleWidth;var C=a[x];if(C){if(C.projection)break;if(v=C.kagiTrend,C.transform&&n.transformFunc){var S=C.kagiPrevOpen;C=C.transform,C.kagiPrevOpen=n.transformFunc(this,n,S)}var w=C.cache,D=d+x;(P0r1k.L1k(D,t.cacheLeft)||P0r1k.J1k(D,t.cacheRight)||!w.open)&&(w.open=f.semiLog?this.pixelFromTransformedValue(C.Open,t):P0r1k.i1k(f.high-C.Open,f.multiplier)+f.top,w.close=f.semiLog?this.pixelFromTransformedValue(C.Close,t):P0r1k.c1k(f.high-C.Close,f.multiplier)+f.top),g=f.semiLog?this.pixelFromTransformedValue(C.kagiPrevOpen,t):P0r1k.p1k(f.high-C.kagiPrevOpen,f.multiplier)+f.top,w.close,m&&(s.moveTo(P0r1k.P1k(d,0)?t.left:Math.floor(y),w.open),s.lineTo(Math.floor(y),w.open),m=!1),-1!=v&&P0r1k.m1k(w.close,g)&&P0r1k.S1k(g,w.open)?(s.lineTo(Math.floor(y),g),m||(s.stroke(),s.beginPath(),s.moveTo(Math.floor(y),g)),s.strokeStyle=h,s.lineWidth=c):P0r1k.j1k(v,1)&&P0r1k.t1k(w.close,g)&&P0r1k.w1k(g,w.open)&&(s.lineTo(Math.floor(y),g),m||(s.stroke(),s.beginPath(),s.moveTo(Math.floor(y),g)),s.strokeStyle=u,s.lineWidth=p),s.lineTo(Math.floor(y),w.close),P0r1k.r7k(x+1,a.length)&&s.lineTo(Math.floor(y+this.layout.candleWidth),w.close),m=!1}}s.stroke(),this.endClip(),s.lineWidth=1},e.ChartEngine.prototype.drawPointFigureChart=function(t,i,r){function n(t,e,i){if(1815690363!==P0r1k.L6v.J6v(0,3397635)&&-861229028!==P0r1k.L6v.J6v(11,8054007)&&1083813754!==P0r1k.L6v.J6v(0,2926101))return context.setLineDash(pattern),context.dashedLineTo(last1[0],last1[1],endX,last1[1],pattern),N1k<v1k;l.moveTo(t+m,P0r1k.k7k(i,f,D)),l.lineTo(P0r1k.Q7k(e,g),P0r1k.V7k(i,w,d,D)),l.moveTo(t+m,P0r1k.F7k(i,w,d,D)),l.lineTo(P0r1k.I7k(e,g),P0r1k.l7k(i,f,D))}function a(t,e,i){l.moveTo(P0r1k.U7k(t+e,2),i+d-D),l.bezierCurveTo(e+g,i+d-D,e+g,i+w-f-D,P0r1k.s7k(t+e,2),i+w-f-D),l.bezierCurveTo(P0r1k.W7k(t,m),i+w-f-D,P0r1k.b7k(t,m),i+d-D,P0r1k.v7k(t+e,2),i+d-D)}if(931176769!==P0r1k.L6v.J6v(0,2350417)&&-1303067796!==P0r1k.L6v.J6v(11,3102960)&&1477830610!==P0r1k.L6v.J6v(0,9240387))return d79<Z79;var s=t.chart;this.startClip(t.name);var o=s.dataSegment,l=s.context;this.canvasColor(i);for(var h=this.canvasStyle(i),u=2,c=1;1219598493!==P0r1k.L6v.I6v(c.toString(),c.toString().length,9923584);c++)this.runAppend("consolidatedQuote",arguments),l.lineTo(x1,top),this.transformDataSetPre(this,tmpHist),u+=2;1186143609!==P0r1k.L6v.I6v(u.toString(),u.toString().length,1983634)&&(points.push(M,yLast),this.createYAxis(t,params),p--,processMove(q,H),labelDate.setSeconds(boundaryTimeUnit));var d=parseInt(h.paddingTop,10),f=parseInt(h.paddingBottom,10),m=parseInt(h.paddingLeft,10),g=parseInt(h.paddingRight,10);h.width&&P0r1k.C7k(parseInt(h.width,10),25)?l.lineWidth=Math.max(1,e.stripPX(h.width)):l.lineWidth=2,l.beginPath();for(var v,y,x=this.chart.state.aggregation.box,C=P0r1k.f7k(s.dataSet.length,s.scroll,1),S=t.yAxis,w=P0r1k.w7k(x,S.multiplier),D=P0r1k.r6k(w,2),b=this.layout.candleWidth,T=P0r1k.k6k(t.left,b,this.micropixels,1),M=0;P0r1k.R6k(M,o.length);M++){T+=b;var k=o[M];if(k){if(k.projection)break;var A=k.pfOpen,P=k.pfClose,_=k.pfTrend,F=k.pfStepBack;k.transform&&s.transformFunc&&(k=k.transform,A=s.transformFunc(this,s,A),P=s.transformFunc(this,s,P));var E=k.cache,L=C+M;(P0r1k.O6k(L,t.cacheLeft)||P0r1k.x6k(L,t.cacheRight)||!E.open)&&(E.open=P0r1k.z6k(S.high-A,S.multiplier)+S.top,E.close=P0r1k.I6k(S.high-P,S.multiplier)+S.top);var N=Math.round(T),O=Math.round(T+b);if(v=Math.abs(Math.round(P0r1k.l6k(P-A,x))),y=E.open,P0r1k.M6k(r,F)&&(P0r1k.g6k(F,"X")?n(N,O,P0r1k.a6k(y,w)):P0r1k.G6k(F,"O")&&a(N,O,y+w)),P0r1k.N6k(r,_))for(;P0r1k.B6k(v,0);v--)P0r1k.H6k(r,"X")?(n(N,O,y),y-=w):P0r1k.n6k(r,"O")&&(a(N,O,y),y+=w)}}l.stroke(),this.endClip(),l.lineWidth=1},e.calculateHeikinAshi=function(t,e,i){if(!e.length)return e;for(var r=2,n=1;1342628800!==P0r1k.L6v.I6v(n.toString(),n.toString().length,2648221);n++)context.moveTo(left+paddingLeft,P0r1k.F7k(start,height,paddingTop,voffset)),context.fillText(obj.text,obj.hz,middle),a.push(g),r+=2;if(-880513974!==P0r1k.L6v.I6v(r.toString(),r.toString().length,4219030))return this.setPeriodicity({period:this.grabEndPeriodicity,interval:this.layout.interval}),this.calculateOHLC4(chart,newScrubbed),p8===a8;i||(i=[]);for(var a=[],s=0;P0r1k.A6k(s,e.length);s++){var o=e[s];if(o){var l=a[P0r1k.T4k(a.length,1)];l||s||(l=i[P0r1k.d4k(i.length,1)]),l||(l=o);var h=o.Close,u=o.Open,c=o.High,p=o.Low,d=l.Open;u=u||P0r1k.Q4k(u,0)?u:h,c=c||P0r1k.V4k(c,0)?c:h,p=p||P0r1k.X4k(p,0)?p:h,d=d||P0r1k.q4k(d,0)?d:l.Close;var f=P0r1k.L4k(d+l.Close,2),m=P0r1k.J4k(u+c+p+h,4),g={DT:o.DT,displayDate:o.displayDate,Date:o.Date,Open:f,Close:m,High:Math.max(c,Math.max(f,m)),Low:Math.min(p,Math.min(f,m)),Volume:o.Volume,iqPrevClose:l.Close};for(var v in o)!g[v]&&P0r1k.i4k(g[v],0)&&(g[v]=o[v]);a.push(g)}}return a},e.calculateKagi=function(t,i,r,n){if(!i.length)return i;n||(n=[]);var a=t.layout;r=parseFloat(r),t.chart.defaultChartStyleConfig.kagi=e.ChartEngine.isDailyInterval(a.interval)?4:.4,(isNaN(r)||P0r1k.c4k(r,0))&&(r=t.chart.defaultChartStyleConfig.kagi,e.Market.Symbology.isForexSymbol(t.chart.symbol)&&(r/=4),P0r1k.p4k(a.kagi,null)&&(a.kagi=null,t.changeOccurred("layout"))),r/=100;for(var s=[],o=n[P0r1k.P4k(n.length,1)],l=o?o.DT:0,h=0;P0r1k.m4k(h,i.length);h++){var u=i[h];if(u&&(o||(o=i[P0r1k.S4k(h,1)]),o)){
var c=o.Open||P0r1k.j4k(o.Open,0)?o.Open:o.Close;if(P0r1k.t4k(c,o.Close)){if(P0r1k.w4k(u.Close,o.Close*(1+r)))u.Open=o.Close;else if(P0r1k.r2k(o.Close,u.Close)&&(o.Close=u.Close),o.Volume+=u.Volume,P0r1k.k2k(h,i.length-1))continue}else if(P0r1k.h2k(c,o.Close)){if(P0r1k.y2k(u.Close,o.Close*(1-r)))u.Open=o.Close;else if(P0r1k.Y2k(o.Close,u.Close)&&(o.Close=u.Close),o.Volume+=u.Volume,P0r1k.F2k(h,i.length-1))continue}else if(o.Close=u.Close,o.Volume+=u.Volume,P0r1k.E2k(h,i.length-1))continue;var p={DT:o.DT,displayDate:o.displayDate,Date:o.Date,Open:o.Open,Close:o.Close,High:Math.max(o.Open,o.Close),Low:Math.min(o.Open,o.Close),Volume:o.Volume,iqPrevClose:o.iqPrevClose};for(var d in u)!p[d]&&P0r1k.e2k(p[d],0)&&(p[d]=u[d]);s.length?p.kagiPrevOpen=s[P0r1k.u2k(s.length,1)].Open:p.kagiPrevOpen=p.Open,P0r1k.U2k(p.Close,p.kagiPrevOpen)&&P0r1k.s2k(p.kagiPrevOpen,p.Open)?p.kagiTrend=1:P0r1k.W2k(p.Close,p.kagiPrevOpen)&&P0r1k.b2k(p.kagiPrevOpen,p.Open)&&(p.kagiTrend=-1),P0r1k.v2k(l,p.DT)&&s.push(p),o=u,t.chart.currentQuote={Close:u.Close}}}return s},e.calculateLineBreak=function(t,e,i,r){if(!e.length)return e;r||(r=[]);var n=t.layout;t.chart.defaultChartStyleConfig.priceLines=3,i=parseInt(i,10),isNaN(i)||P0r1k.C2k(i,0)?(i=t.chart.defaultChartStyleConfig.priceLines,P0r1k.f2k(n.priceLines,null)&&(n.priceLines=null,t.changeOccurred("layout"))):P0r1k.K2k(i,10)&&(n.priceLines=i=10);var a=r.slice(-i),s=a.length,o=0;t:for(var l=0;P0r1k.D3k(l,e.length);l++){var h=e[l];if(h){o+=h.Volume;var u=a[P0r1k.o3k(a.length,1)];u||(u={Open:h.Open,Close:h.Open,High:h.Open,Low:h.Open});var c=u.Close,p=u.High,d=u.Low,f=u.Open;p=p||P0r1k.Z3k(p,0)?p:c,d=d||P0r1k.R3k(d,0)?d:c,f=f||P0r1k.O3k(f,0)?f:c;var m={DT:h.DT,displayDate:h.displayDate,Date:h.Date,Close:h.Close,Volume:o,iqPrevClose:c};t.chart.currentQuote={Close:h.Close};var g,v;if(P0r1k.x3k(h.Close,c)&&P0r1k.z3k(u.Close,f));else if(P0r1k.I3k(h.Close,c)&&P0r1k.l3k(u.Close,f));else if(P0r1k.M3k(h.Close,p)){for(g=2;P0r1k.g3k(g,i);g++)if((v=a[P0r1k.a3k(a.length,g)])&&P0r1k.G3k(h.Close,v.High))continue t}else{if(!P0r1k.N3k(h.Close,d))continue;for(g=2;P0r1k.B3k(g,i);g++)if((v=a[P0r1k.H3k(a.length,g)])&&P0r1k.n3k(h.Close,v.Low))continue t}P0r1k.A3k(h.Close,u.Close)?m.Open=Math.min(f,c):m.Open=Math.max(f,c),m.Low=Math.min(m.Open,m.Close),m.High=Math.max(m.Open,m.Close);for(var y in h)!m[y]&&P0r1k.T0k(m[y],0)&&(m[y]=h[y]);a.push(m),o=0}}return a.slice(s)},e.calculateRenkoBars=function(t,e,i,r){function n(t,e){var i={DT:d.DT,displayDate:d.displayDate,Date:d.Date,Open:t,Close:e,High:Math.max(t,e),Low:Math.min(t,e),Volume:0,iqPrevClose:P0r1k.P0k(t,e)?t:null};for(var r in g)!i[r]&&P0r1k.m0k(i[r],0)&&(i[r]=g[r]);u.push(i)}if(!e.length)return[];r||(r=[]);var a=t.layout,s=t.chart.state.aggregation;s||(s=t.chart.state.aggregation={});var o=Math.min(300,e.length);s.minMax||(s.minMax=t.determineMinMax(e.slice(P0r1k.d0k(e.length,o)),["Close","High","Low"]));var l=P0r1k.Q0k(s.minMax[1],s.minMax[0]),h=t.panels[t.chart.name].height;if(!h)return[];t.chart.defaultChartStyleConfig.renko=P0r1k.V0k(Math.floor(1e4*l/(h/30)),1e4),P0r1k.X0k(i,null)||isNaN(i)||P0r1k.q0k(i,0)?(i=t.chart.defaultChartStyleConfig.renko,P0r1k.L0k(a.renko,null)&&(a.renko=null,t.changeOccurred("layout"))):(i=Math.max(i,P0r1k.J0k(l,h)),P0r1k.i0k(a.renko,i)&&(a.renko=i,t.changeOccurred("layout")));var u=[],c=null,p=null,d=null;if(r.length){var f=r[P0r1k.c0k(r.length,1)];c=P0r1k.p0k(f.Low,i),p=f.High+i}for(var m=0;P0r1k.S0k(m,e.length);m++){var g=e[m];if(g){if(!c&&!p){var v=g.Open||P0r1k.j0k(g.Open,0)?g.Open:g.Close,y=P0r1k.t0k(Math.floor(v/i),i),x=isNaN(y)?v:y;c=P0r1k.w0k(x,i),p=x+i}for(;;)if(d||(d=g),P0r1k.r5k(g.Close,c))n(c+i,c),p=c+P0r1k.k5k(2,i),c-=i,d=null;else{if(!P0r1k.h5k(g.Close,p))break;n(P0r1k.y5k(p,i),p),c=P0r1k.Y5k(p,2*i),p+=i,d=null}t.chart.currentQuote=g}}return P0r1k.F5k(c,e[e.length-1].Close)&&P0r1k.E5k(c+i,e[e.length-1].Close)?n(c+i,e[P0r1k.e5k(e.length,1)].Close):P0r1k.u5k(p,e[e.length-1].Close)&&P0r1k.U5k(p-i,e[e.length-1].Close)&&n(P0r1k.s5k(p,i),e[P0r1k.W5k(e.length,1)].Close),u},e.calculateRangeBars=function(t,e,i,r){function n(t){var e={DT:v.DT,displayDate:v.displayDate,Date:v.Date,Open:g,Close:t,High:f,Low:m,Volume:0,iqPrevClose:g};for(var i in x)!e[i]&&P0r1k.R9k(e[i],0)&&(e[i]=x[i]);p.push(e)}function a(t,e){if(1230277349!==P0r1k.L6v.J6v(0,7424194)&&-1114729874!==P0r1k.L6v.J6v(11,2597162)&&516344788!==P0r1k.L6v.J6v(0,6530285))return labelDate.setHours(boundaryTimeUnit),this.clearPixelCache(),sd.study.calculateFN(this,sd),yAxisPlotter.newSeries("grid","stroke",this.canvasStyle("stx_grid")),M19/U19;for(var r=2,a=1;-1336317885!==P0r1k.L6v.I6v(a.toString(),a.toString().length,7071576);a++)s(),r+=2;if(-874209836!==P0r1k.L6v.I6v(r.toString(),r.toString().length,2156485))return O4s<=Y4s;for(;;){if(v||(v=t),P0r1k.O9k(d,e)){if(d=Math.min(e,f),m=Math.max(m,P0r1k.x9k(d,i)),P0r1k.z9k(e,f))break}else if(P0r1k.I9k(d,e)&&(d=Math.max(e,m),f=Math.min(f,d+i),P0r1k.l9k(e,m)))break;if(void 0===d)return void console.log("Uh oh undefined in calculateRangeBars:processMove");n(d),v=null,s()}}function s(){f=d+i,m=P0r1k.M9k(d,i),g=d}if(!e.length)return e;r||(r=[]);var o=t.layout,l=t.chart.state.aggregation;l||(l=t.chart.state.aggregation={});var h=Math.min(300,e.length);l.minMax||(l.minMax=t.determineMinMax(e.slice(P0r1k.b5k(e.length,h)),["Close","High","Low"]));var u=P0r1k.v5k(l.minMax[1],l.minMax[0]),c=t.panels[t.chart.name].height;if(!c)return[];t.chart.defaultChartStyleConfig.range=P0r1k.C5k(Math.floor(1e4*u/(c/30)),1e4),P0r1k.f5k(i,null)||isNaN(i)||P0r1k.K5k(i,0)?(i=t.chart.defaultChartStyleConfig.range,P0r1k.D9k(o.range,null)&&(o.range=null,t.changeOccurred("layout"))):(i=Math.max(i,P0r1k.o9k(u,c)),P0r1k.Z9k(o.range,i)&&(o.range=i,t.changeOccurred("layout")));for(var p=[],d=null,f=null,m=null,g=null,v=null,y=0;P0r1k.g9k(y,e.length);y++){var x=e[y];if(x){var C=e[P0r1k.a9k(y,1)];if(y||(C||(C=r[P0r1k.G9k(r.length,1)]),C&&((d=C.Close)||P0r1k.N9k(d,0))&&s()),C){var S=x.Close,w=x.Open,D=x.High,b=x.Low;if(S||!P0r1k.B9k(S,0)){if(w=w||P0r1k.H9k(w,0)?w:S,D=D||P0r1k.n9k(D,0)?D:S,b=b||P0r1k.A9k(b,0)?b:S,!d&&P0r1k.T8k(d,0)){var T=P0r1k.d8k(Math.floor(w/i),i);d=isNaN(T)?w:T,s(),a(C,w)}if(y&&a(x,w),P0r1k.Q8k(D-w,w-b)?(D&&a(x,D),b&&a(x,b)):(b&&a(x,b),D&&a(x,D)),a(x,S),P0r1k.V8k(y,e.length-1)&&P0r1k.X8k(S,g)){var M=f;f=m+i,m=P0r1k.q8k(M,i),n(S)}}}}}return p},e.calculatePointFigure=function(t,i,r,n){function a(t,e){if(396686342!==P0r1k.L6v.J6v(0,4490393)&&995079869!==P0r1k.L6v.J6v(11,3990802)&&650196683!==P0r1k.L6v.J6v(0,2104257))return console.log("createTickXAxisWithDates: Assertion error. msPerGridLine < 1"),chart.scroll--,context.lineTo(Math.floor(xbase),previousOpen),context.lineTo(flr_xbase+whitespace,h),y8s===V8s;for(var i in t)!e[i]&&P0r1k.L8k(e[i],0)&&(e[i]=t[i]);return e}function s(t,e,i,r,n){t.High=Math.max(e,t.High),t.Low=Math.min(i,t.Low),t.Close=r,t.Volume+=n}function o(t,e,i,r,n,a,s,o,l){return{DT:t.DT,Date:t.Date,pfOpen:o,pfClose:l,Open:e,Close:n,High:i,Low:r,Volume:a,iqPrevClose:s}}if(!i.length)return i;n||(n=[]);var l=t.chart.state.aggregation;l||(l=t.chart.state.aggregation={});for(var h=-1314432439,u=2,c=1;1954056141!==P0r1k.L6v.I6v(c.toString(),c.toString().length,9158302);c++)u+=2;if(P0r1k.L6v.I6v(u.toString(),u.toString().length,5519947)!==h)return this.plotYAxisGrid(panel),G8k<b8k;var p=t.layout;t.chart.defaultChartStyleConfig.box=1,t.chart.defaultChartStyleConfig.reversal=3,r||(r={});var d=r.box;if(!d){p.pandf&&P0r1k.J8k(p.pandf.box,null)&&(p.pandf.box=null,t.changeOccurred("layout")),d=t.chart.defaultChartStyleConfig.box;var f=i[P0r1k.i8k(i.length,1)].Close;f&&(d=P0r1k.c8k(f,.25)?.0625:P0r1k.p8k(f,1)?.125:P0r1k.P8k(f,5)?.25:P0r1k.m8k(f,20)?.5:P0r1k.S8k(f,100)?1:P0r1k.j8k(f,200)?2:P0r1k.t8k(f,500)?4:P0r1k.w8k(f,1e3)?5:P0r1k.r1v(f,25e3)?50:500),e.ChartEngine.isDailyInterval(p.interval)||(d/=10),e.Market.Symbology.isForexSymbol(t.chart.symbol)&&(f&&(P0r1k.k1v(f,1)?d=.001:P0r1k.h1v(f,2)?d=.002:P0r1k.y1v(f,50)?d=.02:P0r1k.Y1v(f,200)&&(d=.2)),e.ChartEngine.isDailyInterval(p.interval)&&(d*=10)),t.chart.defaultChartStyleConfig.box=d}d=parseFloat(d),(isNaN(d)||P0r1k.F1v(d,0))&&(p.pandf&&P0r1k.E1v(p.pandf.box,null)&&(p.pandf.box=null,t.changeOccurred("layout")),t.chart.defaultChartStyleConfig.box=d=1);var m=Math.ceil(parseFloat(r.reversal));P0r1k.e1v(m,0)&&P0r1k.u1v(m,r.reversal)?(p.pandf.reversal=m,t.changeOccurred("layout")):(isNaN(m)||P0r1k.U1v(m,0))&&(p.pandf&&P0r1k.s1v(p.pandf.reversal,null)&&(p.pandf.reversal=null,t.changeOccurred("layout")),m=t.chart.defaultChartStyleConfig.reversal),l.box=d,m*=d;for(var g,v,y,x=1e-8,C=(d.toString()+".").split(".")[1].length,S=[],w=0,D=0;P0r1k.W1v(D,i.length);D++)if(v=i[D]){w+=v.Volume;var b,T,M=v.Close,k=v.Open,A=v.High,P=v.Low;k=k||P0r1k.b1v(k,0)?k:M,A=A||P0r1k.v1v(A,0)?A:M,P=P||P0r1k.C1v(P,0)?P:M,S.length||n.length?(y=S[P0r1k.o7v(S.length,1)],y||(y=e.clone(n[P0r1k.Z7v(n.length,1)])),P0r1k.R7v(y.pfTrend,"O")?(P0r1k.O7v(P,y.pfClose-d)?(y.pfClose=Number(P0r1k.x7v(Math.ceil(P/d-x),d).toFixed(C)),P0r1k.z7v(y.pfStepBack,"O")&&(y.pfStepBack=null),s(y,A,P,M,w)):P0r1k.I7v(A,y.pfClose+m)?(b=y.pfClose+d,T=Number(P0r1k.l7v(Math.floor(A/d+x),d).toFixed(C)),g=o(v,k,A,P,M,w,y.pfClose,b,T),P0r1k.M7v(b,T)&&(g.pfStepBack="X"),P0r1k.g7v(y.pfStepBack,"O")?(y.pfOpen=b,y.pfClose=T,y.pfTrend="X",s(y,A,P,M,w)):(g=a(v,g),g.pfTrend="X",S.push(g))):s(y,A,P,M,w),w=0):P0r1k.a7v(y.pfTrend,"X")&&(P0r1k.G7v(A,y.pfClose+d)?(y.pfClose=Number(P0r1k.N7v(Math.floor(A/d+x),d).toFixed(C)),(P0r1k.B7v(y.pfStepBack,"X")||P0r1k.H7v(y.pfStepBack,"-"))&&(y.pfStepBack=null),s(y,A,P,M,w)):P0r1k.n7v(P,y.pfClose-m)?(b=P0r1k.A7v(y.pfClose,d),T=Number(P0r1k.T6v(Math.ceil(P/d-x),d).toFixed(C)),g=o(v,k,A,P,M,w,y.pfClose,b,T),P0r1k.d6v(b,T)&&(g.pfStepBack="O"),P0r1k.Q6v(y.pfStepBack,"X")||P0r1k.V6v(y.pfStepBack,"-")?(y.pfOpen=b,y.pfClose=T,y.pfTrend="O",s(y,A,P,M,w),P0r1k.X6v(b,T)&&P0r1k.q6v(y.pfStepBack,"-")&&(y.pfStepBack=null)):(g=a(v,g),g.pfTrend="O",S.push(g))):s(y,A,P,M,w),w=0)):(g=a(v,o(v,k,A,P,M,w,A+d,Number(P0r1k.f1v(Math.ceil(P/d-x),d).toFixed(C)),Number(P0r1k.K1v(Math.floor(A/d+x),d).toFixed(C)))),g.pfTrend="X",P0r1k.D7v(g.pfOpen,g.pfClose)&&(g.pfStepBack="-"),S.push(g),w=0)}return S},t}};return _exports=_exports||{},__polyfills_(_exports),__utility_(_exports),__timezone_(_exports),__core_(_exports,_exports),__market_(_exports),__engine_(_exports,_exports,_exports,_exports),__microkernel_(_exports),__span_(_exports),__quoteFeed_(_exports),__studies_(_exports),__drawing_(_exports),__i18n_(_exports),__customCharts_(_exports),__markers_(_exports),__aggregations_(_exports),__drawingAdvanced_(_exports),__equations_(_exports),__renderersAdvanced_(_exports),__studiesAdvanced_(_exports),__share_(_exports),_exports});